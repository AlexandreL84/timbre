import{a as At,b as X}from"./chunk-6LZF5SW5.js";import{a as ye,b as Ve,c as Ue,d as pe,e as qt,f as lt,g as mt,h as Ft,i as ke,j as st,k as Ji}from"./chunk-TEVUBSSK.js";import{e as Ut}from"./chunk-WDH6RHXI.js";import{c as rt,d as ce,e as qi,g as ot}from"./chunk-XKNZR5IX.js";import{l as I,m as fe,n as Ae,u as we,v as di,w as bi}from"./chunk-FG7OFSHW.js";import{a as Rt}from"./chunk-XQP67XMC.js";import{$ as Ye,Aa as b,Ab as De,Ac as Ot,Ba as Et,Bb as Re,Bc as Nt,Ca as y,Cb as he,Cc as vi,D as vt,Db as Ce,Dc as yi,Ea as ci,Eb as fi,Ec as Mi,Fa as V,Fb as wt,Fc as Si,Ga as k,Gb as Ke,Gc as Bi,H as be,Ha as H,Hc as Ei,I as yt,Ic as Ii,Jb as re,Jc as Ai,K as L,Kb as Oe,Kc as wi,La as bt,Lb as Ne,Lc as Di,M as $,Mb as oe,Mc as Ri,N as Mt,Na as f,Nb as Le,Nc as Oi,Oa as g,Ob as Ze,Oc as Ni,P as St,Pa as J,Pb as Je,Pc as Li,Qb as Xe,Qc as Xt,Rb as et,Rc as Ui,S as x,Sb as tt,Sc as ve,T as v,Tb as it,Tc as Lt,Ub as Dt,Vb as gi,Wb as le,Xa as te,Xb as _i,Ya as ie,Yb as Ti,Za as j,aa as Bt,ab as P,ba as l,bb as It,c as N,ca as S,ha as _,ia as a,ic as nt,jc as me,k as de,kc as hi,l as K,ma as s,mc as xe,na as c,nb as pi,oa as M,ob as u,oc as se,pa as w,pb as z,qa as D,sa as R,ta as B,tc as Ci,ua as p,ub as ge,uc as ae,va as ai,vb as _e,wa as $e,wb as ui,x as C,xa as je,xb as ne,xc as xi,ya as Pe,yb as Qe,za as q,zb as Te}from"./chunk-MY6LMDNH.js";import{f as Zi,g as E}from"./chunk-GOLCFQAC.js";var ee=(r=>(r.TIMBRE="TIMBRE",r.BLOC="BLOC",r.CARNET="CARNET",r.COLLECTOR="COLLECTOR",r))(ee||{});var G=class extends fe{annees;acquis;doublon;idBloc;type;user;sort;getAnnees(){return this.annees}setAnnees(t){this.annees=t}getAcquis(){return this.acquis}setAcquis(t){this.acquis=t}getDoublon(){return this.doublon}setDoublon(t){this.doublon=t}getIdBloc(){return this.idBloc}setIdBloc(t){this.idBloc=t}getUser(){return this.user}setUser(t){this.user=t}getType(){return this.type}setType(t){this.type=t}getSort(){return this.sort}setSort(t){this.sort=t}initCritere(){this.setType(["TIMBRE","CARNET","BLOC"])}initCritereBloc(){this.setType(["CARNET","BLOC"])}};E([I("Ann\xE9e")],G.prototype,"annees",2),E([I("Acquis")],G.prototype,"acquis",2),E([I("Doublon")],G.prototype,"doublon",2),E([I("Ident bloc")],G.prototype,"idBloc",2),E([I("Type")],G.prototype,"type",2),E([I("User")],G.prototype,"user",2);var Z=class extends fe{idUser;idTimbre;acquis;doublon;constructor(t,e,i,r){super(),this.idUser=t||null,this.idTimbre=e||null,this.acquis=i||!1,this.doublon=r||!1}getIdUser(){return this.idUser}setIdUser(t){this.idUser=t}getIdTimbre(){return this.idTimbre}setIdTimbre(t){this.idTimbre=t}isAcquis(){return this.acquis}setAcquis(t){this.acquis=t}isDoublon(){return this.doublon}setDoublon(t){this.doublon=t}};E([I("Identifiant Utilisateur")],Z.prototype,"idUser",2),E([I("Identifiant timbre")],Z.prototype,"idTimbre",2),E([I("Acquis")],Z.prototype,"acquis",2),E([I("Doublon")],Z.prototype,"doublon",2);var ft=class{key;dossier;maxWidth;maxHeight;getKey(){return this.key}setKey(t){this.key=t}getDossier(){return this.dossier}setDossier(t){this.dossier=t}getMaxWidth(){return this.maxWidth}setMaxWidth(t){this.maxWidth=t}getMaxHeight(){return this.maxHeight}setMaxHeight(t){this.maxHeight=t}};var qe=class{dossier;nom;alignLabel;detail;file;getDossier(){return this.dossier}setDossier(t){this.dossier=t}getNom(){return this.nom}setNom(t){this.nom=t}getAlignLabel(){return this.alignLabel}setAlignLabel(t){this.alignLabel=t}getDetail(){return this.detail}setDetail(t){this.detail=t}getFile(){return this.file}setFile(t){this.file=t}};var F=class n{constructor(t,e){this.authService=t;this.firestore=e;this.timbreCritereModel.initCritere(),this.timbreCritereModel.setAcquis("NON"),this.timbreCritereBlocModel.initCritereBloc(),this.timbreCritereBlocModel.setAcquis("NON")}reinitResume$=new N(!0);timbreCritereModel=new G;timbreCritereBlocModel=new G;initUpload(){let t=new qe;t.setDossier("table"),t.setNom(new Date().getTime()?.toString());let e=new ft;e.setMaxWidth(100),e.setMaxHeight(100),e.setDossier("autre");let i=new ft;return i.setMaxWidth(700),i.setMaxHeight(700),i.setDossier("zoom"),t.setDetail([e,i]),t}getAnneesAsync(t){return this.firestore.collection(t,e=>{let i=e;return i=i.orderBy("annee","desc"),i}).valueChanges().pipe(de(e=>{let i=e.map(r=>Number(r.annee)).filter(r=>u(r)&&r!=0);return Array.from(new Set(i))}))}getTimbresByCritereAsync(t){return this.getAllTimbres(t).pipe(de(e=>this.constructTimbres(e,null,null)))}getAllTimbres(t){return this.firestore.collection("/timbres",e=>{let i=e;return u(t)&&(u(t.getAnnees())&&t.getAnnees()?.length>0&&(i=i.where("annee","in",t.getAnnees())),t?.getType()?.length==0||t?.getType()?.length==1&&t?.getType()?.find(r=>r=="TIMBRE")?i=i.where("idBloc","==",null):t?.getType()?.length>0&&!t?.getType()?.find(r=>r=="TIMBRE")?i=i.where("idBloc","!=",null):u(t.getIdBloc())&&(i=i.where("idBloc","==",t.getIdBloc()))),i=i.orderBy("id","asc"),i}).valueChanges()}constructTimbres(t,e,i,r){let o=[];return t?.length>0&&t.forEach(m=>{let d=this.constructTimbre(m,e,i),T=!1;u(r)?((r?.getType()?.find(h=>h=="TIMBRE")&&z(d?.getTimbreBlocModel())||r?.getType()?.find(h=>h=="BLOC")&&u(d?.getTimbreBlocModel())&&d?.getTimbreBlocModel()?.getType()=="BLOC"||r?.getType()?.find(h=>h=="CARNET")&&u(d?.getTimbreBlocModel())&&d?.getTimbreBlocModel()?.getType()=="CARNET")&&(T=!0),u(d.getTimbreAcquisModel())&&(u(r.getAcquis())&&!(r.getAcquis()=="TOUS"||r.getAcquis()=="OUI"&&d.getTimbreAcquisModel().isAcquis()||r.getAcquis()=="NON"&&!d.getTimbreAcquisModel().isAcquis())&&(T=!1),u(r.getDoublon())&&!(r.getDoublon()=="TOUS"||r.getDoublon()=="OUI"&&d.getTimbreAcquisModel().isDoublon()||r.getDoublon()=="NON"&&!d.getTimbreAcquisModel().isDoublon())&&(T=!1))):T=!0,T==!0&&o.push(d)}),o}constructTimbre(t,e,i){let r=Ae(ye,t);if(u(i)){let o=i.find(m=>m.getId()==r?.getIdBloc());u(o)&&r.setTimbreBlocModel(o)}if(u(e)){let o=e.find(m=>m.idTimbre==r.getId());u(o)?r.setTimbreAcquisModel(Ae(Z,o)):r.setTimbreAcquisModel(new Z)}return r}supprimerTimbreAcquis(t){this.firestore.collection("/timbres_acquis").ref.where("idTimbre","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.delete()})})}supprimerTimbre(t){this.firestore.collection("/timbres").ref.where("id","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.delete()})}).catch(e=>{console.error("Erreur de suppression :",e)})}acquis(t,e,i){this.authService.userSelect$.pipe(C(r=>u(r))).subscribe(r=>{this.firestore.collection("/timbres_acquis").ref.where("idTimbre","==",t.getId()).where("idUser","==",r.getId()).get().then(o=>{o?.size==0&&this.addAcquis(r.getId(),t,e),o.forEach(m=>{let d=Ae(Z,m.data());e?(d.setAcquis(!0),d.setDoublon(i||!d.isDoublon())):(d.setAcquis(i||!d.isAcquis()),d.isAcquis()||d.setDoublon(!1)),m.ref.update(Object.assign(new Object,d)).then(T=>{t.setTimbreAcquisModel(d)}).catch(T=>{console.error("Erreur de mise \xE0 jour:",T)})})}).catch(o=>{console.error("Erreur de mise \xE0 jour id introuvable :",o)}),this.reinitResume$.next(!0)})}supprimerAcquisTimbreByUser(t,e,i,r){this.firestore.collection("/timbres_acquis").ref.where("idTimbre","==",e.getId()).where("idUser","==",t).get().then(o=>{o?.size==0&&r&&this.addAcquis(t,e,i),o.forEach(m=>{m.ref.delete().then(d=>{r&&this.supprimerTimbreAcquis(e)})})}).catch(o=>{console.error("Erreur de suppression :",o)})}addAcquis(t,e,i){let r=new Z;r.setIdUser(t),r.setIdTimbre(e.getId()),r.setAcquis(!0),r.setDoublon(i),e.setTimbreAcquisModel(r),this.firestore.collection("/timbres_acquis").add(Object.assign(new Object,r))}static \u0275fac=function(e){return new(e||n)(L(X),L(we))};static \u0275prov=be({token:n,factory:n.\u0275fac})};var ue=class extends fe{idUser;idBloc;acquis;doublon;constructor(t,e,i,r){super(),this.idUser=t||null,this.idBloc=e||null,this.acquis=i||!1,this.doublon=r||!1}getIdUser(){return this.idUser}setIdUser(t){this.idUser=t}getIdBloc(){return this.idBloc}setIdBloc(t){this.idBloc=t}isAcquis(){return this.acquis}setAcquis(t){this.acquis=t}isDoublon(){return this.doublon}setDoublon(t){this.doublon=t}};E([I("Identifiant Utilisateur")],ue.prototype,"idUser",2),E([I("Identifiant bloc")],ue.prototype,"idBloc",2),E([I("Acquis")],ue.prototype,"acquis",2),E([I("Doublon")],ue.prototype,"doublon",2);var ct=class n{transform(t,e){let i=[],r=Object.keys(t),o=Object.values(t);for(let m=0;m<r.length;m++)i.push({key:r[m],value:o[m]});return e=="sort"?i?.sort(function(m,d){return m.key<d.key?-1:m.key>d.key?1:0}):i}static \u0275fac=function(e){return new(e||n)};static \u0275pipe=St({name:"enumToArray",type:n,pure:!0})};var pt=class n{transform(t,e){return u(t)&&typeof t=="string"?(t=t.toLowerCase(),t.charAt(0).toUpperCase()+t.slice(1)):t}static \u0275fac=function(e){return new(e||n)};static \u0275pipe=St({name:"capitalize",type:n,pure:!0})};var on=["canvas"];function ln(n,t){n&1&&M(0,"lib-spinner",5),n&2&&a("textSpec","Chargement en cours ...")}function mn(n,t){if(n&1&&(M(0,"mat-error",23),f(1,"async")),n&2){let e=p(2);a("innerHTML",g(1,1,e.messageError$),Ye)}}function sn(n,t){if(n&1&&(s(0,"mat-option",25),b(1),f(2,"capitalize"),c()),n&2){let e=p().$implicit;a("value",e.value),l(),y(" ",g(2,2,e.value)," ")}}function an(n,t){if(n&1&&(w(0),_(1,sn,3,4,"mat-option",24),D()),n&2){let e=t.$implicit,i=p(2);l(),a("ngIf",e.value!=i.TypeTimbreEnum.TIMBRE)}}function cn(n,t){if(n&1){let e=R();s(0,"form",6,1),B("ngSubmit",function(){x(e);let r=q(1),o=p();return v(o.valider(r))}),s(2,"div",7),_(3,mn,2,3,"mat-error",8),f(4,"async"),s(5,"div",9)(6,"div",10)(7,"label"),M(8,"lib-libelle-model",11),c(),s(9,"input",12),H("ngModelChange",function(r){x(e);let o=p();return k(o.timbreBlocModel.annee,r)||(o.timbreBlocModel.annee=r),v(r)}),c()(),s(10,"div",13)(11,"label"),M(12,"lib-libelle-model",11),c(),s(13,"mat-select",14),H("ngModelChange",function(r){x(e);let o=p();return k(o.timbreBlocModel.type,r)||(o.timbreBlocModel.type=r),v(r)}),_(14,an,2,1,"ng-container",15),f(15,"enumToArray"),c()()(),s(16,"div",10)(17,"label"),M(18,"lib-libelle-model",11),c(),s(19,"input",16),H("ngModelChange",function(r){x(e);let o=p();return k(o.timbreBlocModel.monnaie,r)||(o.timbreBlocModel.monnaie=r),v(r)}),c()(),s(20,"div",9)(21,"div",10)(22,"label"),M(23,"lib-libelle-model",11),c(),s(24,"input",17),H("ngModelChange",function(r){x(e);let o=p();return k(o.timbreBlocModel.yt,r)||(o.timbreBlocModel.yt=r),v(r)}),c()(),M(25,"div",18),c(),s(26,"lib-upload",19),B("outPutObject",function(r){x(e);let o=p();return v(o.timbreBlocModel=r)}),c()(),s(27,"div",20)(28,"button",21),B("click",function(){x(e);let r=p();return v(r.close())}),b(29," Annuler "),c(),s(30,"button",22),b(31," Enregistrer "),c()()()}if(n&2){let e=q(1),i=p();a("ngClass",e!=null&&e.submitted?"red-color":"blue-color"),l(3),a("ngIf",g(4,23,i.messageError$)),l(5),a("object",i.timbreBlocModel)("key","annee"),l(),V("ngModel",i.timbreBlocModel.annee),a("max",i.maxAnnee)("zMax",i.maxAnnee),l(3),a("object",i.timbreBlocModel)("key","type"),l(),V("ngModel",i.timbreBlocModel.type),a("placeholder","Type"),l(),a("ngForOf",g(15,25,i.TypeTimbreEnum)),l(4),a("object",i.timbreBlocModel)("key","monnaie"),l(),V("ngModel",i.timbreBlocModel.monnaie),l(4),a("object",i.timbreBlocModel)("key","yt"),l(),V("ngModel",i.timbreBlocModel.yt),l(2),a("object",i.timbreBlocModel)("key","image")("zoom",i.timbreBlocModel.getImageZoom())("maxWidth",i.DimensionImageEnum.WIDTH_TIMBRE)("maxHeight",i.DimensionImageEnum.HEIGTH_TIMBRE)}}var ut=class n{constructor(t,e,i,r,o){this.httpResponseHandlerService=t;this.dialogRef=e;this.utilsService=i;this.timbreBlocService=r;this.timbreUtilsService=o}canvas;messageError$=new N(null);load$=new N(null);id;maxAnnee=new Date().getFullYear()+1;timbreBlocModel=new Ue;fileUploadModel=new qe;DimensionImageEnum=Ve;TypeTimbreEnum=ee;ngOnInit(){this.fileUploadModel=this.timbreUtilsService.initUpload(),this.load$.next(!1),u(this.id)?this.timbreBlocService.getBlocByIdAsync(this.id).subscribe(t=>{this.timbreBlocModel=t,this.load$.next(!0)}):(this.timbreBlocModel.setAnnee(new Date().getFullYear()),this.timbreBlocModel.setMonnaie("E"),this.load$.next(!0))}valider(t){if(this.messageError$.next(null),t?.valid)if(u(this.timbreBlocModel.getImage()))this.saveData();else{this.messageError$.next("Veuillez s\xE9lectionner une image");return}}saveData(){this.load$.next(!1),u(this.timbreBlocModel.getId())?this.save():this.ajouter()}ajouter(){this.utilsService.getMaxIdentAsync("/timbres_bloc").pipe(C()).subscribe(t=>{this.timbreBlocModel.setId(t),this.save(!0)})}save(t){try{K([this.timbreBlocService.upload(this.timbreBlocModel,"autre"),this.timbreBlocService.upload(this.timbreBlocModel,"table"),this.timbreBlocService.upload(this.timbreBlocModel,"zoom")]).pipe(C(([e,i,r])=>u(e)&&u(r)&&u(i))).subscribe(([e,i,r])=>{u(e)&&e!="nok"&&this.timbreBlocModel.setImage(e),u(i)&&i!="nok"&&this.timbreBlocModel.setImageTable(i),u(r)&&r!="nok"&&this.timbreBlocModel.setImageZoom(r),t?this.timbreBlocService.ajouter(this.timbreBlocModel,!0):this.timbreBlocService.modifier(this.timbreBlocModel),this.httpResponseHandlerService.showNotificationSuccess("Transaction termin\xE9e","Votre timbre a bien \xE9t\xE9 modifi\xE9e."),this.load$.next(!0),this.dialogRef.close()})}catch{this.httpResponseHandlerService.showNotificationError("Transaction non aboutie","Votre timbre n'a pas pu \xEAtre modifi\xE9."),this.load$.next(!0)}}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||n)(S(Ut),S(xe),S(pe),S(Y),S(F))};static \u0275cmp=$({type:n,selectors:[["app-timbre-modifier-bloc"]],viewQuery:function(e,i){if(e&1&&$e(on,5),e&2){let r;je(r=Pe())&&(i.canvas=r.first)}},decls:10,vars:6,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],[3,"ngIf","ngIfElse"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","space-between stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","column","fxLayoutGap","20px",1,"bloc-modal"],[3,"innerHTML",4,"ngIf"],["fxLayout","row","fxLayout.lt-lg","column","fxLayoutGap","30px","fxLayoutGap.lt-lg","5px"],["fxLayout","column",1,"form-input"],[3,"object","key"],["name","page","type","number","minlength","4","maxlength","4","min","1900","zMin","1900","required","","zControl","",1,"annee",2,"width","60px !important",3,"ngModelChange","ngModel","max","zMax"],[1,"form-input","select"],["name","type",1,"scrollBarAccent",2,"width","100px",3,"ngModelChange","ngModel","placeholder"],[4,"ngFor","ngForOf"],["name","monnaie","type","text","trim","","minlength","1","maxlength","2","required","","zControl","",2,"width","25px !important",3,"ngModelChange","ngModel"],["name","yt","type","text","trim","","zControl","",3,"ngModelChange","ngModel"],["fxHide.lt-lg","","fxLayout","column",1,"form-input"],[3,"outPutObject","object","key","zoom","maxWidth","maxHeight"],["fxLayout","row","fxLayoutGap","10px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"],[3,"innerHTML"],["class","selectMin",3,"value",4,"ngIf"],[1,"selectMin",3,"value"]],template:function(e,i){if(e&1&&(s(0,"div",2)(1,"div",3)(2,"span"),b(3),c(),s(4,"span"),b(5),c()(),_(6,ln,1,1,"ng-template",4),f(7,"async"),_(8,cn,32,27,"ng-template",null,0,J),c()),e&2){let r=q(9);l(3),y("",i.timbreBlocModel!=null&&i.timbreBlocModel.getId()?"MODIFICATION":"AJOUT"," BLOC "),l(2),Et(i.timbreBlocModel==null?null:i.timbreBlocModel.getId()),l(),a("ngIf",g(7,4,i.load$)==!1)("ngIfElse",r)}},dependencies:[me,nt,ae,le,te,ie,j,Te,De,Ce,he,Re,Qe,ne,Le,Ke,Ze,re,Oe,et,tt,it,Xe,Je,oe,Ne,ot,ce,rt,qt,lt,mt,Ft,P,ct,pt],encapsulation:2})};var Ge=class extends fe{type;total;constructor(t,e){super(),this.type=t||null,this.total=e||null}getType(){return this.type}setType(t){this.type=t}getTotal(){return this.total}setTotal(t){this.total=t}};E([I("Type")],Ge.prototype,"type",2),E([I("Total")],Ge.prototype,"total",2);var Y=class n{constructor(t,e,i,r,o,m){this.firestore=t;this.authService=e;this.uploadService=i;this.utilsService=r;this.timbreUtilsService=o;this.dialog=m}total$=new N([]);timbresBlocModel$=new N(null);load$=new N(!1);upload(t,e,i){let r=100,o=100;return e=="table"?(r=r*(50/o),o=50):e=="zoom"&&(r=r*(700/o),o=700),this.uploadService.processAndUploadImage(t?.getImage(),r,o,"bloc-"+t.getId(),this.getDossier(t,e,i))}setTotal(t,e){this.total$.pipe(C()).subscribe(i=>{let r=i.find(o=>o.getType()==t?.getType());u(r)?r.setTotal(r.getTotal()+1):i.push(new Ge(t?.getType(),1)),this.total$.next(i)})}getTotal(t){this.total$.next(null),this.getAllBlocs(t).subscribe(e=>{let i=[];Object.keys(ee).forEach(r=>{r!="TIMBRE"&&i.push(new Ge(r,e?.filter(o=>o.type==r)?.length))}),this.total$.next(i)})}getBloc(t){return this.firestore.collection("/timbres_bloc",e=>e.where("id","==",t)).valueChanges()}getBlocByIdAsync(t){return this.getBloc(t).pipe(de(e=>Ae(Ue,e[0])))}getRef(t,e){let i=t;return u(e)&&(u(e.getAnnees())&&e.getAnnees()?.length>0&&(i=i.where("annee","in",e.getAnnees())),u(e.getType())&&e.getType()?.length>0&&(i=i.where("type","in",e.getType()))),i=i.orderBy("id",e?.getSort()=="desc"?"desc":"asc"),i}getAllBlocs(t){return this.firestore.collection("/timbres_bloc",e=>this.getRef(e,t)).valueChanges()}getTimbreBlocAcquis(){return this.authService.userSelect$.pipe(C(t=>u(t)),vt(t=>u(t)?this.getTimbreBlocAcquisByUser(t.getId()).pipe(C(),de(e=>e)):null))}getTimbreBlocAcquisByUser(t){return this.firestore.collection("/timbres_bloc_acquis",e=>e.where("idUser","==",t)).valueChanges()}getBlocs(t,e){this.load$.next(!1),this.timbresBlocModel$.next(null),e&&this.getTotal(),K([this.getAllBlocs(t),this.getTimbreBlocAcquis()]).pipe(C()).subscribe(([i,r])=>{this.timbresBlocModel$.next(this.constructBlocs(i,r,t)),this.load$.next(!0)})}getBlocsAsync(t){return this.timbresBlocModel$.next(null),this.getAllBlocs(t).pipe(C(),de(e=>this.constructBlocs(e,null,t)))}constructBloc(t,e){let i=Ae(Ue,t);if(u(e)){let r=e.find(o=>o.idBloc==i.getId());u(r)?i.setTimbreBlocAcquisModel(Ae(ue,r)):i.setTimbreBlocAcquisModel(new ue)}return i}constructBlocs(t,e,i){let r=[];return t?.length>0&&t.forEach(o=>{let m=this.constructBloc(o,e);this.getTimbresByBlocAsync(m.getId()).subscribe(T=>{m.setNbTimbres(T?.length)});let d=!0;u(i)?u(m.getTimbreBlocAcquisModel())&&(u(i.getAcquis())&&!(i.getAcquis()=="TOUS"||i.getAcquis()=="OUI"&&m.getTimbreBlocAcquisModel().isAcquis()||i.getAcquis()=="NON"&&!m.getTimbreBlocAcquisModel().isAcquis())&&(d=!1),u(i.getDoublon())&&!(i.getDoublon()=="TOUS"||i.getDoublon()=="OUI"&&m.getTimbreBlocAcquisModel().isDoublon()||i.getDoublon()=="NON"&&!m.getTimbreBlocAcquisModel().isDoublon())&&(d=!1)):d=!0,d==!0&&r.push(m)}),r}acquis(t,e){return this.authService.userSelect$.pipe(C(i=>u(i))).subscribe(i=>{u(t?.getTimbreBlocAcquisModel()?.getIdUser())?this.firestore.collection("/timbres_bloc_acquis").ref.where("idBloc","==",t.getId()).where("idUser","==",i.getId()).get().then(r=>{r.forEach(o=>{let m=t.getTimbreBlocAcquisModel();e?(m.setAcquis(!0),m.setDoublon(!m.isDoublon())):(m.setAcquis(!m.isAcquis()),m.isAcquis()||m.setDoublon(!1)),o.ref.update(Object.assign(new Object,m)).then(d=>{t.setTimbreBlocAcquisModel(m)}).catch(d=>{console.error("Erreur de mise \xE0 jour:",d)})})}).catch(r=>{console.error("Erreur de mise \xE0 jour:",r)}):this.addAcquis(i?.getId(),t,e),this.timbreUtilsService.reinitResume$.next(!0)})}addAcquis(t,e,i){let r=new ue;r.setIdUser(t),r.setIdBloc(e.getId()),r.setAcquis(!0),r.setDoublon(i),e.setTimbreBlocAcquisModel(r),this.firestore.collection("/timbres_bloc_acquis").add(Object.assign(new Object,r))}ajouterSansId(t){this.utilsService.getMaxIdentAsync("/timbres_bloc").pipe(C()).subscribe(e=>{t.setId(e),this.ajouter(t,!0)})}ajouter(t,e){this.getBloc(t.getId()).pipe(C()).subscribe(i=>{z(i)||z(i[0])||u(i[0])&&i[0]?.length==0?(t.setTimbreBlocAcquisModel(null),t.setIdOrigine(null),this.firestore.collection("/timbres_bloc").add(Object.assign(new Object,t)).then(r=>{u(this.timbreUtilsService.timbreCritereBlocModel.getAnnees().find(o=>o==t.getAnnee()))&&this.timbresBlocModel$.pipe(C()).subscribe(o=>{o.push(t),this.setTotal(t,1)}),this.timbreUtilsService.reinitResume$.next(!0)}).catch(r=>{console.error("Erreur d'ajout :",r)})):console.error("bloc "+t.getId()+" d\xE9j\xE0 existant")})}isCarnet(t){this.authService.user$.pipe(C(e=>u(e))).subscribe(e=>{e?.getDroit()>=9?(t.getType()=="BLOC"?t.setType("CARNET"):t.getType()=="CARNET"?t.setType("COLLECTOR"):t.setType("BLOC"),this.modifier(t)):this.utilsService.droitInsuffisant()})}modifier(t){t.setTimbreBlocAcquisModel(null),this.firestore.collection("/timbres_bloc").ref.where("id","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.update(Object.assign(new Object,t)).then(r=>{this.timbresBlocModel$.pipe(C(o=>u(o)&&o?.length>0)).subscribe(o=>{let m=o.find(d=>d.getId()==t.getId());u(m)&&Object.assign(m,t)})}).catch(r=>{console.error("Erreur de mise \xE0 jour :",r)})})}).catch(e=>{console.error("Erreur de mise \xE0 jour id introuvable :",e)})}getTimbresByBlocAsync(t){let e=new G;return e.setIdBloc(t),this.timbreUtilsService.getTimbresByCritereAsync(e)}supprimer(t){this.getTimbresByBlocAsync(t.getId()).pipe(C()).subscribe(e=>{e.forEach(i=>{this.timbreUtilsService.supprimerTimbreAcquis(i),this.timbreUtilsService.supprimerTimbre(i)})}),this.firestore.collection("/timbres_bloc_acquis").ref.where("idBloc","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.delete()})}),this.firestore.collection("/timbres_bloc").ref.where("id","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.delete().then(r=>{this.timbresBlocModel$.pipe(C()).subscribe(o=>{let m=o.findIndex(d=>d.getId()==t.getId());m>=0&&(o.splice(m,1),this.setTotal(t,-1))})}).catch(r=>{console.error("Erreur de suppression :",r)})})}).catch(e=>{console.error("Erreur de suppression id introuvable :",e)}),this.timbreUtilsService.reinitResume$.next(!0)}getDossier(t,e,i){let r="timbre//"+t.getAnnee();return u(e)&&(r=r+"/"+e),r=r+"/bloc/"+(u(i)?i:t.getId()),r}getBouchon(){let t=new Ue;return t.setAnnee(new Date().getFullYear()),t.setMonnaie("E"),t}acquisDoublon(t,e){this.authService.user$.pipe(C(i=>u(i))).subscribe(i=>{i?.getDroit()>=9?t?.getType()=="CARNET"?this.acquisCarnetDialog(t,e):this.acquis(t,e):this.utilsService.droitInsuffisant()})}acquisCarnetDialog(t,e){let i="";t?.getTimbreBlocAcquisModel()?.isDoublon()&&e?i="enlever les doublons":t?.getTimbreBlocAcquisModel()?.isAcquis()?i="enlever les acquis":i="mettre en "+(e?"doublon":"acquis")+" tous";let r=this.dialog.open(ke,{maxHeight:"95vh",data:{titre:"Confirmation",message:"Souhaitez-vous <b>"+i+"</b> les timbres du carnet ?",btnDroite:"Oui",btnGauche:"Non"}});r.afterClosed().subscribe(()=>{r.componentInstance.data.resultat==="valider"&&this.authService.userSelect$.pipe(C(o=>u(o))).subscribe(o=>{this.getTimbresByBlocAsync(t.getId()).pipe(C()).subscribe(m=>{m.forEach(d=>{this.timbreUtilsService.acquis(d,e,!t?.getTimbreBlocAcquisModel()?.isAcquis())})}),this.acquis(t,e)})})}modifierDialog(t){let e=this.dialog.open(ut,{height:"75vh",maxHeight:"750px",width:"30%"});e.componentInstance.id=t.getId(),e.afterClosed().subscribe(()=>{e.close()})}supprimerDialog(t){this.getTimbresByBlocAsync(t.getId()).pipe(C()).subscribe(e=>{let i="";u(e)&&e?.length>0&&(i="<span class='warn'>Attention <b>"+e.length+"</b> timbre",e?.length>1?i+="s sont reli\xE9s":i+=" est reli\xE9",i+=" \xE0 ce bloc.</span></br></br>"),i+="Souhaitez-vous supprimer le bloc <b>n\xB0 "+t?.getId()+"</b> ?";let r=this.dialog.open(ke,{maxHeight:"95vh",data:{titre:"Confirmation",message:i,btnDroite:"Oui",btnGauche:"Non"}});r.afterClosed().subscribe(()=>{r.componentInstance.data.resultat==="valider"&&this.supprimer(t)})})}modifAll(){let t=new G;this.getAllBlocs(t).pipe(C(e=>e?.length>0)).subscribe(e=>{e.forEach(i=>{i.carnet==!0?i.type="CARNET":i.type="BLOC",this.firestore.collection("/timbres_bloc").ref.where("id","==",i.id).get().then(r=>{r.forEach(o=>{o.ref.update(i)})})})})}static \u0275fac=function(e){return new(e||n)(L(we),L(X),L(st),L(pe),L(F),L(se))};static \u0275prov=be({token:n,factory:n.\u0275fac})};var pn=["canvas"];function un(n,t){if(n&1&&(s(0,"span",6)(1,"b"),b(2),c()()),n&2){let e=p();l(2),y("N\xB0",e.timbreModel==null?null:e.timbreModel.getId(),"")}}function dn(n,t){n&1&&M(0,"lib-spinner",7),n&2&&a("textSpec","Chargement en cours ...")}function bn(n,t){if(n&1&&(M(0,"mat-error",29),f(1,"async")),n&2){let e=p(2);a("innerHTML",g(1,1,e.messageError$),Ye)}}function fn(n,t){if(n&1&&(s(0,"mat-option",18),b(1),c()),n&2){let e=t.$implicit,i=p(2);a("value",e),l(),ci(" ",e.getAnnee()," - ",e.getId()," ",(e==null?null:e.getType())==i.TypeTimbreEnum.CARNET?" (carnet)":""," ")}}function gn(n,t){if(n&1){let e=R();s(0,"img",30),B("click",function(){let r;x(e);let o=p(2);return v(o.utilsService.zoom(o.timbreModel==null||(r=o.timbreModel.getTimbreBlocModel())==null?null:r.getImageZoom()))}),c()}if(n&2){let e,i=p(2);a("src",i.timbreModel==null||(e=i.timbreModel.getTimbreBlocModel())==null?null:e.getImage(),Bt)}}function _n(n,t){if(n&1){let e=R();s(0,"form",8,1),B("ngSubmit",function(){x(e);let r=q(1),o=p();return v(o.valider(r))}),s(2,"div",9),_(3,bn,2,3,"mat-error",10),f(4,"async"),s(5,"div",11)(6,"div",12)(7,"label"),M(8,"lib-libelle-model",13),c(),s(9,"input",14),H("ngModelChange",function(r){x(e);let o=p();return k(o.timbreModel.annee,r)||(o.timbreModel.annee=r),v(r)}),B("ngModelChange",function(r){x(e);let o=p();return v(o.changeAnnee(r))}),c()(),s(10,"div",15)(11,"label"),M(12,"lib-libelle-model",13),c(),s(13,"div",16)(14,"mat-select",17),f(15,"async"),B("ngModelChange",function(r){x(e);let o=p();return v(o.changeBloc(r))}),M(16,"mat-option",18),_(17,fn,2,4,"mat-option",19),f(18,"async"),c(),_(19,gn,1,1,"img",20),c()()(),s(20,"div",11)(21,"div",12)(22,"label"),M(23,"lib-libelle-model",13),c(),s(24,"input",21),H("ngModelChange",function(r){x(e);let o=p();return k(o.timbreModel.type,r)||(o.timbreModel.type=r),v(r)}),c()(),s(25,"div",12)(26,"label"),M(27,"lib-libelle-model",13),c(),s(28,"input",22),H("ngModelChange",function(r){x(e);let o=p();return k(o.timbreModel.monnaie,r)||(o.timbreModel.monnaie=r),v(r)}),c()()(),s(29,"div",11)(30,"div",12)(31,"label"),M(32,"lib-libelle-model",13),c(),s(33,"input",23),H("ngModelChange",function(r){x(e);let o=p();return k(o.timbreModel.yt,r)||(o.timbreModel.yt=r),v(r)}),c()(),M(34,"div",24),c(),s(35,"lib-upload",25),B("outPutObject",function(r){x(e);let o=p();return v(o.timbreModel=r)}),c()(),s(36,"div",26)(37,"button",27),B("click",function(){x(e);let r=p();return v(r.close())}),b(38," Annuler "),c(),s(39,"button",28),b(40," Enregistrer "),c()()()}if(n&2){let e,i,r=q(1),o=p();a("ngClass",r!=null&&r.submitted?"red-color":"blue-color"),l(3),a("ngIf",g(4,31,o.messageError$)),l(5),a("object",o.timbreModel)("key","annee"),l(),V("ngModel",o.timbreModel.annee),a("max",o.maxAnnee)("zMax",o.maxAnnee)("disabled",!!(o.timbreModel!=null&&o.timbreModel.getId())),l(3),a("object",o.timbreModel)("key","timbreBlocModel"),l(2),a("ngModel",o.timbreModel.getTimbreBlocModel())("placeholder","Choix bloc")("disabled",!!(o.timbreModel!=null&&o.timbreModel.getId())||((e=g(15,33,o.timbreBlocService.timbresBlocModel$))==null?null:e.length)<=0),l(2),a("value",null),l(),a("ngForOf",g(18,35,o.timbreBlocService.timbresBlocModel$)),l(2),a("ngIf",o.timbreModel==null||(i=o.timbreModel.getTimbreBlocModel())==null?null:i.getImage()),l(4),a("object",o.timbreModel)("key","type"),l(),V("ngModel",o.timbreModel.type),l(3),a("object",o.timbreModel)("key","monnaie"),l(),V("ngModel",o.timbreModel.monnaie),a("disabled",!!o.timbreModel.getTimbreBlocModel()),l(4),a("object",o.timbreModel)("key","yt"),l(),V("ngModel",o.timbreModel.yt),l(2),a("object",o.timbreModel)("key","image")("zoom",o.timbreModel.getImageZoom())("maxWidth",o.DimensionImageEnum.WIDTH_TIMBRE)("maxHeight",o.DimensionImageEnum.HEIGTH_TIMBRE)}}var dt=class n{constructor(t,e,i,r,o,m){this.httpResponseHandlerService=t;this.dialogRef=e;this.timbreService=i;this.timbreBlocService=r;this.timbreUtilsService=o;this.utilsService=m}canvas;messageError$=new N(null);load$=new N(null);id;maxAnnee=new Date().getFullYear();timbreModel=new ye;fileUploadModel=new qe;TypeTimbreEnum=ee;DimensionImageEnum=Ve;ngOnInit(){this.fileUploadModel=this.timbreUtilsService.initUpload(),this.load$.next(!1),u(this.id)?this.timbreService.getTimbreByIdAsync(this.id).subscribe(t=>{this.timbreModel=t,u(t.getTimbreBlocModel())&&(this.timbreModel.setAnnee(t.getTimbreBlocModel().getAnnee()),this.timbreModel.setMonnaie(t.getTimbreBlocModel().getMonnaie())),this.load$.next(!0)}):(this.timbreModel.setAnnee(new Date().getFullYear()),this.timbreModel.setMonnaie("E"),this.load$.next(!0)),this.changeAnnee(this.timbreModel.getAnnee())}valider(t){if(this.messageError$.next(null),t?.valid)if(u(this.timbreModel.getImage()))this.saveData();else{this.messageError$.next("Veuillez s\xE9lectionner une image");return}}saveData(){this.load$.next(!1),u(this.timbreModel.getId())?this.save():this.ajouter()}ajouter(){this.utilsService.getMaxIdentAsync("/timbres").pipe(C()).subscribe(t=>{this.timbreModel.setId(t),this.save(!0)})}save(t){try{K([this.timbreService.upload(this.timbreModel,"autre"),this.timbreService.upload(this.timbreModel,"table"),this.timbreService.upload(this.timbreModel,"zoom")]).pipe(C(([e,i,r])=>u(e)&&u(r)&&u(i))).subscribe(([e,i,r])=>{u(e)&&e!="nok"&&this.timbreModel.setImage(e),u(i)&&i!="nok"&&this.timbreModel.setImageTable(i),u(r)&&r!="nok"&&this.timbreModel.setImageZoom(r),t?this.timbreService.ajouter(this.timbreModel,!0):this.timbreService.modifier(this.timbreModel),this.httpResponseHandlerService.showNotificationSuccess("Transaction termin\xE9e","Votre timbre a bien \xE9t\xE9 modifi\xE9e."),this.load$.next(!0),this.dialogRef.close()})}catch{this.httpResponseHandlerService.showNotificationError("Transaction non aboutie","Votre timbre n'a pas pu \xEAtre modifi\xE9."),this.load$.next(!0)}}close(){this.dialogRef.close()}changeAnnee(t){if(this.timbreModel.setTimbreBlocModel(null),u(t)){let e=new G;e.initCritereBloc(),e.setAnnees([t]),e.setSort("desc"),this.timbreBlocService.getBlocs(e,!1)}}changeBloc(t){u(t)?(this.timbreModel.setIdBloc(t.getId()),this.timbreModel.setTimbreBlocModel(t),this.timbreModel.setMonnaie(t.getMonnaie()),this.timbreModel.setAnnee(t.getAnnee())):(this.timbreModel.setIdBloc(null),this.timbreModel.setTimbreBlocModel(null),this.timbreModel.setMonnaie("E"))}static \u0275fac=function(e){return new(e||n)(S(Ut),S(xe),S(Q),S(Y),S(F),S(pe))};static \u0275cmp=$({type:n,selectors:[["app-timbre-modifier"]],viewQuery:function(e,i){if(e&1&&$e(pn,5),e&2){let r;je(r=Pe())&&(i.canvas=r.first)}},decls:9,vars:6,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],["class","accent",4,"ngIf"],[3,"ngIf","ngIfElse"],[1,"accent"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","space-between stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","column","fxLayoutGap","20px",1,"bloc-modal"],[3,"innerHTML",4,"ngIf"],["fxLayout","row","fxLayout.lt-lg","column","fxLayoutGap","30px","fxLayoutGap.lt-lg","5px"],["fxLayout","column",1,"form-input"],[3,"object","key"],["name","page","type","number","minlength","4","maxlength","4","min","1900","zMin","1900","required","","zControl","",1,"annee",2,"width","60px !important",3,"ngModelChange","ngModel","max","zMax","disabled"],["fxLayout","column",1,"form-input","select"],["fxLayout","row","fxLayoutGap","15px"],["name","bloc",2,"width","180px !important",3,"ngModelChange","ngModel","placeholder","disabled"],[1,"selectMin",3,"value"],["class","selectMin",3,"value",4,"ngFor","ngForOf"],["style","max-height: 40px","class","click",3,"src","click",4,"ngIf"],["name","type","type","text","trim","","zControl","",3,"ngModelChange","ngModel"],["name","monnaie","type","text","trim","","minlength","1","maxlength","2","required","","zControl","",2,"width","25px !important",3,"ngModelChange","ngModel","disabled"],["name","yt","type","text","trim","","zControl","",3,"ngModelChange","ngModel"],["fxHide.lt-lg","","fxLayout","column",1,"form-input"],[3,"outPutObject","object","key","zoom","maxWidth","maxHeight"],["fxLayout","row","fxLayoutGap","10px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"],[3,"innerHTML"],[1,"click",2,"max-height","40px",3,"click","src"]],template:function(e,i){if(e&1&&(s(0,"div",2)(1,"div",3)(2,"span"),b(3),c(),_(4,un,3,1,"span",4),c(),_(5,dn,1,1,"ng-template",5),f(6,"async"),_(7,_n,41,37,"ng-template",null,0,J),c()),e&2){let r=q(8);l(3),y("",i.timbreModel!=null&&i.timbreModel.getId()?"MODIFICATION":"AJOUT"," "),l(),a("ngIf",i.timbreModel==null?null:i.timbreModel.getId()),l(),a("ngIf",g(6,4,i.load$)==!1)("ngIfElse",r)}},dependencies:[me,nt,ae,le,te,ie,j,Te,De,Ce,he,Re,Qe,ne,Le,Ke,Ze,re,Oe,et,tt,it,Xe,Je,oe,Ne,ce,ot,rt,qt,lt,mt,Ft,P],encapsulation:2})};var Q=class n{constructor(t,e,i,r,o,m,d){this.firestore=t;this.authService=e;this.timbreBlocService=i;this.uploadService=r;this.utilsService=o;this.timbreUtilsService=m;this.dialog=d}total$=new N(0);timbres$=new N(null);load$=new N(!1);getTimbre(t){return this.firestore.collection("/timbres",e=>e.where("id","==",t)).valueChanges()}getTimbreByIdAsync(t){return K([this.getTimbre(t),this.timbreBlocService.getBlocsAsync()]).pipe(de(([e,i])=>this.timbreUtilsService.constructTimbre(e[0],null,i)))}setTotal(t){this.total$.pipe(C()).subscribe(e=>{this.total$.next(e+t)})}getTotal(t){this.total$.next(null),this.timbreUtilsService.getAllTimbres(t).subscribe(e=>{this.total$.next(e?.length)})}getTimbres(t,e){e&&this.getTotal(),this.timbres$.next(null),this.load$.next(!1),K([this.timbreUtilsService.getAllTimbres(t),this.getTimbreAcquis(),this.timbreBlocService.getBlocsAsync(t)]).pipe(C()).subscribe(([i,r,o])=>{let m=this.timbreUtilsService.constructTimbres(i,r,o,t);m?.length>0&&(m=m.sort((d,T)=>d.getIdBloc()-T.getIdBloc()).sort((d,T)=>d?.getTimbreBlocModel()?.getNbTimbres()-T?.getTimbreBlocModel()?.getNbTimbres())),this.timbres$.next(m),this.load$.next(!0)})}getTimbreAcquis(){return this.authService.userSelect$.pipe(C(t=>u(t)),vt(t=>u(t)?this.getTimbreAcquisByUser(t.getId()).pipe(C(),de(e=>e)):null))}getTimbreAcquisByUser(t){return this.firestore.collection("/timbres_acquis",e=>e.where("idUser","==",t)).valueChanges()}ajouterSansId(t){this.utilsService.getMaxIdentAsync("/timbres").pipe(C()).subscribe(e=>{t.setId(e),u(t.getIdBloc())&&t.setMonnaie(null),this.ajouter(t,!0)})}ajouter(t,e){this.getTimbre(t.getId()).pipe(C()).subscribe(i=>{z(i)||z(i[0])||u(i[0])&&i[0]?.length==0?(t.setTimbreAcquisModel(null),t.setTimbreBlocModel(null),this.firestore.collection("/timbres").add(Object.assign(new Object,t)).then(r=>{e&&(u(this.timbreUtilsService.timbreCritereModel.getAnnees().find(o=>o==t.getAnnee()))&&this.timbres$.pipe(C()).subscribe(o=>{o.push(t),this.setTotal(1)}),this.timbreUtilsService.reinitResume$.next(!0))}).catch(r=>{console.error("Erreur d'ajout :",r)})):console.error("timbre "+t.getId()+" d\xE9j\xE0 existant")})}modifier(t){t.setTimbreBlocModel(null),t.setTimbreAcquisModel(null),this.firestore.collection("/timbres").ref.where("id","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.update(Object.assign(new Object,t)).then(r=>{this.timbres$.pipe(C(o=>u(o)&&o?.length>0)).subscribe(o=>{let m=o.find(d=>d.getId()==t.getId());u(m)&&Object.assign(m,t)})}).catch(r=>{console.error("Erreur de mise \xE0 jour :",r)})})}).catch(e=>{console.error("Erreur de mise \xE0 jour id introuvable :",e)})}supprimerTimbre(t){this.firestore.collection("/timbres").ref.where("id","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.delete().then(r=>{this.timbres$.pipe(C()).subscribe(o=>{let m=o.findIndex(d=>d.getId()==t.getId());m>=0&&(o.splice(m,1),this.setTotal(-1))})}).catch(r=>{console.error("Erreur de suppression :",r)})})}).catch(e=>{console.error("Erreur de suppression id introuvable :",e)})}supprimer(t){this.timbreUtilsService.supprimerTimbreAcquis(t),this.supprimerTimbre(t),this.timbreUtilsService.reinitResume$.next(!0)}getBouchon(){let t=new ye;return t.setAnnee(new Date().getFullYear()),t.setMonnaie("E"),t.setType(""),t.setYt(""),t}upload(t,e,i){let r=100,o=100;return e=="table"?(r=r*(50/o),o=50):e=="zoom"&&(r=r*(700/o),o=700),this.uploadService.processAndUploadImage(t?.getImage(),r,o,u(i)?i:t?.getId(),this.getDossier(t,e))}getDossier(t,e){let i="timbre//";return u(t.getIdBloc())?i=i+t.getTimbreBlocModel().getAnnee():i=i+t.getAnnee(),u(e)&&(i=i+"/"+e),u(t.getIdBloc())&&(i=i+"/bloc/"+t.getIdBloc()),i}acquisDoublon(t,e){this.authService.user$.pipe(C(i=>u(i))).subscribe(i=>{i?.getDroit()>=9?this.timbreUtilsService.acquis(t,e):this.utilsService.droitInsuffisant()})}modifierDialog(t){let e=this.dialog.open(dt,{height:"75vh",maxHeight:"750px",width:"30%"});e.componentInstance.id=t.getId(),e.afterClosed().subscribe(()=>{e.close()})}supprimerDialog(t){let e=this.dialog.open(ke,{maxHeight:"95vh",data:{titre:"Confirmation",message:"Souhaitez-vous supprimer le timbre <b>n\xB0 "+t?.getId()+"</b> ?",btnDroite:"Oui",btnGauche:"Non"}});e.afterClosed().subscribe(()=>{e.componentInstance.data.resultat==="valider"&&this.supprimer(t)})}static \u0275fac=function(e){return new(e||n)(L(we),L(X),L(Y),L(st),L(pe),L(F),L(se))};static \u0275prov=be({token:n,factory:n.\u0275fac})};var O=class extends fe{annee;total;nombre;acquis;doublon;nombreCarnet;nombreTimbresCarnet;acquisTimbresCarnet;doublonTimbresCarnet;nombreCollector;acquisCollector;doublonCollector;nombreTimbresCollector;acquisTimbresCollector;doublonTimbresCollector;nombreBloc;acquisBloc;doublonBloc;nombreTimbresBloc;acquisTimbresBloc;doublonTimbresBloc;constructor(t,e,i,r,o,m,d,T,h,U,A,ze,xt,ti,ii,ni,ri,oi,li,mi,si){super(),this.annee=t||null,this.total=e||0,this.nombre=i||0,this.acquis=r||0,this.doublon=o||0,this.nombreCarnet=m||0,this.nombreTimbresCarnet=d||0,this.acquisTimbresCarnet=T||0,this.doublonTimbresCarnet=h||0,this.nombreCollector=U||0,this.nombreCollector=U||0,this.acquisCollector=A||0,this.nombreTimbresCollector=xt||0,this.acquisTimbresCollector=ti||0,this.doublonTimbresCollector=ii||0,this.nombreBloc=ni||0,this.acquisBloc=ri||0,this.doublonBloc=oi||0,this.nombreTimbresBloc=li||0,this.acquisTimbresBloc=mi||0,this.doublonTimbresBloc=si||0}getAnnee(){return this.annee}setAnnee(t){this.annee=t}getTotal(){return this.total}setTotal(t){this.total=t}getNombre(){return this.nombre}setNombre(t){this.nombre=t}getAcquis(){return this.acquis}setAcquis(t){this.acquis=t}getDoublon(){return this.doublon}setDoublon(t){this.doublon=t}getNombreCarnet(){return this.nombreCarnet}setNombreCarnet(t){this.nombreCarnet=t}getNombreTimbresCarnet(){return this.nombreTimbresCarnet}setNombreTimbresCarnet(t){this.nombreTimbresCarnet=t}getAcquisTimbresCarnet(){return this.acquisTimbresCarnet}setAcquisTimbresCarnet(t){this.acquisTimbresCarnet=t}getDoublonTimbresCarnet(){return this.doublonTimbresCarnet}setDoublonTimbresCarnet(t){this.doublonTimbresCarnet=t}getNombreCollector(){return this.nombreCollector}setNombreCollector(t){this.nombreCollector=t}getAcquisCollector(){return this.acquisCollector}setAcquisCollector(t){this.acquisCollector=t}getDoublonCollector(){return this.doublonCollector}setDoublonCollector(t){this.doublonCollector=t}getNombreTimbresCollector(){return this.nombreTimbresCollector}setNombreTimbresCollector(t){this.nombreTimbresCollector=t}getAcquisTimbresCollector(){return this.acquisTimbresCollector}setAcquisTimbresCollector(t){this.acquisTimbresCollector=t}getDoublonTimbresCollector(){return this.doublonTimbresCollector}setDoublonTimbresCollector(t){this.doublonTimbresCollector=t}getNombreBloc(){return this.nombreBloc}setNombreBloc(t){this.nombreBloc=t}getAcquisBloc(){return this.acquisBloc}setAcquisBloc(t){this.acquisBloc=t}getDoublonBloc(){return this.doublonBloc}setDoublonBloc(t){this.doublonBloc=t}getNombreTimbresBloc(){return this.nombreTimbresBloc}setNombreTimbresBloc(t){this.nombreTimbresBloc=t}getAcquisTimbresBloc(){return this.acquisTimbresBloc}setAcquisTimbresBloc(t){this.acquisTimbresBloc=t}getDoublonTimbresBloc(){return this.doublonTimbresBloc}setDoublonTimbresBloc(t){this.doublonTimbresBloc=t}};E([I("Ann\xE9e")],O.prototype,"annee",2),E([I("Total")],O.prototype,"total",2),E([I("Nombre timbres")],O.prototype,"nombre",2),E([I("Total de timbres acquis")],O.prototype,"acquis",2),E([I("Total de timbres en doublon")],O.prototype,"doublon",2),E([I("Carnet")],O.prototype,"nombreCarnet",2),E([I("Timbres carnet")],O.prototype,"nombreTimbresCarnet",2),E([I("Total timbres carnet acquis")],O.prototype,"acquisTimbresCarnet",2),E([I("Total timbres carnet en doublon")],O.prototype,"doublonTimbresCarnet",2),E([I("Collector")],O.prototype,"nombreCollector",2),E([I("Total bloc collector")],O.prototype,"acquisCollector",2),E([I("Total bloc en collector")],O.prototype,"doublonCollector",2),E([I("Timbres collector")],O.prototype,"nombreTimbresCollector",2),E([I("Total timbres collector acquis")],O.prototype,"acquisTimbresCollector",2),E([I("Total timbres collector en doublon")],O.prototype,"doublonTimbresCollector",2),E([I("Collector")],O.prototype,"nombreBloc",2),E([I("Total bloc acquis")],O.prototype,"acquisBloc",2),E([I("Total bloc en doublon")],O.prototype,"doublonBloc",2),E([I("Timbres bloc")],O.prototype,"nombreTimbresBloc",2),E([I("Total timbres bloc acquis")],O.prototype,"acquisTimbresBloc",2),E([I("Total timbres bloc en doublon")],O.prototype,"doublonTimbresBloc",2);var kt=class n{constructor(t,e,i){this.timbreService=t;this.timbreBlocService=e;this.timbreUtilsService=i}load$=new N(!1);timbresResume$=new N(null);totalTimbreResume$=new N(null);getResume(t){this.load$.next(!1),this.timbresResume$.next(null),this.totalTimbreResume$.next(null),K([this.timbreUtilsService.getAllTimbres(t),this.timbreService.getTimbreAcquis(),this.timbreBlocService.getAllBlocs(t),this.timbreBlocService.getTimbreBlocAcquis()]).pipe(C()).subscribe(([e,i,r,o])=>{this.timbresResume$.next(this.construct(e,i,r,o)),this.timbreUtilsService.reinitResume$.next(!1)})}construct(t,e,i,r){let o=[];if(t?.length>0&&(t.forEach(m=>{let d=m.annee;if(u(i)&&z(m.annee)&&u(m.idBloc)){let U=i.find(A=>A.id==m.idBloc);u(U)&&(d=U.annee)}let T=o.find(U=>U.getAnnee()==d);z(T)&&(T=new O,T.setAnnee(d),o.push(T)),T.setTotal(T.getTotal()+1);let h=u(m.idBloc)?i.find(U=>U.id==m.idBloc):null;if(u(m.idBloc)?u(h)&&h.type=="CARNET"?T.setNombreTimbresCarnet(T.getNombreTimbresCarnet()+1):u(h)&&h.type=="COLLECTOR"?T.setNombreTimbresCollector(T.getNombreTimbresCollector()+1):T.setNombreTimbresBloc(T.getNombreTimbresBloc()+1):T.setNombre(T.getNombre()+1),u(e)){let U=e.find(A=>A.idTimbre==m.id);u(U)&&(U.acquis==!0&&(u(m.idBloc)?u(h)&&h.type=="CARNET"?T.setAcquisTimbresCarnet(T.getAcquisTimbresCarnet()+1):u(h)&&h.type=="COLLECTOR"?T.setAcquisTimbresCollector(T.getAcquisTimbresCollector()+1):T.setAcquisTimbresBloc(T.getAcquisTimbresBloc()+1):T.setAcquis(T.getAcquis()+1)),U.doublon==!0&&(u(m.idBloc)?u(h)&&h.type=="CARNET"?T.setDoublonTimbresCarnet(T.getDoublonTimbresCarnet()+1):u(h)&&h.type=="COLLECTOR"?T.setDoublonTimbresCollector(T.getDoublonTimbresCollector()+1):T.setDoublonTimbresBloc(T.getDoublonTimbresBloc()+1):T.setDoublon(T.getDoublon()+1)))}}),i.forEach(m=>{let d=o.find(T=>T.getAnnee()==m.annee);if(z(d)&&(d=new O,d.setAnnee(m.annee),o.push(d)),m.type=="CARNET"?d.setNombreCarnet(d.getNombreCarnet()+1):m.type=="COLLECTOR"?d.setNombreCollector(d.getNombreCollector()+1):d.setNombreBloc(d.getNombreBloc()+1),u(r)){let T=r.find(h=>h.idBloc==m.id);u(T)&&(T.acquis==!0&&(z(m.type)||m.type=="BLOC"?d.setAcquisBloc(d.getAcquisBloc()+1):m.type=="COLLECTOR"&&d.setAcquisCollector(d.getAcquisCollector()+1)),T.doublon==!0&&(z(m.type)||m.type=="BLOC"?d.setDoublonBloc(d.getDoublonBloc()+1):m.type=="COLLECTOR"&&d.setDoublonCollector(d.getDoublonCollector()+1)))}})),u(o)&&o?.length>0){let m=new O;o.forEach(d=>{m.setTotal(m.getTotal()+d.getTotal()),m.setNombre(m.getNombre()+d.getNombre()),m.setAcquis(m.getAcquis()+d.getAcquis()),m.setDoublon(m.getDoublon()+d.getDoublon()),m.setNombreCarnet(m.getNombreCarnet()+d.getNombreCarnet()),m.setNombreTimbresCarnet(m.getNombreTimbresCarnet()+d.getNombreTimbresCarnet()),m.setAcquisTimbresCarnet(m.getAcquisTimbresCarnet()+d.getAcquisTimbresCarnet()),m.setDoublonTimbresCarnet(m.getDoublonTimbresCarnet()+d.getDoublonTimbresCarnet()),m.setNombreBloc(m.getNombreBloc()+d.getNombreBloc()),m.setAcquisBloc(m.getAcquisBloc()+d.getAcquisBloc()),m.setDoublonBloc(m.getDoublonBloc()+d.getDoublonBloc()),m.setNombreTimbresBloc(m.getNombreTimbresBloc()+d.getNombreTimbresBloc()),m.setAcquisTimbresBloc(m.getAcquisTimbresBloc()+d.getAcquisTimbresBloc()),m.setDoublonTimbresBloc(m.getDoublonTimbresBloc()+d.getDoublonTimbresBloc()),m.setNombreCollector(m.getNombreCollector()+d.getNombreCollector()),m.setAcquisCollector(m.getAcquisCollector()+d.getAcquisCollector()),m.setDoublonCollector(m.getDoublonCollector()+d.getDoublonCollector()),m.setNombreTimbresCollector(m.getNombreTimbresCollector()+d.getNombreTimbresCollector()),m.setAcquisTimbresCollector(m.getAcquisTimbresCollector()+d.getAcquisTimbresCollector()),m.setDoublonTimbresCollector(m.getDoublonTimbresCollector()+d.getDoublonTimbresCollector())}),this.totalTimbreResume$.next(m)}return this.load$.next(!0),o}static \u0275fac=function(e){return new(e||n)(L(Q),L(Y),L(F))};static \u0275prov=be({token:n,factory:n.\u0275fac})};var Fe=class n{constructor(t){this.firestore=t}loadGlob$=new N(!0);load$=new N(!0);supprimer(t,e){return this.load$.next(!1),this.firestore.collection(t).valueChanges().pipe(C()).subscribe(i=>{u(i)&&i?.length>0?i.forEach((r,o)=>{this.firestore.collection(t).ref.where(e,"==",r[e]).get().then(m=>{m.forEach(d=>{d.ref.delete(),o==i.length-1&&this.load$.next(!0)})}).catch(m=>{console.error("Erreur de suppression :",m)})}):this.load$.next(!0)})}supprimerTimbres(t){this.load$.next(!1),this.firestore.collection("/timbres",e=>{let i=e;return i=i.where("annee","==",t),i}).valueChanges().pipe(C()).subscribe(e=>{u(e)&&e?.length>0?e.forEach((i,r)=>{this.firestore.collection("/timbres").ref.where("id","==",i.id).get().then(o=>{o.forEach(m=>{this.supprimerAcquis(i.id),m.ref.delete(),r==e.length-1&&this.load$.next(!0)})}).catch(o=>{console.error("Erreur de suppression :",o)})}):this.load$.next(!0)})}supprimerAcquis(t){this.load$.next(!1),this.firestore.collection("/timbres_acquis",e=>{let i=e;return i=i.where("idTimbre","==",t),i}).valueChanges().pipe(C()).subscribe(e=>{u(e)&&e?.length>0?e.forEach((i,r)=>{this.firestore.collection("/timbres_acquis").ref.where("idTimbre","==",i.idTimbre).get().then(o=>{o.forEach(m=>{m.ref.delete(),r==e.length-1&&this.load$.next(!0)})}).catch(o=>{console.error("Erreur de suppression :",o)})}):this.load$.next(!0)})}supprimerBlocs(t){this.load$.next(!1),this.firestore.collection("/timbres_bloc",e=>{let i=e;return i=i.where("annee","==",t),i}).valueChanges().pipe(C()).subscribe(e=>{u(e)&&e?.length>0?e.forEach((i,r)=>{this.firestore.collection("/timbres_bloc").ref.where("id","==",i.id).get().then(o=>{o.forEach(m=>{this.supprimerBlocsAcquis(i.id),m.ref.delete(),r==e.length-1&&this.load$.next(!0)})}).catch(o=>{console.error("Erreur de suppression :",o)})}):this.load$.next(!0)})}supprimerBlocsAcquis(t){this.load$.next(!1),this.firestore.collection("/timbres_bloc_acquis",e=>{let i=e;return i=i.where("idBloc","==",t),i}).valueChanges().pipe(C()).subscribe(e=>{u(e)&&e?.length>0?e.forEach((i,r)=>{this.firestore.collection("/timbres_bloc_acquis").ref.where("id","==",i.id).get().then(o=>{o.forEach(m=>{m.ref.delete(),r==e.length-1&&this.load$.next(!0)})}).catch(o=>{console.error("Erreur de suppression :",o)})}):this.load$.next(!0)})}static \u0275fac=function(e){return new(e||n)(L(we))};static \u0275prov=be({token:n,factory:n.\u0275fac})};var Ht=class n{static \u0275fac=function(e){return new(e||n)};static \u0275mod=Mt({type:n});static \u0275inj=yt({providers:[Fe],imports:[Ui,It,fi,wt,Dt,qi,Lt,Rt]})};var zi=class n{static \u0275fac=function(e){return new(e||n)};static \u0275mod=Mt({type:n});static \u0275inj=yt({imports:[It,wt,Dt,_i,Ti,Rt,gi,Ci,hi,Lt,me,Ht,le,ae,Nt]})};var Yi=n=>({accent50:n});function hn(n,t){n&1&&M(0,"lib-spinner",2),n&2&&a("textSpec","Chargement en cours ...")}function Cn(n,t){if(n&1&&(s(0,"th",34),M(1,"lib-libelle-model",35),c()),n&2){let e=p(2);l(),a("object",e.timbreResumeModel)("key","annee")}}function xn(n,t){if(n&1&&(s(0,"td",36),b(1),c()),n&2){let e=t.$implicit;l(),y(" ",e==null?null:e.getAnnee()," ")}}function vn(n,t){n&1&&M(0,"td",37)}function yn(n,t){if(n&1&&(s(0,"th",34),M(1,"lib-libelle-model",35),c()),n&2){let e=p(2);l(),a("object",e.timbreResumeModel)("key","total")}}function Mn(n,t){if(n&1&&(s(0,"td",36),b(1),c()),n&2){let e=t.$implicit;l(),y(" ",e==null?null:e.getTotal()," ")}}function Sn(n,t){if(n&1&&(s(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getTotal()," ")}}function Bn(n,t){if(n&1&&(s(0,"th",38),M(1,"lib-libelle-model",35),c()),n&2){let e=p(2);l(),a("object",e.timbreResumeModel)("key","nombre")}}function En(n,t){if(n&1&&(s(0,"td",39),b(1),c()),n&2){let e=t.$implicit;l(),y(" ",e==null?null:e.getNombre()," ")}}function In(n,t){if(n&1&&(s(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getNombre()," ")}}function An(n,t){if(n&1&&(s(0,"th",38),M(1,"lib-icon",40),c()),n&2){let e=p(2);l(),a("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK)("info",e.timbreResumeModel.getPropertyLibelle("acquis"))}}function wn(n,t){if(n&1&&(s(0,"td",41),b(1),c()),n&2){let e=t.$implicit;a("ngClass",bt(2,Yi,(e==null?null:e.getNombre())==(e==null?null:e.getAcquis()))),l(),y(" ",e==null?null:e.getAcquis()," ")}}function Dn(n,t){if(n&1&&(s(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getAcquis()," ")}}function Rn(n,t){if(n&1&&(s(0,"th",38),M(1,"lib-icon",40),c()),n&2){let e=p(2);l(),a("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK_DOUBLE)("info",e.timbreResumeModel.getPropertyLibelle("doublon"))}}function On(n,t){if(n&1&&(s(0,"td",41),b(1),c()),n&2){let e=t.$implicit;a("ngClass",bt(2,Yi,(e==null?null:e.getNombre())==(e==null?null:e.getDoublon()))),l(),y(" ",e==null?null:e.getDoublon()," ")}}function Nn(n,t){if(n&1&&(s(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getDoublon()," ")}}function Ln(n,t){if(n&1&&(s(0,"th",38),M(1,"lib-libelle-model",35),c()),n&2){let e=p(2);l(),a("object",e.timbreResumeModel)("key","nombreCarnet")}}function Un(n,t){if(n&1&&(s(0,"td",41),b(1),c()),n&2){let e=t.$implicit;a("ngClass",(e==null?null:e.getNombreCarnet())==0?"gray25":"primary25"),l(),y(" ",(e==null?null:e.getNombreCarnet())>0?e==null?null:e.getNombreCarnet():""," ")}}function qn(n,t){if(n&1&&(s(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getNombreCarnet()," ")}}function Fn(n,t){if(n&1&&(s(0,"th",38),M(1,"lib-libelle-model",35),c()),n&2){let e=p(2);l(),a("object",e.timbreResumeModel)("key","nombreTimbresCarnet")}}function $n(n,t){if(n&1&&(s(0,"td",41),b(1),c()),n&2){let e=t.$implicit;a("ngClass",(e==null?null:e.getNombreCarnet())==0?"gray25":"primary25"),l(),y(" ",(e==null?null:e.getNombreCarnet())>0?e==null?null:e.getNombreTimbresCarnet():""," ")}}function jn(n,t){if(n&1&&(s(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getNombreTimbresCarnet()," ")}}function Pn(n,t){if(n&1&&(s(0,"th",38),M(1,"lib-icon",40),c()),n&2){let e=p(2);l(),a("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK)("info",e.timbreResumeModel.getPropertyLibelle("acquisTimbresCarnet"))}}function Vn(n,t){if(n&1&&(s(0,"td",41),b(1),c()),n&2){let e=t.$implicit;a("ngClass",(e==null?null:e.getNombreTimbresCarnet())==0?"gray25":(e==null?null:e.getNombreTimbresCarnet())==(e==null?null:e.getAcquisTimbresCarnet())?"accent50":"primary25"),l(),y(" ",(e==null?null:e.getNombreCarnet())>0?e==null?null:e.getAcquisTimbresCarnet():""," ")}}function kn(n,t){if(n&1&&(s(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getAcquisTimbresCarnet()," ")}}function Hn(n,t){if(n&1&&(s(0,"th",38),M(1,"lib-icon",40),c()),n&2){let e=p(2);l(),a("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK_DOUBLE)("info",e.timbreResumeModel.getPropertyLibelle("doublonTimbresCarnet"))}}function Gn(n,t){if(n&1&&(s(0,"td",41),b(1),c()),n&2){let e=t.$implicit;a("ngClass",(e==null?null:e.getNombreTimbresCarnet())==0?"gray25":(e==null?null:e.getNombreTimbresCarnet())==(e==null?null:e.getDoublonTimbresCarnet())?"accent50":"primary25"),l(),y(" ",(e==null?null:e.getNombreCarnet())>0?e==null?null:e.getDoublonTimbresCarnet():""," ")}}function Wn(n,t){if(n&1&&(s(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getDoublonTimbresCarnet()," ")}}function zn(n,t){if(n&1&&(s(0,"th",38),M(1,"lib-libelle-model",35),c()),n&2){let e=p(2);l(),a("object",e.timbreResumeModel)("key","nombreBloc")}}function Yn(n,t){if(n&1&&(s(0,"td",41),b(1),c()),n&2){let e=t.$implicit;a("ngClass",(e==null?null:e.getNombreBloc())==0?"gray25":""),l(),y(" ",(e==null?null:e.getNombreBloc())>0?e==null?null:e.getNombreBloc():""," ")}}function Qn(n,t){if(n&1&&(s(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getNombreBloc()," ")}}function Kn(n,t){if(n&1&&(s(0,"th",38),M(1,"lib-icon",40),c()),n&2){let e=p(2);l(),a("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK)("info",e.timbreResumeModel.getPropertyLibelle("acquisBloc"))}}function Zn(n,t){if(n&1&&(s(0,"td",41),b(1),c()),n&2){let e=t.$implicit;a("ngClass",(e==null?null:e.getNombreBloc())==0?"gray25":e.getNombreBloc()==(e==null?null:e.getAcquisBloc())?"accent50":""),l(),y(" ",(e==null?null:e.getNombreBloc())>0?e==null?null:e.getAcquisBloc():""," ")}}function Jn(n,t){if(n&1&&(s(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getAcquisBloc()," ")}}function Xn(n,t){if(n&1&&(s(0,"th",38),M(1,"lib-icon",40),c()),n&2){let e=p(2);l(),a("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK_DOUBLE)("info",e.timbreResumeModel.getPropertyLibelle("doublonBloc"))}}function er(n,t){if(n&1&&(s(0,"td",41),b(1),c()),n&2){let e=t.$implicit;a("ngClass",(e==null?null:e.getNombreBloc())==0?"gray25":e.getNombreBloc()==(e==null?null:e.getDoublonBloc())?"accent50":""),l(),y(" ",(e==null?null:e.getNombreBloc())>0?e==null?null:e.getDoublonBloc():""," ")}}function tr(n,t){if(n&1&&(s(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getDoublonBloc()," ")}}function ir(n,t){if(n&1&&(s(0,"th",38),M(1,"lib-libelle-model",35),c()),n&2){let e=p(2);l(),a("object",e.timbreResumeModel)("key","nombreTimbresBloc")}}function nr(n,t){if(n&1&&(s(0,"td",41),b(1),c()),n&2){let e=t.$implicit;a("ngClass",(e==null?null:e.getNombreTimbresBloc())==0?"gray25":"primary25"),l(),y(" ",(e==null?null:e.getNombreTimbresBloc())>0?e==null?null:e.getNombreTimbresBloc():""," ")}}function rr(n,t){if(n&1&&(s(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getNombreTimbresBloc()," ")}}function or(n,t){if(n&1&&(s(0,"th",38),M(1,"lib-icon",40),c()),n&2){let e=p(2);l(),a("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK)("info",e.timbreResumeModel.getPropertyLibelle("acquisTimbresBloc"))}}function lr(n,t){if(n&1&&(s(0,"td",41),b(1),c()),n&2){let e=t.$implicit;a("ngClass",(e==null?null:e.getNombreTimbresBloc())==0?"gray25":(e==null?null:e.getNombreTimbresBloc())==(e==null?null:e.getAcquisTimbresBloc())?"accent50":"primary25"),l(),y(" ",(e==null?null:e.getNombreTimbresBloc())>0?e==null?null:e.getAcquisTimbresBloc():""," ")}}function mr(n,t){if(n&1&&(s(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getAcquisTimbresBloc()," ")}}function sr(n,t){if(n&1&&(s(0,"th",38),M(1,"lib-icon",40),c()),n&2){let e=p(2);l(),a("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK_DOUBLE)("info",e.timbreResumeModel.getPropertyLibelle("doublonTimbresBloc"))}}function ar(n,t){if(n&1&&(s(0,"td",41),b(1),c()),n&2){let e=t.$implicit;a("ngClass",(e==null?null:e.getNombreTimbresBloc())==0?"gray25":(e==null?null:e.getNombreTimbresBloc())==(e==null?null:e.getDoublonTimbresBloc())?"accent50":"primary25"),l(),y(" ",(e==null?null:e.getNombreTimbresBloc())>0?e==null?null:e.getDoublonTimbresBloc():""," ")}}function cr(n,t){if(n&1&&(s(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getDoublonTimbresBloc()," ")}}function pr(n,t){if(n&1&&(s(0,"th",38),M(1,"lib-libelle-model",35),c()),n&2){let e=p(2);l(),a("object",e.timbreResumeModel)("key","nombreCollector")}}function ur(n,t){if(n&1&&(s(0,"td",41),b(1),c()),n&2){let e=t.$implicit;a("ngClass",(e==null?null:e.getNombreCollector())==0?"gray25":"primary25"),l(),y(" ",(e==null?null:e.getNombreCollector())>0?e==null?null:e.getNombreCollector():""," ")}}function dr(n,t){if(n&1&&(s(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getNombreCollector()," ")}}function br(n,t){if(n&1&&(s(0,"th",38),M(1,"lib-icon",40),c()),n&2){let e=p(2);l(),a("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK)("info",e.timbreResumeModel.getPropertyLibelle("acquisCollector"))}}function fr(n,t){if(n&1&&(s(0,"td",41),b(1),c()),n&2){let e=t.$implicit;a("ngClass",(e==null?null:e.getNombreCollector())==0?"gray25":e.getNombreCollector()==(e==null?null:e.getAcquisCollector())?"accent50":""),l(),y(" ",(e==null?null:e.getNombreCollector())>0?e==null?null:e.getAcquisCollector():""," ")}}function gr(n,t){if(n&1&&(s(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getAcquisCollector()," ")}}function _r(n,t){if(n&1&&(s(0,"th",38),M(1,"lib-icon",40),c()),n&2){let e=p(2);l(),a("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK_DOUBLE)("info",e.timbreResumeModel.getPropertyLibelle("doublonCollector"))}}function Tr(n,t){if(n&1&&(s(0,"td",41),b(1),c()),n&2){let e=t.$implicit;a("ngClass",(e==null?null:e.getNombreCollector())==0?"gray25":e.getNombreCollector()==(e==null?null:e.getDoublonCollector())?"accent50":""),l(),y(" ",(e==null?null:e.getNombreCollector())>0?e==null?null:e.getDoublonCollector():""," ")}}function hr(n,t){if(n&1&&(s(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getDoublonCollector()," ")}}function Cr(n,t){if(n&1&&(s(0,"th",38),M(1,"lib-libelle-model",35),c()),n&2){let e=p(2);l(),a("object",e.timbreResumeModel)("key","nombreTimbresCollector")}}function xr(n,t){if(n&1&&(s(0,"td",41),b(1),c()),n&2){let e=t.$implicit;a("ngClass",(e==null?null:e.getNombreCollector())==0?"gray25":"primary25"),l(),y(" ",(e==null?null:e.getNombreCollector())>0?e==null?null:e.getNombreTimbresCollector():""," ")}}function vr(n,t){if(n&1&&(s(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getNombreTimbresCollector()," ")}}function yr(n,t){if(n&1&&(s(0,"th",38),M(1,"lib-icon",40),c()),n&2){let e=p(2);l(),a("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK)("info",e.timbreResumeModel.getPropertyLibelle("acquisTimbresCollector"))}}function Mr(n,t){if(n&1&&(s(0,"td",41),b(1),c()),n&2){let e=t.$implicit;a("ngClass",(e==null?null:e.getNombreTimbresCollector())==0?"gray25":(e==null?null:e.getNombreTimbresCollector())==(e==null?null:e.getAcquisTimbresCollector())?"accent50":"primary25"),l(),y(" ",(e==null?null:e.getNombreCollector())>0?e==null?null:e.getAcquisTimbresCollector():""," ")}}function Sr(n,t){if(n&1&&(s(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getAcquisTimbresCollector()," ")}}function Br(n,t){if(n&1&&(s(0,"th",38),M(1,"lib-icon",40),c()),n&2){let e=p(2);l(),a("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK_DOUBLE)("info",e.timbreResumeModel.getPropertyLibelle("doublonTimbresCollector"))}}function Er(n,t){if(n&1&&(s(0,"td",41),b(1),c()),n&2){let e=t.$implicit;a("ngClass",(e==null?null:e.getNombreTimbresCollector())==0?"gray25":(e==null?null:e.getNombreTimbresCollector())==(e==null?null:e.getDoublonTimbresCollector())?"accent50":"primary25"),l(),y(" ",(e==null?null:e.getNombreCollector())>0?e==null?null:e.getDoublonTimbresCollector():""," ")}}function Ir(n,t){if(n&1&&(s(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getDoublonTimbresCollector()," ")}}function Ar(n,t){n&1&&M(0,"tr",42)}function wr(n,t){if(n&1){let e=R();s(0,"tr",43),B("click",function(){let r=x(e).$implicit,o=p(2);return v(o.filtreParAnnee(r))}),c()}}function Dr(n,t){n&1&&M(0,"tr",44)}function Rr(n,t){if(n&1){let e=R();s(0,"table",3),B("matSortChange",function(r){x(e);let o=p();return v(o.sortData(r))}),w(1,4),_(2,Cn,2,2,"th",5)(3,xn,2,1,"td",6)(4,vn,1,0,"td",7),D(),w(5,8),_(6,yn,2,2,"th",5)(7,Mn,2,1,"td",6)(8,Sn,4,3,"td",7),D(),w(9,9),_(10,Bn,2,2,"th",10)(11,En,2,1,"td",11)(12,In,4,3,"td",7),D(),w(13,12),_(14,An,2,3,"th",10)(15,wn,2,4,"td",13)(16,Dn,4,3,"td",7),D(),w(17,14),_(18,Rn,2,3,"th",10)(19,On,2,4,"td",13)(20,Nn,4,3,"td",7),D(),w(21,15),_(22,Ln,2,2,"th",10)(23,Un,2,2,"td",13)(24,qn,4,3,"td",7),D(),w(25,16),_(26,Fn,2,2,"th",10)(27,$n,2,2,"td",13)(28,jn,4,3,"td",7),D(),w(29,17),_(30,Pn,2,3,"th",10)(31,Vn,2,2,"td",13)(32,kn,4,3,"td",7),D(),w(33,18),_(34,Hn,2,3,"th",10)(35,Gn,2,2,"td",13)(36,Wn,4,3,"td",7),D(),w(37,19),_(38,zn,2,2,"th",10)(39,Yn,2,2,"td",13)(40,Qn,4,3,"td",7),D(),w(41,20),_(42,Kn,2,3,"th",10)(43,Zn,2,2,"td",13)(44,Jn,4,3,"td",7),D(),w(45,21),_(46,Xn,2,3,"th",10)(47,er,2,2,"td",13)(48,tr,4,3,"td",7),D(),w(49,22),_(50,ir,2,2,"th",10)(51,nr,2,2,"td",13)(52,rr,4,3,"td",7),D(),w(53,23),_(54,or,2,3,"th",10)(55,lr,2,2,"td",13)(56,mr,4,3,"td",7),D(),w(57,24),_(58,sr,2,3,"th",10)(59,ar,2,2,"td",13)(60,cr,4,3,"td",7),D(),w(61,25),_(62,pr,2,2,"th",10)(63,ur,2,2,"td",13)(64,dr,4,3,"td",7),D(),b(65,"> "),w(66,26),_(67,br,2,3,"th",10)(68,fr,2,2,"td",13)(69,gr,4,3,"td",7),D(),w(70,27),_(71,_r,2,3,"th",10)(72,Tr,2,2,"td",13)(73,hr,4,3,"td",7),D(),w(74,28),_(75,Cr,2,2,"th",10)(76,xr,2,2,"td",13)(77,vr,4,3,"td",7),D(),w(78,29),_(79,yr,2,3,"th",10)(80,Mr,2,2,"td",13)(81,Sr,4,3,"td",7),D(),w(82,30),_(83,Br,2,3,"th",10)(84,Er,2,2,"td",13)(85,Ir,4,3,"td",7),D(),_(86,Ar,1,0,"tr",31)(87,wr,1,0,"tr",32)(88,Dr,1,0,"tr",33),c()}if(n&2){let e=p();a("dataSource",e.dataSource),l(86),a("matHeaderRowDef",e.displayedColumns)("matHeaderRowDefSticky",!0),l(),a("matRowDefColumns",e.displayedColumns),l(),a("matFooterRowDef",e.displayedColumns)("matFooterRowDefSticky",!0)}}var Gt=class n{constructor(t,e,i,r,o){this.dialogRef=t;this.timbreResumeService=e;this.timbreService=i;this.timbreBlocService=r;this.timbreUtilsService=o;this.dataSource=new Xt([])}paginator;sort;dataSource=new Xt;displayedColumns=["annee","total","nombre","acquis","doublon","nombreCarnet","nombreTimbresCarnet","acquisTimbresCarnet","doublonTimbresCarnet","nombreBloc","acquisBloc","doublonBloc","nombreTimbresBloc","acquisTimbresBloc","doublonTimbresBloc","nombreCollector","acquisCollector"];timbreResumeModel=new O;FontAwesomeEnum=_e;FontAwesomeTypeEnum=ge;ngOnInit(){this.timbreUtilsService.reinitResume$.pipe(C()).subscribe(t=>{t==!0&&this.timbreResumeService.getResume(),this.initData()})}initData(){this.timbreResumeService.timbresResume$.pipe(C(t=>u(t)&&t?.length>0)).subscribe(t=>{this.dataSource.data=t})}ngAfterViewInit(){this.dataSource.paginator=this.paginator}sortData(t){u(t)&&(this.dataSource.sort=this.sort)}filtreParAnnee(t){let e=new G;window.location.href.indexOf("bloc")>0?(e.initCritereBloc(),this.timbreUtilsService.timbreCritereBlocModel.setAnnees([t.getAnnee()]),this.timbreBlocService.getBlocs(this.timbreUtilsService.timbreCritereBlocModel,!1)):(e.initCritere(),this.timbreUtilsService.timbreCritereModel.setAnnees([t.getAnnee()]),this.timbreService.getTimbres(this.timbreUtilsService.timbreCritereModel,!1)),this.dialogRef.close()}static \u0275fac=function(e){return new(e||n)(S(xe),S(kt),S(Q),S(Y),S(F))};static \u0275cmp=$({type:n,selectors:[["app-timbre-resume"]],viewQuery:function(e,i){if(e&1&&($e(xi,5),$e(Ot,5)),e&2){let r;je(r=Pe())&&(i.paginator=r.first),je(r=Pe())&&(i.sort=r.first)}},decls:4,vars:4,consts:[["load",""],[3,"ngIf","ngIfElse"],["fxFlexFill","",3,"textSpec"],["mat-table","","matSort","",3,"matSortChange","dataSource"],["matColumnDef","annee","sticky",""],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","","class","primary50",4,"matCellDef"],["mat-footer-cell","",4,"matFooterCellDef"],["matColumnDef","total","sticky",""],["matColumnDef","nombre"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","acquis"],["mat-cell","",3,"ngClass",4,"matCellDef"],["matColumnDef","doublon"],["matColumnDef","nombreCarnet"],["matColumnDef","nombreTimbresCarnet"],["matColumnDef","acquisTimbresCarnet"],["matColumnDef","doublonTimbresCarnet"],["matColumnDef","nombreBloc"],["matColumnDef","acquisBloc"],["matColumnDef","doublonBloc"],["matColumnDef","nombreTimbresBloc"],["matColumnDef","acquisTimbresBloc"],["matColumnDef","doublonTimbresBloc"],["matColumnDef","nombreCollector"],["matColumnDef","acquisCollector"],["matColumnDef","doublonCollector"],["matColumnDef","nombreTimbresCollector"],["matColumnDef","acquisTimbresCollector"],["matColumnDef","doublonTimbresCollector"],["mat-header-row","","class","bg-primary color-white",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","mat-row",3,"click",4,"matRowDef","matRowDefColumns"],["mat-footer-row","","class","bg-primary color-white",4,"matFooterRowDef","matFooterRowDefSticky"],["mat-header-cell","","mat-sort-header",""],[3,"object","key"],["mat-cell","",1,"primary50"],["mat-footer-cell",""],["mat-header-cell",""],["mat-cell",""],[1,"click",2,"font-size","1.2em",3,"type","icone","info"],["mat-cell","",3,"ngClass"],["mat-header-row","",1,"bg-primary","color-white"],["mat-row","",1,"mat-row",3,"click"],["mat-footer-row","",1,"bg-primary","color-white"]],template:function(e,i){if(e&1&&(_(0,hn,1,1,"ng-template",1),f(1,"async"),_(2,Rr,89,6,"ng-template",null,0,J)),e&2){let r=q(3);a("ngIf",g(1,2,i.timbreResumeService.load$)==!1)("ngIfElse",r)}},dependencies:[vi,Mi,wi,Bi,yi,Ri,Si,Di,Ei,Ai,Ii,Oi,Li,Ni,Ot,Nt,te,j,he,ne,ce,ve,ot,P],styles:["th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{text-align:center}th[_ngcontent-%COMP%]{width:40px!important;max-width:40px!important}.mat-row[_ngcontent-%COMP%]{padding:0!important;height:30px}.mat-row[_ngcontent-%COMP%]   .mat-mdc-cell[_ngcontent-%COMP%]{width:40px!important}@media screen and (max-width: 800px){th[_ngcontent-%COMP%]{width:25px!important;max-width:25px!important}.mat-row[_ngcontent-%COMP%]{padding:0!important;height:15px}.mat-row[_ngcontent-%COMP%]   .mat-mdc-cell[_ngcontent-%COMP%]{width:25px!important}th[_ngcontent-%COMP%], .mat-row[_ngcontent-%COMP%]{font-size:.8em}}"]})};var Qi=Zi(Ji());function Or(n,t){if(n&1&&(s(0,"mat-option",7),b(1),f(2,"capitalize"),c()),n&2){let e=t.$implicit;a("value",e.value),l(),y(" ",g(2,2,e.value)," ")}}function Nr(n,t){if(n&1&&(s(0,"mat-option",7),b(1),c()),n&2){let e=t.$implicit;a("value",e),l(),y(" ",e," ")}}function Lr(n,t){if(n&1){let e=R();s(0,"div",1)(1,"div",2)(2,"mat-select",3),H("ngModelChange",function(r){x(e);let o=p();return k(o.timbreUtilsService.timbreCritereModel.type,r)||(o.timbreUtilsService.timbreCritereModel.type=r),v(r)}),B("ngModelChange",function(){x(e);let r=p();return v(r.filtreByCritere())}),_(3,Or,3,4,"mat-option",4),f(4,"enumToArray"),c()(),s(5,"div",5)(6,"mat-select",6),H("ngModelChange",function(r){x(e);let o=p();return k(o.timbreUtilsService.timbreCritereModel.acquis,r)||(o.timbreUtilsService.timbreCritereModel.acquis=r),v(r)}),B("ngModelChange",function(){x(e);let r=p();return v(r.filtreByCritere())}),s(7,"mat-option",7),b(8," Oui"),c(),s(9,"mat-option",7),b(10," Non"),c(),s(11,"mat-option",7),b(12," Tous"),c()()(),s(13,"div",5)(14,"mat-select",8),H("ngModelChange",function(r){x(e);let o=p();return k(o.timbreUtilsService.timbreCritereModel.doublon,r)||(o.timbreUtilsService.timbreCritereModel.doublon=r),v(r)}),B("ngModelChange",function(){x(e);let r=p();return v(r.filtreByCritere())}),s(15,"mat-option",7),b(16," Oui"),c(),s(17,"mat-option",7),b(18," Non"),c(),s(19,"mat-option",7),b(20," Tous"),c()()(),s(21,"div",9)(22,"mat-select",10),H("ngModelChange",function(r){x(e);let o=p();return k(o.timbreUtilsService.timbreCritereModel.annees,r)||(o.timbreUtilsService.timbreCritereModel.annees=r),v(r)}),B("ngModelChange",function(){x(e);let r=p();return v(r.filtreByCritere())}),_(23,Nr,2,2,"mat-option",4),f(24,"async"),c()()()}if(n&2){let e=p();l(2),V("ngModel",e.timbreUtilsService.timbreCritereModel.type),a("placeholder","Type"),l(),a("ngForOf",g(4,16,e.TypeTimbreEnum)),l(3),V("ngModel",e.timbreUtilsService.timbreCritereModel.acquis),a("placeholder","Acquis"),l(),a("value","OUI"),l(2),a("value","NON"),l(2),a("value","TOUS"),l(3),V("ngModel",e.timbreUtilsService.timbreCritereModel.doublon),a("placeholder","Doublon"),l(),a("value","OUI"),l(2),a("value","NON"),l(2),a("value","TOUS"),l(3),V("ngModel",e.timbreUtilsService.timbreCritereModel.annees),a("placeholder","Ann\xE9es"),l(),a("ngForOf",g(24,18,e.annees$))}}var zt=class n{constructor(t,e,i){this.authService=t;this.timbreService=e;this.timbreUtilsService=i}modif=!0;annees$;TypeTimbreEnum=ee;ngOnInit(){this.annees$=this.timbreUtilsService.getAnneesAsync("/timbres")}filtreByCritere(){this.timbreUtilsService.timbreCritereModel.getAcquis()=="NON"&&this.timbreUtilsService.timbreCritereModel.setDoublon("TOUS"),this.recherche()}recherche(){u(this.timbreUtilsService.timbreCritereModel.getAnnees())&&this.timbreUtilsService.timbreCritereModel.getAnnees().length>0&&this.timbreService.getTimbres(this.timbreUtilsService.timbreCritereModel,!1)}static \u0275fac=function(e){return new(e||n)(S(X),S(Q),S(F))};static \u0275cmp=$({type:n,selectors:[["app-timbre-recherche"]],inputs:{modif:"modif"},decls:1,vars:1,consts:[["class","menuRecherche",4,"ngIf"],[1,"menuRecherche"],[1,"form-input","select",2,"width","120px"],["name","type","multiple","",1,"scrollBarAccent",3,"ngModelChange","ngModel","placeholder"],["class","selectMin",3,"value",4,"ngFor","ngForOf"],[1,"form-input","select",2,"width","100px"],["name","acquis",3,"ngModelChange","ngModel","placeholder"],[1,"selectMin",3,"value"],["name","doublon",1,"scrollBarAccent",3,"ngModelChange","ngModel","placeholder"],[1,"form-input","select",2,"width","150px"],["name","anneeSelect","multiple","",3,"ngModelChange","ngModel","placeholder"]],template:function(e,i){e&1&&_(0,Lr,25,20,"div",0),e&2&&a("ngIf",i.modif)},dependencies:[ae,le,ie,j,re,oe,P,ct,pt],styles:[".menuRecherche[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:left;width:100%}.menuRecherche[_ngcontent-%COMP%] > .form-input[_ngcontent-%COMP%]{margin:0 10px;display:flex;flex-direction:column;justify-content:space-between;align-items:stretch}@media screen and (max-width: 800px){.menuRecherche[_ngcontent-%COMP%] > .form-input[_ngcontent-%COMP%]{margin:5px 10px}}"]})};function qr(n,t){if(n&1&&(s(0,"div",3)(1,"span"),b(2,"Nombre de timbres : "),c(),s(3,"span",4),b(4),f(5,"async"),c()()),n&2){let e=p();l(4),Et(g(5,1,e.total$))}}var Yt=class n{constructor(t){this.dialog=t}total$;FontAwesomeEnum=_e;FontAwesomeTypeEnum=ge;resume(){this.dialog.open(Gt,{height:"auto",maxHeight:"95vh",width:"1200px"})}static \u0275fac=function(e){return new(e||n)(S(se))};static \u0275cmp=$({type:n,selectors:[["app-timbre-total"]],inputs:{total$:"total$"},decls:4,vars:6,consts:[[1,"timbreTotal"],["class","nbTimbre",4,"ngIf"],[1,"accent","click",3,"click","icone","type","info"],[1,"nbTimbre"],[1,"bold"]],template:function(e,i){e&1&&(s(0,"div",0),_(1,qr,6,3,"div",1),f(2,"async"),s(3,"lib-icon",2),B("click",function(){return i.resume()}),c()()),e&2&&(l(),a("ngIf",g(2,4,i.total$)),l(2),a("icone",i.FontAwesomeEnum.CHART_LINE_UP)("type",i.FontAwesomeTypeEnum.TYPE_SOLID)("info","D\xE9tail par ann\xE9e"))},dependencies:[j,ve,P],styles:[".timbreTotal[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:start;align-content:center;gap:10px}.timbreTotal[_ngcontent-%COMP%]   .nbTimbre[_ngcontent-%COMP%]{font-size:1.2em}.timbreTotal[_ngcontent-%COMP%]   lib-icon[_ngcontent-%COMP%]{font-size:1.5em}@media screen and (max-width: 800px){.timbreTotal[_ngcontent-%COMP%]{height:25px;gap:5px}.timbreTotal[_ngcontent-%COMP%]   .nbTimbre[_ngcontent-%COMP%]{font-size:1em}.timbreTotal[_ngcontent-%COMP%]   lib-icon[_ngcontent-%COMP%]{font-size:1.2em}}"]})};function $r(n,t){if(n&1){let e=R();s(0,"img",21),B("click",function(){x(e);let r=p().$implicit,o=p();return v(o.utilsService.zoom(r==null?null:r.getImageZoom()))}),c()}if(n&2){let e=p().$implicit;a("src",e==null?null:e.getImage(),Bt)}}function jr(n,t){if(n&1&&b(0),n&2){let e,i=p().$implicit;y(" ",i==null||(e=i.getTimbreBlocModel())==null?null:e.getAnnee()," ")}}function Pr(n,t){if(n&1&&b(0),n&2){let e=p().$implicit;y(" ",e==null?null:e.getAnnee()," ")}}function Vr(n,t){if(n&1){let e=R();s(0,"lib-icon",22),B("click",function(){let r;x(e);let o=p().$implicit,m=p();return v(m.utilsService.zoom(o==null||(r=o.getTimbreBlocModel())==null?null:r.getImageZoom()))}),c()}if(n&2){let e,i=p().$implicit,r=p();a("classIcone","primary")("type",r.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",r.FontAwesomeEnum.IMAGE_POLAROID)("classInfo","imageHoverBloc")("info","<img src='"+(i==null||(e=i.getTimbreBlocModel())==null?null:e.getImageZoom())+"'/>")}}function kr(n,t){if(n&1&&M(0,"lib-icon",23),n&2){let e=p().$implicit,i=p();a("classIcone","primary")("type",i.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",i.FontAwesomeEnum.CIRCLE_INFO)("info",e==null?null:e.getYt())}}function Hr(n,t){if(n&1){let e=R();s(0,"div",8)(1,"div",9)(2,"div",10)(3,"lib-icon",11),B("click",function(){let r=x(e).$implicit,o=p();return v(o.timbreService.acquisDoublon(r,!1))}),c(),s(4,"lib-icon",11),B("click",function(){let r=x(e).$implicit,o=p();return v(o.timbreService.acquisDoublon(r,!0))}),c()(),s(5,"div",12)(6,"lib-icon",13),B("click",function(){let r=x(e).$implicit,o=p();return v(o.timbreService.modifierDialog(r))}),c(),s(7,"lib-icon",13),B("click",function(){let r=x(e).$implicit,o=p();return v(o.timbreService.supprimerDialog(r))}),c()()(),s(8,"div",14),_(9,$r,1,1,"img",15),c(),s(10,"div",16),_(11,jr,1,1,"ng-template",17)(12,Pr,1,1,"ng-template",null,0,J),s(14,"div",18),_(15,Vr,1,5,"lib-icon",19)(16,kr,1,4,"lib-icon",20),c()()()}if(n&2){let e,i,r,o,m,d,T,h=t.$implicit,U=q(13),A=p();a("ngClass",!(h==null||(e=h.getTimbreAcquisModel())==null)&&e.isAcquis()?"border-accent bg-accentA200":"border-primary"),l(3),a("classIcone",!(h==null||(i=h.getTimbreAcquisModel())==null)&&i.isAcquis()?"accent":"primary")("type",A.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",!(h==null||(r=h.getTimbreAcquisModel())==null)&&r.isAcquis()?A.FontAwesomeEnum.CIRCLE_MINUS:A.FontAwesomeEnum.CIRCLE_PLUS)("info",!(h==null||(o=h.getTimbreAcquisModel())==null)&&o.isAcquis()?"pas acquis":"acquis"),l(),a("classIcone",!(h==null||(m=h.getTimbreAcquisModel())==null)&&m.isDoublon()?"accent":"primary")("type",A.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",!(h==null||(d=h.getTimbreAcquisModel())==null)&&d.isDoublon()?A.FontAwesomeEnum.CIRCLE_MINUS:A.FontAwesomeEnum.CIRCLE_PLUS)("info",!(h==null||(T=h.getTimbreAcquisModel())==null)&&T.isDoublon()?"pas en double":"en double"),l(2),a("type",A.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",A.FontAwesomeEnum.PENCIL)("info","Modifier"),l(),a("type",A.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",A.FontAwesomeEnum.TRASH)("info","Supprimer"),l(2),a("ngIf",h==null?null:h.getImage()),l(2),a("ngIf",h==null?null:h.getIdBloc())("ngIfElse",U),l(4),a("ngIf",h==null?null:h.getIdBloc()),l(),a("ngIf",h==null?null:h.getYt())}}var Qt=class n{constructor(t,e,i,r){this.authService=t;this.timbreService=e;this.timbreUtilsService=i;this.utilsService=r}timbres$;load$;total$;modif=!0;timbre=new ye;annees$;FontAwesomeEnum=_e;FontAwesomeTypeEnum=ge;ngOnInit(){this.annees$=this.timbreUtilsService.getAnneesAsync("/timbres"),this.timbre.setTimbreAcquisModel(new Z)}static \u0275fac=function(e){return new(e||n)(S(X),S(Q),S(F),S(pe))};static \u0275cmp=$({type:n,selectors:[["app-timbre-resultat"]],inputs:{timbres$:"timbres$",load$:"load$",total$:"total$",modif:"modif"},decls:10,vars:12,consts:[["noBloc",""],[1,"responsiveDirection","responsiveMenu"],[3,"total$"],[3,"modif"],[1,"spinner",3,"fxHide","textSpec"],[3,"fxHide"],[1,"listeTimbre","primary"],["class","detailTimbre",3,"ngClass",4,"ngFor","ngForOf"],[1,"detailTimbre",3,"ngClass"],[1,"headerTimbre"],[1,"actionTimbre"],[1,"click",3,"click","classIcone","type","icone","info"],[1,"actionTimbre2"],[1,"primary","click",3,"click","type","icone","info"],[1,"imgTimbre"],["class","image click",3,"src","click",4,"ngIf"],[1,"footerTimbre"],[3,"ngIf","ngIfElse"],[1,"infoTimbre"],["class","click",3,"classIcone","type","icone","classInfo","info","click",4,"ngIf"],["class","click",3,"classIcone","type","icone","info",4,"ngIf"],[1,"image","click",3,"click","src"],[1,"click",3,"click","classIcone","type","icone","classInfo","info"],[1,"click",3,"classIcone","type","icone","info"]],template:function(e,i){e&1&&(s(0,"div",1),M(1,"app-timbre-total",2)(2,"app-timbre-recherche",3),c(),M(3,"lib-spinner",4),f(4,"async"),s(5,"section",5),f(6,"async"),s(7,"div",6),_(8,Hr,17,20,"div",7),f(9,"async"),c()()),e&2&&(l(),a("total$",i.total$),l(),a("modif",i.modif),l(),a("fxHide",g(4,6,i.load$)==!0)("textSpec","Chargement en cours ..."),l(2),a("fxHide",g(6,8,i.load$)==!1),l(3),a("ngForOf",g(9,10,i.timbres$)))},dependencies:[te,ie,j,Qe,ne,ce,ve,zt,Yt,P],styles:[".spinner[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;align-items:stretch;flex:100%;height:100%}.listeTimbre[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:left;width:100%}.listeTimbre[_ngcontent-%COMP%]   lib-icon[_ngcontent-%COMP%]{font-size:1.2em}.listeTimbre[_ngcontent-%COMP%]   .detailTimbre[_ngcontent-%COMP%]{margin:10px;width:115px;height:150px;border-radius:10px;border:1px solid;padding:5px 10px;display:flex;flex-direction:column;justify-content:space-between;align-items:stretch}.listeTimbre[_ngcontent-%COMP%]   .detailTimbre[_ngcontent-%COMP%]   .headerTimbre[_ngcontent-%COMP%]{height:25px;display:flex;flex-direction:row;justify-content:space-between;align-items:end;width:100%;padding-bottom:5px}.listeTimbre[_ngcontent-%COMP%]   .detailTimbre[_ngcontent-%COMP%]   .headerTimbre[_ngcontent-%COMP%]   .actionTimbre[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;align-items:start;gap:5px}.listeTimbre[_ngcontent-%COMP%]   .detailTimbre[_ngcontent-%COMP%]   .headerTimbre[_ngcontent-%COMP%]   .actionTimbre2[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;align-items:end;gap:5px}.listeTimbre[_ngcontent-%COMP%]   .detailTimbre[_ngcontent-%COMP%]   .imgTimbre[_ngcontent-%COMP%]{width:100%;display:flex;flex:auto;justify-content:center;align-items:center}.listeTimbre[_ngcontent-%COMP%]   .detailTimbre[_ngcontent-%COMP%]   .imgTimbre[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100px;max-height:100px}.listeTimbre[_ngcontent-%COMP%]   .detailTimbre[_ngcontent-%COMP%]   .footerTimbre[_ngcontent-%COMP%]{height:25px;display:flex;flex-direction:row;justify-content:space-between;align-items:end;width:100%}.listeTimbre[_ngcontent-%COMP%]   .detailTimbre[_ngcontent-%COMP%]   .footerTimbre[_ngcontent-%COMP%]   .infoTimbre[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:end;align-items:end;gap:5px}@media screen and (max-width: 800px){.listeTimbre[_ngcontent-%COMP%]{justify-content:space-evenly}}"]})};function Wr(n,t){if(n&1&&(M(0,"lib-spinner",5),f(1,"async")),n&2){let e=p();a("textSpec",g(1,1,e.messageLoad$))}}function zr(n,t){if(n&1&&(M(0,"mat-error",16),f(1,"async")),n&2){let e=p(2);a("innerHTML",g(1,1,e.messageError$),Ye)}}function Yr(n,t){if(n&1&&M(0,"app-timbre-resultat",17),n&2){let e=p(2);a("load$",e.load$)("timbres$",e.timbres$)("modif",!1)}}function Qr(n,t){if(n&1&&(s(0,"mat-option",21),b(1),c()),n&2){let e=t.$implicit;a("value",e),l(),y(" ",e," ")}}function Kr(n,t){if(n&1){let e=R();s(0,"div",18)(1,"mat-select",19),H("ngModelChange",function(r){x(e);let o=p(2);return k(o.annees,r)||(o.annees=r),v(r)}),_(2,Qr,2,2,"mat-option",20),c()()}if(n&2){let e=p(2);l(),V("ngModel",e.annees),a("placeholder","Ann\xE9es"),l(),a("ngForOf",e.anneesDispo)}}function Zr(n,t){n&1&&(s(0,"button",22),b(1," Enregistrer "),c())}function Jr(n,t){if(n&1){let e=R();s(0,"form",6,1),B("ngSubmit",function(){x(e);let r=q(1),o=p();return v(o.valider(r))}),s(2,"div",7),_(3,zr,2,3,"mat-error",8),f(4,"async"),_(5,Yr,1,3,"app-timbre-resultat",9),f(6,"async"),c(),s(7,"div",10),_(8,Kr,3,3,"div",11),f(9,"async"),f(10,"async"),s(11,"button",12),B("click",function(){x(e);let r=p();return v(r.close())}),b(12," Annuler "),c(),s(13,"input",13),B("change",function(r){x(e);let o=p();return v(o.onFileChange(r))}),c(),s(14,"button",14),B("click",function(){x(e);let r=p();return v(r.triggerFileInput())}),b(15," Choisir un fichier "),c(),_(16,Zr,2,0,"button",15),f(17,"async"),c()()}if(n&2){let e,i,r,o=q(1),m=p();a("ngClass",o!=null&&o.submitted?"red-color":"blue-color"),l(3),a("ngIf",g(4,6,m.messageError$)),l(2),a("ngIf",((e=g(6,8,m.timbres$))==null?null:e.length)>0),l(3),a("ngIf",!g(9,10,m.timbres$)||((i=g(10,12,m.timbres$))==null?null:i.length)==0),l(5),ai("id",m.idFile),l(3),a("ngIf",((r=g(17,14,m.timbres$))==null?null:r.length)>0)}}var Kt=class n{constructor(t,e,i,r,o,m,d){this.authService=t;this.timbreService=e;this.timbreBlocService=i;this.timbreUtilsService=r;this.uploadService=o;this.utilsService=m;this.dialogRef=d}dossier="/assets/images/timbres/";timbres$=new N(null);messageError$=new N(null);messageLoad$=new N("Chargement en cours ...");load$=new N(null);idFile="fileImport";identTimbre=1;identBloc=1;timbresModel=[];timbresBlocsModel=[];anneesDispo=[];annees=[new Date().getFullYear()];ngOnInit(){for(let t=new Date().getFullYear();t>=1900;t--)this.anneesDispo.push(t)}triggerFileInput(){document.getElementById(this.idFile).click()}onFileChange(t){let e=t.target.files[0];e&&(this.load$.next(!1),this.messageLoad$.next("Chargement en cours ..."),this.saveCsv(e))}saveCsv(t){let e=new FileReader;e.onload=()=>{let i=e.result;this.parseCsv(i)},e.readAsText(t)}parseCsv(t){u(this.annees)&&this.annees.length>0&&K([this.utilsService.getMaxIdentAsync("/timbres"),this.utilsService.getMaxIdentAsync("/timbres_bloc"),this.authService.userSelect$]).pipe(C(([e,i,r])=>u(r))).subscribe(([e,i,r])=>{this.identTimbre=e,this.identBloc=i,this.timbresModel=[],this.timbres$.next(null),Qi.parse(t,{header:!0,skipEmptyLines:!0,complete:o=>{u(o.data)&&o.data?.length>0&&(this.timbresBlocsModel=[],o.data.forEach((m,d)=>{let T=this.setTimbre(m,r);u(T?.getId())&&(this.timbresModel.push(T),this.identTimbre++),d==o.data.length-1&&(this.timbres$.next(this.timbresModel),this.load$.next(!0))}))},error:o=>{console.error("Erreur lors du parsing du CSV :",o)}})})}setTimbre(t,e){let i=new ye,r=t.CODE!="NULL"&&t.CODE!=""?Number(t.CODE):null,o=t.IDENT_BLOC!="NULL"&&t.IDENT_BLOC!=""&&u(t.IDENT_BLOC)?Number(t.IDENT_BLOC):null,m=t.ANNEE!="NULL"&&t.ANNEE!=""?Number(t.ANNEE):null,d=t.MONNAIE!="NULL"&&t.MONNAIE!=""?t.MONNAIE:null;if(this.annees.includes(m)){i.setId(this.identTimbre),i.setType(t.TYPE!="NULL"&&t.TYPE!=""?t.TYPE:null),i.setYt(t.YT!="NULL"&&t.YT!=""?t.YT:null),i.setAnnee(m);let T=new Z;T.setIdTimbre(i.getId()),T.setIdUser(e.getId()),T.setAcquis(t.ACQUIS=="1"),T.setDoublon(t.DOUBLON=="1"),i.setTimbreAcquisModel(T);let h=this.dossier+m+"/",U="";if(u(o)){if(h+="bloc/"+o,U=h+".png",h+="-",i.setTimbreBlocModel(this.timbresBlocsModel.find(A=>A.getAnnee()==m&&A.idOrigine==o)),z(i.getTimbreBlocModel())){let A=new Ue;A.setId(this.identBloc),A.setAnnee(m),A.setMonnaie(d),A.setType(t.CARNET=="1"?"CARNET":"BLOC"),A.idOrigine=o;let ze=new ue;ze.setIdBloc(this.identBloc),ze.setIdUser(e.getId()),ze.setAcquis(t.ACQUIS_BLOC=="1"),ze.setDoublon(t.DOUBLON_BLOC=="1"),A.setTimbreBlocAcquisModel(ze),this.uploadService.checkIfImageExists(U).pipe(C()).subscribe(xt=>{xt&&(A.setImage(U),A.setImageTable(U),A.setImageZoom(U))}),this.timbresBlocsModel.push(A),i.setTimbreBlocModel(A),this.identBloc++}i.setIdBloc(i.getTimbreBlocModel()?.getId())}else i.setMonnaie(d);h+=r+".png",this.uploadService.checkIfImageExists(h).pipe(C()).subscribe(A=>{A&&(i.setImage(h),i.setImageTable(h),i.setImageZoom(h))})}return i}valider(t){this.messageError$.next(null),t?.valid&&(this.load$.next(!1),this.messageLoad$.next("Import en cours ..."),u(this.timbresBlocsModel)&&this.timbresBlocsModel?.length>0&&this.timbresBlocsModel.forEach((e,i)=>{this.saveBloc(e)}),this.timbres$.pipe(C()).subscribe(e=>{if(u(e)&&e?.length>0)e.forEach((i,r)=>{this.saveTimbre(i,r==e.length-1)});else{this.messageError$.next("Donn\xE9es incorrectes");return}}))}saveBloc(t){K([this.timbreBlocService.upload(t,"autre"),this.timbreBlocService.upload(t,"table"),this.timbreBlocService.upload(t,"zoom")]).pipe(C(([e,i,r])=>u(e)&&u(r)&&u(i))).subscribe(([e,i,r])=>{u(e)&&e!="nok"&&t.setImage(e),u(i)&&i!="nok"&&t.setImageTable(i),u(r)&&r!="nok"&&t.setImageZoom(r),t?.getTimbreBlocAcquisModel()?.isAcquis()&&this.timbreBlocService.addAcquis(t?.getTimbreBlocAcquisModel()?.getIdUser(),t,t?.getTimbreBlocAcquisModel()?.isDoublon()),this.timbreBlocService.ajouter(t,!1)})}saveTimbre(t,e){K([this.timbreService.upload(t,"autre"),this.timbreService.upload(t,"table"),this.timbreService.upload(t,"zoom")]).pipe(C(([i,r,o])=>u(i)&&u(o)&&u(r))).subscribe(([i,r,o])=>{u(i)&&i!="nok"&&t.setImage(i),u(r)&&r!="nok"&&t.setImageTable(r),u(o)&&o!="nok"&&t.setImageZoom(o),t?.getTimbreAcquisModel()?.isAcquis()&&this.timbreUtilsService.addAcquis(t?.getTimbreAcquisModel()?.getIdUser(),t,t?.getTimbreAcquisModel()?.isDoublon()),this.timbreService.ajouter(t,e),e&&(this.load$.next(!0),this.close())})}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||n)(S(X),S(Q),S(Y),S(F),S(st),S(pe),S(xe))};static \u0275cmp=$({type:n,selectors:[["app-timbre-importer"]],decls:8,vars:4,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],[3,"ngIf","ngIfElse"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","start stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","column","fxLayoutGap","20px",1,"bloc-modal"],[3,"innerHTML",4,"ngIf"],[3,"load$","timbres$","modif",4,"ngIf"],["fxLayout","row","fxLayoutGap","20px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["fxLayout","row","fxLayoutAlign","end center","class","form-input select noError","style","width: 150px",4,"ngIf"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","file","accept",".xls, .xlsx, .csv","hidden","","required","",3,"change","id"],["type","button","mat-raised-button","","color","accent",1,"rounded","large","color-white",3,"click"],["type","submit","class","rounded large color-white","mat-raised-button","","color","accent",4,"ngIf"],[3,"innerHTML"],[3,"load$","timbres$","modif"],["fxLayout","row","fxLayoutAlign","end center",1,"form-input","select","noError",2,"width","150px"],["name","anneeSelect","multiple","",3,"ngModelChange","ngModel","placeholder"],["class","selectMin",3,"value",4,"ngFor","ngForOf"],[1,"selectMin",3,"value"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"]],template:function(e,i){if(e&1&&(s(0,"div",2)(1,"div",3)(2,"span"),b(3,"TIMBRE IMPORTER"),c()(),_(4,Wr,2,3,"ng-template",4),f(5,"async"),_(6,Jr,18,16,"ng-template",null,0,J),c()),e&2){let r=q(7);l(4),a("ngIf",g(5,2,i.load$)==!1)("ngIfElse",r)}},dependencies:[me,nt,ae,le,te,ie,j,Te,De,Ce,he,Re,ne,Le,re,Oe,oe,Ne,ce,Qt,P]})};function Xr(n,t){n&1&&M(0,"lib-spinner",5),n&2&&a("textSpec","Suppression en cours")}function eo(n,t){if(n&1){let e=R();s(0,"form",6,1),B("ngSubmit",function(){x(e);let r=q(1),o=p();return v(o.valider(r))}),s(2,"div",7)(3,"div",8)(4,"input",9),H("ngModelChange",function(r){x(e);let o=p();return k(o.annee,r)||(o.annee=r),v(r)}),c()(),s(5,"button",10),B("click",function(){x(e);let r=p();return v(r.close())}),b(6," Annuler "),c(),s(7,"button",11),b(8," Supprimer "),c()()()}if(n&2){let e=q(1),i=p();a("ngClass",e!=null&&e.submitted?"red-color":"blue-color"),l(4),V("ngModel",i.annee),a("max",i.maxAnnee)("zMax",i.maxAnnee)}}var Zt=class n{constructor(t,e,i){this.dialog=t;this.dialogRef=e;this.timbreSupprimService=i}maxAnnee=new Date().getFullYear();annee=new Date().getFullYear();valider(t){if(t?.valid){let e=this.dialog.open(ke,{maxHeight:"95vh",data:{titre:"Confirmation",message:"Souhaitez-vous supprimer les timbres ?",btnDroite:"Oui",btnGauche:"Non"}});e.afterClosed().subscribe(()=>{e.componentInstance.data.resultat==="valider"&&(this.timbreSupprimService.loadGlob$.next(!1),this.timbreSupprimService.supprimerTimbres(this.annee),this.timbreSupprimService.load$.pipe(C(i=>i==!0)).subscribe(i=>{this.timbreSupprimService.supprimerBlocs(this.annee),this.timbreSupprimService.load$.pipe(C(r=>r==!0)).subscribe(r=>{this.timbreSupprimService.loadGlob$.next(!0)})}))})}}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||n)(S(se),S(xe),S(Fe))};static \u0275cmp=$({type:n,selectors:[["app-timbre-supprim-choix-annee"]],decls:8,vars:4,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],[3,"ngIf","ngIfElse"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","start stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","row","fxLayoutGap","20px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["fxLayout","column","fxFlex","20","fxLayoutAlign","end end",1,"form-input","noError"],["name","annee","type","number","minlength","4","maxlength","4","min","1900","zMin","1900","required","","zControl","",2,"width","60px !important",3,"ngModelChange","ngModel","max","zMax"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"]],template:function(e,i){if(e&1&&(s(0,"div",2)(1,"div",3)(2,"span"),b(3,"TIMBRE IMPORTER"),c()(),_(4,Xr,1,1,"ng-template",4),f(5,"async"),_(6,eo,9,4,"ng-template",null,0,J),c()),e&2){let r=q(7);l(4),a("ngIf",g(5,2,i.timbreSupprimService.loadGlob$)==!1)("ngIfElse",r)}},dependencies:[me,te,j,Te,De,Ce,he,Re,ne,Le,Ke,Ze,re,Oe,et,tt,it,Xe,Je,oe,Ne,ce,rt,lt,mt,P],encapsulation:2})};var to=n=>[n];function io(n,t){if(n&1){let e=R();s(0,"lib-icon",2),B("click",function(){x(e);let r=p();return v(r.supprimer())}),c()}if(n&2){let e=p();a("icone",e.FontAwesomeEnum.ROTATE)("type",e.FontAwesomeTypeEnum.TYPE_SOLID)("attribs",bt(4,to,e.FontAwesomeAttributEnum.SPIN))("info","Supprimer en cours")}}function no(n,t){if(n&1){let e=R();s(0,"lib-icon",3),B("click",function(){x(e);let r=p();return v(r.supprimer())}),c()}if(n&2){let e=p();a("icone",e.FontAwesomeEnum.TRASH)("type",e.FontAwesomeTypeEnum.TYPE_SOLID)("info","Supprimer les timbres")}}var Jt=class n{constructor(t,e){this.dialog=t;this.timbreSupprimService=e}FontAwesomeEnum=_e;FontAwesomeTypeEnum=ge;FontAwesomeAttributEnum=ui;supprimer(){this.dialog.open(Zt,{maxHeight:"50vh",width:"300px"})}static \u0275fac=function(e){return new(e||n)(S(se),S(Fe))};static \u0275cmp=$({type:n,selectors:[["app-timbre-supprim"]],decls:4,vars:6,consts:[["class","warn click","style","font-size: 2em",3,"icone","type","attribs","info","click",4,"ngIf"],["class","warn click","style","font-size: 2em",3,"icone","type","info","click",4,"ngIf"],[1,"warn","click",2,"font-size","2em",3,"click","icone","type","attribs","info"],[1,"warn","click",2,"font-size","2em",3,"click","icone","type","info"]],template:function(e,i){e&1&&(_(0,io,1,6,"lib-icon",0),f(1,"async"),_(2,no,1,3,"lib-icon",1),f(3,"async")),e&2&&(a("ngIf",g(1,2,i.timbreSupprimService.loadGlob$)==!1),l(2),a("ngIf",g(3,4,i.timbreSupprimService.loadGlob$)==!0))},dependencies:[j,ve,P],encapsulation:2})};function oo(n,t){if(n&1){let e=R();s(0,"button",9),B("click",function(){x(e);let r=p(2);return v(r.ajouter())}),b(1," Ajouter "),c()}}function lo(n,t){n&1&&(w(0),b(1,"\xA0Bloc"),D())}function mo(n,t){if(n&1){let e=R();w(0),_(1,oo,2,0,"button",8),f(2,"async"),s(3,"button",9),B("click",function(){x(e);let r=p();return v(r.ajouterBloc())}),b(4," Ajouter "),_(5,lo,2,0,"ng-container",3),f(6,"async"),c(),D()}if(n&2){let e=p();l(),a("ngIf",g(2,2,e.headerService.route$)==e.RouteEnum.TIMBRE),l(4),a("ngIf",g(6,4,e.headerService.route$)==e.RouteEnum.TIMBRE)}}function so(n,t){if(n&1){let e=R();w(0),s(1,"lib-icon",11),B("click",function(){let r=x(e).$implicit,o=p(2);return v(o.headerService.setRoute(r.getRoute()))}),c(),D()}if(n&2){let e=t.$implicit;l(),a("icone",e==null?null:e.getIcone())("type",e==null?null:e.getType())("info",e==null?null:e.getInfo())}}function ao(n,t){if(n&1&&(w(0),_(1,so,2,3,"ng-container",10),f(2,"async"),D()),n&2){let e=p();l(),a("ngForOf",g(2,1,e.headerService.choixRoutesTimbre$))}}function co(n,t){if(n&1){let e=R();s(0,"lib-icon",13),B("click",function(){x(e);let r=p(2);return v(r.headerService.mode=r.ModeEnum.TABLE)}),c()}if(n&2){let e=p(2);a("icone",e.FontAwesomeEnum.TABLE)("type",e.FontAwesomeTypeEnum.TYPE_SOLID)("info","Mode tableau")}}function po(n,t){if(n&1){let e=R();s(0,"lib-icon",13),B("click",function(){x(e);let r=p(2);return v(r.headerService.mode=r.ModeEnum.GRAPH)}),c()}if(n&2){let e=p(2);a("icone",e.FontAwesomeEnum.MEMO)("type",e.FontAwesomeTypeEnum.TYPE_SOLID)("info","Mode tableau")}}function uo(n,t){if(n&1&&(w(0),_(1,co,1,3,"ng-template",12)(2,po,1,3,"ng-template",null,0,J),D()),n&2){let e=q(3),i=p();l(),a("ngIf",i.headerService.mode==i.ModeEnum.GRAPH)("ngIfElse",e)}}function bo(n,t){if(n&1){let e=R();s(0,"lib-icon",14),B("click",function(){x(e);let r=p();return v(r.importer())}),c()}if(n&2){let e=p();a("icone",e.FontAwesomeEnum.UPLOAD)("type",e.FontAwesomeTypeEnum.TYPE_SOLID)("info","Importer les timbres")}}function fo(n,t){n&1&&M(0,"app-timbre-supprim",15)}function go(n,t){if(n&1&&(s(0,"mat-option",19),b(1),c()),n&2){let e=t.$implicit;a("value",e),l(),y(" ",e==null?null:e.getPrenom()," ")}}function _o(n,t){if(n&1){let e=R();s(0,"div",16)(1,"mat-select",17),f(2,"async"),B("ngModelChange",function(r){x(e);let o=p();return v(o.setUser(r))}),_(3,go,2,2,"mat-option",18),f(4,"async"),c()()}if(n&2){let e=p();l(),a("ngModel",g(2,3,e.authService.userSelect$))("placeholder","Utilisateur"),l(2),a("ngForOf",g(4,5,e.authService.users$))}}var Ki=class n{constructor(t,e,i,r,o,m){this.authService=t;this.headerService=e;this.timbreService=i;this.timbreBlocService=r;this.timbreUtilsService=o;this.dialog=m;this.verifRoute()}FontAwesomeEnum=_e;RouteEnum=pi;FontAwesomeTypeEnum=ge;DroitEnum=At;ModeEnum=di;ajouter(){let t=this.dialog.open(dt,{maxHeight:"95vh",width:"30%",minWidth:"300px"});t.afterClosed().subscribe(()=>{t.close()})}ajouterBloc(){let t=this.dialog.open(ut,{maxHeight:"95vh",width:"30%",minWidth:"300px"});t.afterClosed().subscribe(()=>{t.close()})}ajouterBouchon(){this.timbreService.ajouterSansId(this.timbreService.getBouchon())}importer(){let t=this.dialog.open(Kt,{height:"90vh",width:"70%",minWidth:"300px"});t.afterClosed().subscribe(()=>{t.close()})}verifRoute(){window.location.href.indexOf("bloc")>0?u(this.timbreUtilsService.timbreCritereBlocModel.getAnnees())&&this.timbreUtilsService.timbreCritereBlocModel.getAnnees().length>0?this.timbreBlocService.getBlocs(this.timbreUtilsService.timbreCritereBlocModel,!0):this.timbreUtilsService.getAnneesAsync("/timbres_bloc").pipe(C(t=>u(t)&&t?.length>0)).subscribe(t=>{this.timbreUtilsService.timbreCritereBlocModel.setAnnees([t[0]]),this.timbreBlocService.getBlocs(this.timbreUtilsService.timbreCritereBlocModel,!0)}):u(this.timbreUtilsService.timbreCritereModel.getAnnees())&&this.timbreUtilsService.timbreCritereModel.getAnnees().length>0?this.timbreService.getTimbres(this.timbreUtilsService.timbreCritereModel,!0):this.timbreUtilsService.getAnneesAsync("/timbres").pipe(C(t=>u(t)&&t?.length>0)).subscribe(t=>{this.timbreUtilsService.timbreCritereModel.setAnnees([t[0]]),this.timbreService.getTimbres(this.timbreUtilsService.timbreCritereModel,!0)})}setUser(t){this.authService.userSelect$.next(t),this.verifRoute(),this.timbreUtilsService.reinitResume$.next(!0)}static \u0275fac=function(e){return new(e||n)(S(X),S(bi),S(Q),S(Y),S(F),S(se))};static \u0275cmp=$({type:n,selectors:[["app-menu"]],decls:21,vars:30,consts:[["modeTable",""],[1,"menu"],[1,"sousMenu","sousMenuBouton"],[4,"ngIf"],[1,"sousMenu"],["class","accent click hide-on-mobile","style","font-size: 2em",3,"icone","type","info","click",4,"ngIf"],["class","hide-on-mobile",4,"ngIf"],["fxLayout","row","fxLayoutAlign","end center","class","form-input select","style","width: 120px",4,"ngIf"],["class","rounded large color-white","mat-raised-button","","color","primary",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],[4,"ngFor","ngForOf"],[1,"primary","click",2,"font-size","2em",3,"click","icone","type","info"],[3,"ngIf","ngIfElse"],[1,"primary","click","hide-on-mobile",2,"font-size","2em",3,"click","icone","type","info"],[1,"accent","click","hide-on-mobile",2,"font-size","2em",3,"click","icone","type","info"],[1,"hide-on-mobile"],["fxLayout","row","fxLayoutAlign","end center",1,"form-input","select",2,"width","120px"],["name","user",1,"scrollBarAccent",3,"ngModelChange","ngModel","placeholder"],["class","selectMin",3,"value",4,"ngFor","ngForOf"],[1,"selectMin",3,"value"]],template:function(e,i){if(e&1&&(s(0,"div",1)(1,"div",2),_(2,mo,7,6,"ng-container",3),f(3,"async"),c(),s(4,"div",4),_(5,ao,3,3,"ng-container",3),f(6,"async"),_(7,uo,4,2,"ng-container",3),f(8,"async"),f(9,"async"),f(10,"async"),_(11,bo,1,3,"lib-icon",5),f(12,"async"),f(13,"async"),_(14,fo,1,0,"app-timbre-supprim",6),f(15,"async"),f(16,"async"),_(17,_o,5,7,"div",7),f(18,"async"),f(19,"async"),f(20,"async"),c()()),e&2){let r,o,m,d,T,h;l(2),a("ngIf",((r=g(3,6,i.authService.user$))==null?null:r.getDroit())==i.DroitEnum.TOTAL),l(3),a("ngIf",((o=g(6,8,i.headerService.choixRoutesTimbre$))==null?null:o.length)>0),l(2),a("ngIf",((m=g(8,10,i.authService.user$))==null?null:m.getDroit())==i.DroitEnum.TOTAL&&(g(9,12,i.headerService.route$)==i.RouteEnum.TIMBRE||g(10,14,i.headerService.route$)==i.RouteEnum.BLOC)),l(4),a("ngIf",((d=g(12,16,i.authService.user$))==null?null:d.getDroit())==i.DroitEnum.TOTAL&&g(13,18,i.headerService.route$)==i.RouteEnum.TIMBRE),l(3),a("ngIf",((T=g(15,20,i.authService.user$))==null?null:T.getDroit())==i.DroitEnum.TOTAL&&g(16,22,i.headerService.route$)==i.RouteEnum.TIMBRE),l(3),a("ngIf",(((h=g(18,24,i.authService.user$))==null?null:h.getDroit())==i.DroitEnum.TOTAL||((h=g(19,26,i.authService.user$))==null?null:h.getDroit())==i.DroitEnum.CONSULT_TOTAL)&&((h=g(20,28,i.authService.users$))==null?null:h.length)>0)}},dependencies:[ie,j,Te,Ce,re,oe,ve,me,Jt,le,ae,P],styles:[".menu[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:10px;padding:0 5px}.menu[_ngcontent-%COMP%]   .sousMenu[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:15px}@media screen and (max-width: 800px){.menu[_ngcontent-%COMP%]{flex-direction:column}.menu[_ngcontent-%COMP%]   .sousMenuBouton[_ngcontent-%COMP%]{justify-content:space-between}.menu[_ngcontent-%COMP%]   .sousMenu[_ngcontent-%COMP%]{gap:10px}}"]})};export{ee as a,ue as b,Z as c,F as d,ct as e,pt as f,Y as g,Q as h,zt as i,kt as j,Gt as k,Yt as l,Qt as m,Kt as n,Ki as o,zi as p};

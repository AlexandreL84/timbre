import{a as pe,b as bt,c as xe}from"./chunk-TKPOVYQD.js";import{a as ci,b as pi}from"./chunk-O4K5XKVZ.js";import{a as Ce,b as Pe,c as Ne,d as ae,e as wt,f as ot,g as lt,h as Dt,i as mt,j as Zi,k as Rt,q as qi}from"./chunk-MRAKJ2GI.js";import{e as At,f as $e}from"./chunk-I7IONR3M.js";import{c as nt,d as se,g as rt}from"./chunk-6K26VDAP.js";import{l as I,m as Be,n as Ie,o as Et,u as ze,v as J}from"./chunk-WOTJWQDQ.js";import{a as _i}from"./chunk-MJBYZQPI.js";import{$ as We,Aa as b,Ab as Ae,Ac as Bt,Ba as Mt,Bb as we,Bc as It,Ca as y,Cb as ge,Cc as xi,D as vt,Db as _e,Dc as vi,Ea as li,Ec as yi,Fa as V,Fb as ui,Fc as Si,Ga as k,Gb as Qe,Gc as Mi,H as Ee,Ha as H,Hc as Ei,I as ni,Ic as Bi,Jb as ie,Jc as Ii,K as L,Kb as De,Kc as Ai,La as dt,Lb as Re,Lc as wi,M as j,Mb as ne,Mc as Di,N as ri,Na as f,Nb as Oe,Nc as Ri,Oa as g,Ob as Ke,Oc as Oi,P as yt,Pa as Z,Pb as Ze,Pc as Ni,Qb as Je,Qc as Yt,Rb as Xe,S as x,Sb as et,Sc as he,T as v,Tb as tt,Tc as Li,Ub as di,Vb as bi,Wb as re,Xa as X,Xb as fi,Ya as ee,Yb as gi,Za as P,aa as St,ab as $,ba as l,bb as mi,c as N,ca as M,ha as _,ia as s,ic as it,jc as oe,k as ue,kc as Ti,l as Q,ma as m,mc as Te,na as c,nb as si,oa as S,ob as u,oc as le,pa as w,pb as G,qa as D,sa as R,ta as E,tc as hi,ua as p,ub as de,uc as me,va as oi,vb as be,wa as Fe,wb as ai,x as C,xa as Ue,xb as te,xc as Ci,ya as je,yb as Ye,za as F,zb as fe}from"./chunk-XHCW746T.js";import{f as Ki,g as B}from"./chunk-GOLCFQAC.js";var K=class extends Be{idUser;idTimbre;acquis;doublon;constructor(t,e,i,r){super(),this.idUser=t||null,this.idTimbre=e||null,this.acquis=i||!1,this.doublon=r||!1}getIdUser(){return this.idUser}setIdUser(t){this.idUser=t}getIdTimbre(){return this.idTimbre}setIdTimbre(t){this.idTimbre=t}isAcquis(){return this.acquis}setAcquis(t){this.acquis=t}isDoublon(){return this.doublon}setDoublon(t){this.doublon=t}};B([I("Identifiant Utilisateur")],K.prototype,"idUser",2),B([I("Identifiant timbre")],K.prototype,"idTimbre",2),B([I("Acquis")],K.prototype,"acquis",2),B([I("Doublon")],K.prototype,"doublon",2);var ft=class{key;dossier;maxWidth;maxHeight;getKey(){return this.key}setKey(t){this.key=t}getDossier(){return this.dossier}setDossier(t){this.dossier=t}getMaxWidth(){return this.maxWidth}setMaxWidth(t){this.maxWidth=t}getMaxHeight(){return this.maxHeight}setMaxHeight(t){this.maxHeight=t}};var Le=class{dossier;nom;alignLabel;detail;file;getDossier(){return this.dossier}setDossier(t){this.dossier=t}getNom(){return this.nom}setNom(t){this.nom=t}getAlignLabel(){return this.alignLabel}setAlignLabel(t){this.alignLabel=t}getDetail(){return this.detail}setDetail(t){this.detail=t}getFile(){return this.file}setFile(t){this.file=t}};var U=class n{constructor(t,e){this.authService=t;this.firestore=e}reinitResume$=new N(!0);initUpload(){let t=new Le;t.setDossier("table"),t.setNom(new Date().getTime()?.toString());let e=new ft;e.setMaxWidth(100),e.setMaxHeight(100),e.setDossier("autre");let i=new ft;return i.setMaxWidth(700),i.setMaxHeight(700),i.setDossier("zoom"),t.setDetail([e,i]),t}getAnneesAsync(t){return this.firestore.collection(t,e=>{let i=e;return i=i.orderBy("annee","desc"),i}).valueChanges().pipe(ue(e=>{let i=e.map(r=>Number(r.annee)).filter(r=>u(r)&&r!=0);return Array.from(new Set(i))}))}getTimbresByCritereAsync(t){return this.getAllTimbres(t).pipe(ue(e=>this.constructTimbres(e,null,null)))}getAllTimbres(t){return this.firestore.collection("/timbres",e=>{let i=e;return u(t)&&(u(t.getAnnees())&&t.getAnnees()?.length>0&&(i=i.where("annee","in",t.getAnnees())),t?.getType()?.length==0||t?.getType()?.length==1&&t?.getType()?.find(r=>r=="TIMBRE")?i=i.where("idBloc","==",null):t?.getType()?.length>0&&!t?.getType()?.find(r=>r=="TIMBRE")?i=i.where("idBloc","!=",null):u(t.getIdBloc())&&(i=i.where("idBloc","==",t.getIdBloc()))),i=i.orderBy("id","asc"),i}).valueChanges()}constructTimbres(t,e,i,r){let o=[];return t?.length>0&&t.forEach(a=>{let d=this.constructTimbre(a,e,i),T=!1;u(r)?((r?.getType()?.find(h=>h=="TIMBRE")&&G(d?.getTimbreBlocModel())||r?.getType()?.find(h=>h=="BLOC")&&u(d?.getTimbreBlocModel())&&d?.getTimbreBlocModel()?.getType()=="BLOC"||r?.getType()?.find(h=>h=="CARNET")&&u(d?.getTimbreBlocModel())&&d?.getTimbreBlocModel()?.getType()=="CARNET")&&(T=!0),u(d.getTimbreAcquisModel())&&(u(r.getAcquis())&&!(r.getAcquis()=="TOUS"||r.getAcquis()=="OUI"&&d.getTimbreAcquisModel().isAcquis()||r.getAcquis()=="NON"&&!d.getTimbreAcquisModel().isAcquis())&&(T=!1),u(r.getDoublon())&&!(r.getDoublon()=="TOUS"||r.getDoublon()=="OUI"&&d.getTimbreAcquisModel().isDoublon()||r.getDoublon()=="NON"&&!d.getTimbreAcquisModel().isDoublon())&&(T=!1))):T=!0,T==!0&&o.push(d)}),o}constructTimbre(t,e,i){let r=Ie(Ce,t);if(u(i)){let o=i.find(a=>a.getId()==r?.getIdBloc());u(o)&&r.setTimbreBlocModel(o)}if(u(e)){let o=e.find(a=>a.idTimbre==r.getId());u(o)?r.setTimbreAcquisModel(Ie(K,o)):r.setTimbreAcquisModel(new K)}return r}supprimerTimbreAcquis(t){this.firestore.collection("/timbres_acquis").ref.where("idTimbre","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.delete()})})}supprimerTimbre(t){this.firestore.collection("/timbres").ref.where("id","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.delete()})}).catch(e=>{console.error("Erreur de suppression :",e)})}acquis(t,e,i){this.authService.userSelect$.pipe(C(r=>u(r))).subscribe(r=>{this.firestore.collection("/timbres_acquis").ref.where("idTimbre","==",t.getId()).where("idUser","==",r.getId()).get().then(o=>{o?.size==0&&this.addAcquis(r.getId(),t,e),o.forEach(a=>{let d=Ie(K,a.data());e?(d.setAcquis(!0),d.setDoublon(i||!d.isDoublon())):(d.setAcquis(i||!d.isAcquis()),d.isAcquis()||d.setDoublon(!1)),a.ref.update(Object.assign(new Object,d)).then(T=>{t.setTimbreAcquisModel(d)}).catch(T=>{console.error("Erreur de mise \xE0 jour:",T)})})}).catch(o=>{console.error("Erreur de mise \xE0 jour id introuvable :",o)}),this.reinitResume$.next(!0)})}supprimerAcquisTimbreByUser(t,e,i,r){this.firestore.collection("/timbres_acquis").ref.where("idTimbre","==",e.getId()).where("idUser","==",t).get().then(o=>{o?.size==0&&r&&this.addAcquis(t,e,i),o.forEach(a=>{a.ref.delete().then(d=>{r&&this.supprimerTimbreAcquis(e)})})}).catch(o=>{console.error("Erreur de suppression :",o)})}addAcquis(t,e,i){let r=new K;r.setIdUser(t),r.setIdTimbre(e.getId()),r.setAcquis(!0),r.setDoublon(i),e.setTimbreAcquisModel(r),this.firestore.collection("/timbres_acquis").add(Object.assign(new Object,r))}static \u0275fac=function(e){return new(e||n)(L(J),L(ze))};static \u0275prov=Ee({token:n,factory:n.\u0275fac})};var ce=class extends Be{idUser;idBloc;acquis;doublon;constructor(t,e,i,r){super(),this.idUser=t||null,this.idBloc=e||null,this.acquis=i||!1,this.doublon=r||!1}getIdUser(){return this.idUser}setIdUser(t){this.idUser=t}getIdBloc(){return this.idBloc}setIdBloc(t){this.idBloc=t}isAcquis(){return this.acquis}setAcquis(t){this.acquis=t}isDoublon(){return this.doublon}setDoublon(t){this.doublon=t}};B([I("Identifiant Utilisateur")],ce.prototype,"idUser",2),B([I("Identifiant bloc")],ce.prototype,"idBloc",2),B([I("Acquis")],ce.prototype,"acquis",2),B([I("Doublon")],ce.prototype,"doublon",2);var at=class n{transform(t,e){let i=[],r=Object.keys(t),o=Object.values(t);for(let a=0;a<r.length;a++)i.push({key:r[a],value:o[a]});return e=="sort"?i?.sort(function(a,d){return a.key<d.key?-1:a.key>d.key?1:0}):i}static \u0275fac=function(e){return new(e||n)};static \u0275pipe=yt({name:"enumToArray",type:n,pure:!0})};var ct=class n{transform(t,e){return u(t)&&typeof t=="string"?(t=t.toLowerCase(),t.charAt(0).toUpperCase()+t.slice(1)):t}static \u0275fac=function(e){return new(e||n)};static \u0275pipe=yt({name:"capitalize",type:n,pure:!0})};var rn=["canvas"];function on(n,t){n&1&&S(0,"lib-spinner",5),n&2&&s("textSpec","Chargement en cours ...")}function ln(n,t){if(n&1&&(S(0,"mat-error",23),f(1,"async")),n&2){let e=p(2);s("innerHTML",g(1,1,e.messageError$),We)}}function mn(n,t){if(n&1&&(m(0,"mat-option",25),b(1),f(2,"capitalize"),c()),n&2){let e=p().$implicit;s("value",e.value),l(),y(" ",g(2,2,e.value)," ")}}function sn(n,t){if(n&1&&(w(0),_(1,mn,3,4,"mat-option",24),D()),n&2){let e=t.$implicit,i=p(2);l(),s("ngIf",e.value!=i.TypeTimbreEnum.TIMBRE)}}function an(n,t){if(n&1){let e=R();m(0,"form",6,1),E("ngSubmit",function(){x(e);let r=F(1),o=p();return v(o.valider(r))}),m(2,"div",7),_(3,ln,2,3,"mat-error",8),f(4,"async"),m(5,"div",9)(6,"div",10)(7,"label"),S(8,"lib-libelle-model",11),c(),m(9,"input",12),H("ngModelChange",function(r){x(e);let o=p();return k(o.timbreBlocModel.annee,r)||(o.timbreBlocModel.annee=r),v(r)}),c()(),m(10,"div",13)(11,"label"),S(12,"lib-libelle-model",11),c(),m(13,"mat-select",14),H("ngModelChange",function(r){x(e);let o=p();return k(o.timbreBlocModel.type,r)||(o.timbreBlocModel.type=r),v(r)}),_(14,sn,2,1,"ng-container",15),f(15,"enumToArray"),c()()(),m(16,"div",10)(17,"label"),S(18,"lib-libelle-model",11),c(),m(19,"input",16),H("ngModelChange",function(r){x(e);let o=p();return k(o.timbreBlocModel.monnaie,r)||(o.timbreBlocModel.monnaie=r),v(r)}),c()(),m(20,"div",9)(21,"div",10)(22,"label"),S(23,"lib-libelle-model",11),c(),m(24,"input",17),H("ngModelChange",function(r){x(e);let o=p();return k(o.timbreBlocModel.yt,r)||(o.timbreBlocModel.yt=r),v(r)}),c()(),S(25,"div",18),c(),m(26,"lib-upload",19),E("outPutObject",function(r){x(e);let o=p();return v(o.timbreBlocModel=r)}),c()(),m(27,"div",20)(28,"button",21),E("click",function(){x(e);let r=p();return v(r.close())}),b(29," Annuler "),c(),m(30,"button",22),b(31," Enregistrer "),c()()()}if(n&2){let e=F(1),i=p();s("ngClass",e!=null&&e.submitted?"red-color":"blue-color"),l(3),s("ngIf",g(4,23,i.messageError$)),l(5),s("object",i.timbreBlocModel)("key","annee"),l(),V("ngModel",i.timbreBlocModel.annee),s("max",i.maxAnnee)("zMax",i.maxAnnee),l(3),s("object",i.timbreBlocModel)("key","type"),l(),V("ngModel",i.timbreBlocModel.type),s("placeholder","Type"),l(),s("ngForOf",g(15,25,i.TypeTimbreEnum)),l(4),s("object",i.timbreBlocModel)("key","monnaie"),l(),V("ngModel",i.timbreBlocModel.monnaie),l(4),s("object",i.timbreBlocModel)("key","yt"),l(),V("ngModel",i.timbreBlocModel.yt),l(2),s("object",i.timbreBlocModel)("key","image")("zoom",i.timbreBlocModel.getImageZoom())("maxWidth",i.DimensionImageEnum.WIDTH_TIMBRE)("maxHeight",i.DimensionImageEnum.HEIGTH_TIMBRE)}}var pt=class n{constructor(t,e,i,r,o){this.httpResponseHandlerService=t;this.dialogRef=e;this.utilsService=i;this.timbreBlocService=r;this.timbreUtilsService=o}canvas;messageError$=new N(null);load$=new N(null);id;maxAnnee=new Date().getFullYear()+1;timbreBlocModel=new Ne;fileUploadModel=new Le;DimensionImageEnum=Pe;TypeTimbreEnum=pe;ngOnInit(){this.fileUploadModel=this.timbreUtilsService.initUpload(),this.load$.next(!1),u(this.id)?this.timbreBlocService.getBlocByIdAsync(this.id).subscribe(t=>{this.timbreBlocModel=t,this.load$.next(!0)}):(this.timbreBlocModel.setAnnee(new Date().getFullYear()),this.timbreBlocModel.setMonnaie("E"),this.load$.next(!0))}valider(t){if(this.messageError$.next(null),t?.valid)if(u(this.timbreBlocModel.getImage()))this.saveData();else{this.messageError$.next("Veuillez s\xE9lectionner une image");return}}saveData(){this.load$.next(!1),u(this.timbreBlocModel.getId())?this.save():this.ajouter()}ajouter(){this.utilsService.getMaxIdentAsync("/timbres_bloc").pipe(C()).subscribe(t=>{this.timbreBlocModel.setId(t),this.save(!0)})}save(t){try{Q([this.timbreBlocService.upload(this.timbreBlocModel,"autre"),this.timbreBlocService.upload(this.timbreBlocModel,"table"),this.timbreBlocService.upload(this.timbreBlocModel,"zoom")]).pipe(C(([e,i,r])=>u(e)&&u(r)&&u(i))).subscribe(([e,i,r])=>{u(e)&&e!="nok"&&this.timbreBlocModel.setImage(e),u(i)&&i!="nok"&&this.timbreBlocModel.setImageTable(i),u(r)&&r!="nok"&&this.timbreBlocModel.setImageZoom(r),t?this.timbreBlocService.ajouter(this.timbreBlocModel,!0):this.timbreBlocService.modifier(this.timbreBlocModel),this.httpResponseHandlerService.showNotificationSuccess("Transaction termin\xE9e","Votre timbre a bien \xE9t\xE9 modifi\xE9e."),this.load$.next(!0),this.dialogRef.close()})}catch{this.httpResponseHandlerService.showNotificationError("Transaction non aboutie","Votre timbre n'a pas pu \xEAtre modifi\xE9."),this.load$.next(!0)}}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||n)(M(At),M(Te),M(ae),M(z),M(U))};static \u0275cmp=j({type:n,selectors:[["app-timbre-modifier-bloc"]],viewQuery:function(e,i){if(e&1&&Fe(rn,5),e&2){let r;Ue(r=je())&&(i.canvas=r.first)}},decls:10,vars:6,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],[3,"ngIf","ngIfElse"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","space-between stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","column","fxLayoutGap","20px",1,"bloc-modal"],[3,"innerHTML",4,"ngIf"],["fxLayout","row","fxLayout.lt-lg","column","fxLayoutGap","30px","fxLayoutGap.lt-lg","5px"],["fxLayout","column",1,"form-input"],[3,"object","key"],["name","page","type","number","minlength","4","maxlength","4","min","1900","zMin","1900","required","","zControl","",1,"annee",2,"width","60px !important",3,"ngModelChange","ngModel","max","zMax"],[1,"form-input","select"],["name","type",1,"scrollBarAccent",2,"width","100px",3,"ngModelChange","ngModel","placeholder"],[4,"ngFor","ngForOf"],["name","monnaie","type","text","trim","","minlength","1","maxlength","2","required","","zControl","",2,"width","25px !important",3,"ngModelChange","ngModel"],["name","yt","type","text","trim","","zControl","",3,"ngModelChange","ngModel"],["fxHide.lt-lg","","fxLayout","column",1,"form-input"],[3,"outPutObject","object","key","zoom","maxWidth","maxHeight"],["fxLayout","row","fxLayoutGap","10px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"],[3,"innerHTML"],["class","selectMin",3,"value",4,"ngIf"],[1,"selectMin",3,"value"]],template:function(e,i){if(e&1&&(m(0,"div",2)(1,"div",3)(2,"span"),b(3),c(),m(4,"span"),b(5),c()(),_(6,on,1,1,"ng-template",4),f(7,"async"),_(8,an,32,27,"ng-template",null,0,Z),c()),e&2){let r=F(9);l(3),y("",i.timbreBlocModel!=null&&i.timbreBlocModel.getId()?"MODIFICATION":"AJOUT"," BLOC "),l(2),Mt(i.timbreBlocModel==null?null:i.timbreBlocModel.getId()),l(),s("ngIf",g(7,4,i.load$)==!1)("ngIfElse",r)}},dependencies:[oe,it,me,re,X,ee,P,fe,Ae,_e,ge,we,Ye,te,Oe,Qe,Ke,ie,De,Xe,et,tt,Je,Ze,ne,Re,rt,se,nt,wt,ot,lt,Dt,$,at,ct],encapsulation:2})};var ke=class extends Be{type;total;constructor(t,e){super(),this.type=t||null,this.total=e||null}getType(){return this.type}setType(t){this.type=t}getTotal(){return this.total}setTotal(t){this.total=t}};B([I("Type")],ke.prototype,"type",2),B([I("Total")],ke.prototype,"total",2);var z=class n{constructor(t,e,i,r,o,a,d){this.firestore=t;this.authService=e;this.uploadService=i;this.utilsService=r;this.timbreUtilsService=o;this.dialog=a;this.preferenceService=d}total$=new N([]);timbresBlocModel$=new N(null);load$=new N(!1);upload(t,e,i){let r=100,o=100;return e=="table"?(r=r*(50/o),o=50):e=="zoom"&&(r=r*(700/o),o=700),this.uploadService.processAndUploadImage(t?.getImage(),r,o,"bloc-"+t.getId(),this.getDossier(t,e,i))}setTotal(t,e){this.total$.pipe(C()).subscribe(i=>{let r=i.find(o=>o.getType()==t?.getType());u(r)?r.setTotal(r.getTotal()+1):i.push(new ke(t?.getType(),1)),this.total$.next(i)})}getTotal(t){this.total$.next(null),this.getAllBlocs(t).subscribe(e=>{let i=[];Object.keys(pe).forEach(r=>{r!="TIMBRE"&&i.push(new ke(r,e?.filter(o=>o.type==r)?.length))}),this.total$.next(i)})}getBloc(t){return this.firestore.collection("/timbres_bloc",e=>e.where("id","==",t)).valueChanges()}getBlocByIdAsync(t){return this.getBloc(t).pipe(ue(e=>Ie(Ne,e[0])))}getRef(t,e){let i=t;return u(e)&&(u(e.getAnnees())&&e.getAnnees()?.length>0&&(i=i.where("annee","in",e.getAnnees())),u(e.getType())&&e.getType()?.length>0&&(i=i.where("type","in",e.getType()))),i=i.orderBy("id",e?.getSort()=="desc"?"desc":"asc"),i}getAllBlocs(t){return this.firestore.collection("/timbres_bloc",e=>this.getRef(e,t)).valueChanges()}getTimbreBlocAcquis(){return this.authService.userSelect$.pipe(C(t=>u(t)),vt(t=>u(t)?this.getTimbreBlocAcquisByUser(t.getId()).pipe(C(),ue(e=>e)):null))}getTimbreBlocAcquisByUser(t){return this.firestore.collection("/timbres_bloc_acquis",e=>e.where("idUser","==",t)).valueChanges()}getBlocs(t,e){this.load$.next(!1),this.timbresBlocModel$.next(null),e&&this.getTotal(),Q([this.getAllBlocs(t),this.getTimbreBlocAcquis()]).pipe(C()).subscribe(([i,r])=>{this.timbresBlocModel$.next(this.constructBlocs(i,r,t)),this.load$.next(!0)})}getBlocsAsync(t){return this.timbresBlocModel$.next(null),this.getAllBlocs(t).pipe(C(),ue(e=>this.constructBlocs(e,null,t)))}constructBloc(t,e){let i=Ie(Ne,t);if(u(e)){let r=e.find(o=>o.idBloc==i.getId());u(r)?i.setTimbreBlocAcquisModel(Ie(ce,r)):i.setTimbreBlocAcquisModel(new ce)}return i}constructBlocs(t,e,i){let r=[];return t?.length>0&&t.forEach(o=>{let a=this.constructBloc(o,e);this.getTimbresByBlocAsync(a.getId()).subscribe(T=>{a.setNbTimbres(T?.length)});let d=!0;u(i)?u(a.getTimbreBlocAcquisModel())&&(u(i.getAcquis())&&!(i.getAcquis()=="TOUS"||i.getAcquis()=="OUI"&&a.getTimbreBlocAcquisModel().isAcquis()||i.getAcquis()=="NON"&&!a.getTimbreBlocAcquisModel().isAcquis())&&(d=!1),u(i.getDoublon())&&!(i.getDoublon()=="TOUS"||i.getDoublon()=="OUI"&&a.getTimbreBlocAcquisModel().isDoublon()||i.getDoublon()=="NON"&&!a.getTimbreBlocAcquisModel().isDoublon())&&(d=!1)):d=!0,d==!0&&r.push(a)}),r}acquis(t,e){return this.authService.userSelect$.pipe(C(i=>u(i))).subscribe(i=>{u(t?.getTimbreBlocAcquisModel()?.getIdUser())?this.firestore.collection("/timbres_bloc_acquis").ref.where("idBloc","==",t.getId()).where("idUser","==",i.getId()).get().then(r=>{r.forEach(o=>{let a=t.getTimbreBlocAcquisModel();e?(a.setAcquis(!0),a.setDoublon(!a.isDoublon())):(a.setAcquis(!a.isAcquis()),a.isAcquis()||a.setDoublon(!1)),o.ref.update(Object.assign(new Object,a)).then(d=>{t.setTimbreBlocAcquisModel(a)}).catch(d=>{console.error("Erreur de mise \xE0 jour:",d)})})}).catch(r=>{console.error("Erreur de mise \xE0 jour:",r)}):this.addAcquis(i?.getId(),t,e),this.timbreUtilsService.reinitResume$.next(!0)})}addAcquis(t,e,i){let r=new ce;r.setIdUser(t),r.setIdBloc(e.getId()),r.setAcquis(!0),r.setDoublon(i),e.setTimbreBlocAcquisModel(r),this.firestore.collection("/timbres_bloc_acquis").add(Object.assign(new Object,r))}ajouterSansId(t){this.utilsService.getMaxIdentAsync("/timbres_bloc").pipe(C()).subscribe(e=>{t.setId(e),this.ajouter(t,!0)})}ajouter(t,e){this.getBloc(t.getId()).pipe(C()).subscribe(i=>{G(i)||G(i[0])||u(i[0])&&i[0]?.length==0?(t.setTimbreBlocAcquisModel(null),t.setIdOrigine(null),this.firestore.collection("/timbres_bloc").add(Object.assign(new Object,t)).then(r=>{this.preferenceService.getTimbreCritere("timbreCritere").pipe(C()).subscribe(o=>{u(o.getAnnees().find(a=>a==t.getAnnee()))&&this.timbresBlocModel$.pipe(C()).subscribe(a=>{a.push(t),this.setTotal(t,1)})}),this.timbreUtilsService.reinitResume$.next(!0)}).catch(r=>{console.error("Erreur d'ajout :",r)})):console.error("bloc "+t.getId()+" d\xE9j\xE0 existant")})}isCarnet(t){this.authService.user$.pipe(C(e=>u(e))).subscribe(e=>{e?.getDroit()>=9?(t.getType()=="BLOC"?t.setType("CARNET"):t.getType()=="CARNET"?t.setType("COLLECTOR"):t.setType("BLOC"),this.modifier(t)):this.utilsService.droitInsuffisant()})}modifier(t){t.setTimbreBlocAcquisModel(null),this.firestore.collection("/timbres_bloc").ref.where("id","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.update(Object.assign(new Object,t)).then(r=>{this.timbresBlocModel$.pipe(C(o=>u(o)&&o?.length>0)).subscribe(o=>{let a=o.find(d=>d.getId()==t.getId());u(a)&&Object.assign(a,t)})}).catch(r=>{console.error("Erreur de mise \xE0 jour :",r)})})}).catch(e=>{console.error("Erreur de mise \xE0 jour id introuvable :",e)})}getTimbresByBlocAsync(t){let e=new bt;return e.setIdBloc(t),this.timbreUtilsService.getTimbresByCritereAsync(e)}supprimer(t){this.getTimbresByBlocAsync(t.getId()).pipe(C()).subscribe(e=>{e.forEach(i=>{this.timbreUtilsService.supprimerTimbreAcquis(i),this.timbreUtilsService.supprimerTimbre(i)})}),this.firestore.collection("/timbres_bloc_acquis").ref.where("idBloc","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.delete()})}),this.firestore.collection("/timbres_bloc").ref.where("id","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.delete().then(r=>{this.timbresBlocModel$.pipe(C()).subscribe(o=>{let a=o.findIndex(d=>d.getId()==t.getId());a>=0&&(o.splice(a,1),this.setTotal(t,-1))})}).catch(r=>{console.error("Erreur de suppression :",r)})})}).catch(e=>{console.error("Erreur de suppression id introuvable :",e)}),this.timbreUtilsService.reinitResume$.next(!0)}getDossier(t,e,i){let r="timbre//"+t.getAnnee();return u(e)&&(r=r+"/"+e),r=r+"/bloc/"+(u(i)?i:t.getId()),r}getBouchon(){let t=new Ne;return t.setAnnee(new Date().getFullYear()),t.setMonnaie("E"),t}acquisDoublon(t,e){this.authService.user$.pipe(C(i=>u(i))).subscribe(i=>{i?.getDroit()>=9?t?.getType()=="CARNET"?this.acquisCarnetDialog(t,e):this.acquis(t,e):this.utilsService.droitInsuffisant()})}acquisCarnetDialog(t,e){let i="";t?.getTimbreBlocAcquisModel()?.isDoublon()&&e?i="enlever les doublons":t?.getTimbreBlocAcquisModel()?.isAcquis()?i="enlever les acquis":i="mettre en "+(e?"doublon":"acquis")+" tous";let r=this.dialog.open($e,{maxHeight:"95vh",data:{titre:"Confirmation",message:"Souhaitez-vous <b>"+i+"</b> les timbres du "+t?.getType()?.toLowerCase()+" ?",btnDroite:"Oui",btnGauche:"Non"}});r.afterClosed().subscribe(()=>{r.componentInstance.data.resultat==="valider"&&this.authService.userSelect$.pipe(C(o=>u(o))).subscribe(o=>{this.getTimbresByBlocAsync(t.getId()).pipe(C()).subscribe(a=>{a.forEach(d=>{this.timbreUtilsService.acquis(d,e,!t?.getTimbreBlocAcquisModel()?.isAcquis())})}),this.acquis(t,e)})})}modifierDialog(t){let e=this.dialog.open(pt,{height:"75vh",maxHeight:"750px",width:"30%"});e.componentInstance.id=t.getId(),e.afterClosed().subscribe(()=>{e.close()})}supprimerDialog(t){this.getTimbresByBlocAsync(t.getId()).pipe(C()).subscribe(e=>{let i="";u(e)&&e?.length>0&&(i="<span class='warn'>Attention <b>"+e.length+"</b> timbre",e?.length>1?i+="s sont reli\xE9s":i+=" est reli\xE9",i+=" \xE0 ce bloc.</span></br></br>"),i+="Souhaitez-vous supprimer le bloc <b>n\xB0 "+t?.getId()+"</b> ?";let r=this.dialog.open($e,{maxHeight:"95vh",data:{titre:"Confirmation",message:i,btnDroite:"Oui",btnGauche:"Non"}});r.afterClosed().subscribe(()=>{r.componentInstance.data.resultat==="valider"&&this.supprimer(t)})})}modifAll(){let t=new bt;this.getAllBlocs(t).pipe(C(e=>e?.length>0)).subscribe(e=>{e.forEach(i=>{i.carnet==!0?i.type="CARNET":i.type="BLOC",this.firestore.collection("/timbres_bloc").ref.where("id","==",i.id).get().then(r=>{r.forEach(o=>{o.ref.update(i)})})})})}static \u0275fac=function(e){return new(e||n)(L(ze),L(J),L(mt),L(ae),L(U),L(le),L(xe))};static \u0275prov=Ee({token:n,factory:n.\u0275fac})};var cn=["canvas"];function pn(n,t){if(n&1&&(m(0,"span",6)(1,"b"),b(2),c()()),n&2){let e=p();l(2),y("N\xB0",e.timbreModel==null?null:e.timbreModel.getId(),"")}}function un(n,t){n&1&&S(0,"lib-spinner",7),n&2&&s("textSpec","Chargement en cours ...")}function dn(n,t){if(n&1&&(S(0,"mat-error",29),f(1,"async")),n&2){let e=p(2);s("innerHTML",g(1,1,e.messageError$),We)}}function bn(n,t){if(n&1&&(m(0,"mat-option",18),b(1),c()),n&2){let e=t.$implicit,i=p(2);s("value",e),l(),li(" ",e.getAnnee()," - ",e.getId()," ",(e==null?null:e.getType())==i.TypeTimbreEnum.CARNET?" (carnet)":""," ")}}function fn(n,t){if(n&1){let e=R();m(0,"img",30),E("click",function(){let r;x(e);let o=p(2);return v(o.utilsService.zoom(o.timbreModel==null||(r=o.timbreModel.getTimbreBlocModel())==null?null:r.getImageZoom()))}),c()}if(n&2){let e,i=p(2);s("src",i.timbreModel==null||(e=i.timbreModel.getTimbreBlocModel())==null?null:e.getImage(),St)}}function gn(n,t){if(n&1){let e=R();m(0,"form",8,1),E("ngSubmit",function(){x(e);let r=F(1),o=p();return v(o.valider(r))}),m(2,"div",9),_(3,dn,2,3,"mat-error",10),f(4,"async"),m(5,"div",11)(6,"div",12)(7,"label"),S(8,"lib-libelle-model",13),c(),m(9,"input",14),H("ngModelChange",function(r){x(e);let o=p();return k(o.timbreModel.annee,r)||(o.timbreModel.annee=r),v(r)}),E("ngModelChange",function(r){x(e);let o=p();return v(o.changeAnnee(r))}),c()(),m(10,"div",15)(11,"label"),S(12,"lib-libelle-model",13),c(),m(13,"div",16)(14,"mat-select",17),f(15,"async"),E("ngModelChange",function(r){x(e);let o=p();return v(o.changeBloc(r))}),S(16,"mat-option",18),_(17,bn,2,4,"mat-option",19),f(18,"async"),c(),_(19,fn,1,1,"img",20),c()()(),m(20,"div",11)(21,"div",12)(22,"label"),S(23,"lib-libelle-model",13),c(),m(24,"input",21),H("ngModelChange",function(r){x(e);let o=p();return k(o.timbreModel.type,r)||(o.timbreModel.type=r),v(r)}),c()(),m(25,"div",12)(26,"label"),S(27,"lib-libelle-model",13),c(),m(28,"input",22),H("ngModelChange",function(r){x(e);let o=p();return k(o.timbreModel.monnaie,r)||(o.timbreModel.monnaie=r),v(r)}),c()()(),m(29,"div",11)(30,"div",12)(31,"label"),S(32,"lib-libelle-model",13),c(),m(33,"input",23),H("ngModelChange",function(r){x(e);let o=p();return k(o.timbreModel.yt,r)||(o.timbreModel.yt=r),v(r)}),c()(),S(34,"div",24),c(),m(35,"lib-upload",25),E("outPutObject",function(r){x(e);let o=p();return v(o.timbreModel=r)}),c()(),m(36,"div",26)(37,"button",27),E("click",function(){x(e);let r=p();return v(r.close())}),b(38," Annuler "),c(),m(39,"button",28),b(40," Enregistrer "),c()()()}if(n&2){let e,i,r=F(1),o=p();s("ngClass",r!=null&&r.submitted?"red-color":"blue-color"),l(3),s("ngIf",g(4,31,o.messageError$)),l(5),s("object",o.timbreModel)("key","annee"),l(),V("ngModel",o.timbreModel.annee),s("max",o.maxAnnee)("zMax",o.maxAnnee)("disabled",!!(o.timbreModel!=null&&o.timbreModel.getId())),l(3),s("object",o.timbreModel)("key","timbreBlocModel"),l(2),s("ngModel",o.timbreModel.getTimbreBlocModel())("placeholder","Choix bloc")("disabled",!!(o.timbreModel!=null&&o.timbreModel.getId())||((e=g(15,33,o.timbreBlocService.timbresBlocModel$))==null?null:e.length)<=0),l(2),s("value",null),l(),s("ngForOf",g(18,35,o.timbreBlocService.timbresBlocModel$)),l(2),s("ngIf",o.timbreModel==null||(i=o.timbreModel.getTimbreBlocModel())==null?null:i.getImage()),l(4),s("object",o.timbreModel)("key","type"),l(),V("ngModel",o.timbreModel.type),l(3),s("object",o.timbreModel)("key","monnaie"),l(),V("ngModel",o.timbreModel.monnaie),s("disabled",!!o.timbreModel.getTimbreBlocModel()),l(4),s("object",o.timbreModel)("key","yt"),l(),V("ngModel",o.timbreModel.yt),l(2),s("object",o.timbreModel)("key","image")("zoom",o.timbreModel.getImageZoom())("maxWidth",o.DimensionImageEnum.WIDTH_TIMBRE)("maxHeight",o.DimensionImageEnum.HEIGTH_TIMBRE)}}var ut=class n{constructor(t,e,i,r,o,a){this.httpResponseHandlerService=t;this.dialogRef=e;this.timbreService=i;this.timbreBlocService=r;this.timbreUtilsService=o;this.utilsService=a}canvas;messageError$=new N(null);load$=new N(null);id;maxAnnee=new Date().getFullYear();timbreModel=new Ce;fileUploadModel=new Le;TypeTimbreEnum=pe;DimensionImageEnum=Pe;ngOnInit(){this.fileUploadModel=this.timbreUtilsService.initUpload(),this.load$.next(!1),u(this.id)?this.timbreService.getTimbreByIdAsync(this.id).subscribe(t=>{this.timbreModel=t,u(t.getTimbreBlocModel())&&(this.timbreModel.setAnnee(t.getTimbreBlocModel().getAnnee()),this.timbreModel.setMonnaie(t.getTimbreBlocModel().getMonnaie())),this.load$.next(!0)}):(this.timbreModel.setAnnee(new Date().getFullYear()),this.timbreModel.setMonnaie("E"),this.load$.next(!0)),this.changeAnnee(this.timbreModel.getAnnee())}valider(t){if(this.messageError$.next(null),t?.valid)if(u(this.timbreModel.getImage()))this.saveData();else{this.messageError$.next("Veuillez s\xE9lectionner une image");return}}saveData(){this.load$.next(!1),u(this.timbreModel.getId())?this.save():this.ajouter()}ajouter(){this.utilsService.getMaxIdentAsync("/timbres").pipe(C()).subscribe(t=>{this.timbreModel.setId(t),this.save(!0)})}save(t){try{Q([this.timbreService.upload(this.timbreModel,"autre"),this.timbreService.upload(this.timbreModel,"table"),this.timbreService.upload(this.timbreModel,"zoom")]).pipe(C(([e,i,r])=>u(e)&&u(r)&&u(i))).subscribe(([e,i,r])=>{u(e)&&e!="nok"&&this.timbreModel.setImage(e),u(i)&&i!="nok"&&this.timbreModel.setImageTable(i),u(r)&&r!="nok"&&this.timbreModel.setImageZoom(r),t?this.timbreService.ajouter(this.timbreModel,!0):this.timbreService.modifier(this.timbreModel),this.httpResponseHandlerService.showNotificationSuccess("Transaction termin\xE9e","Votre timbre a bien \xE9t\xE9 modifi\xE9e."),this.load$.next(!0),this.dialogRef.close()})}catch{this.httpResponseHandlerService.showNotificationError("Transaction non aboutie","Votre timbre n'a pas pu \xEAtre modifi\xE9."),this.load$.next(!0)}}close(){this.dialogRef.close()}changeAnnee(t){if(this.timbreModel.setTimbreBlocModel(null),u(t)){let e=new bt;e.initCritereBloc(),e.setAnnees([t]),e.setSort("desc"),this.timbreBlocService.getBlocs(e,!1)}}changeBloc(t){u(t)?(this.timbreModel.setIdBloc(t.getId()),this.timbreModel.setTimbreBlocModel(t),this.timbreModel.setMonnaie(t.getMonnaie()),this.timbreModel.setAnnee(t.getAnnee())):(this.timbreModel.setIdBloc(null),this.timbreModel.setTimbreBlocModel(null),this.timbreModel.setMonnaie("E"))}static \u0275fac=function(e){return new(e||n)(M(At),M(Te),M(Y),M(z),M(U),M(ae))};static \u0275cmp=j({type:n,selectors:[["app-timbre-modifier"]],viewQuery:function(e,i){if(e&1&&Fe(cn,5),e&2){let r;Ue(r=je())&&(i.canvas=r.first)}},decls:9,vars:6,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],["class","accent",4,"ngIf"],[3,"ngIf","ngIfElse"],[1,"accent"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","space-between stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","column","fxLayoutGap","20px",1,"bloc-modal"],[3,"innerHTML",4,"ngIf"],["fxLayout","row","fxLayout.lt-lg","column","fxLayoutGap","30px","fxLayoutGap.lt-lg","5px"],["fxLayout","column",1,"form-input"],[3,"object","key"],["name","page","type","number","minlength","4","maxlength","4","min","1900","zMin","1900","required","","zControl","",1,"annee",2,"width","60px !important",3,"ngModelChange","ngModel","max","zMax","disabled"],["fxLayout","column",1,"form-input","select"],["fxLayout","row","fxLayoutGap","15px"],["name","bloc",2,"width","180px !important",3,"ngModelChange","ngModel","placeholder","disabled"],[1,"selectMin",3,"value"],["class","selectMin",3,"value",4,"ngFor","ngForOf"],["style","max-height: 40px","class","click",3,"src","click",4,"ngIf"],["name","type","type","text","trim","","zControl","",3,"ngModelChange","ngModel"],["name","monnaie","type","text","trim","","minlength","1","maxlength","2","required","","zControl","",2,"width","25px !important",3,"ngModelChange","ngModel","disabled"],["name","yt","type","text","trim","","zControl","",3,"ngModelChange","ngModel"],["fxHide.lt-lg","","fxLayout","column",1,"form-input"],[3,"outPutObject","object","key","zoom","maxWidth","maxHeight"],["fxLayout","row","fxLayoutGap","10px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"],[3,"innerHTML"],[1,"click",2,"max-height","40px",3,"click","src"]],template:function(e,i){if(e&1&&(m(0,"div",2)(1,"div",3)(2,"span"),b(3),c(),_(4,pn,3,1,"span",4),c(),_(5,un,1,1,"ng-template",5),f(6,"async"),_(7,gn,41,37,"ng-template",null,0,Z),c()),e&2){let r=F(8);l(3),y("",i.timbreModel!=null&&i.timbreModel.getId()?"MODIFICATION":"AJOUT"," "),l(),s("ngIf",i.timbreModel==null?null:i.timbreModel.getId()),l(),s("ngIf",g(6,4,i.load$)==!1)("ngIfElse",r)}},dependencies:[oe,it,me,re,X,ee,P,fe,Ae,_e,ge,we,Ye,te,Oe,Qe,Ke,ie,De,Xe,et,tt,Je,Ze,ne,Re,se,rt,nt,wt,ot,lt,Dt,$],encapsulation:2})};var Y=class n{constructor(t,e,i,r,o,a,d,T){this.firestore=t;this.authService=e;this.timbreBlocService=i;this.uploadService=r;this.utilsService=o;this.timbreUtilsService=a;this.dialog=d;this.preferenceService=T}total$=new N(0);timbres$=new N(null);load$=new N(!1);getTimbre(t){return this.firestore.collection("/timbres",e=>e.where("id","==",t)).valueChanges()}getTimbreByIdAsync(t){return Q([this.getTimbre(t),this.timbreBlocService.getBlocsAsync()]).pipe(ue(([e,i])=>this.timbreUtilsService.constructTimbre(e[0],null,i)))}setTotal(t){this.total$.pipe(C()).subscribe(e=>{this.total$.next(e+t)})}getTotal(t){this.total$.next(null),this.timbreUtilsService.getAllTimbres(t).subscribe(e=>{this.total$.next(e?.length)})}getTimbres(t,e){e&&this.getTotal(),this.timbres$.next(null),this.load$.next(!1),Q([this.timbreUtilsService.getAllTimbres(t),this.getTimbreAcquis(),this.timbreBlocService.getBlocsAsync(t)]).pipe(C()).subscribe(([i,r,o])=>{let a=this.timbreUtilsService.constructTimbres(i,r,o,t);a?.length>0&&(a=a.sort((d,T)=>d.getIdBloc()-T.getIdBloc()).sort((d,T)=>d?.getTimbreBlocModel()?.getNbTimbres()-T?.getTimbreBlocModel()?.getNbTimbres())),this.timbres$.next(a),this.load$.next(!0)})}getTimbreAcquis(){return this.authService.userSelect$.pipe(C(t=>u(t)),vt(t=>u(t)?this.getTimbreAcquisByUser(t.getId()).pipe(C(),ue(e=>e)):null))}getTimbreAcquisByUser(t){return this.firestore.collection("/timbres_acquis",e=>e.where("idUser","==",t)).valueChanges()}ajouterSansId(t){this.utilsService.getMaxIdentAsync("/timbres").pipe(C()).subscribe(e=>{t.setId(e),u(t.getIdBloc())&&t.setMonnaie(null),this.ajouter(t,!0)})}ajouter(t,e){this.getTimbre(t.getId()).pipe(C()).subscribe(i=>{G(i)||G(i[0])||u(i[0])&&i[0]?.length==0?(t.setTimbreAcquisModel(null),t.setTimbreBlocModel(null),this.firestore.collection("/timbres").add(Object.assign(new Object,t)).then(r=>{e&&(this.preferenceService.getTimbreCritere("timbreCritere").pipe(C()).subscribe(o=>{u(o.getAnnees().find(a=>a==t.getAnnee()))&&this.timbres$.pipe(C()).subscribe(a=>{a.push(t),this.setTotal(1)})}),this.timbreUtilsService.reinitResume$.next(!0))}).catch(r=>{console.error("Erreur d'ajout :",r)})):console.error("timbre "+t.getId()+" d\xE9j\xE0 existant")})}modifier(t){t.setTimbreBlocModel(null),t.setTimbreAcquisModel(null),this.firestore.collection("/timbres").ref.where("id","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.update(Object.assign(new Object,t)).then(r=>{this.timbres$.pipe(C(o=>u(o)&&o?.length>0)).subscribe(o=>{let a=o.find(d=>d.getId()==t.getId());u(a)&&Object.assign(a,t)})}).catch(r=>{console.error("Erreur de mise \xE0 jour :",r)})})}).catch(e=>{console.error("Erreur de mise \xE0 jour id introuvable :",e)})}supprimerTimbre(t){this.firestore.collection("/timbres").ref.where("id","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.delete().then(r=>{this.timbres$.pipe(C()).subscribe(o=>{let a=o.findIndex(d=>d.getId()==t.getId());a>=0&&(o.splice(a,1),this.setTotal(-1))})}).catch(r=>{console.error("Erreur de suppression :",r)})})}).catch(e=>{console.error("Erreur de suppression id introuvable :",e)})}supprimer(t){this.timbreUtilsService.supprimerTimbreAcquis(t),this.supprimerTimbre(t),this.timbreUtilsService.reinitResume$.next(!0)}getBouchon(){let t=new Ce;return t.setAnnee(new Date().getFullYear()),t.setMonnaie("E"),t.setType(""),t.setYt(""),t}upload(t,e,i){let r=100,o=100;return e=="table"?(r=r*(50/o),o=50):e=="zoom"&&(r=r*(700/o),o=700),this.uploadService.processAndUploadImage(t?.getImage(),r,o,u(i)?i:t?.getId(),this.getDossier(t,e))}getDossier(t,e){let i="timbre//";return u(t.getIdBloc())?i=i+t.getTimbreBlocModel().getAnnee():i=i+t.getAnnee(),u(e)&&(i=i+"/"+e),u(t.getIdBloc())&&(i=i+"/bloc/"+t.getIdBloc()),i}acquisDoublon(t,e){this.authService.user$.pipe(C(i=>u(i))).subscribe(i=>{i?.getDroit()>=9?this.timbreUtilsService.acquis(t,e):this.utilsService.droitInsuffisant()})}modifierDialog(t){let e=this.dialog.open(ut,{height:"75vh",maxHeight:"750px",width:"30%"});e.componentInstance.id=t.getId(),e.afterClosed().subscribe(()=>{e.close()})}supprimerDialog(t){let e=this.dialog.open($e,{maxHeight:"95vh",data:{titre:"Confirmation",message:"Souhaitez-vous supprimer le timbre <b>n\xB0 "+t?.getId()+"</b> ?",btnDroite:"Oui",btnGauche:"Non"}});e.afterClosed().subscribe(()=>{e.componentInstance.data.resultat==="valider"&&this.supprimer(t)})}static \u0275fac=function(e){return new(e||n)(L(ze),L(J),L(z),L(mt),L(ae),L(U),L(le),L(xe))};static \u0275prov=Ee({token:n,factory:n.\u0275fac})};var O=class extends Be{annee;total;nombre;acquis;doublon;nombreCarnet;nombreTimbresCarnet;acquisTimbresCarnet;doublonTimbresCarnet;nombreCollector;acquisCollector;doublonCollector;nombreTimbresCollector;acquisTimbresCollector;doublonTimbresCollector;nombreBloc;acquisBloc;doublonBloc;nombreTimbresBloc;acquisTimbresBloc;doublonTimbresBloc;constructor(t,e,i,r,o,a,d,T,h,q,A,Ge,xt,Qt,Kt,Zt,Jt,Xt,ei,ti,ii){super(),this.annee=t||null,this.total=e||0,this.nombre=i||0,this.acquis=r||0,this.doublon=o||0,this.nombreCarnet=a||0,this.nombreTimbresCarnet=d||0,this.acquisTimbresCarnet=T||0,this.doublonTimbresCarnet=h||0,this.nombreCollector=q||0,this.nombreCollector=q||0,this.acquisCollector=A||0,this.nombreTimbresCollector=xt||0,this.acquisTimbresCollector=Qt||0,this.doublonTimbresCollector=Kt||0,this.nombreBloc=Zt||0,this.acquisBloc=Jt||0,this.doublonBloc=Xt||0,this.nombreTimbresBloc=ei||0,this.acquisTimbresBloc=ti||0,this.doublonTimbresBloc=ii||0}getAnnee(){return this.annee}setAnnee(t){this.annee=t}getTotal(){return this.total}setTotal(t){this.total=t}getNombre(){return this.nombre}setNombre(t){this.nombre=t}getAcquis(){return this.acquis}setAcquis(t){this.acquis=t}getDoublon(){return this.doublon}setDoublon(t){this.doublon=t}getNombreCarnet(){return this.nombreCarnet}setNombreCarnet(t){this.nombreCarnet=t}getNombreTimbresCarnet(){return this.nombreTimbresCarnet}setNombreTimbresCarnet(t){this.nombreTimbresCarnet=t}getAcquisTimbresCarnet(){return this.acquisTimbresCarnet}setAcquisTimbresCarnet(t){this.acquisTimbresCarnet=t}getDoublonTimbresCarnet(){return this.doublonTimbresCarnet}setDoublonTimbresCarnet(t){this.doublonTimbresCarnet=t}getNombreCollector(){return this.nombreCollector}setNombreCollector(t){this.nombreCollector=t}getAcquisCollector(){return this.acquisCollector}setAcquisCollector(t){this.acquisCollector=t}getDoublonCollector(){return this.doublonCollector}setDoublonCollector(t){this.doublonCollector=t}getNombreTimbresCollector(){return this.nombreTimbresCollector}setNombreTimbresCollector(t){this.nombreTimbresCollector=t}getAcquisTimbresCollector(){return this.acquisTimbresCollector}setAcquisTimbresCollector(t){this.acquisTimbresCollector=t}getDoublonTimbresCollector(){return this.doublonTimbresCollector}setDoublonTimbresCollector(t){this.doublonTimbresCollector=t}getNombreBloc(){return this.nombreBloc}setNombreBloc(t){this.nombreBloc=t}getAcquisBloc(){return this.acquisBloc}setAcquisBloc(t){this.acquisBloc=t}getDoublonBloc(){return this.doublonBloc}setDoublonBloc(t){this.doublonBloc=t}getNombreTimbresBloc(){return this.nombreTimbresBloc}setNombreTimbresBloc(t){this.nombreTimbresBloc=t}getAcquisTimbresBloc(){return this.acquisTimbresBloc}setAcquisTimbresBloc(t){this.acquisTimbresBloc=t}getDoublonTimbresBloc(){return this.doublonTimbresBloc}setDoublonTimbresBloc(t){this.doublonTimbresBloc=t}};B([I("Ann\xE9e")],O.prototype,"annee",2),B([I("Total")],O.prototype,"total",2),B([I("Nombre timbres")],O.prototype,"nombre",2),B([I("Total de timbres acquis")],O.prototype,"acquis",2),B([I("Total de timbres en doublon")],O.prototype,"doublon",2),B([I("Carnet")],O.prototype,"nombreCarnet",2),B([I("Timbres carnet")],O.prototype,"nombreTimbresCarnet",2),B([I("Total timbres carnet acquis")],O.prototype,"acquisTimbresCarnet",2),B([I("Total timbres carnet en doublon")],O.prototype,"doublonTimbresCarnet",2),B([I("Collector")],O.prototype,"nombreCollector",2),B([I("Total bloc collector")],O.prototype,"acquisCollector",2),B([I("Total bloc en collector")],O.prototype,"doublonCollector",2),B([I("Timbres collector")],O.prototype,"nombreTimbresCollector",2),B([I("Total timbres collector acquis")],O.prototype,"acquisTimbresCollector",2),B([I("Total timbres collector en doublon")],O.prototype,"doublonTimbresCollector",2),B([I("Collector")],O.prototype,"nombreBloc",2),B([I("Total bloc acquis")],O.prototype,"acquisBloc",2),B([I("Total bloc en doublon")],O.prototype,"doublonBloc",2),B([I("Timbres bloc")],O.prototype,"nombreTimbresBloc",2),B([I("Total timbres bloc acquis")],O.prototype,"acquisTimbresBloc",2),B([I("Total timbres bloc en doublon")],O.prototype,"doublonTimbresBloc",2);var jt=class n{constructor(t,e,i){this.timbreService=t;this.timbreBlocService=e;this.timbreUtilsService=i}load$=new N(!1);timbresResume$=new N(null);totalTimbreResume$=new N(null);getResume(t){this.load$.next(!1),this.timbresResume$.next(null),this.totalTimbreResume$.next(null),Q([this.timbreUtilsService.getAllTimbres(t),this.timbreService.getTimbreAcquis(),this.timbreBlocService.getAllBlocs(t),this.timbreBlocService.getTimbreBlocAcquis()]).pipe(C()).subscribe(([e,i,r,o])=>{this.timbresResume$.next(this.construct(e,i,r,o)),this.timbreUtilsService.reinitResume$.next(!1)})}construct(t,e,i,r){let o=[];if(t?.length>0&&(t.forEach(a=>{let d=a.annee;if(u(i)&&G(a.annee)&&u(a.idBloc)){let q=i.find(A=>A.id==a.idBloc);u(q)&&(d=q.annee)}let T=o.find(q=>q.getAnnee()==d);G(T)&&(T=new O,T.setAnnee(d),o.push(T)),T.setTotal(T.getTotal()+1);let h=u(a.idBloc)?i.find(q=>q.id==a.idBloc):null;if(u(a.idBloc)?u(h)&&h.type=="CARNET"?T.setNombreTimbresCarnet(T.getNombreTimbresCarnet()+1):u(h)&&h.type=="COLLECTOR"?T.setNombreTimbresCollector(T.getNombreTimbresCollector()+1):T.setNombreTimbresBloc(T.getNombreTimbresBloc()+1):T.setNombre(T.getNombre()+1),u(e)){let q=e.find(A=>A.idTimbre==a.id);u(q)&&(q.acquis==!0&&(u(a.idBloc)?u(h)&&h.type=="CARNET"?T.setAcquisTimbresCarnet(T.getAcquisTimbresCarnet()+1):u(h)&&h.type=="COLLECTOR"?T.setAcquisTimbresCollector(T.getAcquisTimbresCollector()+1):T.setAcquisTimbresBloc(T.getAcquisTimbresBloc()+1):T.setAcquis(T.getAcquis()+1)),q.doublon==!0&&(u(a.idBloc)?u(h)&&h.type=="CARNET"?T.setDoublonTimbresCarnet(T.getDoublonTimbresCarnet()+1):u(h)&&h.type=="COLLECTOR"?T.setDoublonTimbresCollector(T.getDoublonTimbresCollector()+1):T.setDoublonTimbresBloc(T.getDoublonTimbresBloc()+1):T.setDoublon(T.getDoublon()+1)))}}),i.forEach(a=>{let d=o.find(T=>T.getAnnee()==a.annee);if(G(d)&&(d=new O,d.setAnnee(a.annee),o.push(d)),a.type=="CARNET"?d.setNombreCarnet(d.getNombreCarnet()+1):a.type=="COLLECTOR"?d.setNombreCollector(d.getNombreCollector()+1):d.setNombreBloc(d.getNombreBloc()+1),u(r)){let T=r.find(h=>h.idBloc==a.id);u(T)&&(T.acquis==!0&&(G(a.type)||a.type=="BLOC"?d.setAcquisBloc(d.getAcquisBloc()+1):a.type=="COLLECTOR"&&d.setAcquisCollector(d.getAcquisCollector()+1)),T.doublon==!0&&(G(a.type)||a.type=="BLOC"?d.setDoublonBloc(d.getDoublonBloc()+1):a.type=="COLLECTOR"&&d.setDoublonCollector(d.getDoublonCollector()+1)))}})),u(o)&&o?.length>0){let a=new O;o.forEach(d=>{a.setTotal(a.getTotal()+d.getTotal()),a.setNombre(a.getNombre()+d.getNombre()),a.setAcquis(a.getAcquis()+d.getAcquis()),a.setDoublon(a.getDoublon()+d.getDoublon()),a.setNombreCarnet(a.getNombreCarnet()+d.getNombreCarnet()),a.setNombreTimbresCarnet(a.getNombreTimbresCarnet()+d.getNombreTimbresCarnet()),a.setAcquisTimbresCarnet(a.getAcquisTimbresCarnet()+d.getAcquisTimbresCarnet()),a.setDoublonTimbresCarnet(a.getDoublonTimbresCarnet()+d.getDoublonTimbresCarnet()),a.setNombreBloc(a.getNombreBloc()+d.getNombreBloc()),a.setAcquisBloc(a.getAcquisBloc()+d.getAcquisBloc()),a.setDoublonBloc(a.getDoublonBloc()+d.getDoublonBloc()),a.setNombreTimbresBloc(a.getNombreTimbresBloc()+d.getNombreTimbresBloc()),a.setAcquisTimbresBloc(a.getAcquisTimbresBloc()+d.getAcquisTimbresBloc()),a.setDoublonTimbresBloc(a.getDoublonTimbresBloc()+d.getDoublonTimbresBloc()),a.setNombreCollector(a.getNombreCollector()+d.getNombreCollector()),a.setAcquisCollector(a.getAcquisCollector()+d.getAcquisCollector()),a.setDoublonCollector(a.getDoublonCollector()+d.getDoublonCollector()),a.setNombreTimbresCollector(a.getNombreTimbresCollector()+d.getNombreTimbresCollector()),a.setAcquisTimbresCollector(a.getAcquisTimbresCollector()+d.getAcquisTimbresCollector()),a.setDoublonTimbresCollector(a.getDoublonTimbresCollector()+d.getDoublonTimbresCollector())}),this.totalTimbreResume$.next(a)}return this.load$.next(!0),o}static \u0275fac=function(e){return new(e||n)(L(Y),L(z),L(U))};static \u0275prov=Ee({token:n,factory:n.\u0275fac})};var Wi=class n{static \u0275fac=function(e){return new(e||n)};static \u0275mod=ri({type:n});static \u0275inj=ni({imports:[mi,ui,di,fi,gi,_i,bi,hi,Ti,Li,oe,qi,re,me,It]})};var zi=n=>({accent50:n});function Tn(n,t){n&1&&S(0,"lib-spinner",2),n&2&&s("textSpec","Chargement en cours ...")}function hn(n,t){if(n&1&&(m(0,"th",34),S(1,"lib-libelle-model",35),c()),n&2){let e=p(2);l(),s("object",e.timbreResumeModel)("key","annee")}}function Cn(n,t){if(n&1&&(m(0,"td",36),b(1),c()),n&2){let e=t.$implicit;l(),y(" ",e==null?null:e.getAnnee()," ")}}function xn(n,t){n&1&&S(0,"td",37)}function vn(n,t){if(n&1&&(m(0,"th",34),S(1,"lib-libelle-model",35),c()),n&2){let e=p(2);l(),s("object",e.timbreResumeModel)("key","total")}}function yn(n,t){if(n&1&&(m(0,"td",36),b(1),c()),n&2){let e=t.$implicit;l(),y(" ",e==null?null:e.getTotal()," ")}}function Sn(n,t){if(n&1&&(m(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getTotal()," ")}}function Mn(n,t){if(n&1&&(m(0,"th",38),S(1,"lib-libelle-model",35),c()),n&2){let e=p(2);l(),s("object",e.timbreResumeModel)("key","nombre")}}function En(n,t){if(n&1&&(m(0,"td",39),b(1),c()),n&2){let e=t.$implicit;l(),y(" ",e==null?null:e.getNombre()," ")}}function Bn(n,t){if(n&1&&(m(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getNombre()," ")}}function In(n,t){if(n&1&&(m(0,"th",38),S(1,"lib-icon",40),c()),n&2){let e=p(2);l(),s("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK)("info",e.timbreResumeModel.getPropertyLibelle("acquis"))}}function An(n,t){if(n&1&&(m(0,"td",41),b(1),c()),n&2){let e=t.$implicit;s("ngClass",dt(2,zi,(e==null?null:e.getNombre())==(e==null?null:e.getAcquis()))),l(),y(" ",e==null?null:e.getAcquis()," ")}}function wn(n,t){if(n&1&&(m(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getAcquis()," ")}}function Dn(n,t){if(n&1&&(m(0,"th",38),S(1,"lib-icon",40),c()),n&2){let e=p(2);l(),s("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK_DOUBLE)("info",e.timbreResumeModel.getPropertyLibelle("doublon"))}}function Rn(n,t){if(n&1&&(m(0,"td",41),b(1),c()),n&2){let e=t.$implicit;s("ngClass",dt(2,zi,(e==null?null:e.getNombre())==(e==null?null:e.getDoublon()))),l(),y(" ",e==null?null:e.getDoublon()," ")}}function On(n,t){if(n&1&&(m(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getDoublon()," ")}}function Nn(n,t){if(n&1&&(m(0,"th",38),S(1,"lib-libelle-model",35),c()),n&2){let e=p(2);l(),s("object",e.timbreResumeModel)("key","nombreCarnet")}}function Ln(n,t){if(n&1&&(m(0,"td",41),b(1),c()),n&2){let e=t.$implicit;s("ngClass",(e==null?null:e.getNombreCarnet())==0?"gray25":"primary25"),l(),y(" ",(e==null?null:e.getNombreCarnet())>0?e==null?null:e.getNombreCarnet():""," ")}}function qn(n,t){if(n&1&&(m(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getNombreCarnet()," ")}}function Fn(n,t){if(n&1&&(m(0,"th",38),S(1,"lib-libelle-model",35),c()),n&2){let e=p(2);l(),s("object",e.timbreResumeModel)("key","nombreTimbresCarnet")}}function Un(n,t){if(n&1&&(m(0,"td",41),b(1),c()),n&2){let e=t.$implicit;s("ngClass",(e==null?null:e.getNombreCarnet())==0?"gray25":"primary25"),l(),y(" ",(e==null?null:e.getNombreCarnet())>0?e==null?null:e.getNombreTimbresCarnet():""," ")}}function jn(n,t){if(n&1&&(m(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getNombreTimbresCarnet()," ")}}function Pn(n,t){if(n&1&&(m(0,"th",38),S(1,"lib-icon",40),c()),n&2){let e=p(2);l(),s("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK)("info",e.timbreResumeModel.getPropertyLibelle("acquisTimbresCarnet"))}}function $n(n,t){if(n&1&&(m(0,"td",41),b(1),c()),n&2){let e=t.$implicit;s("ngClass",(e==null?null:e.getNombreTimbresCarnet())==0?"gray25":(e==null?null:e.getNombreTimbresCarnet())==(e==null?null:e.getAcquisTimbresCarnet())?"accent50":"primary25"),l(),y(" ",(e==null?null:e.getNombreCarnet())>0?e==null?null:e.getAcquisTimbresCarnet():""," ")}}function Vn(n,t){if(n&1&&(m(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getAcquisTimbresCarnet()," ")}}function kn(n,t){if(n&1&&(m(0,"th",38),S(1,"lib-icon",40),c()),n&2){let e=p(2);l(),s("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK_DOUBLE)("info",e.timbreResumeModel.getPropertyLibelle("doublonTimbresCarnet"))}}function Hn(n,t){if(n&1&&(m(0,"td",41),b(1),c()),n&2){let e=t.$implicit;s("ngClass",(e==null?null:e.getNombreTimbresCarnet())==0?"gray25":(e==null?null:e.getNombreTimbresCarnet())==(e==null?null:e.getDoublonTimbresCarnet())?"accent50":"primary25"),l(),y(" ",(e==null?null:e.getNombreCarnet())>0?e==null?null:e.getDoublonTimbresCarnet():""," ")}}function Gn(n,t){if(n&1&&(m(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getDoublonTimbresCarnet()," ")}}function Wn(n,t){if(n&1&&(m(0,"th",38),S(1,"lib-libelle-model",35),c()),n&2){let e=p(2);l(),s("object",e.timbreResumeModel)("key","nombreBloc")}}function zn(n,t){if(n&1&&(m(0,"td",41),b(1),c()),n&2){let e=t.$implicit;s("ngClass",(e==null?null:e.getNombreBloc())==0?"gray25":""),l(),y(" ",(e==null?null:e.getNombreBloc())>0?e==null?null:e.getNombreBloc():""," ")}}function Yn(n,t){if(n&1&&(m(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getNombreBloc()," ")}}function Qn(n,t){if(n&1&&(m(0,"th",38),S(1,"lib-icon",40),c()),n&2){let e=p(2);l(),s("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK)("info",e.timbreResumeModel.getPropertyLibelle("acquisBloc"))}}function Kn(n,t){if(n&1&&(m(0,"td",41),b(1),c()),n&2){let e=t.$implicit;s("ngClass",(e==null?null:e.getNombreBloc())==0?"gray25":e.getNombreBloc()==(e==null?null:e.getAcquisBloc())?"accent50":""),l(),y(" ",(e==null?null:e.getNombreBloc())>0?e==null?null:e.getAcquisBloc():""," ")}}function Zn(n,t){if(n&1&&(m(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getAcquisBloc()," ")}}function Jn(n,t){if(n&1&&(m(0,"th",38),S(1,"lib-icon",40),c()),n&2){let e=p(2);l(),s("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK_DOUBLE)("info",e.timbreResumeModel.getPropertyLibelle("doublonBloc"))}}function Xn(n,t){if(n&1&&(m(0,"td",41),b(1),c()),n&2){let e=t.$implicit;s("ngClass",(e==null?null:e.getNombreBloc())==0?"gray25":e.getNombreBloc()==(e==null?null:e.getDoublonBloc())?"accent50":""),l(),y(" ",(e==null?null:e.getNombreBloc())>0?e==null?null:e.getDoublonBloc():""," ")}}function er(n,t){if(n&1&&(m(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getDoublonBloc()," ")}}function tr(n,t){if(n&1&&(m(0,"th",38),S(1,"lib-libelle-model",35),c()),n&2){let e=p(2);l(),s("object",e.timbreResumeModel)("key","nombreTimbresBloc")}}function ir(n,t){if(n&1&&(m(0,"td",41),b(1),c()),n&2){let e=t.$implicit;s("ngClass",(e==null?null:e.getNombreTimbresBloc())==0?"gray25":"primary25"),l(),y(" ",(e==null?null:e.getNombreTimbresBloc())>0?e==null?null:e.getNombreTimbresBloc():""," ")}}function nr(n,t){if(n&1&&(m(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getNombreTimbresBloc()," ")}}function rr(n,t){if(n&1&&(m(0,"th",38),S(1,"lib-icon",40),c()),n&2){let e=p(2);l(),s("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK)("info",e.timbreResumeModel.getPropertyLibelle("acquisTimbresBloc"))}}function or(n,t){if(n&1&&(m(0,"td",41),b(1),c()),n&2){let e=t.$implicit;s("ngClass",(e==null?null:e.getNombreTimbresBloc())==0?"gray25":(e==null?null:e.getNombreTimbresBloc())==(e==null?null:e.getAcquisTimbresBloc())?"accent50":"primary25"),l(),y(" ",(e==null?null:e.getNombreTimbresBloc())>0?e==null?null:e.getAcquisTimbresBloc():""," ")}}function lr(n,t){if(n&1&&(m(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getAcquisTimbresBloc()," ")}}function mr(n,t){if(n&1&&(m(0,"th",38),S(1,"lib-icon",40),c()),n&2){let e=p(2);l(),s("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK_DOUBLE)("info",e.timbreResumeModel.getPropertyLibelle("doublonTimbresBloc"))}}function sr(n,t){if(n&1&&(m(0,"td",41),b(1),c()),n&2){let e=t.$implicit;s("ngClass",(e==null?null:e.getNombreTimbresBloc())==0?"gray25":(e==null?null:e.getNombreTimbresBloc())==(e==null?null:e.getDoublonTimbresBloc())?"accent50":"primary25"),l(),y(" ",(e==null?null:e.getNombreTimbresBloc())>0?e==null?null:e.getDoublonTimbresBloc():""," ")}}function ar(n,t){if(n&1&&(m(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getDoublonTimbresBloc()," ")}}function cr(n,t){if(n&1&&(m(0,"th",38),S(1,"lib-libelle-model",35),c()),n&2){let e=p(2);l(),s("object",e.timbreResumeModel)("key","nombreCollector")}}function pr(n,t){if(n&1&&(m(0,"td",41),b(1),c()),n&2){let e=t.$implicit;s("ngClass",(e==null?null:e.getNombreCollector())==0?"gray25":"primary25"),l(),y(" ",(e==null?null:e.getNombreCollector())>0?e==null?null:e.getNombreCollector():""," ")}}function ur(n,t){if(n&1&&(m(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getNombreCollector()," ")}}function dr(n,t){if(n&1&&(m(0,"th",38),S(1,"lib-icon",40),c()),n&2){let e=p(2);l(),s("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK)("info",e.timbreResumeModel.getPropertyLibelle("acquisCollector"))}}function br(n,t){if(n&1&&(m(0,"td",41),b(1),c()),n&2){let e=t.$implicit;s("ngClass",(e==null?null:e.getNombreCollector())==0?"gray25":e.getNombreCollector()==(e==null?null:e.getAcquisCollector())?"accent50":""),l(),y(" ",(e==null?null:e.getNombreCollector())>0?e==null?null:e.getAcquisCollector():""," ")}}function fr(n,t){if(n&1&&(m(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getAcquisCollector()," ")}}function gr(n,t){if(n&1&&(m(0,"th",38),S(1,"lib-icon",40),c()),n&2){let e=p(2);l(),s("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK_DOUBLE)("info",e.timbreResumeModel.getPropertyLibelle("doublonCollector"))}}function _r(n,t){if(n&1&&(m(0,"td",41),b(1),c()),n&2){let e=t.$implicit;s("ngClass",(e==null?null:e.getNombreCollector())==0?"gray25":e.getNombreCollector()==(e==null?null:e.getDoublonCollector())?"accent50":""),l(),y(" ",(e==null?null:e.getNombreCollector())>0?e==null?null:e.getDoublonCollector():""," ")}}function Tr(n,t){if(n&1&&(m(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getDoublonCollector()," ")}}function hr(n,t){if(n&1&&(m(0,"th",38),S(1,"lib-libelle-model",35),c()),n&2){let e=p(2);l(),s("object",e.timbreResumeModel)("key","nombreTimbresCollector")}}function Cr(n,t){if(n&1&&(m(0,"td",41),b(1),c()),n&2){let e=t.$implicit;s("ngClass",(e==null?null:e.getNombreCollector())==0?"gray25":"primary25"),l(),y(" ",(e==null?null:e.getNombreCollector())>0?e==null?null:e.getNombreTimbresCollector():""," ")}}function xr(n,t){if(n&1&&(m(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getNombreTimbresCollector()," ")}}function vr(n,t){if(n&1&&(m(0,"th",38),S(1,"lib-icon",40),c()),n&2){let e=p(2);l(),s("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK)("info",e.timbreResumeModel.getPropertyLibelle("acquisTimbresCollector"))}}function yr(n,t){if(n&1&&(m(0,"td",41),b(1),c()),n&2){let e=t.$implicit;s("ngClass",(e==null?null:e.getNombreTimbresCollector())==0?"gray25":(e==null?null:e.getNombreTimbresCollector())==(e==null?null:e.getAcquisTimbresCollector())?"accent50":"primary25"),l(),y(" ",(e==null?null:e.getNombreCollector())>0?e==null?null:e.getAcquisTimbresCollector():""," ")}}function Sr(n,t){if(n&1&&(m(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getAcquisTimbresCollector()," ")}}function Mr(n,t){if(n&1&&(m(0,"th",38),S(1,"lib-icon",40),c()),n&2){let e=p(2);l(),s("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK_DOUBLE)("info",e.timbreResumeModel.getPropertyLibelle("doublonTimbresCollector"))}}function Er(n,t){if(n&1&&(m(0,"td",41),b(1),c()),n&2){let e=t.$implicit;s("ngClass",(e==null?null:e.getNombreTimbresCollector())==0?"gray25":(e==null?null:e.getNombreTimbresCollector())==(e==null?null:e.getDoublonTimbresCollector())?"accent50":"primary25"),l(),y(" ",(e==null?null:e.getNombreCollector())>0?e==null?null:e.getDoublonTimbresCollector():""," ")}}function Br(n,t){if(n&1&&(m(0,"td",37)(1,"b"),b(2),f(3,"async"),c()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getDoublonTimbresCollector()," ")}}function Ir(n,t){n&1&&S(0,"tr",42)}function Ar(n,t){if(n&1){let e=R();m(0,"tr",43),E("click",function(){let r=x(e).$implicit,o=p(2);return v(o.filtreParAnnee(r))}),c()}}function wr(n,t){n&1&&S(0,"tr",44)}function Dr(n,t){if(n&1){let e=R();m(0,"table",3),E("matSortChange",function(r){x(e);let o=p();return v(o.sortData(r))}),w(1,4),_(2,hn,2,2,"th",5)(3,Cn,2,1,"td",6)(4,xn,1,0,"td",7),D(),w(5,8),_(6,vn,2,2,"th",5)(7,yn,2,1,"td",6)(8,Sn,4,3,"td",7),D(),w(9,9),_(10,Mn,2,2,"th",10)(11,En,2,1,"td",11)(12,Bn,4,3,"td",7),D(),w(13,12),_(14,In,2,3,"th",10)(15,An,2,4,"td",13)(16,wn,4,3,"td",7),D(),w(17,14),_(18,Dn,2,3,"th",10)(19,Rn,2,4,"td",13)(20,On,4,3,"td",7),D(),w(21,15),_(22,Nn,2,2,"th",10)(23,Ln,2,2,"td",13)(24,qn,4,3,"td",7),D(),w(25,16),_(26,Fn,2,2,"th",10)(27,Un,2,2,"td",13)(28,jn,4,3,"td",7),D(),w(29,17),_(30,Pn,2,3,"th",10)(31,$n,2,2,"td",13)(32,Vn,4,3,"td",7),D(),w(33,18),_(34,kn,2,3,"th",10)(35,Hn,2,2,"td",13)(36,Gn,4,3,"td",7),D(),w(37,19),_(38,Wn,2,2,"th",10)(39,zn,2,2,"td",13)(40,Yn,4,3,"td",7),D(),w(41,20),_(42,Qn,2,3,"th",10)(43,Kn,2,2,"td",13)(44,Zn,4,3,"td",7),D(),w(45,21),_(46,Jn,2,3,"th",10)(47,Xn,2,2,"td",13)(48,er,4,3,"td",7),D(),w(49,22),_(50,tr,2,2,"th",10)(51,ir,2,2,"td",13)(52,nr,4,3,"td",7),D(),w(53,23),_(54,rr,2,3,"th",10)(55,or,2,2,"td",13)(56,lr,4,3,"td",7),D(),w(57,24),_(58,mr,2,3,"th",10)(59,sr,2,2,"td",13)(60,ar,4,3,"td",7),D(),w(61,25),_(62,cr,2,2,"th",10)(63,pr,2,2,"td",13)(64,ur,4,3,"td",7),D(),b(65,"> "),w(66,26),_(67,dr,2,3,"th",10)(68,br,2,2,"td",13)(69,fr,4,3,"td",7),D(),w(70,27),_(71,gr,2,3,"th",10)(72,_r,2,2,"td",13)(73,Tr,4,3,"td",7),D(),w(74,28),_(75,hr,2,2,"th",10)(76,Cr,2,2,"td",13)(77,xr,4,3,"td",7),D(),w(78,29),_(79,vr,2,3,"th",10)(80,yr,2,2,"td",13)(81,Sr,4,3,"td",7),D(),w(82,30),_(83,Mr,2,3,"th",10)(84,Er,2,2,"td",13)(85,Br,4,3,"td",7),D(),_(86,Ir,1,0,"tr",31)(87,Ar,1,0,"tr",32)(88,wr,1,0,"tr",33),c()}if(n&2){let e=p();s("dataSource",e.dataSource),l(86),s("matHeaderRowDef",e.displayedColumns)("matHeaderRowDefSticky",!0),l(),s("matRowDefColumns",e.displayedColumns),l(),s("matFooterRowDef",e.displayedColumns)("matFooterRowDefSticky",!0)}}var Pt=class n{constructor(t,e,i,r,o,a){this.dialogRef=t;this.timbreResumeService=e;this.timbreService=i;this.timbreBlocService=r;this.timbreUtilsService=o;this.preferenceService=a;this.dataSource=new Yt([])}paginator;sort;dataSource=new Yt;displayedColumns=["annee","total","nombre","acquis","doublon","nombreCarnet","nombreTimbresCarnet","acquisTimbresCarnet","doublonTimbresCarnet","nombreBloc","acquisBloc","doublonBloc","nombreTimbresBloc","acquisTimbresBloc","doublonTimbresBloc","nombreCollector","acquisCollector"];timbreResumeModel=new O;FontAwesomeEnum=be;FontAwesomeTypeEnum=de;ngOnInit(){this.timbreUtilsService.reinitResume$.pipe(C()).subscribe(t=>{t==!0&&this.timbreResumeService.getResume(),this.initData()})}initData(){this.timbreResumeService.timbresResume$.pipe(C(t=>u(t)&&t?.length>0)).subscribe(t=>{this.dataSource.data=t})}ngAfterViewInit(){this.dataSource.paginator=this.paginator}sortData(t){u(t)&&(this.dataSource.sort=this.sort)}filtreParAnnee(t){window.location.href.indexOf("bloc")>0?this.preferenceService.getTimbreCritere("blocCritere").pipe(C()).subscribe(e=>{e.initCritereBloc(),e.setAnnees([t.getAnnee()]),this.preferenceService.modifier("blocCritere",e),this.timbreBlocService.getBlocs(e,!1)}):this.preferenceService.getTimbreCritere("timbreCritere").pipe(C()).subscribe(e=>{e.initCritere(),e.setAnnees([t.getAnnee()]),this.preferenceService.modifier("timbreCritere",e),this.timbreService.getTimbres(e,!1)}),this.dialogRef.close()}static \u0275fac=function(e){return new(e||n)(M(Te),M(jt),M(Y),M(z),M(U),M(xe))};static \u0275cmp=j({type:n,selectors:[["app-timbre-resume"]],viewQuery:function(e,i){if(e&1&&(Fe(Ci,5),Fe(Bt,5)),e&2){let r;Ue(r=je())&&(i.paginator=r.first),Ue(r=je())&&(i.sort=r.first)}},decls:4,vars:4,consts:[["load",""],[3,"ngIf","ngIfElse"],["fxFlexFill","",3,"textSpec"],["mat-table","","matSort","",3,"matSortChange","dataSource"],["matColumnDef","annee","sticky",""],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","","class","primary50",4,"matCellDef"],["mat-footer-cell","",4,"matFooterCellDef"],["matColumnDef","total","sticky",""],["matColumnDef","nombre"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","acquis"],["mat-cell","",3,"ngClass",4,"matCellDef"],["matColumnDef","doublon"],["matColumnDef","nombreCarnet"],["matColumnDef","nombreTimbresCarnet"],["matColumnDef","acquisTimbresCarnet"],["matColumnDef","doublonTimbresCarnet"],["matColumnDef","nombreBloc"],["matColumnDef","acquisBloc"],["matColumnDef","doublonBloc"],["matColumnDef","nombreTimbresBloc"],["matColumnDef","acquisTimbresBloc"],["matColumnDef","doublonTimbresBloc"],["matColumnDef","nombreCollector"],["matColumnDef","acquisCollector"],["matColumnDef","doublonCollector"],["matColumnDef","nombreTimbresCollector"],["matColumnDef","acquisTimbresCollector"],["matColumnDef","doublonTimbresCollector"],["mat-header-row","","class","bg-primary color-white",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","mat-row",3,"click",4,"matRowDef","matRowDefColumns"],["mat-footer-row","","class","bg-primary color-white",4,"matFooterRowDef","matFooterRowDefSticky"],["mat-header-cell","","mat-sort-header",""],[3,"object","key"],["mat-cell","",1,"primary50"],["mat-footer-cell",""],["mat-header-cell",""],["mat-cell",""],[1,"click",2,"font-size","1.2em",3,"type","icone","info"],["mat-cell","",3,"ngClass"],["mat-header-row","",1,"bg-primary","color-white"],["mat-row","",1,"mat-row",3,"click"],["mat-footer-row","",1,"bg-primary","color-white"]],template:function(e,i){if(e&1&&(_(0,Tn,1,1,"ng-template",1),f(1,"async"),_(2,Dr,89,6,"ng-template",null,0,Z)),e&2){let r=F(3);s("ngIf",g(1,2,i.timbreResumeService.load$)==!1)("ngIfElse",r)}},dependencies:[xi,yi,Ai,Mi,vi,Di,Si,wi,Ei,Ii,Bi,Ri,Ni,Oi,Bt,It,X,P,ge,te,se,he,rt,$],styles:["th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{text-align:center}th[_ngcontent-%COMP%]{width:40px!important;max-width:40px!important}.mat-row[_ngcontent-%COMP%]{padding:0!important;height:30px}.mat-row[_ngcontent-%COMP%]   .mat-mdc-cell[_ngcontent-%COMP%]{width:40px!important}@media screen and (max-width: 800px){th[_ngcontent-%COMP%]{width:25px!important;max-width:25px!important}.mat-row[_ngcontent-%COMP%]{padding:0!important;height:15px}.mat-row[_ngcontent-%COMP%]   .mat-mdc-cell[_ngcontent-%COMP%]{width:25px!important}th[_ngcontent-%COMP%], .mat-row[_ngcontent-%COMP%]{font-size:.8em}}"]})};var Yi=Ki(Zi());function Rr(n,t){if(n&1&&(m(0,"mat-option",7),b(1),f(2,"capitalize"),c()),n&2){let e=p().$implicit;s("value",e.value),l(),y(" ",g(2,2,e.value)," ")}}function Or(n,t){if(n&1&&(w(0),_(1,Rr,3,4,"mat-option",12),D()),n&2){let e=t.$implicit,i=p(2);l(),s("ngIf",e.value!=i.TypeTimbreEnum.COLLECTOR)}}function Nr(n,t){if(n&1&&(m(0,"mat-option",7),b(1),c()),n&2){let e=t.$implicit;s("value",e),l(),y(" ",e," ")}}function Lr(n,t){if(n&1){let e=R();m(0,"div",1)(1,"div",2)(2,"mat-select",3),H("ngModelChange",function(r){x(e);let o=p();return k(o.preferenceService.timbreCritereModel.type,r)||(o.preferenceService.timbreCritereModel.type=r),v(r)}),E("ngModelChange",function(){x(e);let r=p();return v(r.filtreByCritere())}),_(3,Or,2,1,"ng-container",4),f(4,"enumToArray"),c()(),m(5,"div",5)(6,"mat-select",6),H("ngModelChange",function(r){x(e);let o=p();return k(o.preferenceService.timbreCritereModel.acquis,r)||(o.preferenceService.timbreCritereModel.acquis=r),v(r)}),E("ngModelChange",function(){x(e);let r=p();return v(r.filtreByCritere())}),m(7,"mat-option",7),b(8," Oui"),c(),m(9,"mat-option",7),b(10," Non"),c(),m(11,"mat-option",7),b(12," Tous"),c()()(),m(13,"div",5)(14,"mat-select",8),H("ngModelChange",function(r){x(e);let o=p();return k(o.preferenceService.timbreCritereModel.doublon,r)||(o.preferenceService.timbreCritereModel.doublon=r),v(r)}),E("ngModelChange",function(){x(e);let r=p();return v(r.filtreByCritere())}),m(15,"mat-option",7),b(16," Oui"),c(),m(17,"mat-option",7),b(18," Non"),c(),m(19,"mat-option",7),b(20," Tous"),c()()(),m(21,"div",9)(22,"mat-select",10),H("ngModelChange",function(r){x(e);let o=p();return k(o.preferenceService.timbreCritereModel.annees,r)||(o.preferenceService.timbreCritereModel.annees=r),v(r)}),E("ngModelChange",function(){x(e);let r=p();return v(r.filtreByCritere())}),_(23,Nr,2,2,"mat-option",11),f(24,"async"),c()()()}if(n&2){let e=p();l(2),V("ngModel",e.preferenceService.timbreCritereModel.type),s("placeholder","Type"),l(),s("ngForOf",g(4,16,e.TypeTimbreEnum)),l(3),V("ngModel",e.preferenceService.timbreCritereModel.acquis),s("placeholder","Acquis"),l(),s("value","OUI"),l(2),s("value","NON"),l(2),s("value","TOUS"),l(3),V("ngModel",e.preferenceService.timbreCritereModel.doublon),s("placeholder","Doublon"),l(),s("value","OUI"),l(2),s("value","NON"),l(2),s("value","TOUS"),l(3),V("ngModel",e.preferenceService.timbreCritereModel.annees),s("placeholder","Ann\xE9es"),l(),s("ngForOf",g(24,18,e.annees$))}}var Vt=class n{constructor(t,e,i,r){this.authService=t;this.timbreService=e;this.timbreUtilsService=i;this.preferenceService=r}modif=!0;annees$;TypeTimbreEnum=pe;ngOnInit(){this.annees$=this.timbreUtilsService.getAnneesAsync("/timbres")}filtreByCritere(){this.preferenceService.timbreCritereModel.getAcquis()=="NON"&&this.preferenceService.timbreCritereModel.setDoublon("TOUS"),this.preferenceService.modifier("timbreCritere",this.preferenceService.timbreCritereModel),this.recherche()}recherche(){u(this.preferenceService.timbreCritereModel.getAnnees())&&this.preferenceService.timbreCritereModel.getAnnees().length>0&&this.timbreService.getTimbres(this.preferenceService.timbreCritereModel,!1)}static \u0275fac=function(e){return new(e||n)(M(J),M(Y),M(U),M(xe))};static \u0275cmp=j({type:n,selectors:[["app-timbre-recherche"]],inputs:{modif:"modif"},decls:1,vars:1,consts:[["class","menuRecherche",4,"ngIf"],[1,"menuRecherche"],[1,"form-input","select",2,"width","120px"],["name","type","multiple","",1,"scrollBarAccent",3,"ngModelChange","ngModel","placeholder"],[4,"ngFor","ngForOf"],[1,"form-input","select",2,"width","100px"],["name","acquis",3,"ngModelChange","ngModel","placeholder"],[1,"selectMin",3,"value"],["name","doublon",1,"scrollBarAccent",3,"ngModelChange","ngModel","placeholder"],[1,"form-input","select",2,"width","150px"],["name","anneeSelect","multiple","",3,"ngModelChange","ngModel","placeholder"],["class","selectMin",3,"value",4,"ngFor","ngForOf"],["class","selectMin",3,"value",4,"ngIf"]],template:function(e,i){e&1&&_(0,Lr,25,20,"div",0),e&2&&s("ngIf",i.modif)},dependencies:[me,re,ee,P,ie,ne,$,at,ct],styles:[".menuRecherche[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:left;width:100%}.menuRecherche[_ngcontent-%COMP%] > .form-input[_ngcontent-%COMP%]{margin:0 10px;display:flex;flex-direction:column;justify-content:space-between;align-items:stretch}@media screen and (max-width: 800px){.menuRecherche[_ngcontent-%COMP%] > .form-input[_ngcontent-%COMP%]{margin:5px 10px}}"]})};function Fr(n,t){if(n&1&&(m(0,"div",3)(1,"span"),b(2,"Nombre de timbres : "),c(),m(3,"span",4),b(4),f(5,"async"),c()()),n&2){let e=p();l(4),Mt(g(5,1,e.total$))}}var kt=class n{constructor(t){this.dialog=t}total$;FontAwesomeEnum=be;FontAwesomeTypeEnum=de;resume(){this.dialog.open(Pt,{height:"auto",maxHeight:"95vh",width:"1200px"})}static \u0275fac=function(e){return new(e||n)(M(le))};static \u0275cmp=j({type:n,selectors:[["app-timbre-total"]],inputs:{total$:"total$"},decls:4,vars:6,consts:[[1,"timbreTotal"],["class","nbTimbre",4,"ngIf"],[1,"accent","click",3,"click","icone","type","info"],[1,"nbTimbre"],[1,"bold"]],template:function(e,i){e&1&&(m(0,"div",0),_(1,Fr,6,3,"div",1),f(2,"async"),m(3,"lib-icon",2),E("click",function(){return i.resume()}),c()()),e&2&&(l(),s("ngIf",g(2,4,i.total$)),l(2),s("icone",i.FontAwesomeEnum.CHART_LINE_UP)("type",i.FontAwesomeTypeEnum.TYPE_SOLID)("info","D\xE9tail par ann\xE9e"))},dependencies:[P,he,$],styles:[".timbreTotal[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:start;align-content:center;gap:10px}.timbreTotal[_ngcontent-%COMP%]   .nbTimbre[_ngcontent-%COMP%]{font-size:1.2em}.timbreTotal[_ngcontent-%COMP%]   lib-icon[_ngcontent-%COMP%]{font-size:1.5em}@media screen and (max-width: 800px){.timbreTotal[_ngcontent-%COMP%]{height:25px;gap:5px}.timbreTotal[_ngcontent-%COMP%]   .nbTimbre[_ngcontent-%COMP%]{font-size:1em}.timbreTotal[_ngcontent-%COMP%]   lib-icon[_ngcontent-%COMP%]{font-size:1.2em}}"]})};function jr(n,t){if(n&1){let e=R();m(0,"img",21),E("click",function(){x(e);let r=p().$implicit,o=p();return v(o.utilsService.zoom(r==null?null:r.getImageZoom()))}),c()}if(n&2){let e=p().$implicit;s("src",e==null?null:e.getImage(),St)}}function Pr(n,t){if(n&1&&b(0),n&2){let e,i=p().$implicit;y(" ",i==null||(e=i.getTimbreBlocModel())==null?null:e.getAnnee()," ")}}function $r(n,t){if(n&1&&b(0),n&2){let e=p().$implicit;y(" ",e==null?null:e.getAnnee()," ")}}function Vr(n,t){if(n&1){let e=R();m(0,"lib-icon",22),E("click",function(){let r;x(e);let o=p().$implicit,a=p();return v(a.utilsService.zoom(o==null||(r=o.getTimbreBlocModel())==null?null:r.getImageZoom()))}),c()}if(n&2){let e,i=p().$implicit,r=p();s("classIcone","primary")("type",r.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",r.FontAwesomeEnum.IMAGE_POLAROID)("classInfo","imageHoverBloc")("info","<img src='"+(i==null||(e=i.getTimbreBlocModel())==null?null:e.getImageZoom())+"'/>")}}function kr(n,t){if(n&1&&S(0,"lib-icon",23),n&2){let e=p().$implicit,i=p();s("classIcone","primary")("type",i.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",i.FontAwesomeEnum.CIRCLE_INFO)("info",e==null?null:e.getYt())}}function Hr(n,t){if(n&1){let e=R();m(0,"div",8)(1,"div",9)(2,"div",10)(3,"lib-icon",11),E("click",function(){let r=x(e).$implicit,o=p();return v(o.timbreService.acquisDoublon(r,!1))}),c(),m(4,"lib-icon",11),E("click",function(){let r=x(e).$implicit,o=p();return v(o.timbreService.acquisDoublon(r,!0))}),c()(),m(5,"div",12)(6,"lib-icon",13),E("click",function(){let r=x(e).$implicit,o=p();return v(o.timbreService.modifierDialog(r))}),c(),m(7,"lib-icon",13),E("click",function(){let r=x(e).$implicit,o=p();return v(o.timbreService.supprimerDialog(r))}),c()()(),m(8,"div",14),_(9,jr,1,1,"img",15),c(),m(10,"div",16),_(11,Pr,1,1,"ng-template",17)(12,$r,1,1,"ng-template",null,0,Z),m(14,"div",18),_(15,Vr,1,5,"lib-icon",19)(16,kr,1,4,"lib-icon",20),c()()()}if(n&2){let e,i,r,o,a,d,T,h=t.$implicit,q=F(13),A=p();s("ngClass",!(h==null||(e=h.getTimbreAcquisModel())==null)&&e.isAcquis()?"border-accent bg-accentA200":"border-primary"),l(3),s("classIcone",!(h==null||(i=h.getTimbreAcquisModel())==null)&&i.isAcquis()?"accent":"primary")("type",A.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",!(h==null||(r=h.getTimbreAcquisModel())==null)&&r.isAcquis()?A.FontAwesomeEnum.CIRCLE_MINUS:A.FontAwesomeEnum.CIRCLE_PLUS)("info",!(h==null||(o=h.getTimbreAcquisModel())==null)&&o.isAcquis()?"pas acquis":"acquis"),l(),s("classIcone",!(h==null||(a=h.getTimbreAcquisModel())==null)&&a.isDoublon()?"accent":"primary")("type",A.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",!(h==null||(d=h.getTimbreAcquisModel())==null)&&d.isDoublon()?A.FontAwesomeEnum.CIRCLE_MINUS:A.FontAwesomeEnum.CIRCLE_PLUS)("info",!(h==null||(T=h.getTimbreAcquisModel())==null)&&T.isDoublon()?"pas en double":"en double"),l(2),s("type",A.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",A.FontAwesomeEnum.PENCIL)("info","Modifier"),l(),s("type",A.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",A.FontAwesomeEnum.TRASH)("info","Supprimer"),l(2),s("ngIf",h==null?null:h.getImage()),l(2),s("ngIf",h==null?null:h.getIdBloc())("ngIfElse",q),l(4),s("ngIf",h==null?null:h.getIdBloc()),l(),s("ngIf",h==null?null:h.getYt())}}var Ht=class n{constructor(t,e,i,r){this.authService=t;this.timbreService=e;this.timbreUtilsService=i;this.utilsService=r}timbres$;load$;total$;modif=!0;timbre=new Ce;annees$;FontAwesomeEnum=be;FontAwesomeTypeEnum=de;ngOnInit(){this.annees$=this.timbreUtilsService.getAnneesAsync("/timbres"),this.timbre.setTimbreAcquisModel(new K)}static \u0275fac=function(e){return new(e||n)(M(J),M(Y),M(U),M(ae))};static \u0275cmp=j({type:n,selectors:[["app-timbre-resultat"]],inputs:{timbres$:"timbres$",load$:"load$",total$:"total$",modif:"modif"},decls:10,vars:12,consts:[["noBloc",""],[1,"responsiveDirection","responsiveMenu"],[3,"total$"],[3,"modif"],[1,"spinner",3,"fxHide","textSpec"],[3,"fxHide"],[1,"listeTimbre","primary"],["class","detailTimbre",3,"ngClass",4,"ngFor","ngForOf"],[1,"detailTimbre",3,"ngClass"],[1,"headerTimbre"],[1,"actionTimbre"],[1,"click",3,"click","classIcone","type","icone","info"],[1,"actionTimbre2"],[1,"primary","click",3,"click","type","icone","info"],[1,"imgTimbre"],["class","image click",3,"src","click",4,"ngIf"],[1,"footerTimbre"],[3,"ngIf","ngIfElse"],[1,"infoTimbre"],["class","click",3,"classIcone","type","icone","classInfo","info","click",4,"ngIf"],["class","click",3,"classIcone","type","icone","info",4,"ngIf"],[1,"image","click",3,"click","src"],[1,"click",3,"click","classIcone","type","icone","classInfo","info"],[1,"click",3,"classIcone","type","icone","info"]],template:function(e,i){e&1&&(m(0,"div",1),S(1,"app-timbre-total",2)(2,"app-timbre-recherche",3),c(),S(3,"lib-spinner",4),f(4,"async"),m(5,"section",5),f(6,"async"),m(7,"div",6),_(8,Hr,17,20,"div",7),f(9,"async"),c()()),e&2&&(l(),s("total$",i.total$),l(),s("modif",i.modif),l(),s("fxHide",g(4,6,i.load$)==!0)("textSpec","Chargement en cours ..."),l(2),s("fxHide",g(6,8,i.load$)==!1),l(3),s("ngForOf",g(9,10,i.timbres$)))},dependencies:[X,ee,P,Ye,te,se,he,Vt,kt,$],styles:[".spinner[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;align-items:stretch;flex:100%;height:100%}.listeTimbre[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:left;width:100%}.listeTimbre[_ngcontent-%COMP%]   lib-icon[_ngcontent-%COMP%]{font-size:1.2em}.listeTimbre[_ngcontent-%COMP%]   .detailTimbre[_ngcontent-%COMP%]{margin:10px;width:115px;height:150px;border-radius:10px;border:1px solid;padding:5px 10px;display:flex;flex-direction:column;justify-content:space-between;align-items:stretch}.listeTimbre[_ngcontent-%COMP%]   .detailTimbre[_ngcontent-%COMP%]   .headerTimbre[_ngcontent-%COMP%]{height:25px;display:flex;flex-direction:row;justify-content:space-between;align-items:end;width:100%;padding-bottom:5px}.listeTimbre[_ngcontent-%COMP%]   .detailTimbre[_ngcontent-%COMP%]   .headerTimbre[_ngcontent-%COMP%]   .actionTimbre[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;align-items:start;gap:5px}.listeTimbre[_ngcontent-%COMP%]   .detailTimbre[_ngcontent-%COMP%]   .headerTimbre[_ngcontent-%COMP%]   .actionTimbre2[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;align-items:end;gap:5px}.listeTimbre[_ngcontent-%COMP%]   .detailTimbre[_ngcontent-%COMP%]   .imgTimbre[_ngcontent-%COMP%]{width:100%;display:flex;flex:auto;justify-content:center;align-items:center}.listeTimbre[_ngcontent-%COMP%]   .detailTimbre[_ngcontent-%COMP%]   .imgTimbre[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100px;max-height:100px}.listeTimbre[_ngcontent-%COMP%]   .detailTimbre[_ngcontent-%COMP%]   .footerTimbre[_ngcontent-%COMP%]{height:25px;display:flex;flex-direction:row;justify-content:space-between;align-items:end;width:100%}.listeTimbre[_ngcontent-%COMP%]   .detailTimbre[_ngcontent-%COMP%]   .footerTimbre[_ngcontent-%COMP%]   .infoTimbre[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:end;align-items:end;gap:5px}@media screen and (max-width: 800px){.listeTimbre[_ngcontent-%COMP%]{justify-content:space-evenly}}"]})};function Wr(n,t){if(n&1&&(S(0,"lib-spinner",5),f(1,"async")),n&2){let e=p();s("textSpec",g(1,1,e.messageLoad$))}}function zr(n,t){if(n&1&&(S(0,"mat-error",16),f(1,"async")),n&2){let e=p(2);s("innerHTML",g(1,1,e.messageError$),We)}}function Yr(n,t){if(n&1&&S(0,"app-timbre-resultat",17),n&2){let e=p(2);s("load$",e.load$)("timbres$",e.timbres$)("modif",!1)}}function Qr(n,t){if(n&1&&(m(0,"mat-option",21),b(1),c()),n&2){let e=t.$implicit;s("value",e),l(),y(" ",e," ")}}function Kr(n,t){if(n&1){let e=R();m(0,"div",18)(1,"mat-select",19),H("ngModelChange",function(r){x(e);let o=p(2);return k(o.annees,r)||(o.annees=r),v(r)}),_(2,Qr,2,2,"mat-option",20),c()()}if(n&2){let e=p(2);l(),V("ngModel",e.annees),s("placeholder","Ann\xE9es"),l(),s("ngForOf",e.anneesDispo)}}function Zr(n,t){n&1&&(m(0,"button",22),b(1," Enregistrer "),c())}function Jr(n,t){if(n&1){let e=R();m(0,"form",6,1),E("ngSubmit",function(){x(e);let r=F(1),o=p();return v(o.valider(r))}),m(2,"div",7),_(3,zr,2,3,"mat-error",8),f(4,"async"),_(5,Yr,1,3,"app-timbre-resultat",9),f(6,"async"),c(),m(7,"div",10),_(8,Kr,3,3,"div",11),f(9,"async"),f(10,"async"),m(11,"button",12),E("click",function(){x(e);let r=p();return v(r.close())}),b(12," Annuler "),c(),m(13,"input",13),E("change",function(r){x(e);let o=p();return v(o.onFileChange(r))}),c(),m(14,"button",14),E("click",function(){x(e);let r=p();return v(r.triggerFileInput())}),b(15," Choisir un fichier "),c(),_(16,Zr,2,0,"button",15),f(17,"async"),c()()}if(n&2){let e,i,r,o=F(1),a=p();s("ngClass",o!=null&&o.submitted?"red-color":"blue-color"),l(3),s("ngIf",g(4,6,a.messageError$)),l(2),s("ngIf",((e=g(6,8,a.timbres$))==null?null:e.length)>0),l(3),s("ngIf",!g(9,10,a.timbres$)||((i=g(10,12,a.timbres$))==null?null:i.length)==0),l(5),oi("id",a.idFile),l(3),s("ngIf",((r=g(17,14,a.timbres$))==null?null:r.length)>0)}}var Gt=class n{constructor(t,e,i,r,o,a,d){this.authService=t;this.timbreService=e;this.timbreBlocService=i;this.timbreUtilsService=r;this.uploadService=o;this.utilsService=a;this.dialogRef=d}dossier="/assets/images/timbres/";timbres$=new N(null);messageError$=new N(null);messageLoad$=new N("Chargement en cours ...");load$=new N(null);idFile="fileImport";identTimbre=1;identBloc=1;timbresModel=[];timbresBlocsModel=[];anneesDispo=[];annees=[new Date().getFullYear()];ngOnInit(){for(let t=new Date().getFullYear();t>=1900;t--)this.anneesDispo.push(t)}triggerFileInput(){document.getElementById(this.idFile).click()}onFileChange(t){let e=t.target.files[0];e&&(this.load$.next(!1),this.messageLoad$.next("Chargement en cours ..."),this.saveCsv(e))}saveCsv(t){let e=new FileReader;e.onload=()=>{let i=e.result;this.parseCsv(i)},e.readAsText(t)}parseCsv(t){u(this.annees)&&this.annees.length>0&&Q([this.utilsService.getMaxIdentAsync("/timbres"),this.utilsService.getMaxIdentAsync("/timbres_bloc"),this.authService.userSelect$]).pipe(C(([e,i,r])=>u(r))).subscribe(([e,i,r])=>{this.identTimbre=e,this.identBloc=i,this.timbresModel=[],this.timbres$.next(null),Yi.parse(t,{header:!0,skipEmptyLines:!0,complete:o=>{u(o.data)&&o.data?.length>0&&(this.timbresBlocsModel=[],o.data.forEach((a,d)=>{let T=this.setTimbre(a,r);u(T?.getId())&&(this.timbresModel.push(T),this.identTimbre++),d==o.data.length-1&&(this.timbres$.next(this.timbresModel),this.load$.next(!0))}))},error:o=>{console.error("Erreur lors du parsing du CSV :",o)}})})}setTimbre(t,e){let i=new Ce,r=t.CODE!="NULL"&&t.CODE!=""?Number(t.CODE):null,o=t.IDENT_BLOC!="NULL"&&t.IDENT_BLOC!=""&&u(t.IDENT_BLOC)?Number(t.IDENT_BLOC):null,a=t.ANNEE!="NULL"&&t.ANNEE!=""?Number(t.ANNEE):null,d=t.MONNAIE!="NULL"&&t.MONNAIE!=""?t.MONNAIE:null;if(this.annees.includes(a)){i.setId(this.identTimbre),i.setType(t.TYPE!="NULL"&&t.TYPE!=""?t.TYPE:null),i.setYt(t.YT!="NULL"&&t.YT!=""?t.YT:null),i.setAnnee(a);let T=new K;T.setIdTimbre(i.getId()),T.setIdUser(e.getId()),T.setAcquis(t.ACQUIS=="1"),T.setDoublon(t.DOUBLON=="1"),i.setTimbreAcquisModel(T);let h=this.dossier+a+"/",q="";if(u(o)){if(h+="bloc/"+o,q=h+".png",h+="-",i.setTimbreBlocModel(this.timbresBlocsModel.find(A=>A.getAnnee()==a&&A.idOrigine==o)),G(i.getTimbreBlocModel())){let A=new Ne;A.setId(this.identBloc),A.setAnnee(a),A.setMonnaie(d),A.setType(t.CARNET=="1"?"CARNET":"BLOC"),A.idOrigine=o;let Ge=new ce;Ge.setIdBloc(this.identBloc),Ge.setIdUser(e.getId()),Ge.setAcquis(t.ACQUIS_BLOC=="1"),Ge.setDoublon(t.DOUBLON_BLOC=="1"),A.setTimbreBlocAcquisModel(Ge),this.uploadService.checkIfImageExists(q).pipe(C()).subscribe(xt=>{xt&&(A.setImage(q),A.setImageTable(q),A.setImageZoom(q))}),this.timbresBlocsModel.push(A),i.setTimbreBlocModel(A),this.identBloc++}i.setIdBloc(i.getTimbreBlocModel()?.getId())}else i.setMonnaie(d);h+=r+".png",this.uploadService.checkIfImageExists(h).pipe(C()).subscribe(A=>{A&&(i.setImage(h),i.setImageTable(h),i.setImageZoom(h))})}return i}valider(t){this.messageError$.next(null),t?.valid&&(this.load$.next(!1),this.messageLoad$.next("Import en cours ..."),u(this.timbresBlocsModel)&&this.timbresBlocsModel?.length>0&&this.timbresBlocsModel.forEach((e,i)=>{this.saveBloc(e)}),this.timbres$.pipe(C()).subscribe(e=>{if(u(e)&&e?.length>0)e.forEach((i,r)=>{this.saveTimbre(i,r==e.length-1)});else{this.messageError$.next("Donn\xE9es incorrectes");return}}))}saveBloc(t){Q([this.timbreBlocService.upload(t,"autre"),this.timbreBlocService.upload(t,"table"),this.timbreBlocService.upload(t,"zoom")]).pipe(C(([e,i,r])=>u(e)&&u(r)&&u(i))).subscribe(([e,i,r])=>{u(e)&&e!="nok"&&t.setImage(e),u(i)&&i!="nok"&&t.setImageTable(i),u(r)&&r!="nok"&&t.setImageZoom(r),t?.getTimbreBlocAcquisModel()?.isAcquis()&&this.timbreBlocService.addAcquis(t?.getTimbreBlocAcquisModel()?.getIdUser(),t,t?.getTimbreBlocAcquisModel()?.isDoublon()),this.timbreBlocService.ajouter(t,!1)})}saveTimbre(t,e){Q([this.timbreService.upload(t,"autre"),this.timbreService.upload(t,"table"),this.timbreService.upload(t,"zoom")]).pipe(C(([i,r,o])=>u(i)&&u(o)&&u(r))).subscribe(([i,r,o])=>{u(i)&&i!="nok"&&t.setImage(i),u(r)&&r!="nok"&&t.setImageTable(r),u(o)&&o!="nok"&&t.setImageZoom(o),t?.getTimbreAcquisModel()?.isAcquis()&&this.timbreUtilsService.addAcquis(t?.getTimbreAcquisModel()?.getIdUser(),t,t?.getTimbreAcquisModel()?.isDoublon()),this.timbreService.ajouter(t,e),e&&(this.load$.next(!0),this.close())})}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||n)(M(J),M(Y),M(z),M(U),M(mt),M(ae),M(Te))};static \u0275cmp=j({type:n,selectors:[["app-timbre-importer"]],decls:8,vars:4,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],[3,"ngIf","ngIfElse"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","start stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","column","fxLayoutGap","20px",1,"bloc-modal"],[3,"innerHTML",4,"ngIf"],[3,"load$","timbres$","modif",4,"ngIf"],["fxLayout","row","fxLayoutGap","20px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["fxLayout","row","fxLayoutAlign","end center","class","form-input select noError","style","width: 150px",4,"ngIf"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","file","accept",".xls, .xlsx, .csv","hidden","","required","",3,"change","id"],["type","button","mat-raised-button","","color","accent",1,"rounded","large","color-white",3,"click"],["type","submit","class","rounded large color-white","mat-raised-button","","color","accent",4,"ngIf"],[3,"innerHTML"],[3,"load$","timbres$","modif"],["fxLayout","row","fxLayoutAlign","end center",1,"form-input","select","noError",2,"width","150px"],["name","anneeSelect","multiple","",3,"ngModelChange","ngModel","placeholder"],["class","selectMin",3,"value",4,"ngFor","ngForOf"],[1,"selectMin",3,"value"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"]],template:function(e,i){if(e&1&&(m(0,"div",2)(1,"div",3)(2,"span"),b(3,"TIMBRE IMPORTER"),c()(),_(4,Wr,2,3,"ng-template",4),f(5,"async"),_(6,Jr,18,16,"ng-template",null,0,Z),c()),e&2){let r=F(7);l(4),s("ngIf",g(5,2,i.load$)==!1)("ngIfElse",r)}},dependencies:[oe,it,me,re,X,ee,P,fe,Ae,_e,ge,we,te,Oe,ie,De,ne,Re,se,Ht,$]})};function eo(n,t){n&1&&S(0,"lib-spinner",5),n&2&&s("textSpec","Suppression en cours")}function to(n,t){if(n&1){let e=R();m(0,"form",6,1),E("ngSubmit",function(){x(e);let r=F(1),o=p();return v(o.valider(r))}),m(2,"div",7)(3,"div",8)(4,"input",9),H("ngModelChange",function(r){x(e);let o=p();return k(o.annee,r)||(o.annee=r),v(r)}),c()(),m(5,"button",10),E("click",function(){x(e);let r=p();return v(r.close())}),b(6," Annuler "),c(),m(7,"button",11),b(8," Supprimer "),c()()()}if(n&2){let e=F(1),i=p();s("ngClass",e!=null&&e.submitted?"red-color":"blue-color"),l(4),V("ngModel",i.annee),s("max",i.maxAnnee)("zMax",i.maxAnnee)}}var Wt=class n{constructor(t,e,i){this.dialog=t;this.dialogRef=e;this.timbreSupprimService=i}maxAnnee=new Date().getFullYear();annee=new Date().getFullYear();valider(t){if(t?.valid){let e=this.dialog.open($e,{maxHeight:"95vh",data:{titre:"Confirmation",message:"Souhaitez-vous supprimer les timbres ?",btnDroite:"Oui",btnGauche:"Non"}});e.afterClosed().subscribe(()=>{e.componentInstance.data.resultat==="valider"&&(this.timbreSupprimService.loadGlob$.next(!1),this.timbreSupprimService.supprimerTimbres(this.annee),this.timbreSupprimService.load$.pipe(C(i=>i==!0)).subscribe(i=>{this.timbreSupprimService.supprimerBlocs(this.annee),this.timbreSupprimService.load$.pipe(C(r=>r==!0)).subscribe(r=>{this.timbreSupprimService.loadGlob$.next(!0)})}))})}}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||n)(M(le),M(Te),M(Rt))};static \u0275cmp=j({type:n,selectors:[["app-timbre-supprim-choix-annee"]],decls:8,vars:4,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],[3,"ngIf","ngIfElse"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","start stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","row","fxLayoutGap","20px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["fxLayout","column","fxFlex","20","fxLayoutAlign","end end",1,"form-input","noError"],["name","annee","type","number","minlength","4","maxlength","4","min","1900","zMin","1900","required","","zControl","",2,"width","60px !important",3,"ngModelChange","ngModel","max","zMax"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"]],template:function(e,i){if(e&1&&(m(0,"div",2)(1,"div",3)(2,"span"),b(3,"TIMBRE IMPORTER"),c()(),_(4,eo,1,1,"ng-template",4),f(5,"async"),_(6,to,9,4,"ng-template",null,0,Z),c()),e&2){let r=F(7);l(4),s("ngIf",g(5,2,i.timbreSupprimService.loadGlob$)==!1)("ngIfElse",r)}},dependencies:[oe,X,P,fe,Ae,_e,ge,we,te,Oe,Qe,Ke,ie,De,Xe,et,tt,Je,Ze,ne,Re,se,nt,ot,lt,$],encapsulation:2})};var io=n=>[n];function no(n,t){if(n&1){let e=R();m(0,"lib-icon",2),E("click",function(){x(e);let r=p();return v(r.supprimer())}),c()}if(n&2){let e=p();s("icone",e.FontAwesomeEnum.ROTATE)("type",e.FontAwesomeTypeEnum.TYPE_SOLID)("attribs",dt(4,io,e.FontAwesomeAttributEnum.SPIN))("info","Supprimer en cours")}}function ro(n,t){if(n&1){let e=R();m(0,"lib-icon",3),E("click",function(){x(e);let r=p();return v(r.supprimer())}),c()}if(n&2){let e=p();s("icone",e.FontAwesomeEnum.TRASH)("type",e.FontAwesomeTypeEnum.TYPE_SOLID)("info","Supprimer les timbres")}}var zt=class n{constructor(t,e){this.dialog=t;this.timbreSupprimService=e}FontAwesomeEnum=be;FontAwesomeTypeEnum=de;FontAwesomeAttributEnum=ai;supprimer(){this.dialog.open(Wt,{maxHeight:"50vh",width:"300px"})}static \u0275fac=function(e){return new(e||n)(M(le),M(Rt))};static \u0275cmp=j({type:n,selectors:[["app-timbre-supprim"]],decls:4,vars:6,consts:[["class","warn click","style","font-size: 2em",3,"icone","type","attribs","info","click",4,"ngIf"],["class","warn click","style","font-size: 2em",3,"icone","type","info","click",4,"ngIf"],[1,"warn","click",2,"font-size","2em",3,"click","icone","type","attribs","info"],[1,"warn","click",2,"font-size","2em",3,"click","icone","type","info"]],template:function(e,i){e&1&&(_(0,no,1,6,"lib-icon",0),f(1,"async"),_(2,ro,1,3,"lib-icon",1),f(3,"async")),e&2&&(s("ngIf",g(1,2,i.timbreSupprimService.loadGlob$)==!1),l(2),s("ngIf",g(3,4,i.timbreSupprimService.loadGlob$)==!0))},dependencies:[P,he,$],encapsulation:2})};function lo(n,t){if(n&1){let e=R();m(0,"button",9),E("click",function(){x(e);let r=p(2);return v(r.ajouter())}),b(1," Ajouter "),c()}}function mo(n,t){n&1&&(w(0),b(1,"\xA0Bloc"),D())}function so(n,t){if(n&1){let e=R();w(0),_(1,lo,2,0,"button",8),f(2,"async"),m(3,"button",9),E("click",function(){x(e);let r=p();return v(r.ajouterBloc())}),b(4," Ajouter "),_(5,mo,2,0,"ng-container",3),f(6,"async"),c(),D()}if(n&2){let e=p();l(),s("ngIf",g(2,2,e.headerService.route$)==e.RouteEnum.TIMBRE),l(4),s("ngIf",g(6,4,e.headerService.route$)==e.RouteEnum.TIMBRE)}}function ao(n,t){if(n&1){let e=R();w(0),m(1,"lib-icon",11),E("click",function(){let r=x(e).$implicit,o=p(2);return v(o.headerService.setRoute(r.getRoute()))}),c(),D()}if(n&2){let e=t.$implicit;l(),s("icone",e==null?null:e.getIcone())("type",e==null?null:e.getType())("info",e==null?null:e.getInfo())}}function co(n,t){if(n&1&&(w(0),_(1,ao,2,3,"ng-container",10),f(2,"async"),D()),n&2){let e=p();l(),s("ngForOf",g(2,1,e.headerService.choixRoutesTimbre$))}}function po(n,t){if(n&1){let e=R();m(0,"lib-icon",13),E("click",function(){x(e);let r=p(2);return v(r.headerService.mode=r.ModeEnum.TABLE)}),c()}if(n&2){let e=p(2);s("icone",e.FontAwesomeEnum.TABLE)("type",e.FontAwesomeTypeEnum.TYPE_SOLID)("info","Mode tableau")}}function uo(n,t){if(n&1){let e=R();m(0,"lib-icon",13),E("click",function(){x(e);let r=p(2);return v(r.headerService.mode=r.ModeEnum.GRAPH)}),c()}if(n&2){let e=p(2);s("icone",e.FontAwesomeEnum.MEMO)("type",e.FontAwesomeTypeEnum.TYPE_SOLID)("info","Mode tableau")}}function bo(n,t){if(n&1&&(w(0),_(1,po,1,3,"ng-template",12)(2,uo,1,3,"ng-template",null,0,Z),D()),n&2){let e=F(3),i=p();l(),s("ngIf",i.headerService.mode==i.ModeEnum.GRAPH)("ngIfElse",e)}}function fo(n,t){if(n&1){let e=R();m(0,"lib-icon",14),E("click",function(){x(e);let r=p();return v(r.importer())}),c()}if(n&2){let e=p();s("icone",e.FontAwesomeEnum.UPLOAD)("type",e.FontAwesomeTypeEnum.TYPE_SOLID)("info","Importer les timbres")}}function go(n,t){n&1&&S(0,"app-timbre-supprim",15)}function _o(n,t){if(n&1&&(m(0,"mat-option",19),b(1),c()),n&2){let e=t.$implicit;s("value",e),l(),y(" ",e==null?null:e.getPrenom()," ")}}function To(n,t){if(n&1){let e=R();m(0,"div",16)(1,"mat-select",17),f(2,"async"),E("ngModelChange",function(r){x(e);let o=p();return v(o.setUser(r))}),_(3,_o,2,2,"mat-option",18),f(4,"async"),c()()}if(n&2){let e=p();l(),s("ngModel",g(2,3,e.authService.userSelect$))("placeholder","Utilisateur"),l(2),s("ngForOf",g(4,5,e.authService.users$))}}var Qi=class n{constructor(t,e,i,r,o,a,d){this.preferenceService=t;this.authService=e;this.headerService=i;this.timbreService=r;this.timbreBlocService=o;this.timbreUtilsService=a;this.dialog=d;this.verifRoute()}FontAwesomeEnum=be;RouteEnum=si;FontAwesomeTypeEnum=de;DroitEnum=Et;ModeEnum=ci;ajouter(){let t=this.dialog.open(ut,{maxHeight:"95vh",width:"30%",minWidth:"300px"});t.afterClosed().subscribe(()=>{t.close()})}ajouterBloc(){let t=this.dialog.open(pt,{maxHeight:"95vh",width:"30%",minWidth:"300px"});t.afterClosed().subscribe(()=>{t.close()})}ajouterBouchon(){this.timbreService.ajouterSansId(this.timbreService.getBouchon())}importer(){let t=this.dialog.open(Gt,{height:"90vh",width:"70%",minWidth:"300px"});t.afterClosed().subscribe(()=>{t.close()})}verifRoute(){window.location.href.indexOf("bloc")>0?this.preferenceService.getTimbreCritere("blocCritere").pipe(C()).subscribe(t=>{u(t.getAnnees())&&t.getAnnees().length>0?this.timbreBlocService.getBlocs(t,!0):this.timbreUtilsService.getAnneesAsync("/timbres_bloc").pipe(C(e=>u(e)&&e?.length>0)).subscribe(e=>{t.initCritere(),t.setAcquis("NON"),t.setAnnees([e[0]]),this.preferenceService.timbreCritereBlocModel=t,this.preferenceService.modifier("blocCritere",t),this.timbreBlocService.getBlocs(t,!0)})}):this.preferenceService.getTimbreCritere("timbreCritere").pipe(C()).subscribe(t=>{u(t.getAnnees())&&t.getAnnees().length>0?this.timbreService.getTimbres(t,!0):this.timbreUtilsService.getAnneesAsync("/timbres").pipe(C(e=>u(e)&&e?.length>0)).subscribe(e=>{t.initCritere(),t.setAcquis("NON"),t.setAnnees([e[0]]),this.preferenceService.timbreCritereModel=t,this.preferenceService.modifier("timbreCritere",t),this.timbreService.getTimbres(t,!0)})})}setUser(t){this.authService.userSelect$.next(t),this.verifRoute(),this.timbreUtilsService.reinitResume$.next(!0)}static \u0275fac=function(e){return new(e||n)(M(xe),M(J),M(pi),M(Y),M(z),M(U),M(le))};static \u0275cmp=j({type:n,selectors:[["app-menu"]],decls:21,vars:30,consts:[["modeTable",""],[1,"menu"],[1,"sousMenu","sousMenuBouton"],[4,"ngIf"],[1,"sousMenu"],["class","accent click hide-on-mobile","style","font-size: 2em",3,"icone","type","info","click",4,"ngIf"],["class","hide-on-mobile",4,"ngIf"],["fxLayout","row","fxLayoutAlign","end center","class","form-input select","style","width: 120px",4,"ngIf"],["class","rounded large color-white","mat-raised-button","","color","primary",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],[4,"ngFor","ngForOf"],[1,"primary","click",2,"font-size","2em",3,"click","icone","type","info"],[3,"ngIf","ngIfElse"],[1,"primary","click","hide-on-mobile",2,"font-size","2em",3,"click","icone","type","info"],[1,"accent","click","hide-on-mobile",2,"font-size","2em",3,"click","icone","type","info"],[1,"hide-on-mobile"],["fxLayout","row","fxLayoutAlign","end center",1,"form-input","select",2,"width","120px"],["name","user",1,"scrollBarAccent",3,"ngModelChange","ngModel","placeholder"],["class","selectMin",3,"value",4,"ngFor","ngForOf"],[1,"selectMin",3,"value"]],template:function(e,i){if(e&1&&(m(0,"div",1)(1,"div",2),_(2,so,7,6,"ng-container",3),f(3,"async"),c(),m(4,"div",4),_(5,co,3,3,"ng-container",3),f(6,"async"),_(7,bo,4,2,"ng-container",3),f(8,"async"),f(9,"async"),f(10,"async"),_(11,fo,1,3,"lib-icon",5),f(12,"async"),f(13,"async"),_(14,go,1,0,"app-timbre-supprim",6),f(15,"async"),f(16,"async"),_(17,To,5,7,"div",7),f(18,"async"),f(19,"async"),f(20,"async"),c()()),e&2){let r,o,a,d,T,h;l(2),s("ngIf",((r=g(3,6,i.authService.user$))==null?null:r.getDroit())==i.DroitEnum.TOTAL),l(3),s("ngIf",((o=g(6,8,i.headerService.choixRoutesTimbre$))==null?null:o.length)>0),l(2),s("ngIf",((a=g(8,10,i.authService.user$))==null?null:a.getDroit())==i.DroitEnum.TOTAL&&(g(9,12,i.headerService.route$)==i.RouteEnum.TIMBRE||g(10,14,i.headerService.route$)==i.RouteEnum.BLOC)),l(4),s("ngIf",((d=g(12,16,i.authService.user$))==null?null:d.getDroit())==i.DroitEnum.TOTAL&&g(13,18,i.headerService.route$)==i.RouteEnum.TIMBRE),l(3),s("ngIf",((T=g(15,20,i.authService.user$))==null?null:T.getDroit())==i.DroitEnum.TOTAL&&g(16,22,i.headerService.route$)==i.RouteEnum.TIMBRE),l(3),s("ngIf",(((h=g(18,24,i.authService.user$))==null?null:h.getDroit())==i.DroitEnum.TOTAL||((h=g(19,26,i.authService.user$))==null?null:h.getDroit())==i.DroitEnum.CONSULT_TOTAL)&&((h=g(20,28,i.authService.users$))==null?null:h.length)>0)}},dependencies:[ee,P,fe,_e,ie,ne,he,oe,zt,re,me,$],styles:[".menu[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:10px;padding:0 5px}.menu[_ngcontent-%COMP%]   .sousMenu[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:15px}@media screen and (max-width: 800px){.menu[_ngcontent-%COMP%]{flex-direction:column}.menu[_ngcontent-%COMP%]   .sousMenuBouton[_ngcontent-%COMP%]{justify-content:space-between}.menu[_ngcontent-%COMP%]   .sousMenu[_ngcontent-%COMP%]{gap:10px}}"]})};export{ce as a,K as b,U as c,at as d,ct as e,z as f,Y as g,Vt as h,jt as i,Pt as j,kt as k,Ht as l,Gt as m,Qi as n,Wi as o};

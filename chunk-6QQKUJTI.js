import{a as Ld,b as Ud,c as du,d as qd,e as Li,f as fu,g as ro,h as Bd,i as jd,j as pu,k as be,l as zn,m as St,n as io,o as Ui,p as mu,q as zd,r as so,s as oo,t as Bt,v as _t}from"./chunk-Z2WRGFA4.js";import{B as eo,C as au,D as to,E as Bn,F as uu,G as Od,I as cn,J as cu,K as tt,L as ue,O as lu,Ra as Fd,Va as hu,Y as jn,_ as Fi,a as on,b as kd,c as Js,d as Ys,e as Dd,fb as no,g as qt,h as qn,i as an,j as un,l as ze,m as Vd,q as Nd,qb as Gn,rb as ao,s as Oi,ub as Gd,x as Md,y as Xs,z as Zs}from"./chunk-QXCOODFE.js";import{a as $e,b as su,d as __,f as xd,g as Mi,h as ou,i as k}from"./chunk-GOLCFQAC.js";var jh=__(()=>{var $g;(function(r){(function(e){var t=typeof globalThis=="object"?globalThis:typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:u(),n=i(r);typeof t.Reflect<"u"&&(n=i(t.Reflect,n)),e(n,t),typeof t.Reflect>"u"&&(t.Reflect=r);function i(c,h){return function(f,m){Object.defineProperty(c,f,{configurable:!0,writable:!0,value:m}),h&&h(f,m)}}function s(){try{return Function("return this;")()}catch{}}function o(){try{return(0,eval)("(function() { return this; })()")}catch{}}function u(){return s()||o()}})(function(e,t){var n=Object.prototype.hasOwnProperty,i=typeof Symbol=="function",s=i&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",o=i&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",u=typeof Object.create=="function",c={__proto__:[]}instanceof Array,h=!u&&!c,f={create:u?function(){return Er(Object.create(null))}:c?function(){return Er({__proto__:null})}:function(){return Er({})},has:h?function(A,P){return n.call(A,P)}:function(A,P){return P in A},get:h?function(A,P){return n.call(A,P)?A[P]:void 0}:function(A,P){return A[P]}},m=Object.getPrototypeOf(Function),_=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:je(),v=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Ge(),D=typeof WeakMap=="function"?WeakMap:Ir(),M=i?Symbol.for("@reflect-metadata:registry"):void 0,N=$a(),J=Ii(N);function U(A,P,V,q){if(Z(V)){if(!Dn(A))throw new TypeError;if(!Tr(P))throw new TypeError;return b(A,P)}else{if(!Dn(A))throw new TypeError;if(!_e(P))throw new TypeError;if(!_e(q)&&!Z(q)&&!Se(q))throw new TypeError;return Se(q)&&(q=void 0),V=Ze(V),y(A,P,V,q)}}e("decorate",U);function F(A,P){function V(q,Y){if(!_e(q))throw new TypeError;if(!Z(Y)&&!_i(Y))throw new TypeError;tn(A,P,q,Y)}return V}e("metadata",F);function ee(A,P,V,q){if(!_e(V))throw new TypeError;return Z(q)||(q=Ze(q)),tn(A,P,V,q)}e("defineMetadata",ee);function te(A,P,V){if(!_e(P))throw new TypeError;return Z(V)||(V=Ze(V)),dt(A,P,V)}e("hasMetadata",te);function ne(A,P,V){if(!_e(P))throw new TypeError;return Z(V)||(V=Ze(V)),Ot(A,P,V)}e("hasOwnMetadata",ne);function T(A,P,V){if(!_e(P))throw new TypeError;return Z(V)||(V=Ze(V)),ks(A,P,V)}e("getMetadata",T);function g(A,P,V){if(!_e(P))throw new TypeError;return Z(V)||(V=Ze(V)),en(A,P,V)}e("getOwnMetadata",g);function w(A,P){if(!_e(A))throw new TypeError;return Z(P)||(P=Ze(P)),vr(A,P)}e("getMetadataKeys",w);function I(A,P){if(!_e(A))throw new TypeError;return Z(P)||(P=Ze(P)),gi(A,P)}e("getOwnMetadataKeys",I);function E(A,P,V){if(!_e(P))throw new TypeError;if(Z(V)||(V=Ze(V)),!_e(P))throw new TypeError;Z(V)||(V=Ze(V));var q=Ft(P,V,!1);return Z(q)?!1:q.OrdinaryDeleteMetadata(A,P,V)}e("deleteMetadata",E);function b(A,P){for(var V=A.length-1;V>=0;--V){var q=A[V],Y=q(P);if(!Z(Y)&&!Se(Y)){if(!Tr(Y))throw new TypeError;P=Y}}return P}function y(A,P,V,q){for(var Y=A.length-1;Y>=0;--Y){var Te=A[Y],ke=Te(P,V,q);if(!Z(ke)&&!Se(ke)){if(!_e(ke))throw new TypeError;q=ke}}return q}function dt(A,P,V){var q=Ot(A,P,V);if(q)return!0;var Y=Nn(P);return Se(Y)?!1:dt(A,Y,V)}function Ot(A,P,V){var q=Ft(P,V,!1);return Z(q)?!1:Vs(q.OrdinaryHasOwnMetadata(A,P,V))}function ks(A,P,V){var q=Ot(A,P,V);if(q)return en(A,P,V);var Y=Nn(P);if(!Se(Y))return ks(A,Y,V)}function en(A,P,V){var q=Ft(P,V,!1);if(!Z(q))return q.OrdinaryGetOwnMetadata(A,P,V)}function tn(A,P,V,q){var Y=Ft(V,q,!0);Y.OrdinaryDefineOwnMetadata(A,P,V,q)}function vr(A,P){var V=gi(A,P),q=Nn(A);if(q===null)return V;var Y=vr(q,P);if(Y.length<=0)return V;if(V.length<=0)return Y;for(var Te=new v,ke=[],ae=0,G=V;ae<G.length;ae++){var K=G[ae],Q=Te.has(K);Q||(Te.add(K),ke.push(K))}for(var W=0,se=Y;W<se.length;W++){var K=se[W],Q=Te.has(K);Q||(Te.add(K),ke.push(K))}return ke}function gi(A,P){var V=Ft(A,P,!1);return V?V.OrdinaryOwnMetadataKeys(A,P):[]}function Ds(A){if(A===null)return 1;switch(typeof A){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return A===null?1:6;default:return 6}}function Z(A){return A===void 0}function Se(A){return A===null}function za(A){return typeof A=="symbol"}function _e(A){return typeof A=="object"?A!==null:typeof A=="function"}function Ga(A,P){switch(Ds(A)){case 0:return A;case 1:return A;case 2:return A;case 3:return A;case 4:return A;case 5:return A}var V=P===3?"string":P===5?"number":"default",q=yi(A,s);if(q!==void 0){var Y=q.call(A,V);if(_e(Y))throw new TypeError;return Y}return kn(A,V==="default"?"number":V)}function kn(A,P){if(P==="string"){var V=A.toString;if(At(V)){var q=V.call(A);if(!_e(q))return q}var Y=A.valueOf;if(At(Y)){var q=Y.call(A);if(!_e(q))return q}}else{var Y=A.valueOf;if(At(Y)){var q=Y.call(A);if(!_e(q))return q}var Te=A.toString;if(At(Te)){var q=Te.call(A);if(!_e(q))return q}}throw new TypeError}function Vs(A){return!!A}function Ka(A){return""+A}function Ze(A){var P=Ga(A,3);return za(P)?P:Ka(P)}function Dn(A){return Array.isArray?Array.isArray(A):A instanceof Object?A instanceof Array:Object.prototype.toString.call(A)==="[object Array]"}function At(A){return typeof A=="function"}function Tr(A){return typeof A=="function"}function _i(A){switch(Ds(A)){case 3:return!0;case 4:return!0;default:return!1}}function Vn(A,P){return A===P||A!==A&&P!==P}function yi(A,P){var V=A[P];if(V!=null){if(!At(V))throw new TypeError;return V}}function wi(A){var P=yi(A,o);if(!At(P))throw new TypeError;var V=P.call(A);if(!_e(V))throw new TypeError;return V}function Ns(A){return A.value}function vi(A){var P=A.next();return P.done?!1:P}function Ti(A){var P=A.return;P&&P.call(A)}function Nn(A){var P=Object.getPrototypeOf(A);if(typeof A!="function"||A===m||P!==m)return P;var V=A.prototype,q=V&&Object.getPrototypeOf(V);if(q==null||q===Object.prototype)return P;var Y=q.constructor;return typeof Y!="function"||Y===A?P:Y}function Ms(){var A;!Z(M)&&typeof t.Reflect<"u"&&!(M in t.Reflect)&&typeof t.Reflect.defineMetadata=="function"&&(A=Ei(t.Reflect));var P,V,q,Y=new D,Te={registerProvider:ke,getProvider:G,setProvider:Q};return Te;function ke(W){if(!Object.isExtensible(Te))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case A===W:break;case Z(P):P=W;break;case P===W:break;case Z(V):V=W;break;case V===W:break;default:q===void 0&&(q=new v),q.add(W);break}}function ae(W,se){if(!Z(P)){if(P.isProviderFor(W,se))return P;if(!Z(V)){if(V.isProviderFor(W,se))return P;if(!Z(q))for(var pe=wi(q);;){var me=vi(pe);if(!me)return;var at=Ns(me);if(at.isProviderFor(W,se))return Ti(pe),at}}}if(!Z(A)&&A.isProviderFor(W,se))return A}function G(W,se){var pe=Y.get(W),me;return Z(pe)||(me=pe.get(se)),Z(me)&&(me=ae(W,se),Z(me)||(Z(pe)&&(pe=new _,Y.set(W,pe)),pe.set(se,me))),me}function K(W){if(Z(W))throw new TypeError;return P===W||V===W||!Z(q)&&q.has(W)}function Q(W,se,pe){if(!K(pe))throw new Error("Metadata provider not registered.");var me=G(W,se);if(me!==pe){if(!Z(me))return!1;var at=Y.get(W);Z(at)&&(at=new _,Y.set(W,at)),at.set(se,pe)}return!0}}function $a(){var A;return!Z(M)&&_e(t.Reflect)&&Object.isExtensible(t.Reflect)&&(A=t.Reflect[M]),Z(A)&&(A=Ms()),!Z(M)&&_e(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,M,{enumerable:!1,configurable:!1,writable:!1,value:A}),A}function Ii(A){var P=new D,V={isProviderFor:function(K,Q){var W=P.get(K);return Z(W)?!1:W.has(Q)},OrdinaryDefineOwnMetadata:ke,OrdinaryHasOwnMetadata:Y,OrdinaryGetOwnMetadata:Te,OrdinaryOwnMetadataKeys:ae,OrdinaryDeleteMetadata:G};return N.registerProvider(V),V;function q(K,Q,W){var se=P.get(K),pe=!1;if(Z(se)){if(!W)return;se=new _,P.set(K,se),pe=!0}var me=se.get(Q);if(Z(me)){if(!W)return;if(me=new _,se.set(Q,me),!A.setProvider(K,Q,V))throw se.delete(Q),pe&&P.delete(K),new Error("Wrong provider for target.")}return me}function Y(K,Q,W){var se=q(Q,W,!1);return Z(se)?!1:Vs(se.has(K))}function Te(K,Q,W){var se=q(Q,W,!1);if(!Z(se))return se.get(K)}function ke(K,Q,W,se){var pe=q(W,se,!0);pe.set(K,Q)}function ae(K,Q){var W=[],se=q(K,Q,!1);if(Z(se))return W;for(var pe=se.keys(),me=wi(pe),at=0;;){var Mn=vi(me);if(!Mn)return W.length=at,W;var Os=Ns(Mn);try{W[at]=Os}catch(On){try{Ti(me)}finally{throw On}}at++}}function G(K,Q,W){var se=q(Q,W,!1);if(Z(se)||!se.delete(K))return!1;if(se.size===0){var pe=P.get(Q);Z(pe)||(pe.delete(W),pe.size===0&&P.delete(pe))}return!0}}function Ei(A){var P=A.defineMetadata,V=A.hasOwnMetadata,q=A.getOwnMetadata,Y=A.getOwnMetadataKeys,Te=A.deleteMetadata,ke=new D,ae={isProviderFor:function(G,K){var Q=ke.get(G);return!Z(Q)&&Q.has(K)?!0:Y(G,K).length?(Z(Q)&&(Q=new v,ke.set(G,Q)),Q.add(K),!0):!1},OrdinaryDefineOwnMetadata:P,OrdinaryHasOwnMetadata:V,OrdinaryGetOwnMetadata:q,OrdinaryOwnMetadataKeys:Y,OrdinaryDeleteMetadata:Te};return ae}function Ft(A,P,V){var q=N.getProvider(A,P);if(!Z(q))return q;if(V){if(N.setProvider(A,P,J))return J;throw new Error("Illegal state.")}}function je(){var A={},P=[],V=function(){function ae(G,K,Q){this._index=0,this._keys=G,this._values=K,this._selector=Q}return ae.prototype["@@iterator"]=function(){return this},ae.prototype[o]=function(){return this},ae.prototype.next=function(){var G=this._index;if(G>=0&&G<this._keys.length){var K=this._selector(this._keys[G],this._values[G]);return G+1>=this._keys.length?(this._index=-1,this._keys=P,this._values=P):this._index++,{value:K,done:!1}}return{value:void 0,done:!0}},ae.prototype.throw=function(G){throw this._index>=0&&(this._index=-1,this._keys=P,this._values=P),G},ae.prototype.return=function(G){return this._index>=0&&(this._index=-1,this._keys=P,this._values=P),{value:G,done:!0}},ae}(),q=function(){function ae(){this._keys=[],this._values=[],this._cacheKey=A,this._cacheIndex=-2}return Object.defineProperty(ae.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),ae.prototype.has=function(G){return this._find(G,!1)>=0},ae.prototype.get=function(G){var K=this._find(G,!1);return K>=0?this._values[K]:void 0},ae.prototype.set=function(G,K){var Q=this._find(G,!0);return this._values[Q]=K,this},ae.prototype.delete=function(G){var K=this._find(G,!1);if(K>=0){for(var Q=this._keys.length,W=K+1;W<Q;W++)this._keys[W-1]=this._keys[W],this._values[W-1]=this._values[W];return this._keys.length--,this._values.length--,Vn(G,this._cacheKey)&&(this._cacheKey=A,this._cacheIndex=-2),!0}return!1},ae.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=A,this._cacheIndex=-2},ae.prototype.keys=function(){return new V(this._keys,this._values,Y)},ae.prototype.values=function(){return new V(this._keys,this._values,Te)},ae.prototype.entries=function(){return new V(this._keys,this._values,ke)},ae.prototype["@@iterator"]=function(){return this.entries()},ae.prototype[o]=function(){return this.entries()},ae.prototype._find=function(G,K){if(!Vn(this._cacheKey,G)){this._cacheIndex=-1;for(var Q=0;Q<this._keys.length;Q++)if(Vn(this._keys[Q],G)){this._cacheIndex=Q;break}}return this._cacheIndex<0&&K&&(this._cacheIndex=this._keys.length,this._keys.push(G),this._values.push(void 0)),this._cacheIndex},ae}();return q;function Y(ae,G){return ae}function Te(ae,G){return G}function ke(ae,G){return[ae,G]}}function Ge(){var A=function(){function P(){this._map=new _}return Object.defineProperty(P.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),P.prototype.has=function(V){return this._map.has(V)},P.prototype.add=function(V){return this._map.set(V,V),this},P.prototype.delete=function(V){return this._map.delete(V)},P.prototype.clear=function(){this._map.clear()},P.prototype.keys=function(){return this._map.keys()},P.prototype.values=function(){return this._map.keys()},P.prototype.entries=function(){return this._map.entries()},P.prototype["@@iterator"]=function(){return this.keys()},P.prototype[o]=function(){return this.keys()},P}();return A}function Ir(){var A=16,P=f.create(),V=q();return function(){function G(){this._key=q()}return G.prototype.has=function(K){var Q=Y(K,!1);return Q!==void 0?f.has(Q,this._key):!1},G.prototype.get=function(K){var Q=Y(K,!1);return Q!==void 0?f.get(Q,this._key):void 0},G.prototype.set=function(K,Q){var W=Y(K,!0);return W[this._key]=Q,this},G.prototype.delete=function(K){var Q=Y(K,!1);return Q!==void 0?delete Q[this._key]:!1},G.prototype.clear=function(){this._key=q()},G}();function q(){var G;do G="@@WeakMap@@"+ae();while(f.has(P,G));return P[G]=!0,G}function Y(G,K){if(!n.call(G,V)){if(!K)return;Object.defineProperty(G,V,{value:f.create()})}return G[V]}function Te(G,K){for(var Q=0;Q<K;++Q)G[Q]=Math.random()*255|0;return G}function ke(G){if(typeof Uint8Array=="function"){var K=new Uint8Array(G);return typeof crypto<"u"?crypto.getRandomValues(K):typeof msCrypto<"u"?msCrypto.getRandomValues(K):Te(K,G),K}return Te(new Array(G),G)}function ae(){var G=ke(A);G[6]=G[6]&79|64,G[8]=G[8]&191|128;for(var K="",Q=0;Q<A;++Q){var W=G[Q];(Q===4||Q===6||Q===8)&&(K+="-"),W<16&&(K+="0"),K+=W.toString(16).toLowerCase()}return K}}function Er(A){return A.__=void 0,delete A.__,A}})})($g||($g={}))});var oe=function(r){return r[r.PLAIN_TO_CLASS=0]="PLAIN_TO_CLASS",r[r.CLASS_TO_PLAIN=1]="CLASS_TO_PLAIN",r[r.CLASS_TO_CLASS=2]="CLASS_TO_CLASS",r}(oe||{});var uo=class{constructor(){this._typeMetadatas=new Map,this._transformMetadatas=new Map,this._exposeMetadatas=new Map,this._excludeMetadatas=new Map,this._ancestorsMap=new Map}addTypeMetadata(e){this._typeMetadatas.has(e.target)||this._typeMetadatas.set(e.target,new Map),this._typeMetadatas.get(e.target).set(e.propertyName,e)}addTransformMetadata(e){this._transformMetadatas.has(e.target)||this._transformMetadatas.set(e.target,new Map),this._transformMetadatas.get(e.target).has(e.propertyName)||this._transformMetadatas.get(e.target).set(e.propertyName,[]),this._transformMetadatas.get(e.target).get(e.propertyName).push(e)}addExposeMetadata(e){this._exposeMetadatas.has(e.target)||this._exposeMetadatas.set(e.target,new Map),this._exposeMetadatas.get(e.target).set(e.propertyName,e)}addExcludeMetadata(e){this._excludeMetadatas.has(e.target)||this._excludeMetadatas.set(e.target,new Map),this._excludeMetadatas.get(e.target).set(e.propertyName,e)}findTransformMetadatas(e,t,n){return this.findMetadatas(this._transformMetadatas,e,t).filter(i=>!i.options||i.options.toClassOnly===!0&&i.options.toPlainOnly===!0?!0:i.options.toClassOnly===!0?n===oe.CLASS_TO_CLASS||n===oe.PLAIN_TO_CLASS:i.options.toPlainOnly===!0?n===oe.CLASS_TO_PLAIN:!0)}findExcludeMetadata(e,t){return this.findMetadata(this._excludeMetadatas,e,t)}findExposeMetadata(e,t){return this.findMetadata(this._exposeMetadatas,e,t)}findExposeMetadataByCustomName(e,t){return this.getExposedMetadatas(e).find(n=>n.options&&n.options.name===t)}findTypeMetadata(e,t){return this.findMetadata(this._typeMetadatas,e,t)}getStrategy(e){let t=this._excludeMetadatas.get(e),n=t&&t.get(void 0),i=this._exposeMetadatas.get(e),s=i&&i.get(void 0);return n&&s||!n&&!s?"none":n?"excludeAll":"exposeAll"}getExposedMetadatas(e){return this.getMetadata(this._exposeMetadatas,e)}getExcludedMetadatas(e){return this.getMetadata(this._excludeMetadatas,e)}getExposedProperties(e,t){return this.getExposedMetadatas(e).filter(n=>!n.options||n.options.toClassOnly===!0&&n.options.toPlainOnly===!0?!0:n.options.toClassOnly===!0?t===oe.CLASS_TO_CLASS||t===oe.PLAIN_TO_CLASS:n.options.toPlainOnly===!0?t===oe.CLASS_TO_PLAIN:!0).map(n=>n.propertyName)}getExcludedProperties(e,t){return this.getExcludedMetadatas(e).filter(n=>!n.options||n.options.toClassOnly===!0&&n.options.toPlainOnly===!0?!0:n.options.toClassOnly===!0?t===oe.CLASS_TO_CLASS||t===oe.PLAIN_TO_CLASS:n.options.toPlainOnly===!0?t===oe.CLASS_TO_PLAIN:!0).map(n=>n.propertyName)}clear(){this._typeMetadatas.clear(),this._exposeMetadatas.clear(),this._excludeMetadatas.clear(),this._ancestorsMap.clear()}getMetadata(e,t){let n=e.get(t),i;n&&(i=Array.from(n.values()).filter(o=>o.propertyName!==void 0));let s=[];for(let o of this.getAncestors(t)){let u=e.get(o);if(u){let c=Array.from(u.values()).filter(h=>h.propertyName!==void 0);s.push(...c)}}return s.concat(i||[])}findMetadata(e,t,n){let i=e.get(t);if(i){let s=i.get(n);if(s)return s}for(let s of this.getAncestors(t)){let o=e.get(s);if(o){let u=o.get(n);if(u)return u}}}findMetadatas(e,t,n){let i=e.get(t),s;i&&(s=i.get(n));let o=[];for(let u of this.getAncestors(t)){let c=e.get(u);c&&c.has(n)&&o.push(...c.get(n))}return o.slice().reverse().concat((s||[]).slice().reverse())}getAncestors(e){if(!e)return[];if(!this._ancestorsMap.has(e)){let t=[];for(let n=Object.getPrototypeOf(e.prototype.constructor);typeof n.prototype<"u";n=Object.getPrototypeOf(n.prototype.constructor))t.push(n);this._ancestorsMap.set(e,t)}return this._ancestorsMap.get(e)}};var nt=new uo;function Kd(){if(typeof globalThis<"u")return globalThis;if(typeof global<"u")return global;if(typeof window<"u")return window;if(typeof self<"u")return self}function $d(r){return r!==null&&typeof r=="object"&&typeof r.then=="function"}function y_(r){let e=new r;return!(e instanceof Set)&&!("push"in e)?[]:e}var jt=class{constructor(e,t){this.transformationType=e,this.options=t,this.recursionStack=new Set}transform(e,t,n,i,s,o=0){if(Array.isArray(t)||t instanceof Set){let u=i&&this.transformationType===oe.PLAIN_TO_CLASS?y_(i):[];return t.forEach((c,h)=>{let f=e?e[h]:void 0;if(!this.options.enableCircularCheck||!this.isCircular(c)){let m;if(typeof n!="function"&&n&&n.options&&n.options.discriminator&&n.options.discriminator.property&&n.options.discriminator.subTypes){if(this.transformationType===oe.PLAIN_TO_CLASS){m=n.options.discriminator.subTypes.find(M=>M.name===c[n.options.discriminator.property]);let v={newObject:u,object:c,property:void 0},D=n.typeFunction(v);m===void 0?m=D:m=m.value,n.options.keepDiscriminatorProperty||delete c[n.options.discriminator.property]}this.transformationType===oe.CLASS_TO_CLASS&&(m=c.constructor),this.transformationType===oe.CLASS_TO_PLAIN&&(c[n.options.discriminator.property]=n.options.discriminator.subTypes.find(v=>v.value===c.constructor).name)}else m=n;let _=this.transform(f,c,m,void 0,c instanceof Map,o+1);u instanceof Set?u.add(_):u.push(_)}else this.transformationType===oe.CLASS_TO_CLASS&&(u instanceof Set?u.add(c):u.push(c))}),u}else{if(n===String&&!s)return t==null?t:String(t);if(n===Number&&!s)return t==null?t:Number(t);if(n===Boolean&&!s)return t==null?t:!!t;if((n===Date||t instanceof Date)&&!s)return t instanceof Date?new Date(t.valueOf()):t==null?t:new Date(t);if(Kd().Buffer&&(n===Buffer||t instanceof Buffer)&&!s)return t==null?t:Buffer.from(t);if($d(t)&&!s)return new Promise((u,c)=>{t.then(h=>u(this.transform(void 0,h,n,void 0,void 0,o+1)),c)});if(!s&&t!==null&&typeof t=="object"&&typeof t.then=="function")return t;if(typeof t=="object"&&t!==null){!n&&t.constructor!==Object&&(!Array.isArray(t)&&t.constructor===Array||(n=t.constructor)),!n&&e&&(n=e.constructor),this.options.enableCircularCheck&&this.recursionStack.add(t);let u=this.getKeys(n,t,s),c=e||{};!e&&(this.transformationType===oe.PLAIN_TO_CLASS||this.transformationType===oe.CLASS_TO_CLASS)&&(s?c=new Map:n?c=new n:c={});for(let h of u){if(h==="__proto__"||h==="constructor")continue;let f=h,m=h,_=h;if(!this.options.ignoreDecorators&&n){if(this.transformationType===oe.PLAIN_TO_CLASS){let U=nt.findExposeMetadataByCustomName(n,h);U&&(_=U.propertyName,m=U.propertyName)}else if(this.transformationType===oe.CLASS_TO_PLAIN||this.transformationType===oe.CLASS_TO_CLASS){let U=nt.findExposeMetadata(n,h);U&&U.options&&U.options.name&&(m=U.options.name)}}let v;this.transformationType===oe.PLAIN_TO_CLASS?v=t[f]:t instanceof Map?v=t.get(f):t[f]instanceof Function?v=t[f]():v=t[f];let D,M=v instanceof Map;if(n&&s)D=n;else if(n){let U=nt.findTypeMetadata(n,_);if(U){let F={newObject:c,object:t,property:_},ee=U.typeFunction?U.typeFunction(F):U.reflectedType;U.options&&U.options.discriminator&&U.options.discriminator.property&&U.options.discriminator.subTypes?t[f]instanceof Array?D=U:(this.transformationType===oe.PLAIN_TO_CLASS&&(D=U.options.discriminator.subTypes.find(te=>{if(v&&v instanceof Object&&U.options.discriminator.property in v)return te.name===v[U.options.discriminator.property]}),D===void 0?D=ee:D=D.value,U.options.keepDiscriminatorProperty||v&&v instanceof Object&&U.options.discriminator.property in v&&delete v[U.options.discriminator.property]),this.transformationType===oe.CLASS_TO_CLASS&&(D=v.constructor),this.transformationType===oe.CLASS_TO_PLAIN&&v&&(v[U.options.discriminator.property]=U.options.discriminator.subTypes.find(te=>te.value===v.constructor).name)):D=ee,M=M||U.reflectedType===Map}else if(this.options.targetMaps)this.options.targetMaps.filter(F=>F.target===n&&!!F.properties[_]).forEach(F=>D=F.properties[_]);else if(this.options.enableImplicitConversion&&this.transformationType===oe.PLAIN_TO_CLASS){let F=Reflect.getMetadata("design:type",n.prototype,_);F&&(D=F)}}let N=Array.isArray(t[f])?this.getReflectedType(n,_):void 0,J=e?e[f]:void 0;if(c.constructor.prototype){let U=Object.getOwnPropertyDescriptor(c.constructor.prototype,m);if((this.transformationType===oe.PLAIN_TO_CLASS||this.transformationType===oe.CLASS_TO_CLASS)&&(U&&!U.set||c[m]instanceof Function))continue}if(!this.options.enableCircularCheck||!this.isCircular(v)){let U=this.transformationType===oe.PLAIN_TO_CLASS?m:h,F;this.transformationType===oe.CLASS_TO_PLAIN?(F=t[U],F=this.applyCustomTransformations(F,n,U,t,this.transformationType),F=t[U]===F?v:F,F=this.transform(J,F,D,N,M,o+1)):v===void 0&&this.options.exposeDefaultValues?F=c[m]:(F=this.transform(J,v,D,N,M,o+1),F=this.applyCustomTransformations(F,n,U,t,this.transformationType)),(F!==void 0||this.options.exposeUnsetFields)&&(c instanceof Map?c.set(m,F):c[m]=F)}else if(this.transformationType===oe.CLASS_TO_CLASS){let U=v;U=this.applyCustomTransformations(U,n,h,t,this.transformationType),(U!==void 0||this.options.exposeUnsetFields)&&(c instanceof Map?c.set(m,U):c[m]=U)}}return this.options.enableCircularCheck&&this.recursionStack.delete(t),c}else return t}}applyCustomTransformations(e,t,n,i,s){let o=nt.findTransformMetadatas(t,n,this.transformationType);return this.options.version!==void 0&&(o=o.filter(u=>u.options?this.checkVersion(u.options.since,u.options.until):!0)),this.options.groups&&this.options.groups.length?o=o.filter(u=>u.options?this.checkGroups(u.options.groups):!0):o=o.filter(u=>!u.options||!u.options.groups||!u.options.groups.length),o.forEach(u=>{e=u.transformFn({value:e,key:n,obj:i,type:s,options:this.options})}),e}isCircular(e){return this.recursionStack.has(e)}getReflectedType(e,t){if(!e)return;let n=nt.findTypeMetadata(e,t);return n?n.reflectedType:void 0}getKeys(e,t,n){let i=nt.getStrategy(e);i==="none"&&(i=this.options.strategy||"exposeAll");let s=[];if((i==="exposeAll"||n)&&(t instanceof Map?s=Array.from(t.keys()):s=Object.keys(t)),n)return s;if(this.options.ignoreDecorators&&this.options.excludeExtraneousValues&&e){let o=nt.getExposedProperties(e,this.transformationType),u=nt.getExcludedProperties(e,this.transformationType);s=[...o,...u]}if(!this.options.ignoreDecorators&&e){let o=nt.getExposedProperties(e,this.transformationType);this.transformationType===oe.PLAIN_TO_CLASS&&(o=o.map(c=>{let h=nt.findExposeMetadata(e,c);return h&&h.options&&h.options.name?h.options.name:c})),this.options.excludeExtraneousValues?s=o:s=s.concat(o);let u=nt.getExcludedProperties(e,this.transformationType);u.length>0&&(s=s.filter(c=>!u.includes(c))),this.options.version!==void 0&&(s=s.filter(c=>{let h=nt.findExposeMetadata(e,c);return!h||!h.options?!0:this.checkVersion(h.options.since,h.options.until)})),this.options.groups&&this.options.groups.length?s=s.filter(c=>{let h=nt.findExposeMetadata(e,c);return!h||!h.options?!0:this.checkGroups(h.options.groups)}):s=s.filter(c=>{let h=nt.findExposeMetadata(e,c);return!h||!h.options||!h.options.groups||!h.options.groups.length})}return this.options.excludePrefixes&&this.options.excludePrefixes.length&&(s=s.filter(o=>this.options.excludePrefixes.every(u=>o.substr(0,u.length)!==u))),s=s.filter((o,u,c)=>c.indexOf(o)===u),s}checkVersion(e,t){let n=!0;return n&&e&&(n=this.options.version>=e),n&&t&&(n=this.options.version<t),n}checkGroups(e){return e?this.options.groups.some(t=>e.includes(t)):!0}};var Kn={enableCircularCheck:!1,enableImplicitConversion:!1,excludeExtraneousValues:!1,excludePrefixes:void 0,exposeDefaultValues:!1,exposeUnsetFields:!0,groups:void 0,ignoreDecorators:!1,strategy:void 0,targetMaps:void 0,version:void 0};var co=class{instanceToPlain(e,t){return new jt(oe.CLASS_TO_PLAIN,$e($e({},Kn),t)).transform(void 0,e,void 0,void 0,void 0,void 0)}classToPlainFromExist(e,t,n){return new jt(oe.CLASS_TO_PLAIN,$e($e({},Kn),n)).transform(t,e,void 0,void 0,void 0,void 0)}plainToInstance(e,t,n){return new jt(oe.PLAIN_TO_CLASS,$e($e({},Kn),n)).transform(void 0,t,e,void 0,void 0,void 0)}plainToClassFromExist(e,t,n){return new jt(oe.PLAIN_TO_CLASS,$e($e({},Kn),n)).transform(e,t,void 0,void 0,void 0,void 0)}instanceToInstance(e,t){return new jt(oe.CLASS_TO_CLASS,$e($e({},Kn),t)).transform(void 0,e,void 0,void 0,void 0,void 0)}classToClassFromExist(e,t,n){return new jt(oe.CLASS_TO_CLASS,$e($e({},Kn),n)).transform(t,e,void 0,void 0,void 0,void 0)}serialize(e,t){return JSON.stringify(this.instanceToPlain(e,t))}deserialize(e,t,n){let i=JSON.parse(t);return this.plainToInstance(e,i,n)}deserializeArray(e,t,n){let i=JSON.parse(t);return this.plainToInstance(e,i,n)}};var w_=new co;function gu(r,e,t){return w_.plainToInstance(r,e,t)}var Qd=(i=>(i[i.CONSULT=1]="CONSULT",i[i.CONSULT_TOTAL=2]="CONSULT_TOTAL",i[i.PARTIEL=9]="PARTIEL",i[i.TOTAL=10]="TOTAL",i))(Qd||{});var v_="firebase",T_="10.14.1";Bt(v_,T_,"app");var wu=new Fd("ANGULARFIRE2_VERSION");function Hv(r,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(r).getImmediate({optional:!0})}var I_=(r,e)=>{let t=e?[e]:oo(),n=[];return t.forEach(i=>{i.container.getProvider(r).instances.forEach(o=>{n.includes(o)||n.push(o)})}),n},Qn=class{constructor(){return I_(E_)}},E_="app-check";function Rr(){}var lo=class{zone;delegate;constructor(e,t=Dd){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,n){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,n)}},_u=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let n=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Rr,{},Rr,Rr)),t.pipe(Od({next:n,complete:n,error:n})).subscribe(e).add(n)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},ho=(()=>{class r{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new lo(Zone.current)),this.insideAngular=t.run(()=>new lo(Zone.current,Ys)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(n){return new(n||r)(ue(jn))};static \u0275prov=cn({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function qi(){let r=globalThis.\u0275AngularFireScheduler;if(!r)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return r}function A_(r){return qi().ngZone.runOutsideAngular(()=>r())}function $n(r){return qi().ngZone.run(()=>r())}function Jv(r){return r.pipe(qt(qi().outsideAngular))}function rt(r){return S_(qi())(r)}function S_(r){return function(t){return t=t.lift(new _u(r.ngZone)),t.pipe(qn(r.outsideAngular),qt(r.insideAngular))}}var b_=(r,e)=>function(){let n=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),$n(()=>r.apply(void 0,n))},Yv=(r,e)=>function(){let t,n=arguments;for(let s=0;s<arguments.length;s++)typeof n[s]=="function"&&(e&&(t||=$n(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Rr,{},Rr,Rr))),n[s]=b_(n[s],t));let i=A_(()=>r.apply(this,n));if(!e)if(i instanceof on){let s=qi();return i.pipe(qn(s.outsideAngular),qt(s.insideAngular))}else return $n(()=>i);return i instanceof on?i.pipe(rt):i instanceof Promise?$n(()=>new Promise((s,o)=>i.then(u=>$n(()=>s(u)),u=>$n(()=>o(u))))):typeof i=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),i.apply(this,arguments)}:$n(()=>i)};var P_="firebase",R_="10.14.1";_t.registerVersion(P_,R_,"app-compat");var C_=["ngOnDestroy"],Jd=(r,e,t,n={})=>new Proxy(r,{get:(i,s)=>t.runOutsideAngular(()=>{if(r[s])return n?.spy?.get&&n.spy.get(s,r[s]),r[s];if(C_.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(u=>{let c=u?.[s];return typeof c=="function"?c.bind(u):c?.then?c.then(h=>t.run(()=>h)):t.run(()=>c)});return new Proxy(()=>{},{get:(u,c)=>o[c],apply:(u,c,h)=>o.then(f=>{let m=f?.(...h);return n?.spy?.apply&&n.spy.apply(s,h,m),m})})})});var vu=class{constructor(e){return e}},fo=new tt("angularfire2.app.options"),po=new tt("angularfire2.app.name");function mo(r,e,t){let n=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||n;let o=_t.apps.filter(u=>u&&u.name===i.name)[0]||e.runOutsideAngular(()=>_t.initializeApp(r,i));try{if(JSON.stringify(r)!==JSON.stringify(o.options)){let u=!!module.hot;x_("error",`${o.name} Firebase App already initialized with different options${u?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new vu(o)}var x_=(r,...e)=>{hu()&&typeof console<"u"&&console[r](...e)};function go(r,e,t,n,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(u=>u[0]===r)||[];if(s)return k_(i,o)||(Hd("error",`${e} was already initialized on the ${t} Firebase App with different settings.${D_?" You may need to reload as Firebase is not HMR aware.":""}`),Hd("warn",{is:i,was:o})),s;{let u=n();return globalThis.\u0275AngularfireInstanceCache.push([r,u,i]),u}}function k_(r,e){try{return r.toString()===e.toString()}catch{return r===e}}var D_=typeof module<"u"&&!!module.hot,Hd=(r,...e)=>{hu()&&typeof console<"u"&&console[r](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var Yd=class{constructor(e){return e}},Xd=class{constructor(){return oo()}};var V_=new Map,N_={activated:!1,tokenObservers:[]},M_={initialized:!1,enabled:!1};function yt(r){return V_.get(r)||Object.assign({},N_)}function rf(){return M_}var O_="https://content-firebaseappcheck.googleapis.com/v1";var F_="exchangeDebugToken",Zd={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},AT=24*60*60*1e3;var Iu=class{constructor(e,t,n,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return k(this,null,function*(){this.stop();try{this.pending=new du,this.pending.promise.catch(t=>{}),yield L_(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new du,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function L_(r){return new Promise(e=>{setTimeout(e,r)})}var U_={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},ln=new jd("appCheck","AppCheck",U_);function sf(r){if(!yt(r).activated)throw ln.create("use-before-activation",{appName:r.name})}function of(n,i){return k(this,arguments,function*({url:r,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let v=yield o.getHeartbeatsHeader();v&&(s["X-Firebase-Client"]=v)}let u={method:"POST",body:JSON.stringify(e),headers:s},c;try{c=yield fetch(r,u)}catch(v){throw ln.create("fetch-network-error",{originalErrorMessage:v?.message})}if(c.status!==200)throw ln.create("fetch-status-error",{httpStatus:c.status});let h;try{h=yield c.json()}catch(v){throw ln.create("fetch-parse-error",{originalErrorMessage:v?.message})}let f=h.ttl.match(/^([\d.]+)(s)$/);if(!f||!f[2]||isNaN(Number(f[1])))throw ln.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${h.ttl}`});let m=Number(f[1])*1e3,_=Date.now();return{token:h.token,expireTimeMillis:_+m,issuedAtTimeMillis:_}})}function af(r,e){let{projectId:t,appId:n,apiKey:i}=r.options;return{url:`${O_}/projects/${t}/apps/${n}:${F_}?key=${i}`,body:{debug_token:e}}}var q_="firebase-app-check-database",B_=1,Eu="firebase-app-check-store";var _o=null;function j_(){return _o||(_o=new Promise((r,e)=>{try{let t=indexedDB.open(q_,B_);t.onsuccess=n=>{r(n.target.result)},t.onerror=n=>{var i;e(ln.create("storage-open",{originalErrorMessage:(i=n.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=n=>{let i=n.target.result;switch(n.oldVersion){case 0:i.createObjectStore(Eu,{keyPath:"compositeKey"})}}}catch(t){e(ln.create("storage-open",{originalErrorMessage:t?.message}))}}),_o)}function z_(r,e){return G_(K_(r),e)}function G_(r,e){return k(this,null,function*(){let n=(yield j_()).transaction(Eu,"readwrite"),s=n.objectStore(Eu).put({compositeKey:r,value:e});return new Promise((o,u)=>{s.onsuccess=c=>{o()},n.onerror=c=>{var h;u(ln.create("storage-set",{originalErrorMessage:(h=c.target.error)===null||h===void 0?void 0:h.message}))}})})}function K_(r){return`${r.options.appId}-${r.name}`}var Au=new io("@firebase/app-check");function Tu(r,e){return ro()?z_(r,e).catch(t=>{Au.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function uf(){return rf().enabled}function cf(){return k(this,null,function*(){let r=rf();if(r.enabled&&r.token)return r.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var $_={error:"UNKNOWN_ERROR"};function Q_(r){return Ld.encodeString(JSON.stringify(r),!1)}function Su(r,e=!1){return k(this,null,function*(){let t=r.app;sf(t);let n=yt(t),i=n.token,s;if(i&&!Bi(i)&&(n.token=void 0,i=void 0),!i){let c=yield n.cachedTokenPromise;c&&(Bi(c)?i=c:yield Tu(t,void 0))}if(!e&&i&&Bi(i))return{token:i.token};let o=!1;if(uf()){n.exchangeTokenPromise||(n.exchangeTokenPromise=of(af(t,yield cf()),r.heartbeatServiceProvider).finally(()=>{n.exchangeTokenPromise=void 0}),o=!0);let c=yield n.exchangeTokenPromise;return yield Tu(t,c),n.token=c,{token:c.token}}try{n.exchangeTokenPromise||(n.exchangeTokenPromise=n.provider.getToken().finally(()=>{n.exchangeTokenPromise=void 0}),o=!0),i=yield yt(t).exchangeTokenPromise}catch(c){c.code==="appCheck/throttled"?Au.warn(c.message):Au.error(c),s=c}let u;return i?s?Bi(i)?u={token:i.token,internalError:s}:u=tf(s):(u={token:i.token},n.token=i,yield Tu(t,i)):u=tf(s),o&&Y_(t,u),u})}function W_(r){return k(this,null,function*(){let e=r.app;sf(e);let{provider:t}=yt(e);if(uf()){let n=yield cf(),{token:i}=yield of(af(e,n),r.heartbeatServiceProvider);return{token:i}}else{let{token:n}=yield t.getToken();return{token:n}}})}function H_(r,e,t,n){let{app:i}=r,s=yt(i),o={next:t,error:n,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Bi(s.token)){let u=s.token;Promise.resolve().then(()=>{t({token:u.token}),ef(r)}).catch(()=>{})}s.cachedTokenPromise.then(()=>ef(r))}function lf(r,e){let t=yt(r),n=t.tokenObservers.filter(i=>i.next!==e);n.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=n}function ef(r){let{app:e}=r,t=yt(e),n=t.tokenRefresher;n||(n=J_(r),t.tokenRefresher=n),!n.isRunning()&&t.isTokenAutoRefreshEnabled&&n.start()}function J_(r){let{app:e}=r;return new Iu(()=>k(this,null,function*(){let t=yt(e),n;if(t.token?n=yield Su(r,!0):n=yield Su(r),n.error)throw n.error;if(n.internalError)throw n.internalError}),()=>!0,()=>{let t=yt(e);if(t.token){let n=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return n=Math.min(n,i),Math.max(0,n-Date.now())}else return 0},Zd.RETRIAL_MIN_WAIT,Zd.RETRIAL_MAX_WAIT)}function Y_(r,e){let t=yt(r).tokenObservers;for(let n of t)try{n.type==="EXTERNAL"&&e.error!=null?n.error(e.error):n.next(e)}catch{}}function Bi(r){return r.expireTimeMillis-Date.now()>0}function tf(r){return{token:Q_($_),error:r}}var bu=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=yt(this.app);for(let t of e)lf(this.app,t.next);return Promise.resolve()}};function X_(r,e){return new bu(r,e)}function Z_(r){return{getToken:e=>Su(r,e),getLimitedUseToken:()=>W_(r),addTokenListener:e=>H_(r,"INTERNAL",e),removeTokenListener:e=>lf(r.app,e)}}var ey="@firebase/app-check",ty="0.8.8";var ny="app-check",nf="app-check-internal";function ry(){Ui(new zn(ny,r=>{let e=r.getProvider("app").getImmediate(),t=r.getProvider("heartbeat");return X_(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((r,e,t)=>{r.getProvider(nf).initialize()})),Ui(new zn(nf,r=>{let e=r.getProvider("app-check").getImmediate();return Z_(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Bt(ey,ty)}ry();var iy=["localhost","0.0.0.0","127.0.0.1"],OT=typeof window<"u"&&iy.includes(window.location.hostname);var Pu=new tt("angularfire2.auth.use-emulator"),Ru=new tt("angularfire2.auth.settings"),Cu=new tt("angularfire2.auth.tenant-id"),xu=new tt("angularfire2.auth.langugage-code"),ku=new tt("angularfire2.auth.use-device-language"),Du=new tt("angularfire.auth.persistence"),Vu=(r,e,t,n,i,s,o,u)=>go(`${r.name}.auth`,"AngularFireAuth",r.name,()=>{let c=e.runOutsideAngular(()=>r.auth());if(t&&c.useEmulator(...t),n&&(c.tenantId=n),c.languageCode=i,s&&c.useDeviceLanguage(),o)for(let[h,f]of Object.entries(o))c.settings[h]=f;return u&&c.setPersistence(u),c},[t,n,i,s,o,u]),ji=(()=>{class r{authState;idToken;user;idTokenResult;credential;constructor(t,n,i,s,o,u,c,h,f,m,_,v){let D=new kd,M=un(void 0).pipe(qt(o.outsideAngular),Bn(()=>s.runOutsideAngular(()=>import("./chunk-LQGF67VV.js"))),ze(()=>mo(t,s,n)),ze(N=>Vu(N,s,u,h,f,m,c,_)),au({bufferSize:1,refCount:!1}));if(no(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=un(null);else{M.pipe(Xs()).subscribe();let N=M.pipe(Bn(F=>F.getRedirectResult().then(ee=>ee,()=>null)),rt,au({bufferSize:1,refCount:!1})),J=M.pipe(Bn(F=>new on(ee=>({unsubscribe:s.runOutsideAngular(()=>F.onAuthStateChanged(te=>ee.next(te),te=>ee.error(te),()=>ee.complete()))})))),U=M.pipe(Bn(F=>new on(ee=>({unsubscribe:s.runOutsideAngular(()=>F.onIdTokenChanged(te=>ee.next(te),te=>ee.error(te),()=>ee.complete()))}))));this.authState=N.pipe(uu(J),qn(o.outsideAngular),qt(o.insideAngular)),this.user=N.pipe(uu(U),qn(o.outsideAngular),qt(o.insideAngular)),this.idToken=this.user.pipe(Bn(F=>F?an(F.getIdToken()):un(null))),this.idTokenResult=this.user.pipe(Bn(F=>F?an(F.getIdTokenResult()):un(null))),this.credential=Nd(N,D,this.authState.pipe(Oi(F=>!F))).pipe(ze(F=>F?.user?F:null),qn(o.outsideAngular),qt(o.insideAngular))}return Jd(this,M,s,{spy:{apply:(N,J,U)=>{(N.startsWith("signIn")||N.startsWith("createUser"))&&U.then(F=>D.next(F))}}})}static \u0275fac=function(n){return new(n||r)(ue(fo),ue(po,8),ue(Fi),ue(jn),ue(ho),ue(Pu,8),ue(Ru,8),ue(Cu,8),ue(xu,8),ue(ku,8),ue(Du,8),ue(Qn,8))};static \u0275prov=cn({token:r,factory:r.\u0275fac,providedIn:"any"})}return r})(),XT=(()=>{class r{constructor(){_t.registerVersion("angularfire",wu.full,"auth-compat")}static \u0275fac=function(n){return new(n||r)};static \u0275mod=lu({type:r});static \u0275inj=cu({providers:[ji]})}return r})();var ff=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},pf={};var hn,Nu;(function(){var r;function e(T,g){function w(){}w.prototype=g.prototype,T.D=g.prototype,T.prototype=new w,T.prototype.constructor=T,T.C=function(I,E,b){for(var y=Array(arguments.length-2),dt=2;dt<arguments.length;dt++)y[dt-2]=arguments[dt];return g.prototype[E].apply(I,y)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(T,g,w){w||(w=0);var I=Array(16);if(typeof g=="string")for(var E=0;16>E;++E)I[E]=g.charCodeAt(w++)|g.charCodeAt(w++)<<8|g.charCodeAt(w++)<<16|g.charCodeAt(w++)<<24;else for(E=0;16>E;++E)I[E]=g[w++]|g[w++]<<8|g[w++]<<16|g[w++]<<24;g=T.g[0],w=T.g[1],E=T.g[2];var b=T.g[3],y=g+(b^w&(E^b))+I[0]+3614090360&4294967295;g=w+(y<<7&4294967295|y>>>25),y=b+(E^g&(w^E))+I[1]+3905402710&4294967295,b=g+(y<<12&4294967295|y>>>20),y=E+(w^b&(g^w))+I[2]+606105819&4294967295,E=b+(y<<17&4294967295|y>>>15),y=w+(g^E&(b^g))+I[3]+3250441966&4294967295,w=E+(y<<22&4294967295|y>>>10),y=g+(b^w&(E^b))+I[4]+4118548399&4294967295,g=w+(y<<7&4294967295|y>>>25),y=b+(E^g&(w^E))+I[5]+1200080426&4294967295,b=g+(y<<12&4294967295|y>>>20),y=E+(w^b&(g^w))+I[6]+2821735955&4294967295,E=b+(y<<17&4294967295|y>>>15),y=w+(g^E&(b^g))+I[7]+4249261313&4294967295,w=E+(y<<22&4294967295|y>>>10),y=g+(b^w&(E^b))+I[8]+1770035416&4294967295,g=w+(y<<7&4294967295|y>>>25),y=b+(E^g&(w^E))+I[9]+2336552879&4294967295,b=g+(y<<12&4294967295|y>>>20),y=E+(w^b&(g^w))+I[10]+4294925233&4294967295,E=b+(y<<17&4294967295|y>>>15),y=w+(g^E&(b^g))+I[11]+2304563134&4294967295,w=E+(y<<22&4294967295|y>>>10),y=g+(b^w&(E^b))+I[12]+1804603682&4294967295,g=w+(y<<7&4294967295|y>>>25),y=b+(E^g&(w^E))+I[13]+4254626195&4294967295,b=g+(y<<12&4294967295|y>>>20),y=E+(w^b&(g^w))+I[14]+2792965006&4294967295,E=b+(y<<17&4294967295|y>>>15),y=w+(g^E&(b^g))+I[15]+1236535329&4294967295,w=E+(y<<22&4294967295|y>>>10),y=g+(E^b&(w^E))+I[1]+4129170786&4294967295,g=w+(y<<5&4294967295|y>>>27),y=b+(w^E&(g^w))+I[6]+3225465664&4294967295,b=g+(y<<9&4294967295|y>>>23),y=E+(g^w&(b^g))+I[11]+643717713&4294967295,E=b+(y<<14&4294967295|y>>>18),y=w+(b^g&(E^b))+I[0]+3921069994&4294967295,w=E+(y<<20&4294967295|y>>>12),y=g+(E^b&(w^E))+I[5]+3593408605&4294967295,g=w+(y<<5&4294967295|y>>>27),y=b+(w^E&(g^w))+I[10]+38016083&4294967295,b=g+(y<<9&4294967295|y>>>23),y=E+(g^w&(b^g))+I[15]+3634488961&4294967295,E=b+(y<<14&4294967295|y>>>18),y=w+(b^g&(E^b))+I[4]+3889429448&4294967295,w=E+(y<<20&4294967295|y>>>12),y=g+(E^b&(w^E))+I[9]+568446438&4294967295,g=w+(y<<5&4294967295|y>>>27),y=b+(w^E&(g^w))+I[14]+3275163606&4294967295,b=g+(y<<9&4294967295|y>>>23),y=E+(g^w&(b^g))+I[3]+4107603335&4294967295,E=b+(y<<14&4294967295|y>>>18),y=w+(b^g&(E^b))+I[8]+1163531501&4294967295,w=E+(y<<20&4294967295|y>>>12),y=g+(E^b&(w^E))+I[13]+2850285829&4294967295,g=w+(y<<5&4294967295|y>>>27),y=b+(w^E&(g^w))+I[2]+4243563512&4294967295,b=g+(y<<9&4294967295|y>>>23),y=E+(g^w&(b^g))+I[7]+1735328473&4294967295,E=b+(y<<14&4294967295|y>>>18),y=w+(b^g&(E^b))+I[12]+2368359562&4294967295,w=E+(y<<20&4294967295|y>>>12),y=g+(w^E^b)+I[5]+4294588738&4294967295,g=w+(y<<4&4294967295|y>>>28),y=b+(g^w^E)+I[8]+2272392833&4294967295,b=g+(y<<11&4294967295|y>>>21),y=E+(b^g^w)+I[11]+1839030562&4294967295,E=b+(y<<16&4294967295|y>>>16),y=w+(E^b^g)+I[14]+4259657740&4294967295,w=E+(y<<23&4294967295|y>>>9),y=g+(w^E^b)+I[1]+2763975236&4294967295,g=w+(y<<4&4294967295|y>>>28),y=b+(g^w^E)+I[4]+1272893353&4294967295,b=g+(y<<11&4294967295|y>>>21),y=E+(b^g^w)+I[7]+4139469664&4294967295,E=b+(y<<16&4294967295|y>>>16),y=w+(E^b^g)+I[10]+3200236656&4294967295,w=E+(y<<23&4294967295|y>>>9),y=g+(w^E^b)+I[13]+681279174&4294967295,g=w+(y<<4&4294967295|y>>>28),y=b+(g^w^E)+I[0]+3936430074&4294967295,b=g+(y<<11&4294967295|y>>>21),y=E+(b^g^w)+I[3]+3572445317&4294967295,E=b+(y<<16&4294967295|y>>>16),y=w+(E^b^g)+I[6]+76029189&4294967295,w=E+(y<<23&4294967295|y>>>9),y=g+(w^E^b)+I[9]+3654602809&4294967295,g=w+(y<<4&4294967295|y>>>28),y=b+(g^w^E)+I[12]+3873151461&4294967295,b=g+(y<<11&4294967295|y>>>21),y=E+(b^g^w)+I[15]+530742520&4294967295,E=b+(y<<16&4294967295|y>>>16),y=w+(E^b^g)+I[2]+3299628645&4294967295,w=E+(y<<23&4294967295|y>>>9),y=g+(E^(w|~b))+I[0]+4096336452&4294967295,g=w+(y<<6&4294967295|y>>>26),y=b+(w^(g|~E))+I[7]+1126891415&4294967295,b=g+(y<<10&4294967295|y>>>22),y=E+(g^(b|~w))+I[14]+2878612391&4294967295,E=b+(y<<15&4294967295|y>>>17),y=w+(b^(E|~g))+I[5]+4237533241&4294967295,w=E+(y<<21&4294967295|y>>>11),y=g+(E^(w|~b))+I[12]+1700485571&4294967295,g=w+(y<<6&4294967295|y>>>26),y=b+(w^(g|~E))+I[3]+2399980690&4294967295,b=g+(y<<10&4294967295|y>>>22),y=E+(g^(b|~w))+I[10]+4293915773&4294967295,E=b+(y<<15&4294967295|y>>>17),y=w+(b^(E|~g))+I[1]+2240044497&4294967295,w=E+(y<<21&4294967295|y>>>11),y=g+(E^(w|~b))+I[8]+1873313359&4294967295,g=w+(y<<6&4294967295|y>>>26),y=b+(w^(g|~E))+I[15]+4264355552&4294967295,b=g+(y<<10&4294967295|y>>>22),y=E+(g^(b|~w))+I[6]+2734768916&4294967295,E=b+(y<<15&4294967295|y>>>17),y=w+(b^(E|~g))+I[13]+1309151649&4294967295,w=E+(y<<21&4294967295|y>>>11),y=g+(E^(w|~b))+I[4]+4149444226&4294967295,g=w+(y<<6&4294967295|y>>>26),y=b+(w^(g|~E))+I[11]+3174756917&4294967295,b=g+(y<<10&4294967295|y>>>22),y=E+(g^(b|~w))+I[2]+718787259&4294967295,E=b+(y<<15&4294967295|y>>>17),y=w+(b^(E|~g))+I[9]+3951481745&4294967295,T.g[0]=T.g[0]+g&4294967295,T.g[1]=T.g[1]+(E+(y<<21&4294967295|y>>>11))&4294967295,T.g[2]=T.g[2]+E&4294967295,T.g[3]=T.g[3]+b&4294967295}n.prototype.u=function(T,g){g===void 0&&(g=T.length);for(var w=g-this.blockSize,I=this.B,E=this.h,b=0;b<g;){if(E==0)for(;b<=w;)i(this,T,b),b+=this.blockSize;if(typeof T=="string"){for(;b<g;)if(I[E++]=T.charCodeAt(b++),E==this.blockSize){i(this,I),E=0;break}}else for(;b<g;)if(I[E++]=T[b++],E==this.blockSize){i(this,I),E=0;break}}this.h=E,this.o+=g},n.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var g=1;g<T.length-8;++g)T[g]=0;var w=8*this.o;for(g=T.length-8;g<T.length;++g)T[g]=w&255,w/=256;for(this.u(T),T=Array(16),g=w=0;4>g;++g)for(var I=0;32>I;I+=8)T[w++]=this.g[g]>>>I&255;return T};function s(T,g){var w=u;return Object.prototype.hasOwnProperty.call(w,T)?w[T]:w[T]=g(T)}function o(T,g){this.h=g;for(var w=[],I=!0,E=T.length-1;0<=E;E--){var b=T[E]|0;I&&b==g||(w[E]=b,I=!1)}this.g=w}var u={};function c(T){return-128<=T&&128>T?s(T,function(g){return new o([g|0],0>g?-1:0)}):new o([T|0],0>T?-1:0)}function h(T){if(isNaN(T)||!isFinite(T))return m;if(0>T)return N(h(-T));for(var g=[],w=1,I=0;T>=w;I++)g[I]=T/w|0,w*=4294967296;return new o(g,0)}function f(T,g){if(T.length==0)throw Error("number format error: empty string");if(g=g||10,2>g||36<g)throw Error("radix out of range: "+g);if(T.charAt(0)=="-")return N(f(T.substring(1),g));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=h(Math.pow(g,8)),I=m,E=0;E<T.length;E+=8){var b=Math.min(8,T.length-E),y=parseInt(T.substring(E,E+b),g);8>b?(b=h(Math.pow(g,b)),I=I.j(b).add(h(y))):(I=I.j(w),I=I.add(h(y)))}return I}var m=c(0),_=c(1),v=c(16777216);r=o.prototype,r.m=function(){if(M(this))return-N(this).m();for(var T=0,g=1,w=0;w<this.g.length;w++){var I=this.i(w);T+=(0<=I?I:4294967296+I)*g,g*=4294967296}return T},r.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(D(this))return"0";if(M(this))return"-"+N(this).toString(T);for(var g=h(Math.pow(T,6)),w=this,I="";;){var E=ee(w,g).g;w=J(w,E.j(g));var b=((0<w.g.length?w.g[0]:w.h)>>>0).toString(T);if(w=E,D(w))return b+I;for(;6>b.length;)b="0"+b;I=b+I}},r.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function D(T){if(T.h!=0)return!1;for(var g=0;g<T.g.length;g++)if(T.g[g]!=0)return!1;return!0}function M(T){return T.h==-1}r.l=function(T){return T=J(this,T),M(T)?-1:D(T)?0:1};function N(T){for(var g=T.g.length,w=[],I=0;I<g;I++)w[I]=~T.g[I];return new o(w,~T.h).add(_)}r.abs=function(){return M(this)?N(this):this},r.add=function(T){for(var g=Math.max(this.g.length,T.g.length),w=[],I=0,E=0;E<=g;E++){var b=I+(this.i(E)&65535)+(T.i(E)&65535),y=(b>>>16)+(this.i(E)>>>16)+(T.i(E)>>>16);I=y>>>16,b&=65535,y&=65535,w[E]=y<<16|b}return new o(w,w[w.length-1]&-2147483648?-1:0)};function J(T,g){return T.add(N(g))}r.j=function(T){if(D(this)||D(T))return m;if(M(this))return M(T)?N(this).j(N(T)):N(N(this).j(T));if(M(T))return N(this.j(N(T)));if(0>this.l(v)&&0>T.l(v))return h(this.m()*T.m());for(var g=this.g.length+T.g.length,w=[],I=0;I<2*g;I++)w[I]=0;for(I=0;I<this.g.length;I++)for(var E=0;E<T.g.length;E++){var b=this.i(I)>>>16,y=this.i(I)&65535,dt=T.i(E)>>>16,Ot=T.i(E)&65535;w[2*I+2*E]+=y*Ot,U(w,2*I+2*E),w[2*I+2*E+1]+=b*Ot,U(w,2*I+2*E+1),w[2*I+2*E+1]+=y*dt,U(w,2*I+2*E+1),w[2*I+2*E+2]+=b*dt,U(w,2*I+2*E+2)}for(I=0;I<g;I++)w[I]=w[2*I+1]<<16|w[2*I];for(I=g;I<2*g;I++)w[I]=0;return new o(w,0)};function U(T,g){for(;(T[g]&65535)!=T[g];)T[g+1]+=T[g]>>>16,T[g]&=65535,g++}function F(T,g){this.g=T,this.h=g}function ee(T,g){if(D(g))throw Error("division by zero");if(D(T))return new F(m,m);if(M(T))return g=ee(N(T),g),new F(N(g.g),N(g.h));if(M(g))return g=ee(T,N(g)),new F(N(g.g),g.h);if(30<T.g.length){if(M(T)||M(g))throw Error("slowDivide_ only works with positive integers.");for(var w=_,I=g;0>=I.l(T);)w=te(w),I=te(I);var E=ne(w,1),b=ne(I,1);for(I=ne(I,2),w=ne(w,2);!D(I);){var y=b.add(I);0>=y.l(T)&&(E=E.add(w),b=y),I=ne(I,1),w=ne(w,1)}return g=J(T,E.j(g)),new F(E,g)}for(E=m;0<=T.l(g);){for(w=Math.max(1,Math.floor(T.m()/g.m())),I=Math.ceil(Math.log(w)/Math.LN2),I=48>=I?1:Math.pow(2,I-48),b=h(w),y=b.j(g);M(y)||0<y.l(T);)w-=I,b=h(w),y=b.j(g);D(b)&&(b=_),E=E.add(b),T=J(T,y)}return new F(E,T)}r.A=function(T){return ee(this,T).h},r.and=function(T){for(var g=Math.max(this.g.length,T.g.length),w=[],I=0;I<g;I++)w[I]=this.i(I)&T.i(I);return new o(w,this.h&T.h)},r.or=function(T){for(var g=Math.max(this.g.length,T.g.length),w=[],I=0;I<g;I++)w[I]=this.i(I)|T.i(I);return new o(w,this.h|T.h)},r.xor=function(T){for(var g=Math.max(this.g.length,T.g.length),w=[],I=0;I<g;I++)w[I]=this.i(I)^T.i(I);return new o(w,this.h^T.h)};function te(T){for(var g=T.g.length+1,w=[],I=0;I<g;I++)w[I]=T.i(I)<<1|T.i(I-1)>>>31;return new o(w,T.h)}function ne(T,g){var w=g>>5;g%=32;for(var I=T.g.length-w,E=[],b=0;b<I;b++)E[b]=0<g?T.i(b+w)>>>g|T.i(b+w+1)<<32-g:T.i(b+w);return new o(E,T.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Nu=pf.Md5=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=f,hn=pf.Integer=o}).apply(typeof ff<"u"?ff:typeof self<"u"?self:typeof window<"u"?window:{});var yo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},zt={};var Mu,sy,Cr,Ou,zi,wo,Fu,Lu,Uu;(function(){var r,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,l,d){return a==Array.prototype||a==Object.prototype||(a[l]=d.value),a};function t(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof yo=="object"&&yo];for(var l=0;l<a.length;++l){var d=a[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var n=t(this);function i(a,l){if(l)e:{var d=n;a=a.split(".");for(var p=0;p<a.length-1;p++){var S=a[p];if(!(S in d))break e;d=d[S]}a=a[a.length-1],p=d[a],l=l(p),l!=p&&l!=null&&e(d,a,{configurable:!0,writable:!0,value:l})}}function s(a,l){a instanceof String&&(a+="");var d=0,p=!1,S={next:function(){if(!p&&d<a.length){var C=d++;return{value:l(C,a[C]),done:!1}}return p=!0,{done:!0,value:void 0}}};return S[Symbol.iterator]=function(){return S},S}i("Array.prototype.values",function(a){return a||function(){return s(this,function(l,d){return d})}});var o=o||{},u=this||self;function c(a){var l=typeof a;return l=l!="object"?l:a?Array.isArray(a)?"array":l:"null",l=="array"||l=="object"&&typeof a.length=="number"}function h(a){var l=typeof a;return l=="object"&&a!=null||l=="function"}function f(a,l,d){return a.call.apply(a.bind,arguments)}function m(a,l,d){if(!a)throw Error();if(2<arguments.length){var p=Array.prototype.slice.call(arguments,2);return function(){var S=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(S,p),a.apply(l,S)}}return function(){return a.apply(l,arguments)}}function _(a,l,d){return _=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:m,_.apply(null,arguments)}function v(a,l){var d=Array.prototype.slice.call(arguments,1);return function(){var p=d.slice();return p.push.apply(p,arguments),a.apply(this,p)}}function D(a,l){function d(){}d.prototype=l.prototype,a.aa=l.prototype,a.prototype=new d,a.prototype.constructor=a,a.Qb=function(p,S,C){for(var B=Array(arguments.length-2),ye=2;ye<arguments.length;ye++)B[ye-2]=arguments[ye];return l.prototype[S].apply(p,B)}}function M(a){let l=a.length;if(0<l){let d=Array(l);for(let p=0;p<l;p++)d[p]=a[p];return d}return[]}function N(a,l){for(let d=1;d<arguments.length;d++){let p=arguments[d];if(c(p)){let S=a.length||0,C=p.length||0;a.length=S+C;for(let B=0;B<C;B++)a[S+B]=p[B]}else a.push(p)}}class J{constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function U(a){return/^[\s\xa0]*$/.test(a)}function F(){var a=u.navigator;return a&&(a=a.userAgent)?a:""}function ee(a){return ee[" "](a),a}ee[" "]=function(){};var te=F().indexOf("Gecko")!=-1&&!(F().toLowerCase().indexOf("webkit")!=-1&&F().indexOf("Edge")==-1)&&!(F().indexOf("Trident")!=-1||F().indexOf("MSIE")!=-1)&&F().indexOf("Edge")==-1;function ne(a,l,d){for(let p in a)l.call(d,a[p],p,a)}function T(a,l){for(let d in a)l.call(void 0,a[d],d,a)}function g(a){let l={};for(let d in a)l[d]=a[d];return l}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function I(a,l){let d,p;for(let S=1;S<arguments.length;S++){p=arguments[S];for(d in p)a[d]=p[d];for(let C=0;C<w.length;C++)d=w[C],Object.prototype.hasOwnProperty.call(p,d)&&(a[d]=p[d])}}function E(a){var l=1;a=a.split(":");let d=[];for(;0<l&&a.length;)d.push(a.shift()),l--;return a.length&&d.push(a.join(":")),d}function b(a){u.setTimeout(()=>{throw a},0)}function y(){var a=vr;let l=null;return a.g&&(l=a.g,a.g=a.g.next,a.g||(a.h=null),l.next=null),l}class dt{constructor(){this.h=this.g=null}add(l,d){let p=Ot.get();p.set(l,d),this.h?this.h.next=p:this.g=p,this.h=p}}var Ot=new J(()=>new ks,a=>a.reset());class ks{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let en,tn=!1,vr=new dt,gi=()=>{let a=u.Promise.resolve(void 0);en=()=>{a.then(Ds)}};var Ds=()=>{for(var a;a=y();){try{a.h.call(a.g)}catch(d){b(d)}var l=Ot;l.j(a),100>l.h&&(l.h++,a.next=l.g,l.g=a)}tn=!1};function Z(){this.s=this.s,this.C=this.C}Z.prototype.s=!1,Z.prototype.ma=function(){this.s||(this.s=!0,this.N())},Z.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Se(a,l){this.type=a,this.g=this.target=l,this.defaultPrevented=!1}Se.prototype.h=function(){this.defaultPrevented=!0};var za=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var a=!1,l=Object.defineProperty({},"passive",{get:function(){a=!0}});try{let d=()=>{};u.addEventListener("test",d,l),u.removeEventListener("test",d,l)}catch{}return a}();function _e(a,l){if(Se.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var d=this.type=a.type,p=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=l,l=a.relatedTarget){if(te){e:{try{ee(l.nodeName);var S=!0;break e}catch{}S=!1}S||(l=null)}}else d=="mouseover"?l=a.fromElement:d=="mouseout"&&(l=a.toElement);this.relatedTarget=l,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=typeof a.pointerType=="string"?a.pointerType:Ga[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&_e.aa.h.call(this)}}D(_e,Se);var Ga={2:"touch",3:"pen",4:"mouse"};_e.prototype.h=function(){_e.aa.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var kn="closure_listenable_"+(1e6*Math.random()|0),Vs=0;function Ka(a,l,d,p,S){this.listener=a,this.proxy=null,this.src=l,this.type=d,this.capture=!!p,this.ha=S,this.key=++Vs,this.da=this.fa=!1}function Ze(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function Dn(a){this.src=a,this.g={},this.h=0}Dn.prototype.add=function(a,l,d,p,S){var C=a.toString();a=this.g[C],a||(a=this.g[C]=[],this.h++);var B=Tr(a,l,p,S);return-1<B?(l=a[B],d||(l.fa=!1)):(l=new Ka(l,this.src,C,!!p,S),l.fa=d,a.push(l)),l};function At(a,l){var d=l.type;if(d in a.g){var p=a.g[d],S=Array.prototype.indexOf.call(p,l,void 0),C;(C=0<=S)&&Array.prototype.splice.call(p,S,1),C&&(Ze(l),a.g[d].length==0&&(delete a.g[d],a.h--))}}function Tr(a,l,d,p){for(var S=0;S<a.length;++S){var C=a[S];if(!C.da&&C.listener==l&&C.capture==!!d&&C.ha==p)return S}return-1}var _i="closure_lm_"+(1e6*Math.random()|0),Vn={};function yi(a,l,d,p,S){if(p&&p.once)return vi(a,l,d,p,S);if(Array.isArray(l)){for(var C=0;C<l.length;C++)yi(a,l[C],d,p,S);return null}return d=Ft(d),a&&a[kn]?a.K(l,d,h(p)?!!p.capture:!!p,S):wi(a,l,d,!1,p,S)}function wi(a,l,d,p,S,C){if(!l)throw Error("Invalid event type");var B=h(S)?!!S.capture:!!S,ye=Ii(a);if(ye||(a[_i]=ye=new Dn(a)),d=ye.add(l,d,p,B,C),d.proxy)return d;if(p=Ns(),d.proxy=p,p.src=a,p.listener=d,a.addEventListener)za||(S=B),S===void 0&&(S=!1),a.addEventListener(l.toString(),p,S);else if(a.attachEvent)a.attachEvent(Ms(l.toString()),p);else if(a.addListener&&a.removeListener)a.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return d}function Ns(){function a(d){return l.call(a.src,a.listener,d)}let l=$a;return a}function vi(a,l,d,p,S){if(Array.isArray(l)){for(var C=0;C<l.length;C++)vi(a,l[C],d,p,S);return null}return d=Ft(d),a&&a[kn]?a.L(l,d,h(p)?!!p.capture:!!p,S):wi(a,l,d,!0,p,S)}function Ti(a,l,d,p,S){if(Array.isArray(l))for(var C=0;C<l.length;C++)Ti(a,l[C],d,p,S);else p=h(p)?!!p.capture:!!p,d=Ft(d),a&&a[kn]?(a=a.i,l=String(l).toString(),l in a.g&&(C=a.g[l],d=Tr(C,d,p,S),-1<d&&(Ze(C[d]),Array.prototype.splice.call(C,d,1),C.length==0&&(delete a.g[l],a.h--)))):a&&(a=Ii(a))&&(l=a.g[l.toString()],a=-1,l&&(a=Tr(l,d,p,S)),(d=-1<a?l[a]:null)&&Nn(d))}function Nn(a){if(typeof a!="number"&&a&&!a.da){var l=a.src;if(l&&l[kn])At(l.i,a);else{var d=a.type,p=a.proxy;l.removeEventListener?l.removeEventListener(d,p,a.capture):l.detachEvent?l.detachEvent(Ms(d),p):l.addListener&&l.removeListener&&l.removeListener(p),(d=Ii(l))?(At(d,a),d.h==0&&(d.src=null,l[_i]=null)):Ze(a)}}}function Ms(a){return a in Vn?Vn[a]:Vn[a]="on"+a}function $a(a,l){if(a.da)a=!0;else{l=new _e(l,this);var d=a.listener,p=a.ha||a.src;a.fa&&Nn(a),a=d.call(p,l)}return a}function Ii(a){return a=a[_i],a instanceof Dn?a:null}var Ei="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ft(a){return typeof a=="function"?a:(a[Ei]||(a[Ei]=function(l){return a.handleEvent(l)}),a[Ei])}function je(){Z.call(this),this.i=new Dn(this),this.M=this,this.F=null}D(je,Z),je.prototype[kn]=!0,je.prototype.removeEventListener=function(a,l,d,p){Ti(this,a,l,d,p)};function Ge(a,l){var d,p=a.F;if(p)for(d=[];p;p=p.F)d.push(p);if(a=a.M,p=l.type||l,typeof l=="string")l=new Se(l,a);else if(l instanceof Se)l.target=l.target||a;else{var S=l;l=new Se(p,a),I(l,S)}if(S=!0,d)for(var C=d.length-1;0<=C;C--){var B=l.g=d[C];S=Ir(B,p,!0,l)&&S}if(B=l.g=a,S=Ir(B,p,!0,l)&&S,S=Ir(B,p,!1,l)&&S,d)for(C=0;C<d.length;C++)B=l.g=d[C],S=Ir(B,p,!1,l)&&S}je.prototype.N=function(){if(je.aa.N.call(this),this.i){var a=this.i,l;for(l in a.g){for(var d=a.g[l],p=0;p<d.length;p++)Ze(d[p]);delete a.g[l],a.h--}}this.F=null},je.prototype.K=function(a,l,d,p){return this.i.add(String(a),l,!1,d,p)},je.prototype.L=function(a,l,d,p){return this.i.add(String(a),l,!0,d,p)};function Ir(a,l,d,p){if(l=a.i.g[String(l)],!l)return!0;l=l.concat();for(var S=!0,C=0;C<l.length;++C){var B=l[C];if(B&&!B.da&&B.capture==d){var ye=B.listener,Ke=B.ha||B.src;B.fa&&At(a.i,B),S=ye.call(Ke,p)!==!1&&S}}return S&&!p.defaultPrevented}function Er(a,l,d){if(typeof a=="function")d&&(a=_(a,d));else if(a&&typeof a.handleEvent=="function")a=_(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<Number(l)?-1:u.setTimeout(a,l||0)}function A(a){a.g=Er(()=>{a.g=null,a.i&&(a.i=!1,A(a))},a.l);let l=a.h;a.h=null,a.m.apply(null,l)}class P extends Z{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:A(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function V(a){Z.call(this),this.h=a,this.g={}}D(V,Z);var q=[];function Y(a){ne(a.g,function(l,d){this.g.hasOwnProperty(d)&&Nn(l)},a),a.g={}}V.prototype.N=function(){V.aa.N.call(this),Y(this)},V.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Te=u.JSON.stringify,ke=u.JSON.parse,ae=class{stringify(a){return u.JSON.stringify(a,void 0)}parse(a){return u.JSON.parse(a,void 0)}};function G(){}G.prototype.h=null;function K(a){return a.h||(a.h=a.i())}function Q(){}var W={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function se(){Se.call(this,"d")}D(se,Se);function pe(){Se.call(this,"c")}D(pe,Se);var me={},at=null;function Mn(){return at=at||new je}me.La="serverreachability";function Os(a){Se.call(this,me.La,a)}D(Os,Se);function On(a){let l=Mn();Ge(l,new Os(l))}me.STAT_EVENT="statevent";function zh(a,l){Se.call(this,me.STAT_EVENT,a),this.stat=l}D(zh,Se);function et(a){let l=Mn();Ge(l,new zh(l,a))}me.Ma="timingevent";function Gh(a,l){Se.call(this,me.Ma,a),this.size=l}D(Gh,Se);function Ai(a,l){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){a()},l)}function Si(){this.g=!0}Si.prototype.xa=function(){this.g=!1};function Wg(a,l,d,p,S,C){a.info(function(){if(a.g)if(C)for(var B="",ye=C.split("&"),Ke=0;Ke<ye.length;Ke++){var fe=ye[Ke].split("=");if(1<fe.length){var He=fe[0];fe=fe[1];var Je=He.split("_");B=2<=Je.length&&Je[1]=="type"?B+(He+"="+fe+"&"):B+(He+"=redacted&")}}else B=null;else B=C;return"XMLHTTP REQ ("+p+") [attempt "+S+"]: "+l+`
`+d+`
`+B})}function Hg(a,l,d,p,S,C,B){a.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+S+"]: "+l+`
`+d+`
`+C+" "+B})}function Ar(a,l,d,p){a.info(function(){return"XMLHTTP TEXT ("+l+"): "+Yg(a,d)+(p?" "+p:"")})}function Jg(a,l){a.info(function(){return"TIMEOUT: "+l})}Si.prototype.info=function(){};function Yg(a,l){if(!a.g)return l;if(!l)return null;try{var d=JSON.parse(l);if(d){for(a=0;a<d.length;a++)if(Array.isArray(d[a])){var p=d[a];if(!(2>p.length)){var S=p[1];if(Array.isArray(S)&&!(1>S.length)){var C=S[0];if(C!="noop"&&C!="stop"&&C!="close")for(var B=1;B<S.length;B++)S[B]=""}}}}return Te(d)}catch{return l}}var Fs={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Kh={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Qa;function Ls(){}D(Ls,G),Ls.prototype.g=function(){return new XMLHttpRequest},Ls.prototype.i=function(){return{}},Qa=new Ls;function nn(a,l,d,p){this.j=a,this.i=l,this.l=d,this.R=p||1,this.U=new V(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new $h}function $h(){this.i=null,this.g="",this.h=!1}var Qh={},Wa={};function Ha(a,l,d){a.L=1,a.v=js(Lt(l)),a.m=d,a.P=!0,Wh(a,null)}function Wh(a,l){a.F=Date.now(),Us(a),a.A=Lt(a.v);var d=a.A,p=a.R;Array.isArray(p)||(p=[String(p)]),ud(d.i,"t",p),a.C=0,d=a.j.J,a.h=new $h,a.g=bd(a.j,d?l:null,!a.m),0<a.O&&(a.M=new P(_(a.Y,a,a.g),a.O)),l=a.U,d=a.g,p=a.ca;var S="readystatechange";Array.isArray(S)||(S&&(q[0]=S.toString()),S=q);for(var C=0;C<S.length;C++){var B=yi(d,S[C],p||l.handleEvent,!1,l.h||l);if(!B)break;l.g[B.key]=B}l=a.H?g(a.H):{},a.m?(a.u||(a.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.m,l)):(a.u="GET",a.g.ea(a.A,a.u,null,l)),On(),Wg(a.i,a.u,a.A,a.l,a.R,a.m)}nn.prototype.ca=function(a){a=a.target;let l=this.M;l&&Ut(a)==3?l.j():this.Y(a)},nn.prototype.Y=function(a){try{if(a==this.g)e:{let Je=Ut(this.g);var l=this.g.Ba();let Pr=this.g.Z();if(!(3>Je)&&(Je!=3||this.g&&(this.h.h||this.g.oa()||md(this.g)))){this.J||Je!=4||l==7||(l==8||0>=Pr?On(3):On(2)),Ja(this);var d=this.g.Z();this.X=d;t:if(Hh(this)){var p=md(this.g);a="";var S=p.length,C=Ut(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Fn(this),bi(this);var B="";break t}this.h.i=new u.TextDecoder}for(l=0;l<S;l++)this.h.h=!0,a+=this.h.i.decode(p[l],{stream:!(C&&l==S-1)});p.length=0,this.h.g+=a,this.C=0,B=this.h.g}else B=this.g.oa();if(this.o=d==200,Hg(this.i,this.u,this.A,this.l,this.R,Je,d),this.o){if(this.T&&!this.K){t:{if(this.g){var ye,Ke=this.g;if((ye=Ke.g?Ke.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!U(ye)){var fe=ye;break t}}fe=null}if(d=fe)Ar(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ya(this,d);else{this.o=!1,this.s=3,et(12),Fn(this),bi(this);break e}}if(this.P){d=!0;let gt;for(;!this.J&&this.C<B.length;)if(gt=Xg(this,B),gt==Wa){Je==4&&(this.s=4,et(14),d=!1),Ar(this.i,this.l,null,"[Incomplete Response]");break}else if(gt==Qh){this.s=4,et(15),Ar(this.i,this.l,B,"[Invalid Chunk]"),d=!1;break}else Ar(this.i,this.l,gt,null),Ya(this,gt);if(Hh(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Je!=4||B.length!=0||this.h.h||(this.s=1,et(16),d=!1),this.o=this.o&&d,!d)Ar(this.i,this.l,B,"[Invalid Chunked Response]"),Fn(this),bi(this);else if(0<B.length&&!this.W){this.W=!0;var He=this.j;He.g==this&&He.ba&&!He.M&&(He.j.info("Great, no buffering proxy detected. Bytes received: "+B.length),ru(He),He.M=!0,et(11))}}else Ar(this.i,this.l,B,null),Ya(this,B);Je==4&&Fn(this),this.o&&!this.J&&(Je==4?Id(this.j,this):(this.o=!1,Us(this)))}else m_(this.g),d==400&&0<B.indexOf("Unknown SID")?(this.s=3,et(12)):(this.s=0,et(13)),Fn(this),bi(this)}}}catch{}finally{}};function Hh(a){return a.g?a.u=="GET"&&a.L!=2&&a.j.Ca:!1}function Xg(a,l){var d=a.C,p=l.indexOf(`
`,d);return p==-1?Wa:(d=Number(l.substring(d,p)),isNaN(d)?Qh:(p+=1,p+d>l.length?Wa:(l=l.slice(p,p+d),a.C=p+d,l)))}nn.prototype.cancel=function(){this.J=!0,Fn(this)};function Us(a){a.S=Date.now()+a.I,Jh(a,a.I)}function Jh(a,l){if(a.B!=null)throw Error("WatchDog timer not null");a.B=Ai(_(a.ba,a),l)}function Ja(a){a.B&&(u.clearTimeout(a.B),a.B=null)}nn.prototype.ba=function(){this.B=null;let a=Date.now();0<=a-this.S?(Jg(this.i,this.A),this.L!=2&&(On(),et(17)),Fn(this),this.s=2,bi(this)):Jh(this,this.S-a)};function bi(a){a.j.G==0||a.J||Id(a.j,a)}function Fn(a){Ja(a);var l=a.M;l&&typeof l.ma=="function"&&l.ma(),a.M=null,Y(a.U),a.g&&(l=a.g,a.g=null,l.abort(),l.ma())}function Ya(a,l){try{var d=a.j;if(d.G!=0&&(d.g==a||Xa(d.h,a))){if(!a.K&&Xa(d.h,a)&&d.G==3){try{var p=d.Da.g.parse(l)}catch{p=null}if(Array.isArray(p)&&p.length==3){var S=p;if(S[0]==0){e:if(!d.u){if(d.g)if(d.g.F+3e3<a.F)Qs(d),Ks(d);else break e;nu(d),et(18)}}else d.za=S[1],0<d.za-d.T&&37500>S[2]&&d.F&&d.v==0&&!d.C&&(d.C=Ai(_(d.Za,d),6e3));if(1>=Zh(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else Un(d,11)}else if((a.K||d.g==a)&&Qs(d),!U(l))for(S=d.Da.g.parse(l),l=0;l<S.length;l++){let fe=S[l];if(d.T=fe[0],fe=fe[1],d.G==2)if(fe[0]=="c"){d.K=fe[1],d.ia=fe[2];let He=fe[3];He!=null&&(d.la=He,d.j.info("VER="+d.la));let Je=fe[4];Je!=null&&(d.Aa=Je,d.j.info("SVER="+d.Aa));let Pr=fe[5];Pr!=null&&typeof Pr=="number"&&0<Pr&&(p=1.5*Pr,d.L=p,d.j.info("backChannelRequestTimeoutMs_="+p)),p=d;let gt=a.g;if(gt){let Hs=gt.g?gt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Hs){var C=p.h;C.g||Hs.indexOf("spdy")==-1&&Hs.indexOf("quic")==-1&&Hs.indexOf("h2")==-1||(C.j=C.l,C.g=new Set,C.h&&(Za(C,C.h),C.h=null))}if(p.D){let iu=gt.g?gt.g.getResponseHeader("X-HTTP-Session-Id"):null;iu&&(p.ya=iu,Ie(p.I,p.D,iu))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-a.F,d.j.info("Handshake RTT: "+d.R+"ms")),p=d;var B=a;if(p.qa=Sd(p,p.J?p.ia:null,p.W),B.K){ed(p.h,B);var ye=B,Ke=p.L;Ke&&(ye.I=Ke),ye.B&&(Ja(ye),Us(ye)),p.g=B}else vd(p);0<d.i.length&&$s(d)}else fe[0]!="stop"&&fe[0]!="close"||Un(d,7);else d.G==3&&(fe[0]=="stop"||fe[0]=="close"?fe[0]=="stop"?Un(d,7):tu(d):fe[0]!="noop"&&d.l&&d.l.ta(fe),d.v=0)}}On(4)}catch{}}var Zg=class{constructor(a,l){this.g=a,this.map=l}};function Yh(a){this.l=a||10,u.PerformanceNavigationTiming?(a=u.performance.getEntriesByType("navigation"),a=0<a.length&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Xh(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function Zh(a){return a.h?1:a.g?a.g.size:0}function Xa(a,l){return a.h?a.h==l:a.g?a.g.has(l):!1}function Za(a,l){a.g?a.g.add(l):a.h=l}function ed(a,l){a.h&&a.h==l?a.h=null:a.g&&a.g.has(l)&&a.g.delete(l)}Yh.prototype.cancel=function(){if(this.i=td(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let a of this.g.values())a.cancel();this.g.clear()}};function td(a){if(a.h!=null)return a.i.concat(a.h.D);if(a.g!=null&&a.g.size!==0){let l=a.i;for(let d of a.g.values())l=l.concat(d.D);return l}return M(a.i)}function e_(a){if(a.V&&typeof a.V=="function")return a.V();if(typeof Map<"u"&&a instanceof Map||typeof Set<"u"&&a instanceof Set)return Array.from(a.values());if(typeof a=="string")return a.split("");if(c(a)){for(var l=[],d=a.length,p=0;p<d;p++)l.push(a[p]);return l}l=[],d=0;for(p in a)l[d++]=a[p];return l}function t_(a){if(a.na&&typeof a.na=="function")return a.na();if(!a.V||typeof a.V!="function"){if(typeof Map<"u"&&a instanceof Map)return Array.from(a.keys());if(!(typeof Set<"u"&&a instanceof Set)){if(c(a)||typeof a=="string"){var l=[];a=a.length;for(var d=0;d<a;d++)l.push(d);return l}l=[],d=0;for(let p in a)l[d++]=p;return l}}}function nd(a,l){if(a.forEach&&typeof a.forEach=="function")a.forEach(l,void 0);else if(c(a)||typeof a=="string")Array.prototype.forEach.call(a,l,void 0);else for(var d=t_(a),p=e_(a),S=p.length,C=0;C<S;C++)l.call(void 0,p[C],d&&d[C],a)}var rd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function n_(a,l){if(a){a=a.split("&");for(var d=0;d<a.length;d++){var p=a[d].indexOf("="),S=null;if(0<=p){var C=a[d].substring(0,p);S=a[d].substring(p+1)}else C=a[d];l(C,S?decodeURIComponent(S.replace(/\+/g," ")):"")}}}function Ln(a){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,a instanceof Ln){this.h=a.h,qs(this,a.j),this.o=a.o,this.g=a.g,Bs(this,a.s),this.l=a.l;var l=a.i,d=new Ci;d.i=l.i,l.g&&(d.g=new Map(l.g),d.h=l.h),id(this,d),this.m=a.m}else a&&(l=String(a).match(rd))?(this.h=!1,qs(this,l[1]||"",!0),this.o=Pi(l[2]||""),this.g=Pi(l[3]||"",!0),Bs(this,l[4]),this.l=Pi(l[5]||"",!0),id(this,l[6]||"",!0),this.m=Pi(l[7]||"")):(this.h=!1,this.i=new Ci(null,this.h))}Ln.prototype.toString=function(){var a=[],l=this.j;l&&a.push(Ri(l,sd,!0),":");var d=this.g;return(d||l=="file")&&(a.push("//"),(l=this.o)&&a.push(Ri(l,sd,!0),"@"),a.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.s,d!=null&&a.push(":",String(d))),(d=this.l)&&(this.g&&d.charAt(0)!="/"&&a.push("/"),a.push(Ri(d,d.charAt(0)=="/"?s_:i_,!0))),(d=this.i.toString())&&a.push("?",d),(d=this.m)&&a.push("#",Ri(d,a_)),a.join("")};function Lt(a){return new Ln(a)}function qs(a,l,d){a.j=d?Pi(l,!0):l,a.j&&(a.j=a.j.replace(/:$/,""))}function Bs(a,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);a.s=l}else a.s=null}function id(a,l,d){l instanceof Ci?(a.i=l,u_(a.i,a.h)):(d||(l=Ri(l,o_)),a.i=new Ci(l,a.h))}function Ie(a,l,d){a.i.set(l,d)}function js(a){return Ie(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function Pi(a,l){return a?l?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function Ri(a,l,d){return typeof a=="string"?(a=encodeURI(a).replace(l,r_),d&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function r_(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var sd=/[#\/\?@]/g,i_=/[#\?:]/g,s_=/[#\?]/g,o_=/[#\?@]/g,a_=/#/g;function Ci(a,l){this.h=this.g=null,this.i=a||null,this.j=!!l}function rn(a){a.g||(a.g=new Map,a.h=0,a.i&&n_(a.i,function(l,d){a.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}r=Ci.prototype,r.add=function(a,l){rn(this),this.i=null,a=Sr(this,a);var d=this.g.get(a);return d||this.g.set(a,d=[]),d.push(l),this.h+=1,this};function od(a,l){rn(a),l=Sr(a,l),a.g.has(l)&&(a.i=null,a.h-=a.g.get(l).length,a.g.delete(l))}function ad(a,l){return rn(a),l=Sr(a,l),a.g.has(l)}r.forEach=function(a,l){rn(this),this.g.forEach(function(d,p){d.forEach(function(S){a.call(l,S,p,this)},this)},this)},r.na=function(){rn(this);let a=Array.from(this.g.values()),l=Array.from(this.g.keys()),d=[];for(let p=0;p<l.length;p++){let S=a[p];for(let C=0;C<S.length;C++)d.push(l[p])}return d},r.V=function(a){rn(this);let l=[];if(typeof a=="string")ad(this,a)&&(l=l.concat(this.g.get(Sr(this,a))));else{a=Array.from(this.g.values());for(let d=0;d<a.length;d++)l=l.concat(a[d])}return l},r.set=function(a,l){return rn(this),this.i=null,a=Sr(this,a),ad(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[l]),this.h+=1,this},r.get=function(a,l){return a?(a=this.V(a),0<a.length?String(a[0]):l):l};function ud(a,l,d){od(a,l),0<d.length&&(a.i=null,a.g.set(Sr(a,l),M(d)),a.h+=d.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let a=[],l=Array.from(this.g.keys());for(var d=0;d<l.length;d++){var p=l[d];let C=encodeURIComponent(String(p)),B=this.V(p);for(p=0;p<B.length;p++){var S=C;B[p]!==""&&(S+="="+encodeURIComponent(String(B[p]))),a.push(S)}}return this.i=a.join("&")};function Sr(a,l){return l=String(l),a.j&&(l=l.toLowerCase()),l}function u_(a,l){l&&!a.j&&(rn(a),a.i=null,a.g.forEach(function(d,p){var S=p.toLowerCase();p!=S&&(od(this,p),ud(this,S,d))},a)),a.j=l}function c_(a,l){let d=new Si;if(u.Image){let p=new Image;p.onload=v(sn,d,"TestLoadImage: loaded",!0,l,p),p.onerror=v(sn,d,"TestLoadImage: error",!1,l,p),p.onabort=v(sn,d,"TestLoadImage: abort",!1,l,p),p.ontimeout=v(sn,d,"TestLoadImage: timeout",!1,l,p),u.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=a}else l(!1)}function l_(a,l){let d=new Si,p=new AbortController,S=setTimeout(()=>{p.abort(),sn(d,"TestPingServer: timeout",!1,l)},1e4);fetch(a,{signal:p.signal}).then(C=>{clearTimeout(S),C.ok?sn(d,"TestPingServer: ok",!0,l):sn(d,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(S),sn(d,"TestPingServer: error",!1,l)})}function sn(a,l,d,p,S){try{S&&(S.onload=null,S.onerror=null,S.onabort=null,S.ontimeout=null),p(d)}catch{}}function h_(){this.g=new ae}function d_(a,l,d){let p=d||"";try{nd(a,function(S,C){let B=S;h(S)&&(B=Te(S)),l.push(p+C+"="+encodeURIComponent(B))})}catch(S){throw l.push(p+"type="+encodeURIComponent("_badmap")),S}}function xi(a){this.l=a.Ub||null,this.j=a.eb||!1}D(xi,G),xi.prototype.g=function(){return new zs(this.l,this.j)},xi.prototype.i=function(a){return function(){return a}}({});function zs(a,l){je.call(this),this.D=a,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}D(zs,je),r=zs.prototype,r.open=function(a,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=a,this.A=l,this.readyState=1,Di(this)},r.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};a&&(l.body=a),(this.D||u).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ki(this)),this.readyState=0},r.Sa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,Di(this)),this.g&&(this.readyState=3,Di(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;cd(this)}else a.text().then(this.Ra.bind(this),this.ga.bind(this))};function cd(a){a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a))}r.Pa=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var l=a.value?a.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!a.done}))&&(this.response=this.responseText+=l)}a.done?ki(this):Di(this),this.readyState==3&&cd(this)}},r.Ra=function(a){this.g&&(this.response=this.responseText=a,ki(this))},r.Qa=function(a){this.g&&(this.response=a,ki(this))},r.ga=function(){this.g&&ki(this)};function ki(a){a.readyState=4,a.l=null,a.j=null,a.v=null,Di(a)}r.setRequestHeader=function(a,l){this.u.append(a,l)},r.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let a=[],l=this.h.entries();for(var d=l.next();!d.done;)d=d.value,a.push(d[0]+": "+d[1]),d=l.next();return a.join(`\r
`)};function Di(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(zs.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function ld(a){let l="";return ne(a,function(d,p){l+=p,l+=":",l+=d,l+=`\r
`}),l}function eu(a,l,d){e:{for(p in d){var p=!1;break e}p=!0}p||(d=ld(d),typeof a=="string"?d!=null&&encodeURIComponent(String(d)):Ie(a,l,d))}function Ce(a){je.call(this),this.headers=new Map,this.o=a||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}D(Ce,je);var f_=/^https?$/i,p_=["POST","PUT"];r=Ce.prototype,r.Ha=function(a){this.J=a},r.ea=function(a,l,d,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);l=l?l.toUpperCase():"GET",this.D=a,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Qa.g(),this.v=this.o?K(this.o):K(Qa),this.g.onreadystatechange=_(this.Ea,this);try{this.B=!0,this.g.open(l,String(a),!0),this.B=!1}catch(C){hd(this,C);return}if(a=d||"",d=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var S in p)d.set(S,p[S]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(let C of p.keys())d.set(C,p.get(C));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(d.keys()).find(C=>C.toLowerCase()=="content-type"),S=u.FormData&&a instanceof u.FormData,!(0<=Array.prototype.indexOf.call(p_,l,void 0))||p||S||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[C,B]of d)this.g.setRequestHeader(C,B);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{pd(this),this.u=!0,this.g.send(a),this.u=!1}catch(C){hd(this,C)}};function hd(a,l){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=l,a.m=5,dd(a),Gs(a)}function dd(a){a.A||(a.A=!0,Ge(a,"complete"),Ge(a,"error"))}r.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=a||7,Ge(this,"complete"),Ge(this,"abort"),Gs(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Gs(this,!0)),Ce.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?fd(this):this.bb())},r.bb=function(){fd(this)};function fd(a){if(a.h&&typeof o<"u"&&(!a.v[1]||Ut(a)!=4||a.Z()!=2)){if(a.u&&Ut(a)==4)Er(a.Ea,0,a);else if(Ge(a,"readystatechange"),Ut(a)==4){a.h=!1;try{let B=a.Z();e:switch(B){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var d;if(!(d=l)){var p;if(p=B===0){var S=String(a.D).match(rd)[1]||null;!S&&u.self&&u.self.location&&(S=u.self.location.protocol.slice(0,-1)),p=!f_.test(S?S.toLowerCase():"")}d=p}if(d)Ge(a,"complete"),Ge(a,"success");else{a.m=6;try{var C=2<Ut(a)?a.g.statusText:""}catch{C=""}a.l=C+" ["+a.Z()+"]",dd(a)}}finally{Gs(a)}}}}function Gs(a,l){if(a.g){pd(a);let d=a.g,p=a.v[0]?()=>{}:null;a.g=null,a.v=null,l||Ge(a,"ready");try{d.onreadystatechange=p}catch{}}}function pd(a){a.I&&(u.clearTimeout(a.I),a.I=null)}r.isActive=function(){return!!this.g};function Ut(a){return a.g?a.g.readyState:0}r.Z=function(){try{return 2<Ut(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(a){if(this.g){var l=this.g.responseText;return a&&l.indexOf(a)==0&&(l=l.substring(a.length)),ke(l)}};function md(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.H){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function m_(a){let l={};a=(a.g&&2<=Ut(a)&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<a.length;p++){if(U(a[p]))continue;var d=E(a[p]);let S=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();let C=l[S]||[];l[S]=C,C.push(d)}T(l,function(p){return p.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Vi(a,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[a]||l}function gd(a){this.Aa=0,this.i=[],this.j=new Si,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Vi("failFast",!1,a),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Vi("baseRetryDelayMs",5e3,a),this.cb=Vi("retryDelaySeedMs",1e4,a),this.Wa=Vi("forwardChannelMaxRetries",2,a),this.wa=Vi("forwardChannelRequestTimeoutMs",2e4,a),this.pa=a&&a.xmlHttpFactory||void 0,this.Xa=a&&a.Tb||void 0,this.Ca=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.h=new Yh(a&&a.concurrentRequestLimit),this.Da=new h_,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=a&&a.Rb||!1,a&&a.xa&&this.j.xa(),a&&a.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&a&&a.detectBufferingProxy||!1,this.ja=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.ja=a.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=gd.prototype,r.la=8,r.G=1,r.connect=function(a,l,d,p){et(0),this.W=a,this.H=l||{},d&&p!==void 0&&(this.H.OSID=d,this.H.OAID=p),this.F=this.X,this.I=Sd(this,null,this.W),$s(this)};function tu(a){if(_d(a),a.G==3){var l=a.U++,d=Lt(a.I);if(Ie(d,"SID",a.K),Ie(d,"RID",l),Ie(d,"TYPE","terminate"),Ni(a,d),l=new nn(a,a.j,l),l.L=2,l.v=js(Lt(d)),d=!1,u.navigator&&u.navigator.sendBeacon)try{d=u.navigator.sendBeacon(l.v.toString(),"")}catch{}!d&&u.Image&&(new Image().src=l.v,d=!0),d||(l.g=bd(l.j,null),l.g.ea(l.v)),l.F=Date.now(),Us(l)}Ad(a)}function Ks(a){a.g&&(ru(a),a.g.cancel(),a.g=null)}function _d(a){Ks(a),a.u&&(u.clearTimeout(a.u),a.u=null),Qs(a),a.h.cancel(),a.s&&(typeof a.s=="number"&&u.clearTimeout(a.s),a.s=null)}function $s(a){if(!Xh(a.h)&&!a.s){a.s=!0;var l=a.Ga;en||gi(),tn||(en(),tn=!0),vr.add(l,a),a.B=0}}function g_(a,l){return Zh(a.h)>=a.h.j-(a.s?1:0)?!1:a.s?(a.i=l.D.concat(a.i),!0):a.G==1||a.G==2||a.B>=(a.Va?0:a.Wa)?!1:(a.s=Ai(_(a.Ga,a,l),Ed(a,a.B)),a.B++,!0)}r.Ga=function(a){if(this.s)if(this.s=null,this.G==1){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;let S=new nn(this,this.j,a),C=this.o;if(this.S&&(C?(C=g(C),I(C,this.S)):C=this.S),this.m!==null||this.O||(S.H=C,C=null),this.P)e:{for(var l=0,d=0;d<this.i.length;d++){t:{var p=this.i[d];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(l+=p,4096<l){l=d;break e}if(l===4096||d===this.i.length-1){l=d+1;break e}}l=1e3}else l=1e3;l=wd(this,S,l),d=Lt(this.I),Ie(d,"RID",a),Ie(d,"CVER",22),this.D&&Ie(d,"X-HTTP-Session-Id",this.D),Ni(this,d),C&&(this.O?l="headers="+encodeURIComponent(String(ld(C)))+"&"+l:this.m&&eu(d,this.m,C)),Za(this.h,S),this.Ua&&Ie(d,"TYPE","init"),this.P?(Ie(d,"$req",l),Ie(d,"SID","null"),S.T=!0,Ha(S,d,null)):Ha(S,d,l),this.G=2}}else this.G==3&&(a?yd(this,a):this.i.length==0||Xh(this.h)||yd(this))};function yd(a,l){var d;l?d=l.l:d=a.U++;let p=Lt(a.I);Ie(p,"SID",a.K),Ie(p,"RID",d),Ie(p,"AID",a.T),Ni(a,p),a.m&&a.o&&eu(p,a.m,a.o),d=new nn(a,a.j,d,a.B+1),a.m===null&&(d.H=a.o),l&&(a.i=l.D.concat(a.i)),l=wd(a,d,1e3),d.I=Math.round(.5*a.wa)+Math.round(.5*a.wa*Math.random()),Za(a.h,d),Ha(d,p,l)}function Ni(a,l){a.H&&ne(a.H,function(d,p){Ie(l,p,d)}),a.l&&nd({},function(d,p){Ie(l,p,d)})}function wd(a,l,d){d=Math.min(a.i.length,d);var p=a.l?_(a.l.Na,a.l,a):null;e:{var S=a.i;let C=-1;for(;;){let B=["count="+d];C==-1?0<d?(C=S[0].g,B.push("ofs="+C)):C=0:B.push("ofs="+C);let ye=!0;for(let Ke=0;Ke<d;Ke++){let fe=S[Ke].g,He=S[Ke].map;if(fe-=C,0>fe)C=Math.max(0,S[Ke].g-100),ye=!1;else try{d_(He,B,"req"+fe+"_")}catch{p&&p(He)}}if(ye){p=B.join("&");break e}}}return a=a.i.splice(0,d),l.D=a,p}function vd(a){if(!a.g&&!a.u){a.Y=1;var l=a.Fa;en||gi(),tn||(en(),tn=!0),vr.add(l,a),a.v=0}}function nu(a){return a.g||a.u||3<=a.v?!1:(a.Y++,a.u=Ai(_(a.Fa,a),Ed(a,a.v)),a.v++,!0)}r.Fa=function(){if(this.u=null,Td(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var a=2*this.R;this.j.info("BP detection timer enabled: "+a),this.A=Ai(_(this.ab,this),a)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,et(10),Ks(this),Td(this))};function ru(a){a.A!=null&&(u.clearTimeout(a.A),a.A=null)}function Td(a){a.g=new nn(a,a.j,"rpc",a.Y),a.m===null&&(a.g.H=a.o),a.g.O=0;var l=Lt(a.qa);Ie(l,"RID","rpc"),Ie(l,"SID",a.K),Ie(l,"AID",a.T),Ie(l,"CI",a.F?"0":"1"),!a.F&&a.ja&&Ie(l,"TO",a.ja),Ie(l,"TYPE","xmlhttp"),Ni(a,l),a.m&&a.o&&eu(l,a.m,a.o),a.L&&(a.g.I=a.L);var d=a.g;a=a.ia,d.L=1,d.v=js(Lt(l)),d.m=null,d.P=!0,Wh(d,a)}r.Za=function(){this.C!=null&&(this.C=null,Ks(this),nu(this),et(19))};function Qs(a){a.C!=null&&(u.clearTimeout(a.C),a.C=null)}function Id(a,l){var d=null;if(a.g==l){Qs(a),ru(a),a.g=null;var p=2}else if(Xa(a.h,l))d=l.D,ed(a.h,l),p=1;else return;if(a.G!=0){if(l.o)if(p==1){d=l.m?l.m.length:0,l=Date.now()-l.F;var S=a.B;p=Mn(),Ge(p,new Gh(p,d)),$s(a)}else vd(a);else if(S=l.s,S==3||S==0&&0<l.X||!(p==1&&g_(a,l)||p==2&&nu(a)))switch(d&&0<d.length&&(l=a.h,l.i=l.i.concat(d)),S){case 1:Un(a,5);break;case 4:Un(a,10);break;case 3:Un(a,6);break;default:Un(a,2)}}}function Ed(a,l){let d=a.Ta+Math.floor(Math.random()*a.cb);return a.isActive()||(d*=2),d*l}function Un(a,l){if(a.j.info("Error code "+l),l==2){var d=_(a.fb,a),p=a.Xa;let S=!p;p=new Ln(p||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||qs(p,"https"),js(p),S?c_(p.toString(),d):l_(p.toString(),d)}else et(2);a.G=0,a.l&&a.l.sa(l),Ad(a),_d(a)}r.fb=function(a){a?(this.j.info("Successfully pinged google.com"),et(2)):(this.j.info("Failed to ping google.com"),et(1))};function Ad(a){if(a.G=0,a.ka=[],a.l){let l=td(a.h);(l.length!=0||a.i.length!=0)&&(N(a.ka,l),N(a.ka,a.i),a.h.i.length=0,M(a.i),a.i.length=0),a.l.ra()}}function Sd(a,l,d){var p=d instanceof Ln?Lt(d):new Ln(d);if(p.g!="")l&&(p.g=l+"."+p.g),Bs(p,p.s);else{var S=u.location;p=S.protocol,l=l?l+"."+S.hostname:S.hostname,S=+S.port;var C=new Ln(null);p&&qs(C,p),l&&(C.g=l),S&&Bs(C,S),d&&(C.l=d),p=C}return d=a.D,l=a.ya,d&&l&&Ie(p,d,l),Ie(p,"VER",a.la),Ni(a,p),p}function bd(a,l,d){if(l&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return l=a.Ca&&!a.pa?new Ce(new xi({eb:d})):new Ce(a.pa),l.Ha(a.J),l}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function Pd(){}r=Pd.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function Ws(){}Ws.prototype.g=function(a,l){return new ct(a,l)};function ct(a,l){je.call(this),this.g=new gd(l),this.l=a,this.h=l&&l.messageUrlParams||null,a=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(a?a["X-WebChannel-Content-Type"]=l.messageContentType:a={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(a?a["X-WebChannel-Client-Profile"]=l.va:a={"X-WebChannel-Client-Profile":l.va}),this.g.S=a,(a=l&&l.Sb)&&!U(a)&&(this.g.m=a),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!U(l)&&(this.g.D=l,a=this.h,a!==null&&l in a&&(a=this.h,l in a&&delete a[l])),this.j=new br(this)}D(ct,je),ct.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},ct.prototype.close=function(){tu(this.g)},ct.prototype.o=function(a){var l=this.g;if(typeof a=="string"){var d={};d.__data__=a,a=d}else this.u&&(d={},d.__data__=Te(a),a=d);l.i.push(new Zg(l.Ya++,a)),l.G==3&&$s(l)},ct.prototype.N=function(){this.g.l=null,delete this.j,tu(this.g),delete this.g,ct.aa.N.call(this)};function Rd(a){se.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var l=a.__sm__;if(l){e:{for(let d in l){a=d;break e}a=void 0}(this.i=a)&&(a=this.i,l=l!==null&&a in l?l[a]:void 0),this.data=l}else this.data=a}D(Rd,se);function Cd(){pe.call(this),this.status=1}D(Cd,pe);function br(a){this.g=a}D(br,Pd),br.prototype.ua=function(){Ge(this.g,"a")},br.prototype.ta=function(a){Ge(this.g,new Rd(a))},br.prototype.sa=function(a){Ge(this.g,new Cd)},br.prototype.ra=function(){Ge(this.g,"b")},Ws.prototype.createWebChannel=Ws.prototype.g,ct.prototype.send=ct.prototype.o,ct.prototype.open=ct.prototype.m,ct.prototype.close=ct.prototype.close,Uu=zt.createWebChannelTransport=function(){return new Ws},Lu=zt.getStatEventTarget=function(){return Mn()},Fu=zt.Event=me,wo=zt.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Fs.NO_ERROR=0,Fs.TIMEOUT=8,Fs.HTTP_ERROR=6,zi=zt.ErrorCode=Fs,Kh.COMPLETE="complete",Ou=zt.EventType=Kh,Q.EventType=W,W.OPEN="a",W.CLOSE="b",W.ERROR="c",W.MESSAGE="d",je.prototype.listen=je.prototype.K,Cr=zt.WebChannel=Q,sy=zt.FetchXmlHttpFactory=xi,Ce.prototype.listenOnce=Ce.prototype.L,Ce.prototype.getLastError=Ce.prototype.Ka,Ce.prototype.getLastErrorCode=Ce.prototype.Ba,Ce.prototype.getStatus=Ce.prototype.Z,Ce.prototype.getResponseJson=Ce.prototype.Oa,Ce.prototype.getResponseText=Ce.prototype.oa,Ce.prototype.send=Ce.prototype.ea,Ce.prototype.setWithCredentials=Ce.prototype.Ha,Mu=zt.XhrIo=Ce}).apply(typeof yo<"u"?yo:typeof self<"u"?self:typeof window<"u"?window:{});var mf="@firebase/firestore";var Le=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Le.UNAUTHENTICATED=new Le(null),Le.GOOGLE_CREDENTIALS=new Le("google-credentials-uid"),Le.FIRST_PARTY=new Le("first-party-uid"),Le.MOCK_USER=new Le("mock-user");var oi="10.14.0";var yn=new io("@firebase/firestore");function Nr(){return yn.logLevel}function yp(r){yn.setLogLevel(r)}function L(r,...e){if(yn.logLevel<=St.DEBUG){let t=e.map(Gl);yn.debug(`Firestore (${oi}): ${r}`,...t)}}function De(r,...e){if(yn.logLevel<=St.ERROR){let t=e.map(Gl);yn.error(`Firestore (${oi}): ${r}`,...t)}}function wt(r,...e){if(yn.logLevel<=St.WARN){let t=e.map(Gl);yn.warn(`Firestore (${oi}): ${r}`,...t)}}function Gl(r){if(typeof r=="string")return r;try{return function(t){return JSON.stringify(t)}(r)}catch{return r}}function $(r="Unexpected state"){let e=`FIRESTORE (${oi}) INTERNAL ASSERTION FAILED: `+r;throw De(e),new Error(e)}function H(r,e){r||$()}function wp(r,e){r||$()}function j(r,e){return r}var x={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},O=class extends Bd{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var qe=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Co=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Ku=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Le.UNAUTHENTICATED))}shutdown(){}},$u=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Qu=class{constructor(e){this.t=e,this.currentUser=Le.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){H(this.o===void 0);let n=this.i,i=c=>this.i!==n?(n=this.i,t(c)):Promise.resolve(),s=new qe;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new qe,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let c=s;e.enqueueRetryable(()=>k(this,null,function*(){yield c.promise,yield i(this.currentUser)}))},u=c=>{L("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?u(c):(L("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new qe)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(L("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(H(typeof n.accessToken=="string"),new Co(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return H(e===null||typeof e=="string"),new Le(e)}},Wu=class{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Le.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Hu=class{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new Wu(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Le.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Ju=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Yu=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){H(this.o===void 0);let n=s=>{s.error!=null&&L("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,L("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};let i=s=>{L("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):L("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(H(typeof t.token=="string"),this.R=t.token,new Ju(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function oy(r){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}var xo=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";for(;n.length<20;){let i=oy(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+=e.charAt(i[s]%e.length))}return n}};function re(r,e){return r<e?-1:r>e?1:0}function zr(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}function vp(r){return r+"\0"}var Pe=class r{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new O(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new O(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new O(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new O(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return r.fromMillis(Date.now())}static fromDate(e){return r.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new r(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?re(this.nanoseconds,e.nanoseconds):re(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var X=class r{constructor(e){this.timestamp=e}static fromTimestamp(e){return new r(e)}static min(){return new r(new Pe(0,0))}static max(){return new r(new Pe(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var ko=class r{constructor(e,t,n){t===void 0?t=0:t>e.length&&$(),n===void 0?n=e.length-t:n>e.length-t&&$(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return r.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof r?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let i=0;i<n;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},he=class r extends ko{construct(e,t,n){return new r(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new O(x.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new r(t)}static emptyPath(){return new r([])}},ay=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ve=class r extends ko{construct(e,t,n){return new r(e,t,n)}static isValidIdentifier(e){return ay.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new r(["__name__"])}static fromServerFormat(e){let t=[],n="",i=0,s=()=>{if(n.length===0)throw new O(x.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},o=!1;for(;i<e.length;){let u=e[i];if(u==="\\"){if(i+1===e.length)throw new O(x.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let c=e[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new O(x.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=c,i+=2}else u==="`"?(o=!o,i++):u!=="."||o?(n+=u,i++):(s(),i++)}if(s(),o)throw new O(x.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new r(t)}static emptyPath(){return new r([])}};var z=class r{constructor(e){this.path=e}static fromPath(e){return new r(he.fromString(e))}static fromName(e){return new r(he.fromString(e).popFirst(5))}static empty(){return new r(he.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&he.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return he.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new r(new he(e.slice()))}};var Gr=class{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}};function Xu(r){return r.fields.find(e=>e.kind===2)}function Hn(r){return r.fields.filter(e=>e.kind!==2)}Gr.UNKNOWN_ID=-1;var qr=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var ts=class r{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new r(0,pt.min())}};function Tp(r,e){let t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=X.fromTimestamp(n===1e9?new Pe(t+1,0):new Pe(t,n));return new pt(i,z.empty(),e)}function Ip(r){return new pt(r.readTime,r.key,-1)}var pt=class r{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new r(X.min(),z.empty(),-1)}static max(){return new r(X.max(),z.empty(),-1)}};function Kl(r,e){let t=r.readTime.compareTo(e.readTime);return t!==0?t:(t=z.comparator(r.documentKey,e.documentKey),t!==0?t:re(r.largestBatchId,e.largestBatchId))}var Ep="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Do=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Rn(r){return k(this,null,function*(){if(r.code!==x.FAILED_PRECONDITION||r.message!==Ep)throw r;L("LocalStore","Unexpectedly lost primary lease")})}var R=class r{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&$(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new r((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof r?t:r.resolve(t)}catch(t){return r.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):r.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):r.reject(t)}static resolve(e){return new r((t,n)=>{t(e)})}static reject(e){return new r((t,n)=>{n(e)})}static waitFor(e){return new r((t,n)=>{let i=0,s=0,o=!1;e.forEach(u=>{++i,u.next(()=>{++s,o&&s===i&&t()},c=>n(c))}),o=!0,s===i&&t()})}static or(e){let t=r.resolve(!1);for(let n of e)t=t.next(i=>i?r.resolve(i):n());return t}static forEach(e,t){let n=[];return e.forEach((i,s)=>{n.push(t.call(this,i,s))}),this.waitFor(n)}static mapArray(e,t){return new r((n,i)=>{let s=e.length,o=new Array(s),u=0;for(let c=0;c<s;c++){let h=c;t(e[h]).next(f=>{o[h]=f,++u,u===s&&n(o)},f=>i(f))}})}static doWhile(e,t){return new r((n,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):n()};s()})}};var Vo=class r{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new qe,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new tr(e,t.error)):this.V.resolve()},this.transaction.onerror=n=>{let i=$l(n.target.error);this.V.reject(new tr(e,i))}}static open(e,t,n,i){try{return new r(t,e.transaction(i,n))}catch(s){throw new tr(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(L("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new ec(t)}},wn=class r{constructor(e,t,n){this.name=e,this.version=t,this.p=n,r.S(Li())===12.2&&De("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return L("SimpleDb","Removing database:",e),Jn(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!ro())return!1;if(r.v())return!0;let e=Li(),t=r.S(e),n=0<t&&t<10,i=Ap(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(e){return k(this,null,function*(){return this.db||(L("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,n)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{n(new tr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?n(new O(x.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?n(new O(x.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):n(new tr(e,o))},i.onupgradeneeded=s=>{L("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.O(o,i.transaction,s.oldVersion,this.version).next(()=>{L("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,i){return k(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.M(e);let u=Vo.open(this.db,e,s?"readonly":"readwrite",n),c=i(u).next(h=>(u.g(),h)).catch(h=>(u.abort(h),R.reject(h))).toPromise();return c.catch(()=>{}),yield u.m,c}catch(u){let c=u,h=c.name!=="FirebaseError"&&o<3;if(L("SimpleDb","Transaction failed with error:",c.message,"Retrying:",h),this.close(),!h)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function Ap(r){let e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var Zu=class{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Jn(this.B.delete())}},tr=class extends O{constructor(e,t){super(x.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Cn(r){return r.name==="IndexedDbTransactionError"}var ec=class{constructor(e){this.store=e}put(e,t){let n;return t!==void 0?(L("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(L("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Jn(n)}add(e){return L("SimpleDb","ADD",this.store.name,e,e),Jn(this.store.add(e))}get(e){return Jn(this.store.get(e)).next(t=>(t===void 0&&(t=null),L("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return L("SimpleDb","DELETE",this.store.name,e),Jn(this.store.delete(e))}count(){return L("SimpleDb","COUNT",this.store.name),Jn(this.store.count())}U(e,t){let n=this.options(e,t),i=n.index?this.store.index(n.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(n.range);return new R((o,u)=>{s.onerror=c=>{u(c.target.error)},s.onsuccess=c=>{o(c.target.result)}})}{let s=this.cursor(n),o=[];return this.W(s,(u,c)=>{o.push(c)}).next(()=>o)}}G(e,t){let n=this.store.getAll(e,t===null?void 0:t);return new R((i,s)=>{n.onerror=o=>{s(o.target.error)},n.onsuccess=o=>{i(o.target.result)}})}j(e,t){L("SimpleDb","DELETE ALL",this.store.name);let n=this.options(e,t);n.H=!1;let i=this.cursor(n);return this.W(i,(s,o,u)=>u.delete())}J(e,t){let n;t?n=e:(n={},t=e);let i=this.cursor(n);return this.W(i,t)}Y(e){let t=this.cursor({});return new R((n,i)=>{t.onerror=s=>{let o=$l(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(u=>{u?o.continue():n()}):n()}})}W(e,t){let n=[];return new R((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let u=o.target.result;if(!u)return void i();let c=new Zu(u),h=t(u.primaryKey,u.value,c);if(h instanceof R){let f=h.catch(m=>(c.done(),R.reject(m)));n.push(f)}c.isDone?i():c.K===null?u.continue():u.continue(c.K)}}).next(()=>R.waitFor(n))}options(e,t){let n;return e!==void 0&&(typeof e=="string"?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function Jn(r){return new R((e,t)=>{r.onsuccess=n=>{let i=n.target.result;e(i)},r.onerror=n=>{let i=$l(n.target.error);t(i)}})}var gf=!1;function $l(r){let e=wn.S(Li());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(t)>=0){let n=new O("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return gf||(gf=!0,setTimeout(()=>{throw n},0)),n}}return r}var tc=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){L("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>k(this,null,function*(){this.task=null;try{L("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){Cn(t)?L("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield Rn(t)}yield this.X(6e4)}))}},nc=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return k(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let n=new Set,i=t,s=!0;return R.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!n.has(o))return L("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,i).next(u=>{i-=u,n.add(o)});s=!1})).next(()=>t-i)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,n).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(i,s)).next(u=>(L("IndexBackfiller",`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(e,t,u))).next(()=>o.size)}))}re(e,t){let n=e;return t.changes.forEach((i,s)=>{let o=Ip(s);Kl(o,n)>0&&(n=o)}),new pt(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}};var lt=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=i=>this.ie(i),this.se=i=>n.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return r.oe=-1,r})();function Is(r){return r==null}function ns(r){return r===0&&1/r==-1/0}function Sp(r){return typeof r=="number"&&Number.isInteger(r)&&!ns(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function it(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=_f(e)),e=uy(r.get(t),e);return _f(e)}function uy(r,e){let t=e,n=r.length;for(let i=0;i<n;i++){let s=r.charAt(i);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function _f(r){return r+""}function bt(r){let e=r.length;if(H(e>=2),e===2)return H(r.charAt(0)===""&&r.charAt(1)===""),he.emptyPath();let t=e-2,n=[],i="";for(let s=0;s<e;){let o=r.indexOf("",s);switch((o<0||o>t)&&$(),r.charAt(o+1)){case"":let u=r.substring(s,o),c;i.length===0?c=u:(i+=u,c=i,i=""),n.push(c);break;case"":i+=r.substring(s,o),i+="\0";break;case"":i+=r.substring(s,o+1);break;default:$()}s=o+2}return new he(n)}var yf=["userId","batchId"];function Ao(r,e){return[r,it(e)]}function bp(r,e,t){return[r,it(e),t]}var cy={},ly=["prefixPath","collectionGroup","readTime","documentId"],hy=["prefixPath","collectionGroup","documentId"],dy=["collectionGroup","readTime","prefixPath","documentId"],fy=["canonicalId","targetId"],py=["targetId","path"],my=["path","targetId"],gy=["collectionId","parent"],_y=["indexId","uid"],yy=["uid","sequenceNumber"],wy=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],vy=["indexId","uid","orderedDocumentKey"],Ty=["userId","collectionPath","documentId"],Iy=["userId","collectionPath","largestBatchId"],Ey=["userId","collectionGroup","largestBatchId"],Pp=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Ay=[...Pp,"documentOverlays"],Rp=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Cp=Rp,Ql=[...Cp,"indexConfiguration","indexState","indexEntries"],Sy=Ql,by=[...Ql,"globals"];var rs=class extends Do{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function Be(r,e){let t=j(r);return wn.F(t._e,e)}function wf(r){let e=0;for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function fr(r,e){for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function xp(r){for(let e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}var Ee=class r{constructor(e,t){this.comparator=e,this.root=t||Rt.EMPTY}insert(e,t){return new r(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Rt.BLACK,null,null))}remove(e){return new r(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Rt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(e,n.key);if(i===0)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ur(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ur(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ur(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ur(this.root,e,this.comparator,!0)}},Ur=class{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Rt=class r{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=n??r.RED,this.left=i??r.EMPTY,this.right=s??r.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new r(e??this.key,t??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return r.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return r.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw $();let e=this.left.check();if(e!==this.right.check())throw $();return e+(this.isRed()?0:1)}};Rt.EMPTY=null,Rt.RED=!0,Rt.BLACK=!1;Rt.EMPTY=new class{constructor(){this.size=0}get key(){throw $()}get value(){throw $()}get color(){throw $()}get left(){throw $()}get right(){throw $()}copy(e,t,n,i,s){return this}insert(e,t,n){return new Rt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var we=class r{constructor(e){this.comparator=e,this.data=new Ee(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new No(this.data.getIterator())}getIteratorFrom(e){return new No(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof r)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=n.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new r(this.comparator);return t.data=e,t}},No=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function xr(r){return r.hasNext()?r.getNext():void 0}var ht=class r{constructor(e){this.fields=e,e.sort(Ve.comparator)}static empty(){return new r([])}unionWith(e){let t=new we(Ve.comparator);for(let n of this.fields)t=t.add(n);for(let n of e)t=t.add(n);return new r(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return zr(this.fields,e.fields,(t,n)=>t.isEqual(n))}};var Mo=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function kp(){return typeof atob<"u"}var Me=class r{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Mo("Invalid base64 string: "+s):s}}(e);return new r(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new r(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return re(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Me.EMPTY_BYTE_STRING=new Me("");var Py=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function $t(r){if(H(!!r),typeof r=="string"){let e=0,t=Py.exec(r);if(H(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:Ae(r.seconds),nanos:Ae(r.nanos)}}function Ae(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function vn(r){return typeof r=="string"?Me.fromBase64String(r):Me.fromUint8Array(r)}function ba(r){var e,t;return((t=(((e=r?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Wl(r){let e=r.mapValue.fields.__previous_value__;return ba(e)?Wl(e):e}function is(r){let e=$t(r.mapValue.fields.__local_write_time__.timestampValue);return new Pe(e.seconds,e.nanos)}var rc=class{constructor(e,t,n,i,s,o,u,c,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=h}},Tn=class r{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new r("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof r&&e.projectId===this.projectId&&e.database===this.database}};var gn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},So={nullValue:"NULL_VALUE"};function nr(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?ba(r)?4:Dp(r)?9007199254740991:Pa(r)?10:11:$()}function kt(r,e){if(r===e)return!0;let t=nr(r);if(t!==nr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return is(r).isEqual(is(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=$t(i.timestampValue),u=$t(s.timestampValue);return o.seconds===u.seconds&&o.nanos===u.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return function(i,s){return vn(i.bytesValue).isEqual(vn(s.bytesValue))}(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,s){return Ae(i.geoPointValue.latitude)===Ae(s.geoPointValue.latitude)&&Ae(i.geoPointValue.longitude)===Ae(s.geoPointValue.longitude)}(r,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return Ae(i.integerValue)===Ae(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=Ae(i.doubleValue),u=Ae(s.doubleValue);return o===u?ns(o)===ns(u):isNaN(o)&&isNaN(u)}return!1}(r,e);case 9:return zr(r.arrayValue.values||[],e.arrayValue.values||[],kt);case 10:case 11:return function(i,s){let o=i.mapValue.fields||{},u=s.mapValue.fields||{};if(wf(o)!==wf(u))return!1;for(let c in o)if(o.hasOwnProperty(c)&&(u[c]===void 0||!kt(o[c],u[c])))return!1;return!0}(r,e);default:return $()}}function ss(r,e){return(r.values||[]).find(t=>kt(t,e))!==void 0}function In(r,e){if(r===e)return 0;let t=nr(r),n=nr(e);if(t!==n)return re(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return re(r.booleanValue,e.booleanValue);case 2:return function(s,o){let u=Ae(s.integerValue||s.doubleValue),c=Ae(o.integerValue||o.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1}(r,e);case 3:return vf(r.timestampValue,e.timestampValue);case 4:return vf(is(r),is(e));case 5:return re(r.stringValue,e.stringValue);case 6:return function(s,o){let u=vn(s),c=vn(o);return u.compareTo(c)}(r.bytesValue,e.bytesValue);case 7:return function(s,o){let u=s.split("/"),c=o.split("/");for(let h=0;h<u.length&&h<c.length;h++){let f=re(u[h],c[h]);if(f!==0)return f}return re(u.length,c.length)}(r.referenceValue,e.referenceValue);case 8:return function(s,o){let u=re(Ae(s.latitude),Ae(o.latitude));return u!==0?u:re(Ae(s.longitude),Ae(o.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return Tf(r.arrayValue,e.arrayValue);case 10:return function(s,o){var u,c,h,f;let m=s.fields||{},_=o.fields||{},v=(u=m.value)===null||u===void 0?void 0:u.arrayValue,D=(c=_.value)===null||c===void 0?void 0:c.arrayValue,M=re(((h=v?.values)===null||h===void 0?void 0:h.length)||0,((f=D?.values)===null||f===void 0?void 0:f.length)||0);return M!==0?M:Tf(v,D)}(r.mapValue,e.mapValue);case 11:return function(s,o){if(s===gn.mapValue&&o===gn.mapValue)return 0;if(s===gn.mapValue)return 1;if(o===gn.mapValue)return-1;let u=s.fields||{},c=Object.keys(u),h=o.fields||{},f=Object.keys(h);c.sort(),f.sort();for(let m=0;m<c.length&&m<f.length;++m){let _=re(c[m],f[m]);if(_!==0)return _;let v=In(u[c[m]],h[f[m]]);if(v!==0)return v}return re(c.length,f.length)}(r.mapValue,e.mapValue);default:throw $()}}function vf(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return re(r,e);let t=$t(r),n=$t(e),i=re(t.seconds,n.seconds);return i!==0?i:re(t.nanos,n.nanos)}function Tf(r,e){let t=r.values||[],n=e.values||[];for(let i=0;i<t.length&&i<n.length;++i){let s=In(t[i],n[i]);if(s)return s}return re(t.length,n.length)}function Kr(r){return ic(r)}function ic(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){let n=$t(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(t){return vn(t).toBase64()}(r.bytesValue):"referenceValue"in r?function(t){return z.fromName(t).toString()}(r.referenceValue):"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(let s of t.values||[])i?i=!1:n+=",",n+=ic(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){let n=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of n)s?s=!1:i+=",",i+=`${o}:${ic(t.fields[o])}`;return i+"}"}(r.mapValue):$()}function rr(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function sc(r){return!!r&&"integerValue"in r}function os(r){return!!r&&"arrayValue"in r}function If(r){return!!r&&"nullValue"in r}function Ef(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function bo(r){return!!r&&"mapValue"in r}function Pa(r){var e,t;return((t=(((e=r?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Ji(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){let e={mapValue:{fields:{}}};return fr(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=Ji(n)),e}if(r.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ji(r.arrayValue.values[t]);return e}return Object.assign({},r)}function Dp(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var Vp={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function Ry(r){return"nullValue"in r?So:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?rr(Tn.empty(),z.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?Pa(r)?Vp:{mapValue:{}}:$()}function Cy(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?rr(Tn.empty(),z.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?Vp:"mapValue"in r?Pa(r)?{mapValue:{}}:gn:$()}function Af(r,e){let t=In(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?-1:!r.inclusive&&e.inclusive?1:0}function Sf(r,e){let t=In(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?1:!r.inclusive&&e.inclusive?-1:0}var Xe=class r{constructor(e){this.value=e}static empty(){return new r({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!bo(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ji(t)}setAll(e){let t=Ve.emptyPath(),n={},i=[];e.forEach((o,u)=>{if(!t.isImmediateParentOf(u)){let c=this.getFieldsMap(t);this.applyChanges(c,n,i),n={},i=[],t=u.popLast()}o?n[u.lastSegment()]=Ji(o):i.push(u.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){let t=this.field(e.popLast());bo(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return kt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];bo(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){fr(t,(i,s)=>e[i]=s);for(let i of n)delete e[i]}clone(){return new r(Ji(this.value))}};function Np(r){let e=[];return fr(r.fields,(t,n)=>{let i=new Ve([t]);if(bo(n)){let s=Np(n.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new ht(e)}var Ue=class r{constructor(e,t,n,i,s,o,u){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=o,this.documentState=u}static newInvalidDocument(e){return new r(e,0,X.min(),X.min(),X.min(),Xe.empty(),0)}static newFoundDocument(e,t,n,i){return new r(e,1,t,X.min(),n,i,0)}static newNoDocument(e,t){return new r(e,2,t,X.min(),X.min(),Xe.empty(),0)}static newUnknownDocument(e,t){return new r(e,3,t,X.min(),X.min(),Xe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(X.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Xe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Xe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=X.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof r&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Dt=class{constructor(e,t){this.position=e,this.inclusive=t}};function bf(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){let s=e[i],o=r.position[i];if(s.field.isKeyField()?n=z.comparator(z.fromName(o.referenceValue),t.key):n=In(o,t.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function Pf(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!kt(r.position[t],e.position[t]))return!1;return!0}var ir=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function xy(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}var Oo=class{},ce=class r extends Oo{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new uc(e,t,n):t==="array-contains"?new hc(e,n):t==="in"?new Fo(e,n):t==="not-in"?new dc(e,n):t==="array-contains-any"?new fc(e,n):new r(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new cc(e,n):new lc(e,n)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(In(t,this.value)):t!==null&&nr(this.value)===nr(t)&&this.matchesComparison(In(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return $()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ge=class r extends Oo{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new r(e,t)}matches(e){return $r(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function $r(r){return r.op==="and"}function oc(r){return r.op==="or"}function Hl(r){return Mp(r)&&$r(r)}function Mp(r){for(let e of r.filters)if(e instanceof ge)return!1;return!0}function ac(r){if(r instanceof ce)return r.field.canonicalString()+r.op.toString()+Kr(r.value);if(Hl(r))return r.filters.map(e=>ac(e)).join(",");{let e=r.filters.map(t=>ac(t)).join(",");return`${r.op}(${e})`}}function Op(r,e){return r instanceof ce?function(n,i){return i instanceof ce&&n.op===i.op&&n.field.isEqual(i.field)&&kt(n.value,i.value)}(r,e):r instanceof ge?function(n,i){return i instanceof ge&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce((s,o,u)=>s&&Op(o,i.filters[u]),!0):!1}(r,e):void $()}function Fp(r,e){let t=r.filters.concat(e);return ge.create(t,r.op)}function Lp(r){return r instanceof ce?function(t){return`${t.field.canonicalString()} ${t.op} ${Kr(t.value)}`}(r):r instanceof ge?function(t){return t.op.toString()+" {"+t.getFilters().map(Lp).join(" ,")+"}"}(r):"Filter"}var uc=class extends ce{constructor(e,t,n){super(e,t,n),this.key=z.fromName(n.referenceValue)}matches(e){let t=z.comparator(e.key,this.key);return this.matchesComparison(t)}},cc=class extends ce{constructor(e,t){super(e,"in",t),this.keys=Up("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},lc=class extends ce{constructor(e,t){super(e,"not-in",t),this.keys=Up("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function Up(r,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>z.fromName(n.referenceValue))}var hc=class extends ce{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return os(t)&&ss(t.arrayValue,this.value)}},Fo=class extends ce{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&ss(this.value.arrayValue,t)}},dc=class extends ce{constructor(e,t){super(e,"not-in",t)}matches(e){if(ss(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!ss(this.value.arrayValue,t)}},fc=class extends ce{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!os(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>ss(this.value.arrayValue,n))}};var pc=class{constructor(e,t=null,n=[],i=[],s=null,o=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=o,this.endAt=u,this.ue=null}};function mc(r,e=null,t=[],n=[],i=null,s=null,o=null){return new pc(r,e,t,n,i,s,o)}function sr(r){let e=j(r);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>ac(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(s){return s.field.canonicalString()+s.dir}(n)).join(","),Is(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>Kr(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>Kr(n)).join(",")),e.ue=t}return e.ue}function Es(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!xy(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!Op(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!Pf(r.startAt,e.startAt)&&Pf(r.endAt,e.endAt)}function Lo(r){return z.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function Uo(r,e){return r.filters.filter(t=>t instanceof ce&&t.field.isEqual(e))}function Rf(r,e,t){let n=So,i=!0;for(let s of Uo(r,e)){let o=So,u=!0;switch(s.op){case"<":case"<=":o=Ry(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,u=!1;break;case"!=":case"not-in":o=So}Af({value:n,inclusive:i},{value:o,inclusive:u})<0&&(n=o,i=u)}if(t!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){let o=t.position[s];Af({value:n,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(n=o,i=t.inclusive);break}}return{value:n,inclusive:i}}function Cf(r,e,t){let n=gn,i=!0;for(let s of Uo(r,e)){let o=gn,u=!0;switch(s.op){case">=":case">":o=Cy(s.value),u=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,u=!1;break;case"!=":case"not-in":o=gn}Sf({value:n,inclusive:i},{value:o,inclusive:u})>0&&(n=o,i=u)}if(t!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){let o=t.position[s];Sf({value:n,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(n=o,i=t.inclusive);break}}return{value:n,inclusive:i}}var vt=class{constructor(e,t=null,n=[],i=[],s=null,o="F",u=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=o,this.startAt=u,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function qp(r,e,t,n,i,s,o,u){return new vt(r,e,t,n,i,s,o,u)}function ai(r){return new vt(r)}function xf(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function Jl(r){return r.collectionGroup!==null}function Br(r){let e=j(r);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let u=new we(Ve.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(h=>{h.isInequality()&&(u=u.add(h.field))})}),u})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new ir(s,n))}),t.has(Ve.keyField().canonicalString())||e.ce.push(new ir(Ve.keyField(),n))}return e.ce}function st(r){let e=j(r);return e.le||(e.le=ky(e,Br(r))),e.le}function ky(r,e){if(r.limitType==="F")return mc(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new ir(i.field,s)});let t=r.endAt?new Dt(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Dt(r.startAt.position,r.startAt.inclusive):null;return mc(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}function gc(r,e){let t=r.filters.concat([e]);return new vt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function qo(r,e,t){return new vt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function As(r,e){return Es(st(r),st(e))&&r.limitType===e.limitType}function Bp(r){return`${sr(st(r))}|lt:${r.limitType}`}function Mr(r){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>Lp(i)).join(", ")}]`),Is(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>Kr(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>Kr(i)).join(",")),`Target(${n})`}(st(r))}; limitType=${r.limitType})`}function Ss(r,e){return e.isFoundDocument()&&function(n,i){let s=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):z.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,e)&&function(n,i){for(let s of Br(n))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(r,e)&&function(n,i){for(let s of n.filters)if(!s.matches(i))return!1;return!0}(r,e)&&function(n,i){return!(n.startAt&&!function(o,u,c){let h=bf(o,u,c);return o.inclusive?h<=0:h<0}(n.startAt,Br(n),i)||n.endAt&&!function(o,u,c){let h=bf(o,u,c);return o.inclusive?h>=0:h>0}(n.endAt,Br(n),i))}(r,e)}function jp(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function zp(r){return(e,t)=>{let n=!1;for(let i of Br(r)){let s=Dy(i,e,t);if(s!==0)return s;n=n||i.field.isKeyField()}return 0}}function Dy(r,e,t){let n=r.field.isKeyField()?z.comparator(e.key,t.key):function(s,o,u){let c=o.data.field(s),h=u.data.field(s);return c!==null&&h!==null?In(c,h):$()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return $()}}var Vt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(let[i,s]of n)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let n=this.mapKeyFn(e),i=this.inner[n];if(i===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return n.length===1?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){fr(this.inner,(t,n)=>{for(let[i,s]of n)e(i,s)})}isEmpty(){return xp(this.inner)}size(){return this.innerSize}};var Vy=new Ee(z.comparator);function ut(){return Vy}var Gp=new Ee(z.comparator);function Wi(...r){let e=Gp;for(let t of r)e=e.insert(t.key,t);return e}function Kp(r){let e=Gp;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function Pt(){return Yi()}function $p(){return Yi()}function Yi(){return new Vt(r=>r.toString(),(r,e)=>r.isEqual(e))}var Ny=new Ee(z.comparator),My=new we(z.comparator);function ie(...r){let e=My;for(let t of r)e=e.add(t);return e}var Oy=new we(re);function Yl(){return Oy}function Xl(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ns(e)?"-0":e}}function Qp(r){return{integerValue:""+r}}function Wp(r,e){return Sp(e)?Qp(e):Xl(r,e)}var Qr=class{constructor(){this._=void 0}};function Fy(r,e,t){return r instanceof En?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&ba(s)&&(s=Wl(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):r instanceof Qt?Jp(r,e):r instanceof Wt?Yp(r,e):function(i,s){let o=Hp(i,s),u=kf(o)+kf(i.Pe);return sc(o)&&sc(i.Pe)?Qp(u):Xl(i.serializer,u)}(r,e)}function Ly(r,e,t){return r instanceof Qt?Jp(r,e):r instanceof Wt?Yp(r,e):t}function Hp(r,e){return r instanceof An?function(n){return sc(n)||function(s){return!!s&&"doubleValue"in s}(n)}(e)?e:{integerValue:0}:null}var En=class extends Qr{},Qt=class extends Qr{constructor(e){super(),this.elements=e}};function Jp(r,e){let t=Xp(e);for(let n of r.elements)t.some(i=>kt(i,n))||t.push(n);return{arrayValue:{values:t}}}var Wt=class extends Qr{constructor(e){super(),this.elements=e}};function Yp(r,e){let t=Xp(e);for(let n of r.elements)t=t.filter(i=>!kt(i,n));return{arrayValue:{values:t}}}var An=class extends Qr{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function kf(r){return Ae(r.integerValue||r.doubleValue)}function Xp(r){return os(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}var or=class{constructor(e,t){this.field=e,this.transform=t}};function Uy(r,e){return r.field.isEqual(e.field)&&function(n,i){return n instanceof Qt&&i instanceof Qt||n instanceof Wt&&i instanceof Wt?zr(n.elements,i.elements,kt):n instanceof An&&i instanceof An?kt(n.Pe,i.Pe):n instanceof En&&i instanceof En}(r.transform,e.transform)}var _c=class{constructor(e,t){this.version=e,this.transformResults=t}},xe=class r{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new r}static exists(e){return new r(void 0,e)}static updateTime(e){return new r(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Po(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}var Wr=class{};function Zp(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new bn(r.key,xe.none()):new Sn(r.key,r.data,xe.none());{let t=r.data,n=Xe.empty(),i=new we(Ve.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?n.delete(s):n.set(s,o),i=i.add(s)}return new Tt(r.key,n,new ht(i.toArray()),xe.none())}}function qy(r,e,t){r instanceof Sn?function(i,s,o){let u=i.value.clone(),c=Vf(i.fieldTransforms,s,o.transformResults);u.setAll(c),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(r,e,t):r instanceof Tt?function(i,s,o){if(!Po(i.precondition,s))return void s.convertToUnknownDocument(o.version);let u=Vf(i.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(em(i)),c.setAll(u),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(r,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Xi(r,e,t,n){return r instanceof Sn?function(s,o,u,c){if(!Po(s.precondition,o))return u;let h=s.value.clone(),f=Nf(s.fieldTransforms,c,o);return h.setAll(f),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null}(r,e,t,n):r instanceof Tt?function(s,o,u,c){if(!Po(s.precondition,o))return u;let h=Nf(s.fieldTransforms,c,o),f=o.data;return f.setAll(em(s)),f.setAll(h),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),u===null?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(m=>m.field))}(r,e,t,n):function(s,o,u){return Po(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):u}(r,e,t)}function By(r,e){let t=null;for(let n of r.fieldTransforms){let i=e.data.field(n.field),s=Hp(n.transform,i||null);s!=null&&(t===null&&(t=Xe.empty()),t.set(n.field,s))}return t||null}function Df(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&zr(n,i,(s,o)=>Uy(s,o))}(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}var Sn=class extends Wr{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Tt=class extends Wr{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function em(r){let e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let n=r.data.field(t);e.set(t,n)}}),e}function Vf(r,e,t){let n=new Map;H(r.length===t.length);for(let i=0;i<t.length;i++){let s=r[i],o=s.transform,u=e.data.field(s.field);n.set(s.field,Ly(o,u,t[i]))}return n}function Nf(r,e,t){let n=new Map;for(let i of r){let s=i.transform,o=t.data.field(i.field);n.set(i.field,Fy(s,o,e))}return n}var bn=class extends Wr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},as=class extends Wr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var us=class{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&qy(s,e,n[i])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=Xi(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=Xi(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=$p();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,u=this.applyToLocalView(o,s.mutatedFields);u=t.has(i.key)?null:u;let c=Zp(o,u);c!==null&&n.set(i.key,c),o.isValidDocument()||o.convertToNoDocument(X.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ie())}isEqual(e){return this.batchId===e.batchId&&zr(this.mutations,e.mutations,(t,n)=>Df(t,n))&&zr(this.baseMutations,e.baseMutations,(t,n)=>Df(t,n))}},yc=class r{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){H(e.mutations.length===n.length);let i=function(){return Ny}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,n[o].version);return new r(e,t,n,i)}};var cs=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var wc=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Oe,le;function tm(r){switch(r){default:return $();case x.CANCELLED:case x.UNKNOWN:case x.DEADLINE_EXCEEDED:case x.RESOURCE_EXHAUSTED:case x.INTERNAL:case x.UNAVAILABLE:case x.UNAUTHENTICATED:return!1;case x.INVALID_ARGUMENT:case x.NOT_FOUND:case x.ALREADY_EXISTS:case x.PERMISSION_DENIED:case x.FAILED_PRECONDITION:case x.ABORTED:case x.OUT_OF_RANGE:case x.UNIMPLEMENTED:case x.DATA_LOSS:return!0}}function nm(r){if(r===void 0)return De("GRPC error has no .code"),x.UNKNOWN;switch(r){case Oe.OK:return x.OK;case Oe.CANCELLED:return x.CANCELLED;case Oe.UNKNOWN:return x.UNKNOWN;case Oe.DEADLINE_EXCEEDED:return x.DEADLINE_EXCEEDED;case Oe.RESOURCE_EXHAUSTED:return x.RESOURCE_EXHAUSTED;case Oe.INTERNAL:return x.INTERNAL;case Oe.UNAVAILABLE:return x.UNAVAILABLE;case Oe.UNAUTHENTICATED:return x.UNAUTHENTICATED;case Oe.INVALID_ARGUMENT:return x.INVALID_ARGUMENT;case Oe.NOT_FOUND:return x.NOT_FOUND;case Oe.ALREADY_EXISTS:return x.ALREADY_EXISTS;case Oe.PERMISSION_DENIED:return x.PERMISSION_DENIED;case Oe.FAILED_PRECONDITION:return x.FAILED_PRECONDITION;case Oe.ABORTED:return x.ABORTED;case Oe.OUT_OF_RANGE:return x.OUT_OF_RANGE;case Oe.UNIMPLEMENTED:return x.UNIMPLEMENTED;case Oe.DATA_LOSS:return x.DATA_LOSS;default:return $()}}(le=Oe||(Oe={}))[le.OK=0]="OK",le[le.CANCELLED=1]="CANCELLED",le[le.UNKNOWN=2]="UNKNOWN",le[le.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",le[le.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",le[le.NOT_FOUND=5]="NOT_FOUND",le[le.ALREADY_EXISTS=6]="ALREADY_EXISTS",le[le.PERMISSION_DENIED=7]="PERMISSION_DENIED",le[le.UNAUTHENTICATED=16]="UNAUTHENTICATED",le[le.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",le[le.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",le[le.ABORTED=10]="ABORTED",le[le.OUT_OF_RANGE=11]="OUT_OF_RANGE",le[le.UNIMPLEMENTED=12]="UNIMPLEMENTED",le[le.INTERNAL=13]="INTERNAL",le[le.UNAVAILABLE=14]="UNAVAILABLE",le[le.DATA_LOSS=15]="DATA_LOSS";var Mf=null;function rm(){return new TextEncoder}var jy=new hn([4294967295,4294967295],0);function Of(r){let e=rm().encode(r),t=new Nu;return t.update(e),new Uint8Array(t.digest())}function Ff(r){let e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new hn([t,n],0),new hn([i,s],0)]}var vc=class r{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new er(`Invalid padding: ${t}`);if(n<0)throw new er(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new er(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new er(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=hn.fromNumber(this.Ie)}Ee(e,t,n){let i=e.add(t.multiply(hn.fromNumber(n)));return i.compare(jy)===1&&(i=new hn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=Of(e),[n,i]=Ff(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(n,i,s);if(!this.de(o))return!1}return!0}static create(e,t,n){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new r(s,i,t);return n.forEach(u=>o.insert(u)),o}insert(e){if(this.Ie===0)return;let t=Of(e),[n,i]=Ff(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(n,i,s);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}},er=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var ls=class r{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let i=new Map;return i.set(e,hs.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new r(X.min(),i,new Ee(re),ut(),ie())}},hs=class r{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new r(n,t,ie(),ie(),ie())}};var jr=class{constructor(e,t,n,i){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=i}},Bo=class{constructor(e,t){this.targetId=e,this.me=t}},jo=class{constructor(e,t,n=Me.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}},zo=class{constructor(){this.fe=0,this.ge=Uf(),this.pe=Me.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=ie(),t=ie(),n=ie();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:$()}}),new hs(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=Uf()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,H(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},Tc=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=ut(),this.qe=Lf(),this.Qe=new Ee(re)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:$()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,i)=>{this.ze(i)&&t(i)})}He(e){let t=e.targetId,n=e.me.count,i=this.Je(t);if(i){let s=i.target;if(Lo(s))if(n===0){let o=new z(s.path);this.Ue(t,o,Ue.newNoDocument(o,X.min()))}else H(n===1);else{let o=this.Ye(t);if(o!==n){let u=this.Ze(e),c=u?this.Xe(u,e,o):1;if(c!==0){this.je(t);let h=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,h)}Mf?.et(function(f,m,_,v,D){var M,N,J,U,F,ee;let te={localCacheCount:f,existenceFilterCount:m.count,databaseId:_.database,projectId:_.projectId},ne=m.unchangedNames;return ne&&(te.bloomFilter={applied:D===0,hashCount:(M=ne?.hashCount)!==null&&M!==void 0?M:0,bitmapLength:(U=(J=(N=ne?.bits)===null||N===void 0?void 0:N.bitmap)===null||J===void 0?void 0:J.length)!==null&&U!==void 0?U:0,padding:(ee=(F=ne?.bits)===null||F===void 0?void 0:F.padding)!==null&&ee!==void 0?ee:0,mightContain:T=>{var g;return(g=v?.mightContain(T))!==null&&g!==void 0&&g}}),te}(o,e.me,this.Le.tt(),u,c))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t,o,u;try{o=vn(n).toUint8Array()}catch(c){if(c instanceof Mo)return wt("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new vc(o,i,s)}catch(c){return wt(c instanceof er?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return u.Ie===0?null:u}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){let n=this.Le.getRemoteKeysForTarget(t),i=0;return n.forEach(s=>{let o=this.Le.tt(),u=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(u)||(this.Ue(t,s,null),i++)}),i}rt(e){let t=new Map;this.Be.forEach((s,o)=>{let u=this.Je(o);if(u){if(s.current&&Lo(u.target)){let c=new z(u.target.path);this.ke.get(c)!==null||this.it(o,c)||this.Ue(o,c,Ue.newNoDocument(c,e))}s.be&&(t.set(o,s.ve()),s.Ce())}});let n=ie();this.qe.forEach((s,o)=>{let u=!0;o.forEachWhile(c=>{let h=this.Je(c);return!h||h.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(n=n.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));let i=new ls(e,t,this.Qe,this.ke,n);return this.ke=ut(),this.qe=Lf(),this.Qe=new Ee(re),i}$e(e,t){if(!this.ze(e))return;let n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;let i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new zo,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new we(re),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||L("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new zo),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function Lf(){return new Ee(z.comparator)}function Uf(){return new Ee(z.comparator)}var zy={asc:"ASCENDING",desc:"DESCENDING"},Gy={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ky={and:"AND",or:"OR"},Ic=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Ec(r,e){return r.useProto3Json||Is(e)?e:{value:e}}function Hr(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function im(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function $y(r,e){return Hr(r,e.toTimestamp())}function Ne(r){return H(!!r),X.fromTimestamp(function(t){let n=$t(t);return new Pe(n.seconds,n.nanos)}(r))}function Zl(r,e){return Ac(r,e).canonicalString()}function Ac(r,e){let t=function(i){return new he(["projects",i.projectId,"databases",i.database])}(r).child("documents");return e===void 0?t:t.child(e)}function sm(r){let e=he.fromString(r);return H(mm(e)),e}function ds(r,e){return Zl(r.databaseId,e.path)}function Ct(r,e){let t=sm(e);if(t.get(1)!==r.databaseId.projectId)throw new O(x.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new O(x.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new z(um(t))}function om(r,e){return Zl(r.databaseId,e)}function am(r){let e=sm(r);return e.length===4?he.emptyPath():um(e)}function Sc(r){return new he(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function um(r){return H(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function qf(r,e,t){return{name:ds(r,e),fields:t.value.mapValue.fields}}function cm(r,e,t){let n=Ct(r,e.name),i=Ne(e.updateTime),s=e.createTime?Ne(e.createTime):X.min(),o=new Xe({mapValue:{fields:e.fields}}),u=Ue.newFoundDocument(n,i,s,o);return t&&u.setHasCommittedMutations(),t?u.setHasCommittedMutations():u}function Qy(r,e){return"found"in e?function(n,i){H(!!i.found),i.found.name,i.found.updateTime;let s=Ct(n,i.found.name),o=Ne(i.found.updateTime),u=i.found.createTime?Ne(i.found.createTime):X.min(),c=new Xe({mapValue:{fields:i.found.fields}});return Ue.newFoundDocument(s,o,u,c)}(r,e):"missing"in e?function(n,i){H(!!i.missing),H(!!i.readTime);let s=Ct(n,i.missing),o=Ne(i.readTime);return Ue.newNoDocument(s,o)}(r,e):$()}function Wy(r,e){let t;if("targetChange"in e){e.targetChange;let n=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:$()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(h,f){return h.useProto3Json?(H(f===void 0||typeof f=="string"),Me.fromBase64String(f||"")):(H(f===void 0||f instanceof Buffer||f instanceof Uint8Array),Me.fromUint8Array(f||new Uint8Array))}(r,e.targetChange.resumeToken),o=e.targetChange.cause,u=o&&function(h){let f=h.code===void 0?x.UNKNOWN:nm(h.code);return new O(f,h.message||"")}(o);t=new jo(n,i,s,u||null)}else if("documentChange"in e){e.documentChange;let n=e.documentChange;n.document,n.document.name,n.document.updateTime;let i=Ct(r,n.document.name),s=Ne(n.document.updateTime),o=n.document.createTime?Ne(n.document.createTime):X.min(),u=new Xe({mapValue:{fields:n.document.fields}}),c=Ue.newFoundDocument(i,s,o,u),h=n.targetIds||[],f=n.removedTargetIds||[];t=new jr(h,f,c.key,c)}else if("documentDelete"in e){e.documentDelete;let n=e.documentDelete;n.document;let i=Ct(r,n.document),s=n.readTime?Ne(n.readTime):X.min(),o=Ue.newNoDocument(i,s),u=n.removedTargetIds||[];t=new jr([],u,o.key,o)}else if("documentRemove"in e){e.documentRemove;let n=e.documentRemove;n.document;let i=Ct(r,n.document),s=n.removedTargetIds||[];t=new jr([],s,i,null)}else{if(!("filter"in e))return $();{e.filter;let n=e.filter;n.targetId;let{count:i=0,unchangedNames:s}=n,o=new wc(i,s),u=n.targetId;t=new Bo(u,o)}}return t}function fs(r,e){let t;if(e instanceof Sn)t={update:qf(r,e.key,e.value)};else if(e instanceof bn)t={delete:ds(r,e.key)};else if(e instanceof Tt)t={update:qf(r,e.key,e.data),updateMask:ew(e.fieldMask)};else{if(!(e instanceof as))return $();t={verify:ds(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(s,o){let u=o.transform;if(u instanceof En)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Qt)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Wt)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof An)return{fieldPath:o.field.canonicalString(),increment:u.Pe};throw $()}(0,n))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:$y(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:$()}(r,e.precondition)),t}function bc(r,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?xe.updateTime(Ne(s.updateTime)):s.exists!==void 0?xe.exists(s.exists):xe.none()}(e.currentDocument):xe.none(),n=e.updateTransforms?e.updateTransforms.map(i=>function(o,u){let c=null;if("setToServerValue"in u)H(u.setToServerValue==="REQUEST_TIME"),c=new En;else if("appendMissingElements"in u){let f=u.appendMissingElements.values||[];c=new Qt(f)}else if("removeAllFromArray"in u){let f=u.removeAllFromArray.values||[];c=new Wt(f)}else"increment"in u?c=new An(o,u.increment):$();let h=Ve.fromServerFormat(u.fieldPath);return new or(h,c)}(r,i)):[];if(e.update){e.update.name;let i=Ct(r,e.update.name),s=new Xe({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(c){let h=c.fieldPaths||[];return new ht(h.map(f=>Ve.fromServerFormat(f)))}(e.updateMask);return new Tt(i,s,o,t,n)}return new Sn(i,s,t,n)}if(e.delete){let i=Ct(r,e.delete);return new bn(i,t)}if(e.verify){let i=Ct(r,e.verify);return new as(i,t)}return $()}function Hy(r,e){return r&&r.length>0?(H(e!==void 0),r.map(t=>function(i,s){let o=i.updateTime?Ne(i.updateTime):Ne(s);return o.isEqual(X.min())&&(o=Ne(s)),new _c(o,i.transformResults||[])}(t,e))):[]}function lm(r,e){return{documents:[om(r,e.path)]}}function hm(r,e){let t={structuredQuery:{}},n=e.path,i;e.collectionGroup!==null?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=om(r,i);let s=function(h){if(h.length!==0)return pm(ge.create(h,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(h){if(h.length!==0)return h.map(f=>function(_){return{field:Or(_.field),direction:Yy(_.dir)}}(f))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let u=Ec(r,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{_t:t,parent:i}}function dm(r){let e=am(r.parent),t=r.structuredQuery,n=t.from?t.from.length:0,i=null;if(n>0){H(n===1);let f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=function(m){let _=fm(m);return _ instanceof ge&&Hl(_)?_.getFilters():[_]}(t.where));let o=[];t.orderBy&&(o=function(m){return m.map(_=>function(D){return new ir(Fr(D.field),function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(D.direction))}(_))}(t.orderBy));let u=null;t.limit&&(u=function(m){let _;return _=typeof m=="object"?m.value:m,Is(_)?null:_}(t.limit));let c=null;t.startAt&&(c=function(m){let _=!!m.before,v=m.values||[];return new Dt(v,_)}(t.startAt));let h=null;return t.endAt&&(h=function(m){let _=!m.before,v=m.values||[];return new Dt(v,_)}(t.endAt)),qp(e,i,o,s,u,"F",c,h)}function Jy(r,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return $()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function fm(r){return r.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let n=Fr(t.unaryFilter.field);return ce.create(n,"==",{doubleValue:NaN});case"IS_NULL":let i=Fr(t.unaryFilter.field);return ce.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Fr(t.unaryFilter.field);return ce.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=Fr(t.unaryFilter.field);return ce.create(o,"!=",{nullValue:"NULL_VALUE"});default:return $()}}(r):r.fieldFilter!==void 0?function(t){return ce.create(Fr(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return $()}}(t.fieldFilter.op),t.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(t){return ge.create(t.compositeFilter.filters.map(n=>fm(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return $()}}(t.compositeFilter.op))}(r):$()}function Yy(r){return zy[r]}function Xy(r){return Gy[r]}function Zy(r){return Ky[r]}function Or(r){return{fieldPath:r.canonicalString()}}function Fr(r){return Ve.fromServerFormat(r.fieldPath)}function pm(r){return r instanceof ce?function(t){if(t.op==="=="){if(Ef(t.value))return{unaryFilter:{field:Or(t.field),op:"IS_NAN"}};if(If(t.value))return{unaryFilter:{field:Or(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Ef(t.value))return{unaryFilter:{field:Or(t.field),op:"IS_NOT_NAN"}};if(If(t.value))return{unaryFilter:{field:Or(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Or(t.field),op:Xy(t.op),value:t.value}}}(r):r instanceof ge?function(t){let n=t.getFilters().map(i=>pm(i));return n.length===1?n[0]:{compositeFilter:{op:Zy(t.op),filters:n}}}(r):$()}function ew(r){let e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function mm(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}var Jr=class r{constructor(e,t,n,i,s=X.min(),o=X.min(),u=Me.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(e){return new r(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Go=class{constructor(e){this.ct=e}};function tw(r,e){let t;if(e.document)t=cm(r.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let n=z.fromSegments(e.noDocument.path),i=ur(e.noDocument.readTime);t=Ue.newNoDocument(n,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return $();{let n=z.fromSegments(e.unknownDocument.path),i=ur(e.unknownDocument.version);t=Ue.newUnknownDocument(n,i)}}return e.readTime&&t.setReadTime(function(i){let s=new Pe(i[0],i[1]);return X.fromTimestamp(s)}(e.readTime)),t}function Bf(r,e){let t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Ko(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document=function(s,o){return{name:ds(s,o.key),fields:o.data.value.mapValue.fields,updateTime:Hr(s,o.version.toTimestamp()),createTime:Hr(s,o.createTime.toTimestamp())}}(r.ct,e);else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:ar(e.version)};else{if(!e.isUnknownDocument())return $();n.unknownDocument={path:t.path.toArray(),version:ar(e.version)}}return n}function Ko(r){let e=r.toTimestamp();return[e.seconds,e.nanoseconds]}function ar(r){let e=r.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function ur(r){let e=new Pe(r.seconds,r.nanoseconds);return X.fromTimestamp(e)}function Yn(r,e){let t=(e.baseMutations||[]).map(s=>bc(r.ct,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let u=e.mutations[s+1];o.updateTransforms=u.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let n=e.mutations.map(s=>bc(r.ct,s)),i=Pe.fromMillis(e.localWriteTimeMs);return new us(e.batchId,i,t,n)}function Hi(r){let e=ur(r.readTime),t=r.lastLimboFreeSnapshotVersion!==void 0?ur(r.lastLimboFreeSnapshotVersion):X.min(),n;return n=function(s){return s.documents!==void 0}(r.query)?function(s){return H(s.documents.length===1),st(ai(am(s.documents[0])))}(r.query):function(s){return st(dm(s))}(r.query),new Jr(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,e,t,Me.fromBase64String(r.resumeToken))}function gm(r,e){let t=ar(e.snapshotVersion),n=ar(e.lastLimboFreeSnapshotVersion),i;i=Lo(e.target)?lm(r.ct,e.target):hm(r.ct,e.target)._t;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:sr(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function eh(r){let e=dm({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?qo(e,e.limit,"L"):e}function qu(r,e){return new cs(e.largestBatchId,bc(r.ct,e.overlayMutation))}function jf(r,e){let t=e.path.lastSegment();return[r,it(e.path.popLast()),t]}function zf(r,e,t,n){return{indexId:r,uid:e,sequenceNumber:t,readTime:ar(n.readTime),documentKey:it(n.documentKey.path),largestBatchId:n.largestBatchId}}var Pc=class{getBundleMetadata(e,t){return Gf(e).get(t).next(n=>{if(n)return function(s){return{id:s.bundleId,createTime:ur(s.createTime),version:s.version}}(n)})}saveBundleMetadata(e,t){return Gf(e).put(function(i){return{bundleId:i.id,createTime:ar(Ne(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return Kf(e).get(t).next(n=>{if(n)return function(s){return{name:s.name,query:eh(s.bundledQuery),readTime:ur(s.readTime)}}(n)})}saveNamedQuery(e,t){return Kf(e).put(function(i){return{name:i.name,readTime:ar(Ne(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};function Gf(r){return Be(r,"bundles")}function Kf(r){return Be(r,"namedQueries")}var $o=class r{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){let n=t.uid||"";return new r(e,n)}getOverlay(e,t){return Gi(e).get(jf(this.userId,t)).next(n=>n?qu(this.serializer,n):null)}getOverlays(e,t){let n=Pt();return R.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){let i=[];return n.forEach((s,o)=>{let u=new cs(t,o);i.push(this.ht(e,u))}),R.waitFor(i)}removeOverlaysForBatchId(e,t,n){let i=new Set;t.forEach(o=>i.add(it(o.getCollectionPath())));let s=[];return i.forEach(o=>{let u=IDBKeyRange.bound([this.userId,o,n],[this.userId,o,n+1],!1,!0);s.push(Gi(e).j("collectionPathOverlayIndex",u))}),R.waitFor(s)}getOverlaysForCollection(e,t,n){let i=Pt(),s=it(t),o=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Gi(e).U("collectionPathOverlayIndex",o).next(u=>{for(let c of u){let h=qu(this.serializer,c);i.set(h.getKey(),h)}return i})}getOverlaysForCollectionGroup(e,t,n,i){let s=Pt(),o,u=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Gi(e).J({index:"collectionGroupOverlayIndex",range:u},(c,h,f)=>{let m=qu(this.serializer,h);s.size()<i||m.largestBatchId===o?(s.set(m.getKey(),m),o=m.largestBatchId):f.done()}).next(()=>s)}ht(e,t){return Gi(e).put(function(i,s,o){let[u,c,h]=jf(s,o.mutation.key);return{userId:s,collectionPath:c,documentId:h,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:fs(i.ct,o.mutation)}}(this.serializer,this.userId,t))}};function Gi(r){return Be(r,"documentOverlays")}var Rc=class{Pt(e){return Be(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{let n=t?.value;return n?Me.fromUint8Array(n):Me.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}};var Gt=class{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(Ae(e.integerValue));else if("doubleValue"in e){let n=Ae(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),ns(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),typeof n=="string"&&(n=$t(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(vn(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?Dp(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Pa(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):$()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){let n=e.fields||{};this.dt(t,55);for(let i of Object.keys(n))this.Vt(i,t),this.Tt(n[i],t)}wt(e,t){var n,i;let s=e.fields||{};this.dt(t,53);let o="value",u=((i=(n=s[o].arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.length)||0;this.dt(t,15),t.At(Ae(u)),this.Vt(o,t),this.Tt(s[o],t)}bt(e,t){let n=e.values||[];this.dt(t,50);for(let i of n)this.Tt(i,t)}yt(e,t){this.dt(t,37),z.fromName(e).path.forEach(n=>{this.dt(t,60),this.Dt(n,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}};Gt.vt=new Gt;function nw(r){if(r===0)return 8;let e=0;return!(r>>4)&&(e+=4,r<<=4),!(r>>6)&&(e+=2,r<<=2),!(r>>7)&&(e+=1),e}function $f(r){let e=64-function(n){let i=0;for(let s=0;s<8;++s){let o=nw(255&n[s]);if(i+=o,o!==8)break}return i}(r);return Math.ceil(e/8)}var Cc=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ft(n.value),n=t.next();this.Mt()}xt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ot(n.value),n=t.next();this.Nt()}Lt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Ft(n);else if(n<2048)this.Ft(960|n>>>6),this.Ft(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|n>>>12),this.Ft(128|63&n>>>6),this.Ft(128|63&n);else{let i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Bt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Ot(n);else if(n<2048)this.Ot(960|n>>>6),this.Ot(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|n>>>12),this.Ot(128|63&n>>>6),this.Ot(128|63&n);else{let i=t.codePointAt(0);this.Ot(240|i>>>18),this.Ot(128|63&i>>>12),this.Ot(128|63&i>>>6),this.Ot(128|63&i)}}this.Nt()}kt(e){let t=this.qt(e),n=$f(t);this.Qt(1+n),this.buffer[this.position++]=255&n;for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Kt(e){let t=this.qt(e),n=$f(t);this.Qt(1+n),this.buffer[this.position++]=~(255&n);for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),n=(128&t[0])!=0;t[0]^=n?255:128;for(let i=1;i<t.length;++i)t[i]^=n?255:0;return t}Ft(e){let t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){let t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}},xc=class{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}},kc=class{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}},Xn=class{constructor(){this.jt=new Cc,this.Ht=new xc(this.jt),this.Jt=new kc(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}};var Zn=class r{constructor(e,t,n,i){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=i}Zt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new r(this.indexId,this.documentKey,this.arrayValue,n)}};function dn(r,e){let t=r.indexId-e.indexId;return t!==0?t:(t=Qf(r.arrayValue,e.arrayValue),t!==0?t:(t=Qf(r.directionalValue,e.directionalValue),t!==0?t:z.comparator(r.documentKey,e.documentKey)))}function Qf(r,e){for(let t=0;t<r.length&&t<e.length;++t){let n=r[t]-e[t];if(n!==0)return n}return r.length-e.length}var Qo=class{constructor(e){this.Xt=new we((t,n)=>Ve.comparator(t.field,n.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(let t of e.filters){let n=t;n.isInequality()?this.Xt=this.Xt.add(n):this.tn.push(n)}}get nn(){return this.Xt.size>1}rn(e){if(H(e.collectionGroup===this.collectionId),this.nn)return!1;let t=Xu(e);if(t!==void 0&&!this.sn(t))return!1;let n=Hn(e),i=new Set,s=0,o=0;for(;s<n.length&&this.sn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Xt.size>0){let u=this.Xt.getIterator().getNext();if(!i.has(u.field.canonicalString())){let c=n[s];if(!this.on(u,c)||!this._n(this.en[o++],c))return!1}++s}for(;s<n.length;++s){let u=n[s];if(o>=this.en.length||!this._n(this.en[o++],u))return!1}return!0}an(){if(this.nn)return null;let e=new we(Ve.comparator),t=[];for(let n of this.tn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")t.push(new qr(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new qr(n.field,0))}for(let n of this.en)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new qr(n.field,n.dir==="asc"?0:1)));return new Gr(Gr.UNKNOWN_ID,this.collectionId,t,ts.empty())}sn(e){for(let t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let n=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===n}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function _m(r){var e,t;if(H(r instanceof ce||r instanceof ge),r instanceof ce){if(r instanceof Fo){let i=((t=(e=r.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>ce.create(r.field,"==",s)))||[];return ge.create(i,"or")}return r}let n=r.filters.map(i=>_m(i));return ge.create(n,r.op)}function rw(r){if(r.getFilters().length===0)return[];let e=Nc(_m(r));return H(ym(e)),Dc(e)||Vc(e)?[e]:e.getFilters()}function Dc(r){return r instanceof ce}function Vc(r){return r instanceof ge&&Hl(r)}function ym(r){return Dc(r)||Vc(r)||function(t){if(t instanceof ge&&oc(t)){for(let n of t.getFilters())if(!Dc(n)&&!Vc(n))return!1;return!0}return!1}(r)}function Nc(r){if(H(r instanceof ce||r instanceof ge),r instanceof ce)return r;if(r.filters.length===1)return Nc(r.filters[0]);let e=r.filters.map(n=>Nc(n)),t=ge.create(e,r.op);return t=Wo(t),ym(t)?t:(H(t instanceof ge),H($r(t)),H(t.filters.length>1),t.filters.reduce((n,i)=>th(n,i)))}function th(r,e){let t;return H(r instanceof ce||r instanceof ge),H(e instanceof ce||e instanceof ge),t=r instanceof ce?e instanceof ce?function(i,s){return ge.create([i,s],"and")}(r,e):Wf(r,e):e instanceof ce?Wf(e,r):function(i,s){if(H(i.filters.length>0&&s.filters.length>0),$r(i)&&$r(s))return Fp(i,s.getFilters());let o=oc(i)?i:s,u=oc(i)?s:i,c=o.filters.map(h=>th(h,u));return ge.create(c,"or")}(r,e),Wo(t)}function Wf(r,e){if($r(e))return Fp(e,r.getFilters());{let t=e.filters.map(n=>th(r,n));return ge.create(t,"or")}}function Wo(r){if(H(r instanceof ce||r instanceof ge),r instanceof ce)return r;let e=r.getFilters();if(e.length===1)return Wo(e[0]);if(Mp(r))return r;let t=e.map(i=>Wo(i)),n=[];return t.forEach(i=>{i instanceof ce?n.push(i):i instanceof ge&&(i.op===r.op?n.push(...i.filters):n.push(i))}),n.length===1?n[0]:ge.create(n,r.op)}var Mc=class{constructor(){this.un=new ps}addToCollectionParentIndex(e,t){return this.un.add(t),R.resolve()}getCollectionParents(e,t){return R.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return R.resolve()}deleteFieldIndex(e,t){return R.resolve()}deleteAllFieldIndexes(e){return R.resolve()}createTargetIndexes(e,t){return R.resolve()}getDocumentsMatchingTarget(e,t){return R.resolve(null)}getIndexType(e,t){return R.resolve(0)}getFieldIndexes(e,t){return R.resolve([])}getNextCollectionGroupToUpdate(e){return R.resolve(null)}getMinOffset(e,t){return R.resolve(pt.min())}getMinOffsetFromCollectionGroup(e,t){return R.resolve(pt.min())}updateCollectionGroup(e,t,n){return R.resolve()}updateIndexEntries(e,t){return R.resolve()}},ps=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new we(he.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new we(he.comparator)).toArray()}};var vo=new Uint8Array(0),Oc=class{constructor(e,t){this.databaseId=t,this.cn=new ps,this.ln=new Vt(n=>sr(n),(n,i)=>Es(n,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){let n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});let s={collectionId:n,parent:it(i)};return Hf(e).put(s)}return R.resolve()}getCollectionParents(e,t){let n=[],i=IDBKeyRange.bound([t,""],[vp(t),""],!1,!0);return Hf(e).U(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;n.push(bt(o.parent))}return n})}addFieldIndex(e,t){let n=Ki(e),i=function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(t);delete i.indexId;let s=n.add(i);if(t.indexState){let o=Dr(e);return s.next(u=>{o.put(zf(u,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let n=Ki(e),i=Dr(e),s=kr(e);return n.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Ki(e),n=kr(e),i=Dr(e);return t.j().next(()=>n.j()).next(()=>i.j())}createTargetIndexes(e,t){return R.forEach(this.hn(t),n=>this.getIndexType(e,n).next(i=>{if(i===0||i===1){let s=new Qo(n).an();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let n=kr(e),i=!0,s=new Map;return R.forEach(this.hn(t),o=>this.Pn(e,o).next(u=>{i&&(i=!!u),s.set(o,u)})).next(()=>{if(i){let o=ie(),u=[];return R.forEach(s,(c,h)=>{L("IndexedDbIndexManager",`Using index ${function(F){return`id=${F.indexId}|cg=${F.collectionGroup}|f=${F.fields.map(ee=>`${ee.fieldPath}:${ee.kind}`).join(",")}`}(c)} to execute ${sr(t)}`);let f=function(F,ee){let te=Xu(ee);if(te===void 0)return null;for(let ne of Uo(F,te.fieldPath))switch(ne.op){case"array-contains-any":return ne.value.arrayValue.values||[];case"array-contains":return[ne.value]}return null}(h,c),m=function(F,ee){let te=new Map;for(let ne of Hn(ee))for(let T of Uo(F,ne.fieldPath))switch(T.op){case"==":case"in":te.set(ne.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return te.set(ne.fieldPath.canonicalString(),T.value),Array.from(te.values())}return null}(h,c),_=function(F,ee){let te=[],ne=!0;for(let T of Hn(ee)){let g=T.kind===0?Rf(F,T.fieldPath,F.startAt):Cf(F,T.fieldPath,F.startAt);te.push(g.value),ne&&(ne=g.inclusive)}return new Dt(te,ne)}(h,c),v=function(F,ee){let te=[],ne=!0;for(let T of Hn(ee)){let g=T.kind===0?Cf(F,T.fieldPath,F.endAt):Rf(F,T.fieldPath,F.endAt);te.push(g.value),ne&&(ne=g.inclusive)}return new Dt(te,ne)}(h,c),D=this.In(c,h,_),M=this.In(c,h,v),N=this.Tn(c,h,m),J=this.En(c.indexId,f,D,_.inclusive,M,v.inclusive,N);return R.forEach(J,U=>n.G(U,t.limit).next(F=>{F.forEach(ee=>{let te=z.fromSegments(ee.documentKey);o.has(te)||(o=o.add(te),u.push(te))})}))}).next(()=>u)}return R.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=rw(ge.create(e.filters,"and")).map(n=>mc(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,n,i,s,o,u){let c=(t!=null?t.length:1)*Math.max(n.length,s.length),h=c/(t!=null?t.length:1),f=[];for(let m=0;m<c;++m){let _=t?this.dn(t[m/h]):vo,v=this.An(e,_,n[m%h],i),D=this.Rn(e,_,s[m%h],o),M=u.map(N=>this.An(e,_,N,!0));f.push(...this.createRange(v,D,M))}return f}An(e,t,n,i){let s=new Zn(e,z.empty(),t,n);return i?s:s.Zt()}Rn(e,t,n,i){let s=new Zn(e,z.empty(),t,n);return i?s.Zt():s}Pn(e,t){let n=new Qo(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let u of s)n.rn(u)&&(!o||u.fields.length>o.fields.length)&&(o=u);return o})}getIndexType(e,t){let n=2,i=this.hn(t);return R.forEach(i,s=>this.Pn(e,s).next(o=>{o?n!==0&&o.fields.length<function(c){let h=new we(Ve.comparator),f=!1;for(let m of c.filters)for(let _ of m.getFlattenedFilters())_.field.isKeyField()||(_.op==="array-contains"||_.op==="array-contains-any"?f=!0:h=h.add(_.field));for(let m of c.orderBy)m.field.isKeyField()||(h=h.add(m.field));return h.size+(f?1:0)}(s)&&(n=1):n=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&n===2?1:n)}Vn(e,t){let n=new Xn;for(let i of Hn(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=n.Yt(i.kind);Gt.vt.It(s,o)}return n.zt()}dn(e){let t=new Xn;return Gt.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){let n=new Xn;return Gt.vt.It(rr(this.databaseId,t),n.Yt(function(s){let o=Hn(s);return o.length===0?0:o[o.length-1].kind}(e))),n.zt()}Tn(e,t,n){if(n===null)return[];let i=[];i.push(new Xn);let s=0;for(let o of Hn(e)){let u=n[s++];for(let c of i)if(this.fn(t,o.fieldPath)&&os(u))i=this.gn(i,o,u);else{let h=c.Yt(o.kind);Gt.vt.It(u,h)}}return this.pn(i)}In(e,t,n){return this.Tn(e,t,n.position)}pn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].zt();return t}gn(e,t,n){let i=[...e],s=[];for(let o of n.arrayValue.values||[])for(let u of i){let c=new Xn;c.seed(u.zt()),Gt.vt.It(o,c.Yt(t.kind)),s.push(c)}return s}fn(e,t){return!!e.filters.find(n=>n instanceof ce&&n.field.isEqual(t)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(e,t){let n=Ki(e),i=Dr(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(s=>{let o=[];return R.forEach(s,u=>i.get([u.indexId,this.uid]).next(c=>{o.push(function(f,m){let _=m?new ts(m.sequenceNumber,new pt(ur(m.readTime),new z(bt(m.documentKey)),m.largestBatchId)):ts.empty(),v=f.fields.map(([D,M])=>new qr(Ve.fromServerFormat(D),M));return new Gr(f.indexId,f.collectionGroup,v,_)}(u,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((n,i)=>{let s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:re(n.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){let i=Ki(e),s=Dr(e);return this.yn(e).next(o=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(u=>R.forEach(u,c=>s.put(zf(c.indexId,this.uid,o,n)))))}updateIndexEntries(e,t){let n=new Map;return R.forEach(t,(i,s)=>{let o=n.get(i.collectionGroup);return(o?R.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(u=>(n.set(i.collectionGroup,u),R.forEach(u,c=>this.wn(e,i,c).next(h=>{let f=this.Sn(s,c);return h.isEqual(f)?R.resolve():this.bn(e,s,c,h,f)}))))})}Dn(e,t,n,i){return kr(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.mn(n,t.key),documentKey:t.key.path.toArray()})}vn(e,t,n,i){return kr(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.mn(n,t.key),t.key.path.toArray()])}wn(e,t,n){let i=kr(e),s=new we(dn);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.mn(n,t)])},(o,u)=>{s=s.add(new Zn(n.indexId,t,u.arrayValue,u.directionalValue))}).next(()=>s)}Sn(e,t){let n=new we(dn),i=this.Vn(t,e);if(i==null)return n;let s=Xu(t);if(s!=null){let o=e.data.field(s.fieldPath);if(os(o))for(let u of o.arrayValue.values||[])n=n.add(new Zn(t.indexId,e.key,this.dn(u),i))}else n=n.add(new Zn(t.indexId,e.key,vo,i));return n}bn(e,t,n,i,s){L("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return function(c,h,f,m,_){let v=c.getIterator(),D=h.getIterator(),M=xr(v),N=xr(D);for(;M||N;){let J=!1,U=!1;if(M&&N){let F=f(M,N);F<0?U=!0:F>0&&(J=!0)}else M!=null?U=!0:J=!0;J?(m(N),N=xr(D)):U?(_(M),M=xr(v)):(M=xr(v),N=xr(D))}}(i,s,dn,u=>{o.push(this.Dn(e,t,n,u))},u=>{o.push(this.vn(e,t,n,u))}),R.waitFor(o)}yn(e){let t=1;return Dr(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((o,u)=>dn(o,u)).filter((o,u,c)=>!u||dn(o,c[u-1])!==0);let i=[];i.push(e);for(let o of n){let u=dn(o,e),c=dn(o,t);if(u===0)i[0]=e.Zt();else if(u>0&&c<0)i.push(o),i.push(o.Zt());else if(c>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.Cn(i[o],i[o+1]))return[];let u=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,vo,[]],c=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,vo,[]];s.push(IDBKeyRange.bound(u,c))}return s}Cn(e,t){return dn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Jf)}getMinOffset(e,t){return R.mapArray(this.hn(t),n=>this.Pn(e,n).next(i=>i||$())).next(Jf)}};function Hf(r){return Be(r,"collectionParents")}function kr(r){return Be(r,"indexEntries")}function Ki(r){return Be(r,"indexConfiguration")}function Dr(r){return Be(r,"indexState")}function Jf(r){H(r.length!==0);let e=r[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<r.length;n++){let i=r[n].indexState.offset;Kl(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new pt(e.readTime,e.documentKey,t)}var Yf={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},ft=class r{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new r(e,r.DEFAULT_COLLECTION_PERCENTILE,r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function wm(r,e,t){let n=r.store("mutations"),i=r.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId),u=0,c=n.J({range:o},(f,m,_)=>(u++,_.delete()));s.push(c.next(()=>{H(u===1)}));let h=[];for(let f of t.mutations){let m=bp(e,f.key.path,t.batchId);s.push(i.delete(m)),h.push(f.key)}return R.waitFor(s).next(()=>h)}function Ho(r){if(!r)return 0;let e;if(r.document)e=r.document;else if(r.unknownDocument)e=r.unknownDocument;else{if(!r.noDocument)throw $();e=r.noDocument}return JSON.stringify(e).length}ft.DEFAULT_COLLECTION_PERCENTILE=10,ft.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ft.DEFAULT=new ft(41943040,ft.DEFAULT_COLLECTION_PERCENTILE,ft.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ft.DISABLED=new ft(-1,0,0);var Jo=class r{constructor(e,t,n,i){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=i,this.Fn={}}static lt(e,t,n,i){H(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new r(s,t,n,i)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return fn(e).J({index:"userMutationsIndex",range:n},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,n,i){let s=Lr(e),o=fn(e);return o.add({}).next(u=>{H(typeof u=="number");let c=new us(u,t,n,i),h=function(v,D,M){let N=M.baseMutations.map(U=>fs(v.ct,U)),J=M.mutations.map(U=>fs(v.ct,U));return{userId:D,batchId:M.batchId,localWriteTimeMs:M.localWriteTime.toMillis(),baseMutations:N,mutations:J}}(this.serializer,this.userId,c),f=[],m=new we((_,v)=>re(_.canonicalString(),v.canonicalString()));for(let _ of i){let v=bp(this.userId,_.key.path,u);m=m.add(_.key.path.popLast()),f.push(o.put(h)),f.push(s.put(v,cy))}return m.forEach(_=>{f.push(this.indexManager.addToCollectionParentIndex(e,_))}),e.addOnCommittedListener(()=>{this.Fn[u]=c.keys()}),R.waitFor(f).next(()=>c)})}lookupMutationBatch(e,t){return fn(e).get(t).next(n=>n?(H(n.userId===this.userId),Yn(this.serializer,n)):null)}Mn(e,t){return this.Fn[t]?R.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){let i=n.keys();return this.Fn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]),s=null;return fn(e).J({index:"userMutationsIndex",range:i},(o,u,c)=>{u.userId===this.userId&&(H(u.batchId>=n),s=Yn(this.serializer,u)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return fn(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{n=s.batchId,o.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return fn(e).U("userMutationsIndex",t).next(n=>n.map(i=>Yn(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=Ao(this.userId,t.path),i=IDBKeyRange.lowerBound(n),s=[];return Lr(e).J({range:i},(o,u,c)=>{let[h,f,m]=o,_=bt(f);if(h===this.userId&&t.path.isEqual(_))return fn(e).get(m).next(v=>{if(!v)throw $();H(v.userId===this.userId),s.push(Yn(this.serializer,v))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new we(re),i=[];return t.forEach(s=>{let o=Ao(this.userId,s.path),u=IDBKeyRange.lowerBound(o),c=Lr(e).J({range:u},(h,f,m)=>{let[_,v,D]=h,M=bt(v);_===this.userId&&s.path.isEqual(M)?n=n.add(D):m.done()});i.push(c)}),R.waitFor(i).next(()=>this.xn(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,s=Ao(this.userId,n),o=IDBKeyRange.lowerBound(s),u=new we(re);return Lr(e).J({range:o},(c,h,f)=>{let[m,_,v]=c,D=bt(_);m===this.userId&&n.isPrefixOf(D)?D.length===i&&(u=u.add(v)):f.done()}).next(()=>this.xn(e,u))}xn(e,t){let n=[],i=[];return t.forEach(s=>{i.push(fn(e).get(s).next(o=>{if(o===null)throw $();H(o.userId===this.userId),n.push(Yn(this.serializer,o))}))}),R.waitFor(i).next(()=>n)}removeMutationBatch(e,t){return wm(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),R.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return R.resolve();let n=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return Lr(e).J({range:n},(s,o,u)=>{if(s[0]===this.userId){let c=bt(s[1]);i.push(c)}else u.done()}).next(()=>{H(i.length===0)})})}containsKey(e,t){return vm(e,this.userId,t)}Nn(e){return Tm(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function vm(r,e,t){let n=Ao(e,t.path),i=n[1],s=IDBKeyRange.lowerBound(n),o=!1;return Lr(r).J({range:s,H:!0},(u,c,h)=>{let[f,m,_]=u;f===e&&m===i&&(o=!0),h.done()}).next(()=>o)}function fn(r){return Be(r,"mutations")}function Lr(r){return Be(r,"documentMutations")}function Tm(r){return Be(r,"mutationQueues")}var Yr=class r{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new r(0)}static kn(){return new r(-1)}};var Fc=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{let n=new Yr(t.highestTargetId);return t.highestTargetId=n.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>X.fromTimestamp(new Pe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.qn(e).next(i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Qn(e,i)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(n=>(n.targetCount+=1,this.$n(t,n),this.Qn(e,n))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Vr(e).delete(t.targetId)).next(()=>this.qn(e)).next(n=>(H(n.targetCount>0),n.targetCount-=1,this.Qn(e,n)))}removeTargets(e,t,n){let i=0,s=[];return Vr(e).J((o,u)=>{let c=Hi(u);c.sequenceNumber<=t&&n.get(c.targetId)===null&&(i++,s.push(this.removeTargetData(e,c)))}).next(()=>R.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Vr(e).J((n,i)=>{let s=Hi(i);t(s)})}qn(e){return Xf(e).get("targetGlobalKey").next(t=>(H(t!==null),t))}Qn(e,t){return Xf(e).put("targetGlobalKey",t)}Kn(e,t){return Vr(e).put(gm(this.serializer,t))}$n(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){let n=sr(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),s=null;return Vr(e).J({range:i,index:"queryTargetsIndex"},(o,u,c)=>{let h=Hi(u);Es(t,h.target)&&(s=h,c.done())}).next(()=>s)}addMatchingKeys(e,t,n){let i=[],s=pn(e);return t.forEach(o=>{let u=it(o.path);i.push(s.put({targetId:n,path:u})),i.push(this.referenceDelegate.addReference(e,n,o))}),R.waitFor(i)}removeMatchingKeys(e,t,n){let i=pn(e);return R.forEach(t,s=>{let o=it(s.path);return R.waitFor([i.delete([n,o]),this.referenceDelegate.removeReference(e,n,s)])})}removeMatchingKeysForTargetId(e,t){let n=pn(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),i=pn(e),s=ie();return i.J({range:n,H:!0},(o,u,c)=>{let h=bt(o[1]),f=new z(h);s=s.add(f)}).next(()=>s)}containsKey(e,t){let n=it(t.path),i=IDBKeyRange.bound([n],[vp(n)],!1,!0),s=0;return pn(e).J({index:"documentTargetsIndex",H:!0,range:i},([o,u],c,h)=>{o!==0&&(s++,h.done())}).next(()=>s>0)}ot(e,t){return Vr(e).get(t).next(n=>n?Hi(n):null)}};function Vr(r){return Be(r,"targets")}function Xf(r){return Be(r,"targetGlobal")}function pn(r){return Be(r,"targetDocuments")}function Zf([r,e],[t,n]){let i=re(r,t);return i===0?re(e,n):i}var Lc=class{constructor(e){this.Un=e,this.buffer=new we(Zf),this.Wn=0}Gn(){return++this.Wn}zn(e){let t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{let n=this.buffer.last();Zf(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}},Uc=class{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){L("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>k(this,null,function*(){this.jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Cn(t)?L("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield Rn(t)}yield this.Hn(3e5)}))}},qc=class{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(t===0)return R.resolve(lt.oe);let n=new Lc(t);return this.Jn.forEachTarget(e,i=>n.zn(i.sequenceNumber)).next(()=>this.Jn.Zn(e,i=>n.zn(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(L("LruGarbageCollector","Garbage collection skipped; disabled"),R.resolve(Yf)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(L("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Yf):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let n,i,s,o,u,c,h,f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(L("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),i=this.params.maximumSequenceNumbersToCollect):i=m,o=Date.now(),this.nthSequenceNumber(e,i))).next(m=>(n=m,u=Date.now(),this.removeTargets(e,n,t))).next(m=>(s=m,c=Date.now(),this.removeOrphanedDocuments(e,n))).next(m=>(h=Date.now(),Nr()<=St.DEBUG&&L("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-f}ms
	Determined least recently used ${i} in `+(u-o)+`ms
	Removed ${s} targets in `+(c-u)+`ms
	Removed ${m} documents in `+(h-c)+`ms
Total Duration: ${h-f}ms`),R.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:m})))}};function iw(r,e){return new qc(r,e)}var Bc=class{constructor(e,t){this.db=e,this.garbageCollector=iw(this,t)}Yn(e){let t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}er(e){let t=0;return this.Zn(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(n,i)=>t(i))}addReference(e,t,n){return To(e,n)}removeReference(e,t,n){return To(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return To(e,t)}nr(e,t){return function(i,s){let o=!1;return Tm(i).Y(u=>vm(i,u,s).next(c=>(c&&(o=!0),R.resolve(!c)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.tr(e,(o,u)=>{if(u<=t){let c=this.nr(e,o).next(h=>{if(!h)return s++,n.getEntry(e,o).next(()=>(n.removeEntry(o,X.min()),pn(e).delete(function(m){return[0,it(m.path)]}(o))))});i.push(c)}}).next(()=>R.waitFor(i)).next(()=>n.apply(e)).next(()=>s)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return To(e,t)}tr(e,t){let n=pn(e),i,s=lt.oe;return n.J({index:"documentTargetsIndex"},([o,u],{path:c,sequenceNumber:h})=>{o===0?(s!==lt.oe&&t(new z(bt(i)),s),s=h,i=c):s=lt.oe}).next(()=>{s!==lt.oe&&t(new z(bt(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function To(r,e){return pn(r).put(function(n,i){return{targetId:0,path:it(n.path),sequenceNumber:i}}(e,r.currentSequenceNumber))}var Yo=class{constructor(){this.changes=new Vt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ue.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return n!==void 0?R.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var jc=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Wn(e).put(n)}removeEntry(e,t,n){return Wn(e).delete(function(s,o){let u=s.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Ko(o),u[u.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.rr(e,n)))}getEntry(e,t){let n=Ue.newInvalidDocument(t);return Wn(e).J({index:"documentKeyIndex",range:IDBKeyRange.only($i(t))},(i,s)=>{n=this.ir(t,s)}).next(()=>n)}sr(e,t){let n={size:0,document:Ue.newInvalidDocument(t)};return Wn(e).J({index:"documentKeyIndex",range:IDBKeyRange.only($i(t))},(i,s)=>{n={document:this.ir(t,s),size:Ho(s)}}).next(()=>n)}getEntries(e,t){let n=ut();return this._r(e,t,(i,s)=>{let o=this.ir(i,s);n=n.insert(i,o)}).next(()=>n)}ar(e,t){let n=ut(),i=new Ee(z.comparator);return this._r(e,t,(s,o)=>{let u=this.ir(s,o);n=n.insert(s,u),i=i.insert(s,Ho(o))}).next(()=>({documents:n,ur:i}))}_r(e,t,n){if(t.isEmpty())return R.resolve();let i=new we(np);t.forEach(c=>i=i.add(c));let s=IDBKeyRange.bound($i(i.first()),$i(i.last())),o=i.getIterator(),u=o.getNext();return Wn(e).J({index:"documentKeyIndex",range:s},(c,h,f)=>{let m=z.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;u&&np(u,m)<0;)n(u,null),u=o.getNext();u&&u.isEqual(m)&&(n(u,h),u=o.hasNext()?o.getNext():null),u?f.$($i(u)):f.done()}).next(()=>{for(;u;)n(u,null),u=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,n,i,s){let o=t.path,u=[o.popLast().toArray(),o.lastSegment(),Ko(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Wn(e).U(IDBKeyRange.bound(u,c,!0)).next(h=>{s?.incrementDocumentReadCount(h.length);let f=ut();for(let m of h){let _=this.ir(z.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);_.isFoundDocument()&&(Ss(t,_)||i.has(_.key))&&(f=f.insert(_.key,_))}return f})}getAllFromCollectionGroup(e,t,n,i){let s=ut(),o=tp(t,n),u=tp(t,pt.max());return Wn(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,u,!0)},(c,h,f)=>{let m=this.ir(z.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);s=s.insert(m.key,m),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(e){return new zc(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return ep(e).get("remoteDocumentGlobalKey").next(t=>(H(!!t),t))}rr(e,t){return ep(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){let n=tw(this.serializer,t);if(!(n.isNoDocument()&&n.version.isEqual(X.min())))return n}return Ue.newInvalidDocument(e)}};function Im(r){return new jc(r)}var zc=class extends Yo{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Vt(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(e){let t=[],n=0,i=new we((s,o)=>re(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let u=this.lr.get(s);if(t.push(this.cr.removeEntry(e,s,u.readTime)),o.isValidDocument()){let c=Bf(this.cr.serializer,o);i=i.add(s.path.popLast());let h=Ho(c);n+=h-u.size,t.push(this.cr.addEntry(e,s,c))}else if(n-=u.size,this.trackRemovals){let c=Bf(this.cr.serializer,o.convertToNoDocument(X.min()));t.push(this.cr.addEntry(e,s,c))}}),i.forEach(s=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.cr.updateMetadata(e,n)),R.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(n=>(this.lr.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:n,ur:i})=>(i.forEach((s,o)=>{this.lr.set(s,{size:o,readTime:n.get(s).readTime})}),n))}};function ep(r){return Be(r,"remoteDocumentGlobal")}function Wn(r){return Be(r,"remoteDocumentsV14")}function $i(r){let e=r.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function tp(r,e){let t=e.documentKey.path.toArray();return[r,Ko(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function np(r,e){let t=r.path.toArray(),n=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<n.length-2;++s)if(i=re(t[s],n[s]),i)return i;return i=re(t.length,n.length),i||(i=re(t[t.length-2],n[n.length-2]),i||re(t[t.length-1],n[n.length-1]))}var Gc=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Xo=class{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(n!==null&&Xi(n.mutation,i,ht.empty(),Pe.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,ie()).next(()=>n))}getLocalViewOfDocuments(e,t,n=ie()){let i=Pt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(s=>{let o=Wi();return s.forEach((u,c)=>{o=o.insert(u,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let n=Pt();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,ie()))}populateOverlays(e,t,n){let i=[];return n.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,u)=>{t.set(o,u)})})}computeViews(e,t,n,i){let s=ut(),o=Yi(),u=function(){return Yi()}();return t.forEach((c,h)=>{let f=n.get(h.key);i.has(h.key)&&(f===void 0||f.mutation instanceof Tt)?s=s.insert(h.key,h):f!==void 0?(o.set(h.key,f.mutation.getFieldMask()),Xi(f.mutation,h,f.mutation.getFieldMask(),Pe.now())):o.set(h.key,ht.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((h,f)=>o.set(h,f)),t.forEach((h,f)=>{var m;return u.set(h,new Gc(f,(m=o.get(h))!==null&&m!==void 0?m:null))}),u))}recalculateAndSaveOverlays(e,t){let n=Yi(),i=new Ee((o,u)=>o-u),s=ie();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let u of o)u.keys().forEach(c=>{let h=t.get(c);if(h===null)return;let f=n.get(c)||ht.empty();f=u.applyToLocalView(h,f),n.set(c,f);let m=(i.get(u.batchId)||ie()).add(c);i=i.insert(u.batchId,m)})}).next(()=>{let o=[],u=i.getReverseIterator();for(;u.hasNext();){let c=u.getNext(),h=c.key,f=c.value,m=$p();f.forEach(_=>{if(!s.has(_)){let v=Zp(t.get(_),n.get(_));v!==null&&m.set(_,v),s=s.add(_)}}),o.push(this.documentOverlayCache.saveOverlays(e,h,m))}return R.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return function(o){return z.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Jl(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):R.resolve(Pt()),u=-1,c=s;return o.next(h=>R.forEach(h,(f,m)=>(u<m.largestBatchId&&(u=m.largestBatchId),s.get(f)?R.resolve():this.remoteDocumentCache.getEntry(e,f).next(_=>{c=c.insert(f,_)}))).next(()=>this.populateOverlays(e,h,s)).next(()=>this.computeViews(e,c,h,ie())).next(f=>({batchId:u,changes:Kp(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new z(t)).next(n=>{let i=Wi();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){let s=t.collectionGroup,o=Wi();return this.indexManager.getCollectionParents(e,s).next(u=>R.forEach(u,c=>{let h=function(m,_){return new vt(_,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(t,c.child(s));return this.getDocumentsMatchingCollectionQuery(e,h,n,i).next(f=>{f.forEach((m,_)=>{o=o.insert(m,_)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(o=>{s.forEach((c,h)=>{let f=h.getKey();o.get(f)===null&&(o=o.insert(f,Ue.newInvalidDocument(f)))});let u=Wi();return o.forEach((c,h)=>{let f=s.get(c);f!==void 0&&Xi(f.mutation,h,ht.empty(),Pe.now()),Ss(t,h)&&(u=u.insert(c,h))}),u})}};var Kc=class{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return R.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:Ne(i.createTime)}}(t)),R.resolve()}getNamedQuery(e,t){return R.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(i){return{name:i.name,query:eh(i.bundledQuery),readTime:Ne(i.readTime)}}(t)),R.resolve()}};var $c=class{constructor(){this.overlays=new Ee(z.comparator),this.Ir=new Map}getOverlay(e,t){return R.resolve(this.overlays.get(t))}getOverlays(e,t){let n=Pt();return R.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,s)=>{this.ht(e,t,s)}),R.resolve()}removeOverlaysForBatchId(e,t,n){let i=this.Ir.get(n);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(n)),R.resolve()}getOverlaysForCollection(e,t,n){let i=Pt(),s=t.length+1,o=new z(t.child("")),u=this.overlays.getIteratorFrom(o);for(;u.hasNext();){let c=u.getNext().value,h=c.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&c.largestBatchId>n&&i.set(c.getKey(),c)}return R.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new Ee((h,f)=>h-f),o=this.overlays.getIterator();for(;o.hasNext();){let h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>n){let f=s.get(h.largestBatchId);f===null&&(f=Pt(),s=s.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}let u=Pt(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((h,f)=>u.set(h,f)),!(u.size()>=i)););return R.resolve(u)}ht(e,t,n){let i=this.overlays.get(n.key);if(i!==null){let o=this.Ir.get(i.largestBatchId).delete(n.key);this.Ir.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new cs(t,n));let s=this.Ir.get(t);s===void 0&&(s=ie(),this.Ir.set(t,s)),this.Ir.set(t,s.add(n.key))}};var Qc=class{constructor(){this.sessionToken=Me.EMPTY_BYTE_STRING}getSessionToken(e){return R.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,R.resolve()}};var ms=class{constructor(){this.Tr=new we(Fe.Er),this.dr=new we(Fe.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){let n=new Fe(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Vr(new Fe(e,t))}mr(e,t){e.forEach(n=>this.removeReference(n,t))}gr(e){let t=new z(new he([])),n=new Fe(t,e),i=new Fe(t,e+1),s=[];return this.dr.forEachInRange([n,i],o=>{this.Vr(o),s.push(o.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){let t=new z(new he([])),n=new Fe(t,e),i=new Fe(t,e+1),s=ie();return this.dr.forEachInRange([n,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new Fe(e,0),n=this.Tr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}},Fe=class{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return z.comparator(e.key,t.key)||re(e.wr,t.wr)}static Ar(e,t){return re(e.wr,t.wr)||z.comparator(e.key,t.key)}};var Wc=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new we(Fe.Er)}checkEmpty(e){return R.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,i){let s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new us(s,t,n,i);this.mutationQueue.push(o);for(let u of i)this.br=this.br.add(new Fe(u.key,s)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return R.resolve(o)}lookupMutationBatch(e,t){return R.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){let n=t+1,i=this.vr(n),s=i<0?0:i;return R.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return R.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return R.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new Fe(t,0),i=new Fe(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([n,i],o=>{let u=this.Dr(o.wr);s.push(u)}),R.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new we(re);return t.forEach(i=>{let s=new Fe(i,0),o=new Fe(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,o],u=>{n=n.add(u.wr)})}),R.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,s=n;z.isDocumentKey(s)||(s=s.child(""));let o=new Fe(new z(s),0),u=new we(re);return this.br.forEachWhile(c=>{let h=c.key.path;return!!n.isPrefixOf(h)&&(h.length===i&&(u=u.add(c.wr)),!0)},o),R.resolve(this.Cr(u))}Cr(e){let t=[];return e.forEach(n=>{let i=this.Dr(n);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){H(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let n=this.br;return R.forEach(t.mutations,i=>{let s=new Fe(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){let n=new Fe(t,0),i=this.br.firstAfterOrEqual(n);return R.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,R.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){let t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var Hc=class{constructor(e){this.Mr=e,this.docs=function(){return new Ee(z.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,i=this.docs.get(n),s=i?i.size:0,o=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return R.resolve(n?n.document.mutableCopy():Ue.newInvalidDocument(t))}getEntries(e,t){let n=ut();return t.forEach(i=>{let s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():Ue.newInvalidDocument(i))}),R.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=ut(),o=t.path,u=new z(o.child("")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){let{key:h,value:{document:f}}=c.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||Kl(Ip(f),n)<=0||(i.has(f.key)||Ss(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return R.resolve(s)}getAllFromCollectionGroup(e,t,n,i){$()}Or(e,t){return R.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new Jc(this)}getSize(e){return R.resolve(this.size)}},Jc=class extends Yo{constructor(e){super(),this.cr=e}applyChanges(e){let t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.cr.addEntry(e,i)):this.cr.removeEntry(n)}),R.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}};var Yc=class{constructor(e){this.persistence=e,this.Nr=new Vt(t=>sr(t),Es),this.lastRemoteSnapshotVersion=X.min(),this.highestTargetId=0,this.Lr=0,this.Br=new ms,this.targetCount=0,this.kr=Yr.Bn()}forEachTarget(e,t){return this.Nr.forEach((n,i)=>t(i)),R.resolve()}getLastRemoteSnapshotVersion(e){return R.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return R.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),R.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),R.resolve()}Kn(e){this.Nr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.kr=new Yr(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,R.resolve()}updateTargetData(e,t){return this.Kn(t),R.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,R.resolve()}removeTargets(e,t,n){let i=0,s=[];return this.Nr.forEach((o,u)=>{u.sequenceNumber<=t&&n.get(u.targetId)===null&&(this.Nr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),R.waitFor(s).next(()=>i)}getTargetCount(e){return R.resolve(this.targetCount)}getTargetData(e,t){let n=this.Nr.get(t)||null;return R.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),R.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),R.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),R.resolve()}getMatchingKeysForTargetId(e,t){let n=this.Br.yr(t);return R.resolve(n)}containsKey(e,t){return R.resolve(this.Br.containsKey(t))}};var Zo=class{constructor(e,t){this.qr={},this.overlays={},this.Qr=new lt(0),this.Kr=!1,this.Kr=!0,this.$r=new Qc,this.referenceDelegate=e(this),this.Ur=new Yc(this),this.indexManager=new Mc,this.remoteDocumentCache=function(i){return new Hc(i)}(n=>this.referenceDelegate.Wr(n)),this.serializer=new Go(t),this.Gr=new Kc(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new $c,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new Wc(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){L("MemoryPersistence","Starting transaction:",e);let i=new Xc(this.Qr.next());return this.referenceDelegate.zr(),n(i).next(s=>this.referenceDelegate.jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Hr(e,t){return R.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}},Xc=class extends Do{constructor(e){super(),this.currentSequenceNumber=e}},ea=class r{constructor(e){this.persistence=e,this.Jr=new ms,this.Yr=null}static Zr(e){return new r(e)}get Xr(){if(this.Yr)return this.Yr;throw $()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),R.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),R.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),R.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(i=>this.Xr.add(i.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Xr.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return R.forEach(this.Xr,n=>{let i=z.fromPath(n);return this.ei(e,i).next(s=>{s||t.removeEntry(i,X.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(n=>{n?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return R.or([()=>R.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}};var Zc=class{constructor(e){this.serializer=e}O(e,t,n,i){let s=new Vo("createOrUpgrade",t);n<1&&i>=1&&(function(c){c.createObjectStore("owner")}(e),function(c){c.createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",yf,{unique:!0}),c.createObjectStore("documentMutations")}(e),rp(e),function(c){c.createObjectStore("remoteDocuments")}(e));let o=R.resolve();return n<3&&i>=3&&(n!==0&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),rp(e)),o=o.next(()=>function(c){let h=c.store("targetGlobal"),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:X.min().toTimestamp(),targetCount:0};return h.put("targetGlobalKey",f)}(s))),n<4&&i>=4&&(n!==0&&(o=o.next(()=>function(c,h){return h.store("mutations").U().next(f=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",yf,{unique:!0});let m=h.store("mutations"),_=f.map(v=>m.put(v));return R.waitFor(_)})}(e,s))),o=o.next(()=>{(function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),n<5&&i>=5&&(o=o.next(()=>this.ni(s))),n<6&&i>=6&&(o=o.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.ri(s)))),n<7&&i>=7&&(o=o.next(()=>this.ii(s))),n<8&&i>=8&&(o=o.next(()=>this.si(e,s))),n<9&&i>=9&&(o=o.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),n<10&&i>=10&&(o=o.next(()=>this.oi(s))),n<11&&i>=11&&(o=o.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&i>=12&&(o=o.next(()=>{(function(c){let h=c.createObjectStore("documentOverlays",{keyPath:Ty});h.createIndex("collectionPathOverlayIndex",Iy,{unique:!1}),h.createIndex("collectionGroupOverlayIndex",Ey,{unique:!1})})(e)})),n<13&&i>=13&&(o=o.next(()=>function(c){let h=c.createObjectStore("remoteDocumentsV14",{keyPath:ly});h.createIndex("documentKeyIndex",hy),h.createIndex("collectionGroupIndex",dy)}(e)).next(()=>this._i(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&i>=14&&(o=o.next(()=>this.ai(e,s))),n<15&&i>=15&&(o=o.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:_y}).createIndex("sequenceNumberIndex",yy,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:wy}).createIndex("documentKeyIndex",vy,{unique:!1})}(e))),n<16&&i>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),n<17&&i>=17&&(o=o.next(()=>{(function(c){c.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((n,i)=>{t+=Ho(i)}).next(()=>{let n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}ni(e){let t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(i=>R.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",o).next(u=>R.forEach(u,c=>{H(c.userId===s.userId);let h=Yn(this.serializer,c);return wm(e,s.userId,h).next(()=>{})}))}))}ii(e){let t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return n.J((o,u)=>{let c=new he(o),h=function(m){return[0,it(m)]}(c);s.push(t.get(h).next(f=>f?R.resolve():(m=>t.put({targetId:0,path:it(m),sequenceNumber:i.highestListenSequenceNumber}))(c)))}).next(()=>R.waitFor(s))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:gy});let n=t.store("collectionParents"),i=new ps,s=o=>{if(i.add(o)){let u=o.lastSegment(),c=o.popLast();return n.put({collectionId:u,parent:it(c)})}};return t.store("remoteDocuments").J({H:!0},(o,u)=>{let c=new he(o);return s(c.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,u,c],h)=>{let f=bt(u);return s(f.popLast())}))}oi(e){let t=e.store("targets");return t.J((n,i)=>{let s=Hi(i),o=gm(this.serializer,s);return t.put(o)})}_i(e,t){let n=t.store("remoteDocuments"),i=[];return n.J((s,o)=>{let u=t.store("remoteDocumentsV14"),c=function(m){return m.document?new z(he.fromString(m.document.name).popFirst(5)):m.noDocument?z.fromSegments(m.noDocument.path):m.unknownDocument?z.fromSegments(m.unknownDocument.path):$()}(o).path.toArray(),h={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(u.put(h))}).next(()=>R.waitFor(i))}ai(e,t){let n=t.store("mutations"),i=Im(this.serializer),s=new Zo(ea.Zr,this.serializer.ct);return n.U().next(o=>{let u=new Map;return o.forEach(c=>{var h;let f=(h=u.get(c.userId))!==null&&h!==void 0?h:ie();Yn(this.serializer,c).keys().forEach(m=>f=f.add(m)),u.set(c.userId,f)}),R.forEach(u,(c,h)=>{let f=new Le(h),m=$o.lt(this.serializer,f),_=s.getIndexManager(f),v=Jo.lt(f,this.serializer,_,s.referenceDelegate);return new Xo(i,v,m,_).recalculateAndSaveOverlaysForDocumentKeys(new rs(t,lt.oe),c).next()})})}};function rp(r){r.createObjectStore("targetDocuments",{keyPath:py}).createIndex("documentTargetsIndex",my,{unique:!0}),r.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",fy,{unique:!0}),r.createObjectStore("targetGlobal")}var Bu="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",el=class r{constructor(e,t,n,i,s,o,u,c,h,f,m=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ui=s,this.window=o,this.document=u,this.ci=h,this.li=f,this.hi=m,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=_=>Promise.resolve(),!r.D())throw new O(x.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Bc(this,i),this.Ai=t+"main",this.serializer=new Go(c),this.Ri=new wn(this.Ai,this.hi,new Zc(this.serializer)),this.$r=new Rc,this.Ur=new Fc(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Im(this.serializer),this.Gr=new Pc,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,f===!1&&De("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new O(x.FAILED_PRECONDITION,Bu);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new lt(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=t=>k(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(t=>k(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(()=>k(this,null,function*(){this.started&&(yield this.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Io(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(Cn(e))return L("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return L("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Qi(e).get("owner").next(t=>R.resolve(this.vi(t)))}Ci(e){return Io(e).delete(this.clientId)}Fi(){return k(this,null,function*(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let n=Be(t,"clientMetadata");return n.U().next(i=>{let s=this.xi(i,18e5),o=i.filter(u=>s.indexOf(u)===-1);return R.forEach(o,u=>n.delete(u.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(let t of e)this.Vi.removeItem(this.Oi(t.clientId))}})}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?R.resolve(!0):Qi(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new O(x.FAILED_PRECONDITION,Bu);return!1}}return!(!this.networkEnabled||!this.inForeground)||Io(e).U().next(n=>this.xi(n,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,u=this.networkEnabled===i.networkEnabled;if(s||o&&u)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&L("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return k(this,null,function*(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),yield this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new rs(e,lt.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()})}xi(e,t){return e.filter(n=>this.Mi(n.updateTimeMs,t)&&!this.Ni(n.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Io(e).U().next(t=>this.xi(t,18e5).map(n=>n.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Jo.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Oc(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return $o.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,n){L("IndexedDbPersistence","Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(c){return c===17?by:c===16?Sy:c===15?Ql:c===14?Cp:c===13?Rp:c===12?Ay:c===11?Pp:void $()}(this.hi),o;return this.Ri.runTransaction(e,i,s,u=>(o=new rs(u,this.Qr?this.Qr.next():lt.oe),t==="readwrite-primary"?this.wi(o).next(c=>!!c||this.Si(o)).next(c=>{if(!c)throw De(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new O(x.FAILED_PRECONDITION,Ep);return n(o)}).next(c=>this.Di(o).next(()=>c)):this.Ki(o).next(()=>n(o)))).then(u=>(o.raiseOnCommittedEvent(),u))}Ki(e){return Qi(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new O(x.FAILED_PRECONDITION,Bu)})}Di(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Qi(e).put("owner",t)}static D(){return wn.D()}bi(e){let t=Qi(e);return t.get("owner").next(n=>this.vi(n)?(L("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):R.resolve())}Mi(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(De(`Detected an update time that is in the future: ${e} > ${n}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();let t=/(?:Version|Mobile)\/1[456]/;fu()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{let n=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return L("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return De("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){De("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function Qi(r){return Be(r,"owner")}function Io(r){return Be(r,"clientMetadata")}function nh(r,e){let t=r.projectId;return r.isDefaultDatabase||(t+="."+r.database),"firestore/"+e+"/"+t+"/"}var tl=class r{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=i}static Wi(e,t){let n=ie(),i=ie();for(let s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new r(e,t.fromCache,n,i)}};var nl=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var ta=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return fu()?8:Ap(Li())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,i){let s={result:null};return this.Yi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Zi(e,t,i,n).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new nl;return this.Xi(e,t,o).next(u=>{if(s.result=u,this.zi)return this.es(e,t,o,u.size)})}).next(()=>s.result)}es(e,t,n,i){return n.documentReadCount<this.ji?(Nr()<=St.DEBUG&&L("QueryEngine","SDK will not create cache indexes for query:",Mr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),R.resolve()):(Nr()<=St.DEBUG&&L("QueryEngine","Query:",Mr(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Hi*i?(Nr()<=St.DEBUG&&L("QueryEngine","The SDK decides to create cache indexes for query:",Mr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,st(t))):R.resolve())}Yi(e,t){if(xf(t))return R.resolve(null);let n=st(t);return this.indexManager.getIndexType(e,n).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=qo(t,null,"F"),n=st(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{let o=ie(...s);return this.Ji.getDocuments(e,o).next(u=>this.indexManager.getMinOffset(e,n).next(c=>{let h=this.ts(t,u);return this.ns(t,h,o,c.readTime)?this.Yi(e,qo(t,null,"F")):this.rs(e,h,t,c)}))})))}Zi(e,t,n,i){return xf(t)||i.isEqual(X.min())?R.resolve(null):this.Ji.getDocuments(e,n).next(s=>{let o=this.ts(t,s);return this.ns(t,o,n,i)?R.resolve(null):(Nr()<=St.DEBUG&&L("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Mr(t)),this.rs(e,o,t,Tp(i,-1)).next(u=>u))})}ts(e,t){let n=new we(zp(e));return t.forEach((i,s)=>{Ss(e,s)&&(n=n.add(s))}),n}ns(e,t,n,i){if(e.limit===null)return!1;if(n.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(e,t,n){return Nr()<=St.DEBUG&&L("QueryEngine","Using full collection scan to execute query:",Mr(t)),this.Ji.getDocumentsMatchingQuery(e,t,pt.min(),n)}rs(e,t,n,i){return this.Ji.getDocumentsMatchingQuery(e,n,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var rl=class{constructor(e,t,n,i){this.persistence=e,this.ss=t,this.serializer=i,this.os=new Ee(re),this._s=new Vt(s=>sr(s),Es),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Xo(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}};function Em(r,e,t,n){return new rl(r,e,t,n)}function Am(r,e){return k(this,null,function*(){let t=j(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,t.ls(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{let o=[],u=[],c=ie();for(let h of i){o.push(h.batchId);for(let f of h.mutations)c=c.add(f.key)}for(let h of s){u.push(h.batchId);for(let f of h.mutations)c=c.add(f.key)}return t.localDocuments.getDocuments(n,c).next(h=>({hs:h,removedBatchIds:o,addedBatchIds:u}))})})})}function sw(r,e){let t=j(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let i=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return function(u,c,h,f){let m=h.batch,_=m.keys(),v=R.resolve();return _.forEach(D=>{v=v.next(()=>f.getEntry(c,D)).next(M=>{let N=h.docVersions.get(D);H(N!==null),M.version.compareTo(N)<0&&(m.applyToRemoteDocument(M,h),M.isValidDocument()&&(M.setReadTime(h.commitVersion),f.addEntry(M)))})}),v.next(()=>u.mutationQueue.removeMutationBatch(c,m))}(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let c=ie();for(let h=0;h<u.mutationResults.length;++h)u.mutationResults[h].transformResults.length>0&&(c=c.add(u.batch.mutations[h].key));return c}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}function Sm(r){let e=j(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function ow(r,e){let t=j(r),n=e.snapshotVersion,i=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.cs.newChangeBuffer({trackRemovals:!0});i=t.os;let u=[];e.targetChanges.forEach((f,m)=>{let _=i.get(m);if(!_)return;u.push(t.Ur.removeMatchingKeys(s,f.removedDocuments,m).next(()=>t.Ur.addMatchingKeys(s,f.addedDocuments,m)));let v=_.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(m)!==null?v=v.withResumeToken(Me.EMPTY_BYTE_STRING,X.min()).withLastLimboFreeSnapshotVersion(X.min()):f.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(f.resumeToken,n)),i=i.insert(m,v),function(M,N,J){return M.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-M.snapshotVersion.toMicroseconds()>=3e8?!0:J.addedDocuments.size+J.modifiedDocuments.size+J.removedDocuments.size>0}(_,v,f)&&u.push(t.Ur.updateTargetData(s,v))});let c=ut(),h=ie();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))}),u.push(bm(s,o,e.documentUpdates).next(f=>{c=f.Ps,h=f.Is})),!n.isEqual(X.min())){let f=t.Ur.getLastRemoteSnapshotVersion(s).next(m=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,n));u.push(f)}return R.waitFor(u).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,h)).next(()=>c)}).then(s=>(t.os=i,s))}function bm(r,e,t){let n=ie(),i=ie();return t.forEach(s=>n=n.add(s)),e.getEntries(r,n).next(s=>{let o=ut();return t.forEach((u,c)=>{let h=s.get(u);c.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(u)),c.isNoDocument()&&c.version.isEqual(X.min())?(e.removeEntry(u,c.readTime),o=o.insert(u,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||c.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(c),o=o.insert(u,c)):L("LocalStore","Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version)}),{Ps:o,Is:i}})}function aw(r,e){let t=j(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function Xr(r,e){let t=j(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.Ur.getTargetData(n,e).next(s=>s?(i=s,R.resolve(i)):t.Ur.allocateTargetId(n).next(o=>(i=new Jr(e,o,"TargetPurposeListen",n.currentSequenceNumber),t.Ur.addTargetData(n,i).next(()=>i))))}).then(n=>{let i=t.os.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.os=t.os.insert(n.targetId,n),t._s.set(e,n.targetId)),n})}function Zr(r,e,t){return k(this,null,function*(){let n=j(r),i=n.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",s,o=>n.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!Cn(o))throw o;L("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}n.os=n.os.remove(e),n._s.delete(i.target)})}function na(r,e,t){let n=j(r),i=X.min(),s=ie();return n.persistence.runTransaction("Execute query","readwrite",o=>function(c,h,f){let m=j(c),_=m._s.get(f);return _!==void 0?R.resolve(m.os.get(_)):m.Ur.getTargetData(h,f)}(n,o,st(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(o,u.targetId).next(c=>{s=c})}).next(()=>n.ss.getDocumentsMatchingQuery(o,e,t?i:X.min(),t?s:ie())).next(u=>(Cm(n,jp(e),u),{documents:u,Ts:s})))}function Pm(r,e){let t=j(r),n=j(t.Ur),i=t.os.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>n.ot(s,e).next(o=>o?o.target:null))}function Rm(r,e){let t=j(r),n=t.us.get(e)||X.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.cs.getAllFromCollectionGroup(i,e,Tp(n,-1),Number.MAX_SAFE_INTEGER)).then(i=>(Cm(t,e,i),i))}function Cm(r,e,t){let n=r.us.get(e)||X.min();t.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.us.set(e,n)}function uw(r,e,t,n){return k(this,null,function*(){let i=j(r),s=ie(),o=ut();for(let h of t){let f=e.Es(h.metadata.name);h.document&&(s=s.add(f));let m=e.ds(h);m.setReadTime(e.As(h.metadata.readTime)),o=o.insert(f,m)}let u=i.cs.newChangeBuffer({trackRemovals:!0}),c=yield Xr(i,function(f){return st(ai(he.fromString(`__bundle__/docs/${f}`)))}(n));return i.persistence.runTransaction("Apply bundle documents","readwrite",h=>bm(h,u,o).next(f=>(u.apply(h),f)).next(f=>i.Ur.removeMatchingKeysForTargetId(h,c.targetId).next(()=>i.Ur.addMatchingKeys(h,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(h,f.Ps,f.Is)).next(()=>f.Ps)))})}function cw(n,i){return k(this,arguments,function*(r,e,t=ie()){let s=yield Xr(r,st(eh(e.bundledQuery))),o=j(r);return o.persistence.runTransaction("Save named query","readwrite",u=>{let c=Ne(e.readTime);if(s.snapshotVersion.compareTo(c)>=0)return o.Gr.saveNamedQuery(u,e);let h=s.withResumeToken(Me.EMPTY_BYTE_STRING,c);return o.os=o.os.insert(h.targetId,h),o.Ur.updateTargetData(u,h).next(()=>o.Ur.removeMatchingKeysForTargetId(u,s.targetId)).next(()=>o.Ur.addMatchingKeys(u,t,s.targetId)).next(()=>o.Gr.saveNamedQuery(u,e))})})}function ip(r,e){return`firestore_clients_${r}_${e}`}function sp(r,e,t){let n=`firestore_mutations_${r}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}function ju(r,e){return`firestore_targets_${r}_${e}`}var ra=class r{constructor(e,t,n,i){this.user=e,this.batchId=t,this.state=n,this.error=i}static Rs(e,t,n){let i=JSON.parse(n),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new O(i.error.code,i.error.message))),o?new r(e,t,i.state,s):(De("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Zi=class r{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Rs(e,t){let n=JSON.parse(t),i,s=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return s&&n.error&&(s=typeof n.error.message=="string"&&typeof n.error.code=="string",s&&(i=new O(n.error.code,n.error.message))),s?new r(e,n.state,i):(De("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},ia=class r{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){let n=JSON.parse(t),i=typeof n=="object"&&n.activeTargetIds instanceof Array,s=Yl();for(let o=0;i&&o<n.activeTargetIds.length;++o)i=Sp(n.activeTargetIds[o]),s=s.add(n.activeTargetIds[o]);return i?new r(e,s):(De("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},il=class r{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new r(t.clientId,t.onlineState):(De("SharedClientState",`Failed to parse online state: ${e}`),null)}},gs=class{constructor(){this.activeTargetIds=Yl()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},es=class{constructor(e,t,n,i,s){this.window=e,this.ui=t,this.persistenceKey=n,this.ps=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Ee(re),this.started=!1,this.bs=[];let o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ds=ip(this.persistenceKey,this.ps),this.vs=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new gs),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this.Os=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}start(){return k(this,null,function*(){let e=yield this.syncEngine.Qi();for(let n of e){if(n===this.ps)continue;let i=this.getItem(ip(this.persistenceKey,n));if(i){let s=ia.Rs(n,i);s&&(this.Ss=this.Ss.insert(s.clientId,s))}}this.Ns();let t=this.storage.getItem(this.xs);if(t){let n=this.Ls(t);n&&this.Bs(n)}for(let n of this.bs)this.ws(n);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((n,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,n){this.qs(e,t,n),this.Qs(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){let i=this.storage.getItem(ju(this.persistenceKey,e));if(i){let s=Zi.Rs(e,i);s&&(n=s.state)}}return t&&this.Ks.fs(e),this.Ns(),n}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(ju(this.persistenceKey,e))}updateQueryState(e,t,n){this.$s(e,t,n)}handleUserChange(e,t,n){t.forEach(i=>{this.Qs(i)}),this.currentUser=e,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return L("SharedClientState","READ",e,t),t}setItem(e,t){L("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){L("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){let t=e;if(t.storageArea===this.storage){if(L("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void De("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(()=>k(this,null,function*(){if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){let n=this.Gs(t.key);return this.zs(n,null)}{let n=this.js(t.key,t.newValue);if(n)return this.zs(n.clientId,n)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){let n=this.Hs(t.key,t.newValue);if(n)return this.Js(n)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){let n=this.Ys(t.key,t.newValue);if(n)return this.Zs(n)}}else if(t.key===this.xs){if(t.newValue!==null){let n=this.Ls(t.newValue);if(n)return this.Bs(n)}}else if(t.key===this.vs){let n=function(s){let o=lt.oe;if(s!=null)try{let u=JSON.parse(s);H(typeof u=="number"),o=u}catch(u){De("SharedClientState","Failed to read sequence number from WebStorage",u)}return o}(t.newValue);n!==lt.oe&&this.sequenceNumberHandler(n)}else if(t.key===this.Os){let n=this.Xs(t.newValue);yield Promise.all(n.map(i=>this.syncEngine.eo(i)))}}}else this.bs.push(t)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,n){let i=new ra(this.currentUser,e,t,n),s=sp(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Vs())}Qs(e){let t=sp(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){let t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,n){let i=ju(this.persistenceKey,e),s=new Zi(e,t,n);this.setItem(i,s.Vs())}Ws(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){let t=this.Cs.exec(e);return t?t[1]:null}js(e,t){let n=this.Gs(e);return ia.Rs(n,t)}Hs(e,t){let n=this.Fs.exec(e),i=Number(n[1]),s=n[2]!==void 0?n[2]:null;return ra.Rs(new Le(s),i,t)}Ys(e,t){let n=this.Ms.exec(e),i=Number(n[1]);return Zi.Rs(i,t)}Ls(e){return il.Rs(e)}Xs(e){return JSON.parse(e)}Js(e){return k(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);L("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){let n=t?this.Ss.insert(e,t):this.Ss.remove(e),i=this.ks(this.Ss),s=this.ks(n),o=[],u=[];return s.forEach(c=>{i.has(c)||o.push(c)}),i.forEach(c=>{s.has(c)||u.push(c)}),this.syncEngine.io(o,u).then(()=>{this.Ss=n})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Yl();return e.forEach((n,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},sa=class{constructor(){this.so=new gs,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new gs,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var sl=class{_o(e){}shutdown(){}};var oa=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){L("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ho)e(0)}lo(){L("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Eo=null;function zu(){return Eo===null?Eo=function(){return 268435456+Math.round(2147483648*Math.random())}():Eo++,"0x"+Eo.toString(16)}var lw={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var ol=class{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}};var Ye="WebChannelConnection",al=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let n=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo=`projects/${i}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Fo(){return!1}Mo(t,n,i,s,o){let u=zu(),c=this.xo(t,n.toUriEncodedString());L("RestConnection",`Sending RPC '${t}' ${u}:`,c,i);let h={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(h,s,o),this.No(t,c,h,i).then(f=>(L("RestConnection",`Received RPC '${t}' ${u}: `,f),f),f=>{throw wt("RestConnection",`RPC '${t}' ${u} failed with error: `,f,"url: ",c,"request:",i),f})}Lo(t,n,i,s,o,u){return this.Mo(t,n,i,s,o)}Oo(t,n,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+oi}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}xo(t,n){let i=lw[t];return`${this.Do}/v1/${n}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,i){let s=zu();return new Promise((o,u)=>{let c=new Mu;c.setWithCredentials(!0),c.listenOnce(Ou.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case zi.NO_ERROR:let f=c.getResponseJson();L(Ye,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(f)),o(f);break;case zi.TIMEOUT:L(Ye,`RPC '${e}' ${s} timed out`),u(new O(x.DEADLINE_EXCEEDED,"Request time out"));break;case zi.HTTP_ERROR:let m=c.getStatus();if(L(Ye,`RPC '${e}' ${s} failed with status:`,m,"response text:",c.getResponseText()),m>0){let _=c.getResponseJson();Array.isArray(_)&&(_=_[0]);let v=_?.error;if(v&&v.status&&v.message){let D=function(N){let J=N.toLowerCase().replace(/_/g,"-");return Object.values(x).indexOf(J)>=0?J:x.UNKNOWN}(v.status);u(new O(D,v.message))}else u(new O(x.UNKNOWN,"Server responded with status "+c.getStatus()))}else u(new O(x.UNAVAILABLE,"Connection failed."));break;default:$()}}finally{L(Ye,`RPC '${e}' ${s} completed.`)}});let h=JSON.stringify(i);L(Ye,`RPC '${e}' ${s} sending request:`,i),c.send(t,"POST",h,n,15)})}Bo(e,t,n){let i=zu(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Uu(),u=Lu(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(c.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Oo(c.initMessageHeaders,t,n),c.encodeInitMessageHeaders=!0;let f=s.join("");L(Ye,`Creating RPC '${e}' stream ${i}: ${f}`,c);let m=o.createWebChannel(f,c),_=!1,v=!1,D=new ol({Io:N=>{v?L(Ye,`Not sending because RPC '${e}' stream ${i} is closed:`,N):(_||(L(Ye,`Opening RPC '${e}' stream ${i} transport.`),m.open(),_=!0),L(Ye,`RPC '${e}' stream ${i} sending:`,N),m.send(N))},To:()=>m.close()}),M=(N,J,U)=>{N.listen(J,F=>{try{U(F)}catch(ee){setTimeout(()=>{throw ee},0)}})};return M(m,Cr.EventType.OPEN,()=>{v||(L(Ye,`RPC '${e}' stream ${i} transport opened.`),D.yo())}),M(m,Cr.EventType.CLOSE,()=>{v||(v=!0,L(Ye,`RPC '${e}' stream ${i} transport closed`),D.So())}),M(m,Cr.EventType.ERROR,N=>{v||(v=!0,wt(Ye,`RPC '${e}' stream ${i} transport errored:`,N),D.So(new O(x.UNAVAILABLE,"The operation could not be completed")))}),M(m,Cr.EventType.MESSAGE,N=>{var J;if(!v){let U=N.data[0];H(!!U);let F=U,ee=F.error||((J=F[0])===null||J===void 0?void 0:J.error);if(ee){L(Ye,`RPC '${e}' stream ${i} received error:`,ee);let te=ee.status,ne=function(w){let I=Oe[w];if(I!==void 0)return nm(I)}(te),T=ee.message;ne===void 0&&(ne=x.INTERNAL,T="Unknown error status: "+te+" with message "+ee.message),v=!0,D.So(new O(ne,T)),m.close()}else L(Ye,`RPC '${e}' stream ${i} received:`,U),D.bo(U)}}),M(u,Fu.STAT_EVENT,N=>{N.stat===wo.PROXY?L(Ye,`RPC '${e}' stream ${i} detected buffering proxy`):N.stat===wo.NOPROXY&&L(Ye,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{D.wo()},0),D}};function xm(){return typeof window<"u"?window:null}function Ro(){return typeof document<"u"?document:null}function bs(r){return new Ic(r,!0)}var _s=class{constructor(e,t,n=1e3,i=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();let t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),i=Math.max(0,t-n);i>0&&L("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var aa=class{constructor(e,t,n,i,s,o,u,c){this.ui=e,this.Ho=n,this.Jo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new _s(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return k(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){return k(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){return k(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===x.RESOURCE_EXHAUSTED?(De(t.toString()),De("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===x.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.mo(t)})}l_(){}auth(){this.state=1;let e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.Yo===t&&this.P_(n,i)},n=>{e(()=>{let i=new O(x.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(i)})})}P_(e,t){let n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{n(()=>this.I_(i))}),this.stream.onMessage(i=>{n(()=>++this.e_==1?this.E_(i):this.onNext(i))})}i_(){this.state=5,this.t_.Go(()=>k(this,null,function*(){this.state=0,this.start()}))}I_(e){return L("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(L("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},ul=class extends aa{constructor(e,t,n,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,o),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();let t=Wy(this.serializer,e),n=function(s){if(!("targetChange"in s))return X.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?X.min():o.readTime?Ne(o.readTime):X.min()}(e);return this.listener.d_(t,n)}A_(e){let t={};t.database=Sc(this.serializer),t.addTarget=function(s,o){let u,c=o.target;if(u=Lo(c)?{documents:lm(s,c)}:{query:hm(s,c)._t},u.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){u.resumeToken=im(s,o.resumeToken);let h=Ec(s,o.expectedCount);h!==null&&(u.expectedCount=h)}else if(o.snapshotVersion.compareTo(X.min())>0){u.readTime=Hr(s,o.snapshotVersion.toTimestamp());let h=Ec(s,o.expectedCount);h!==null&&(u.expectedCount=h)}return u}(this.serializer,e);let n=Jy(this.serializer,e);n&&(t.labels=n),this.a_(t)}R_(e){let t={};t.database=Sc(this.serializer),t.removeTarget=e,this.a_(t)}},cl=class extends aa{constructor(e,t,n,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,o),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return H(!!e.streamToken),this.lastStreamToken=e.streamToken,H(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){H(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();let t=Hy(e.writeResults,e.commitTime),n=Ne(e.commitTime);return this.listener.g_(n,t)}p_(){let e={};e.database=Sc(this.serializer),this.a_(e)}m_(e){let t={streamToken:this.lastStreamToken,writes:e.map(n=>fs(this.serializer,n))};this.a_(t)}};var ll=class extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new O(x.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Mo(e,Ac(t,n),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new O(x.UNKNOWN,s.toString())})}Lo(e,t,n,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,u])=>this.connection.Lo(e,Ac(t,n),i,o,u,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new O(x.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},hl=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(De(t),this.D_=!1):L("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var dl=class{constructor(e,t,n,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(o=>{n.enqueueAndForget(()=>k(this,null,function*(){xn(this)&&(L("RemoteStore","Restarting streams for network reachability change."),yield function(c){return k(this,null,function*(){let h=j(c);h.L_.add(4),yield ui(h),h.q_.set("Unknown"),h.L_.delete(4),yield Ps(h)})}(this))}))}),this.q_=new hl(n,i)}};function Ps(r){return k(this,null,function*(){if(xn(r))for(let e of r.B_)yield e(!0)})}function ui(r){return k(this,null,function*(){for(let e of r.B_)yield e(!1)})}function Ra(r,e){let t=j(r);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),sh(t)?ih(t):li(t).r_()&&rh(t,e))}function ei(r,e){let t=j(r),n=li(t);t.N_.delete(e),n.r_()&&km(t,e),t.N_.size===0&&(n.r_()?n.o_():xn(t)&&t.q_.set("Unknown"))}function rh(r,e){if(r.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(X.min())>0){let t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}li(r).A_(e)}function km(r,e){r.Q_.xe(e),li(r).R_(e)}function ih(r){r.Q_=new Tc({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.N_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),li(r).start(),r.q_.v_()}function sh(r){return xn(r)&&!li(r).n_()&&r.N_.size>0}function xn(r){return j(r).L_.size===0}function Dm(r){r.Q_=void 0}function hw(r){return k(this,null,function*(){r.q_.set("Online")})}function dw(r){return k(this,null,function*(){r.N_.forEach((e,t)=>{rh(r,e)})})}function fw(r,e){return k(this,null,function*(){Dm(r),sh(r)?(r.q_.M_(e),ih(r)):r.q_.set("Unknown")})}function pw(r,e,t){return k(this,null,function*(){if(r.q_.set("Online"),e instanceof jo&&e.state===2&&e.cause)try{yield function(i,s){return k(this,null,function*(){let o=s.cause;for(let u of s.targetIds)i.N_.has(u)&&(yield i.remoteSyncer.rejectListen(u,o),i.N_.delete(u),i.Q_.removeTarget(u))})}(r,e)}catch(n){L("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield ua(r,n)}else if(e instanceof jr?r.Q_.Ke(e):e instanceof Bo?r.Q_.He(e):r.Q_.We(e),!t.isEqual(X.min()))try{let n=yield Sm(r.localStore);t.compareTo(n)>=0&&(yield function(s,o){let u=s.Q_.rt(o);return u.targetChanges.forEach((c,h)=>{if(c.resumeToken.approximateByteSize()>0){let f=s.N_.get(h);f&&s.N_.set(h,f.withResumeToken(c.resumeToken,o))}}),u.targetMismatches.forEach((c,h)=>{let f=s.N_.get(c);if(!f)return;s.N_.set(c,f.withResumeToken(Me.EMPTY_BYTE_STRING,f.snapshotVersion)),km(s,c);let m=new Jr(f.target,c,h,f.sequenceNumber);rh(s,m)}),s.remoteSyncer.applyRemoteEvent(u)}(r,t))}catch(n){L("RemoteStore","Failed to raise snapshot:",n),yield ua(r,n)}})}function ua(r,e,t){return k(this,null,function*(){if(!Cn(e))throw e;r.L_.add(1),yield ui(r),r.q_.set("Offline"),t||(t=()=>Sm(r.localStore)),r.asyncQueue.enqueueRetryable(()=>k(this,null,function*(){L("RemoteStore","Retrying IndexedDB access"),yield t(),r.L_.delete(1),yield Ps(r)}))})}function Vm(r,e){return e().catch(t=>ua(r,t,e))}function ci(r){return k(this,null,function*(){let e=j(r),t=Pn(e),n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;mw(e);)try{let i=yield aw(e.localStore,n);if(i===null){e.O_.length===0&&t.o_();break}n=i.batchId,gw(e,i)}catch(i){yield ua(e,i)}Nm(e)&&Mm(e)})}function mw(r){return xn(r)&&r.O_.length<10}function gw(r,e){r.O_.push(e);let t=Pn(r);t.r_()&&t.V_&&t.m_(e.mutations)}function Nm(r){return xn(r)&&!Pn(r).n_()&&r.O_.length>0}function Mm(r){Pn(r).start()}function _w(r){return k(this,null,function*(){Pn(r).p_()})}function yw(r){return k(this,null,function*(){let e=Pn(r);for(let t of r.O_)e.m_(t.mutations)})}function ww(r,e,t){return k(this,null,function*(){let n=r.O_.shift(),i=yc.from(n,e,t);yield Vm(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield ci(r)})}function vw(r,e){return k(this,null,function*(){e&&Pn(r).V_&&(yield function(n,i){return k(this,null,function*(){if(function(o){return tm(o)&&o!==x.ABORTED}(i.code)){let s=n.O_.shift();Pn(n).s_(),yield Vm(n,()=>n.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield ci(n)}})}(r,e)),Nm(r)&&Mm(r)})}function op(r,e){return k(this,null,function*(){let t=j(r);t.asyncQueue.verifyOperationInProgress(),L("RemoteStore","RemoteStore received new credentials");let n=xn(t);t.L_.add(3),yield ui(t),n&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield Ps(t)})}function fl(r,e){return k(this,null,function*(){let t=j(r);e?(t.L_.delete(2),yield Ps(t)):e||(t.L_.add(2),yield ui(t),t.q_.set("Unknown"))})}function li(r){return r.K_||(r.K_=function(t,n,i){let s=j(t);return s.w_(),new ul(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Eo:hw.bind(null,r),Ro:dw.bind(null,r),mo:fw.bind(null,r),d_:pw.bind(null,r)}),r.B_.push(e=>k(this,null,function*(){e?(r.K_.s_(),sh(r)?ih(r):r.q_.set("Unknown")):(yield r.K_.stop(),Dm(r))}))),r.K_}function Pn(r){return r.U_||(r.U_=function(t,n,i){let s=j(t);return s.w_(),new cl(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Eo:()=>Promise.resolve(),Ro:_w.bind(null,r),mo:vw.bind(null,r),f_:yw.bind(null,r),g_:ww.bind(null,r)}),r.B_.push(e=>k(this,null,function*(){e?(r.U_.s_(),yield ci(r)):(yield r.U_.stop(),r.O_.length>0&&(L("RemoteStore",`Stopping write stream with ${r.O_.length} pending writes`),r.O_=[]))}))),r.U_}var pl=class r{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new qe,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){let o=Date.now()+n,u=new r(e,t,o,i,s);return u.start(n),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new O(x.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function hi(r,e){if(De("AsyncQueue",`${e}: ${r}`),Cn(r))return new O(x.UNAVAILABLE,`${e}: ${r}`);throw r}var ca=class r{constructor(e){this.comparator=e?(t,n)=>e(t,n)||z.comparator(t.key,n.key):(t,n)=>z.comparator(t.key,n.key),this.keyedMap=Wi(),this.sortedSet=new Ee(this.comparator)}static emptySet(e){return new r(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof r)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let n=new r;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}};var la=class{constructor(){this.W_=new Ee(z.comparator)}track(e){let t=e.doc.key,n=this.W_.get(t);n?e.type!==0&&n.type===3?this.W_=this.W_.insert(t,e):e.type===3&&n.type!==1?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.W_=this.W_.remove(t):e.type===1&&n.type===2?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):$():this.W_=this.W_.insert(t,e)}G_(){let e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}},ti=class r{constructor(e,t,n,i,s,o,u,c,h){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(e,t,n,i,s){let o=[];return t.forEach(u=>{o.push({type:0,doc:u})}),new r(e,t,ca.emptySet(t),o,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&As(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}};var ml=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}},gl=class{constructor(){this.queries=ap(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,n){let i=j(t),s=i.queries;i.queries=ap(),s.forEach((o,u)=>{for(let c of u.j_)c.onError(n)})})(this,new O(x.ABORTED,"Firestore shutting down"))}};function ap(){return new Vt(r=>Bp(r),As)}function oh(r,e){return k(this,null,function*(){let t=j(r),n=3,i=e.query,s=t.queries.get(i);s?!s.H_()&&e.J_()&&(n=2):(s=new ml,n=e.J_()?0:1);try{switch(n){case 0:s.z_=yield t.onListen(i,!0);break;case 1:s.z_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let u=hi(o,`Initialization of query '${Mr(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&uh(t)})}function ah(r,e){return k(this,null,function*(){let t=j(r),n=e.query,i=3,s=t.queries.get(n);if(s){let o=s.j_.indexOf(e);o>=0&&(s.j_.splice(o,1),s.j_.length===0?i=e.J_()?0:1:!s.H_()&&e.J_()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})}function Tw(r,e){let t=j(r),n=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let u of o.j_)u.X_(i)&&(n=!0);o.z_=i}}n&&uh(t)}function Iw(r,e,t){let n=j(r),i=n.queries.get(e);if(i)for(let s of i.j_)s.onError(t);n.queries.delete(e)}function uh(r){r.Y_.forEach(e=>{e.next()})}var _l,up;(up=_l||(_l={})).ea="default",up.Cache="cache";var ys=class{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){let n=[];for(let i of e.docChanges)i.type!==3&&n.push(i);e=new ti(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;let n=t!=="Offline";return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;let t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=ti.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==_l.Cache}};var yl=class{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}};var ha=class{constructor(e){this.serializer=e}Es(e){return Ct(this.serializer,e)}ds(e){return e.metadata.exists?cm(this.serializer,e.document,!1):Ue.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Ne(e)}},wl=class{constructor(e,t,n){this.ca=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Om(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;let n=he.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){let t=new Map,n=new ha(this.serializer);for(let i of e)if(i.metadata.queries){let s=n.Es(i.metadata.name);for(let o of i.metadata.queries){let u=(t.get(o)||ie()).add(s);t.set(o,u)}}return t}complete(){return k(this,null,function*(){let e=yield uw(this.localStore,new ha(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(let n of this.queries)yield cw(this.localStore,n,t.get(n.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}})}};function Om(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}var da=class{constructor(e){this.key=e}},fa=class{constructor(e){this.key=e}},pa=class{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=ie(),this.mutatedKeys=ie(),this.Aa=zp(e),this.Ra=new ca(this.Aa)}get Va(){return this.Ta}ma(e,t){let n=t?t.fa:new la,i=t?t.Ra:this.Ra,s=t?t.mutatedKeys:this.mutatedKeys,o=i,u=!1,c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,m)=>{let _=i.get(f),v=Ss(this.query,m)?m:null,D=!!_&&this.mutatedKeys.has(_.key),M=!!v&&(v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations),N=!1;_&&v?_.data.isEqual(v.data)?D!==M&&(n.track({type:3,doc:v}),N=!0):this.ga(_,v)||(n.track({type:2,doc:v}),N=!0,(c&&this.Aa(v,c)>0||h&&this.Aa(v,h)<0)&&(u=!0)):!_&&v?(n.track({type:0,doc:v}),N=!0):_&&!v&&(n.track({type:1,doc:_}),N=!0,(c||h)&&(u=!0)),N&&(v?(o=o.add(v),s=M?s.add(f):s.delete(f)):(o=o.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let f=this.query.limitType==="F"?o.last():o.first();o=o.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{Ra:o,fa:n,ns:u,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){let s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;let o=e.fa.G_();o.sort((f,m)=>function(v,D){let M=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return $()}};return M(v)-M(D)}(f.type,m.type)||this.Aa(f.doc,m.doc)),this.pa(n),i=i!=null&&i;let u=t&&!i?this.ya():[],c=this.da.size===0&&this.current&&!i?1:0,h=c!==this.Ea;return this.Ea=c,o.length!==0||h?{snapshot:new ti(this.query,e.Ra,s,o,e.mutatedKeys,c===0,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:u}:{wa:u}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new la,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];let e=this.da;this.da=ie(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});let t=[];return e.forEach(n=>{this.da.has(n)||t.push(new fa(n))}),this.da.forEach(n=>{e.has(n)||t.push(new da(n))}),t}ba(e){this.Ta=e.Ts,this.da=ie();let t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return ti.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},vl=class{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}},Tl=class{constructor(e){this.key=e,this.va=!1}},Il=class{constructor(e,t,n,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Vt(u=>Bp(u),As),this.Ma=new Map,this.xa=new Set,this.Oa=new Ee(z.comparator),this.Na=new Map,this.La=new ms,this.Ba={},this.ka=new Map,this.qa=Yr.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function Ew(r,e,t=!0){return k(this,null,function*(){let n=Ca(r),i,s=n.Fa.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=yield Fm(n,e,t,!0),i})}function Aw(r,e){return k(this,null,function*(){let t=Ca(r);yield Fm(t,e,!0,!1)})}function Fm(r,e,t,n){return k(this,null,function*(){let i=yield Xr(r.localStore,st(e)),s=i.targetId,o=r.sharedClientState.addLocalQueryTarget(s,t),u;return n&&(u=yield ch(r,e,s,o==="current",i.resumeToken)),r.isPrimaryClient&&t&&Ra(r.remoteStore,i),u})}function ch(r,e,t,n,i){return k(this,null,function*(){r.Ka=(m,_,v)=>function(M,N,J,U){return k(this,null,function*(){let F=N.view.ma(J);F.ns&&(F=yield na(M.localStore,N.query,!1).then(({documents:T})=>N.view.ma(T,F)));let ee=U&&U.targetChanges.get(N.targetId),te=U&&U.targetMismatches.get(N.targetId)!=null,ne=N.view.applyChanges(F,M.isPrimaryClient,ee,te);return El(M,N.targetId,ne.wa),ne.snapshot})}(r,m,_,v);let s=yield na(r.localStore,e,!0),o=new pa(e,s.Ts),u=o.ma(s.documents),c=hs.createSynthesizedTargetChangeForCurrentChange(t,n&&r.onlineState!=="Offline",i),h=o.applyChanges(u,r.isPrimaryClient,c);El(r,t,h.wa);let f=new vl(e,t,o);return r.Fa.set(e,f),r.Ma.has(t)?r.Ma.get(t).push(e):r.Ma.set(t,[e]),h.snapshot})}function Sw(r,e,t){return k(this,null,function*(){let n=j(r),i=n.Fa.get(e),s=n.Ma.get(i.targetId);if(s.length>1)return n.Ma.set(i.targetId,s.filter(o=>!As(o,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Zr(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&ei(n.remoteStore,i.targetId),ni(n,i.targetId)}).catch(Rn))):(ni(n,i.targetId),yield Zr(n.localStore,i.targetId,!0))})}function bw(r,e){return k(this,null,function*(){let t=j(r),n=t.Fa.get(e),i=t.Ma.get(n.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),ei(t.remoteStore,n.targetId))})}function Pw(r,e,t){return k(this,null,function*(){let n=fh(r);try{let i=yield function(o,u){let c=j(o),h=Pe.now(),f=u.reduce((v,D)=>v.add(D.key),ie()),m,_;return c.persistence.runTransaction("Locally write mutations","readwrite",v=>{let D=ut(),M=ie();return c.cs.getEntries(v,f).next(N=>{D=N,D.forEach((J,U)=>{U.isValidDocument()||(M=M.add(J))})}).next(()=>c.localDocuments.getOverlayedDocuments(v,D)).next(N=>{m=N;let J=[];for(let U of u){let F=By(U,m.get(U.key).overlayedDocument);F!=null&&J.push(new Tt(U.key,F,Np(F.value.mapValue),xe.exists(!0)))}return c.mutationQueue.addMutationBatch(v,h,J,u)}).next(N=>{_=N;let J=N.applyToLocalDocumentSet(m,M);return c.documentOverlayCache.saveOverlays(v,N.batchId,J)})}).then(()=>({batchId:_.batchId,changes:Kp(m)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(o,u,c){let h=o.Ba[o.currentUser.toKey()];h||(h=new Ee(re)),h=h.insert(u,c),o.Ba[o.currentUser.toKey()]=h}(n,i.batchId,t),yield Yt(n,i.changes),yield ci(n.remoteStore)}catch(i){let s=hi(i,"Failed to persist write");t.reject(s)}})}function Lm(r,e){return k(this,null,function*(){let t=j(r);try{let n=yield ow(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Na.get(s);o&&(H(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.va=!0:i.modifiedDocuments.size>0?H(o.va):i.removedDocuments.size>0&&(H(o.va),o.va=!1))}),yield Yt(t,n,e)}catch(n){yield Rn(n)}})}function cp(r,e,t){let n=j(r);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){let i=[];n.Fa.forEach((s,o)=>{let u=o.view.Z_(e);u.snapshot&&i.push(u.snapshot)}),function(o,u){let c=j(o);c.onlineState=u;let h=!1;c.queries.forEach((f,m)=>{for(let _ of m.j_)_.Z_(u)&&(h=!0)}),h&&uh(c)}(n.eventManager,e),i.length&&n.Ca.d_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function Rw(r,e,t){return k(this,null,function*(){let n=j(r);n.sharedClientState.updateQueryState(e,"rejected",t);let i=n.Na.get(e),s=i&&i.key;if(s){let o=new Ee(z.comparator);o=o.insert(s,Ue.newNoDocument(s,X.min()));let u=ie().add(s),c=new ls(X.min(),new Map,new Ee(re),o,u);yield Lm(n,c),n.Oa=n.Oa.remove(s),n.Na.delete(e),dh(n)}else yield Zr(n.localStore,e,!1).then(()=>ni(n,e,t)).catch(Rn)})}function Cw(r,e){return k(this,null,function*(){let t=j(r),n=e.batch.batchId;try{let i=yield sw(t.localStore,e);hh(t,n,null),lh(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield Yt(t,i)}catch(i){yield Rn(i)}})}function xw(r,e,t){return k(this,null,function*(){let n=j(r);try{let i=yield function(o,u){let c=j(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return c.mutationQueue.lookupMutationBatch(h,u).next(m=>(H(m!==null),f=m.keys(),c.mutationQueue.removeMutationBatch(h,m))).next(()=>c.mutationQueue.performConsistencyCheck(h)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(h,f,u)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>c.localDocuments.getDocuments(h,f))})}(n.localStore,e);hh(n,e,t),lh(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield Yt(n,i)}catch(i){yield Rn(i)}})}function kw(r,e){return k(this,null,function*(){let t=j(r);xn(t.remoteStore)||L("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=yield function(o){let u=j(o);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>u.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(n===-1)return void e.resolve();let i=t.ka.get(n)||[];i.push(e),t.ka.set(n,i)}catch(n){let i=hi(n,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function lh(r,e){(r.ka.get(e)||[]).forEach(t=>{t.resolve()}),r.ka.delete(e)}function hh(r,e,t){let n=j(r),i=n.Ba[n.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),n.Ba[n.currentUser.toKey()]=i}}function ni(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(let n of r.Ma.get(e))r.Fa.delete(n),t&&r.Ca.$a(n,t);r.Ma.delete(e),r.isPrimaryClient&&r.La.gr(e).forEach(n=>{r.La.containsKey(n)||Um(r,n)})}function Um(r,e){r.xa.delete(e.path.canonicalString());let t=r.Oa.get(e);t!==null&&(ei(r.remoteStore,t),r.Oa=r.Oa.remove(e),r.Na.delete(t),dh(r))}function El(r,e,t){for(let n of t)n instanceof da?(r.La.addReference(n.key,e),Dw(r,n)):n instanceof fa?(L("SyncEngine","Document no longer in limbo: "+n.key),r.La.removeReference(n.key,e),r.La.containsKey(n.key)||Um(r,n.key)):$()}function Dw(r,e){let t=e.key,n=t.path.canonicalString();r.Oa.get(t)||r.xa.has(n)||(L("SyncEngine","New document in limbo: "+t),r.xa.add(n),dh(r))}function dh(r){for(;r.xa.size>0&&r.Oa.size<r.maxConcurrentLimboResolutions;){let e=r.xa.values().next().value;r.xa.delete(e);let t=new z(he.fromString(e)),n=r.qa.next();r.Na.set(n,new Tl(t)),r.Oa=r.Oa.insert(t,n),Ra(r.remoteStore,new Jr(st(ai(t.path)),n,"TargetPurposeLimboResolution",lt.oe))}}function Yt(r,e,t){return k(this,null,function*(){let n=j(r),i=[],s=[],o=[];n.Fa.isEmpty()||(n.Fa.forEach((u,c)=>{o.push(n.Ka(c,e,t).then(h=>{var f;if((h||t)&&n.isPrimaryClient){let m=h?!h.fromCache:(f=t?.targetChanges.get(c.targetId))===null||f===void 0?void 0:f.current;n.sharedClientState.updateQueryState(c.targetId,m?"current":"not-current")}if(h){i.push(h);let m=tl.Wi(c.targetId,h);s.push(m)}}))}),yield Promise.all(o),n.Ca.d_(i),yield function(c,h){return k(this,null,function*(){let f=j(c);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>R.forEach(h,_=>R.forEach(_.$i,v=>f.persistence.referenceDelegate.addReference(m,_.targetId,v)).next(()=>R.forEach(_.Ui,v=>f.persistence.referenceDelegate.removeReference(m,_.targetId,v)))))}catch(m){if(!Cn(m))throw m;L("LocalStore","Failed to update sequence numbers: "+m)}for(let m of h){let _=m.targetId;if(!m.fromCache){let v=f.os.get(_),D=v.snapshotVersion,M=v.withLastLimboFreeSnapshotVersion(D);f.os=f.os.insert(_,M)}}})}(n.localStore,s))})}function Vw(r,e){return k(this,null,function*(){let t=j(r);if(!t.currentUser.isEqual(e)){L("SyncEngine","User change. New user:",e.toKey());let n=yield Am(t.localStore,e);t.currentUser=e,function(s,o){s.ka.forEach(u=>{u.forEach(c=>{c.reject(new O(x.CANCELLED,o))})}),s.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield Yt(t,n.hs)}})}function Nw(r,e){let t=j(r),n=t.Na.get(e);if(n&&n.va)return ie().add(n.key);{let i=ie(),s=t.Ma.get(e);if(!s)return i;for(let o of s){let u=t.Fa.get(o);i=i.unionWith(u.view.Va)}return i}}function Mw(r,e){return k(this,null,function*(){let t=j(r),n=yield na(t.localStore,e.query,!0),i=e.view.ba(n);return t.isPrimaryClient&&El(t,e.targetId,i.wa),i})}function Ow(r,e){return k(this,null,function*(){let t=j(r);return Rm(t.localStore,e).then(n=>Yt(t,n))})}function Fw(r,e,t,n){return k(this,null,function*(){let i=j(r),s=yield function(u,c){let h=j(u),f=j(h.mutationQueue);return h.persistence.runTransaction("Lookup mutation documents","readonly",m=>f.Mn(m,c).next(_=>_?h.localDocuments.getDocuments(m,_):R.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?yield ci(i.remoteStore):t==="acknowledged"||t==="rejected"?(hh(i,e,n||null),lh(i,e),function(u,c){j(j(u).mutationQueue).On(c)}(i.localStore,e)):$(),yield Yt(i,s)):L("SyncEngine","Cannot apply mutation batch with id: "+e)})}function Lw(r,e){return k(this,null,function*(){let t=j(r);if(Ca(t),fh(t),e===!0&&t.Qa!==!0){let n=t.sharedClientState.getAllActiveQueryTargets(),i=yield lp(t,n.toArray());t.Qa=!0,yield fl(t.remoteStore,!0);for(let s of i)Ra(t.remoteStore,s)}else if(e===!1&&t.Qa!==!1){let n=[],i=Promise.resolve();t.Ma.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?n.push(o):i=i.then(()=>(ni(t,o),Zr(t.localStore,o,!0))),ei(t.remoteStore,o)}),yield i,yield lp(t,n),function(o){let u=j(o);u.Na.forEach((c,h)=>{ei(u.remoteStore,h)}),u.La.pr(),u.Na=new Map,u.Oa=new Ee(z.comparator)}(t),t.Qa=!1,yield fl(t.remoteStore,!1)}})}function lp(r,e,t){return k(this,null,function*(){let n=j(r),i=[],s=[];for(let o of e){let u,c=n.Ma.get(o);if(c&&c.length!==0){u=yield Xr(n.localStore,st(c[0]));for(let h of c){let f=n.Fa.get(h),m=yield Mw(n,f);m.snapshot&&s.push(m.snapshot)}}else{let h=yield Pm(n.localStore,o);u=yield Xr(n.localStore,h),yield ch(n,qm(h),o,!1,u.resumeToken)}i.push(u)}return n.Ca.d_(s),i})}function qm(r){return qp(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function Uw(r){return function(t){return j(j(t).persistence).Qi()}(j(r).localStore)}function qw(r,e,t,n){return k(this,null,function*(){let i=j(r);if(i.Qa)return void L("SyncEngine","Ignoring unexpected query state notification.");let s=i.Ma.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield Rm(i.localStore,jp(s[0])),u=ls.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Me.EMPTY_BYTE_STRING);yield Yt(i,o,u);break}case"rejected":yield Zr(i.localStore,e,!0),ni(i,e,n);break;default:$()}})}function Bw(r,e,t){return k(this,null,function*(){let n=Ca(r);if(n.Qa){for(let i of e){if(n.Ma.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){L("SyncEngine","Adding an already active target "+i);continue}let s=yield Pm(n.localStore,i),o=yield Xr(n.localStore,s);yield ch(n,qm(s),o.targetId,!1,o.resumeToken),Ra(n.remoteStore,o)}for(let i of t)n.Ma.has(i)&&(yield Zr(n.localStore,i,!1).then(()=>{ei(n.remoteStore,i),ni(n,i)}).catch(Rn))}})}function Ca(r){let e=j(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=Lm.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Nw.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Rw.bind(null,e),e.Ca.d_=Tw.bind(null,e.eventManager),e.Ca.$a=Iw.bind(null,e.eventManager),e}function fh(r){let e=j(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Cw.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=xw.bind(null,e),e}function jw(r,e,t){let n=j(r);(function(s,o,u){return k(this,null,function*(){try{let c=yield o.getMetadata();if(yield function(v,D){let M=j(v),N=Ne(D.createTime);return M.persistence.runTransaction("hasNewerBundle","readonly",J=>M.Gr.getBundleMetadata(J,D.id)).then(J=>!!J&&J.createTime.compareTo(N)>=0)}(s.localStore,c))return yield o.close(),u._completeWith(function(v){return{taskState:"Success",documentsLoaded:v.totalDocuments,bytesLoaded:v.totalBytes,totalDocuments:v.totalDocuments,totalBytes:v.totalBytes}}(c)),Promise.resolve(new Set);u._updateProgress(Om(c));let h=new wl(c,s.localStore,o.serializer),f=yield o.Ua();for(;f;){let _=yield h.la(f);_&&u._updateProgress(_),f=yield o.Ua()}let m=yield h.complete();return yield Yt(s,m.Ia,void 0),yield function(v,D){let M=j(v);return M.persistence.runTransaction("Save bundle","readwrite",N=>M.Gr.saveBundleMetadata(N,D))}(s.localStore,c),u._completeWith(m.progress),Promise.resolve(m.Pa)}catch(c){return wt("SyncEngine",`Loading bundle failed with ${c}`),u._failWith(c),Promise.resolve(new Set)}})})(n,e,t).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}var Al=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return k(this,null,function*(){this.serializer=bs(t.databaseInfo.databaseId),this.sharedClientState=this.Wa(t),this.persistence=this.Ga(t),yield this.persistence.start(),this.localStore=this.za(t),this.gcScheduler=this.ja(t,this.localStore),this.indexBackfillerScheduler=this.Ha(t,this.localStore)})}ja(t,n){return null}Ha(t,n){return null}za(t){return Em(this.persistence,new ta,t.initialUser,this.serializer)}Ga(t){return new Zo(ea.Zr,this.serializer)}Wa(t){return new sa}terminate(){return k(this,null,function*(){var t,n;(t=this.gcScheduler)===null||t===void 0||t.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return r.provider={build:()=>new r},r})();var ma=class r extends Al{constructor(e,t,n){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return k(this,null,function*(){yield ou(r.prototype,this,"initialize").call(this,e),yield this.Ja.initialize(this,e),yield fh(this.Ja.syncEngine),yield ci(this.Ja.remoteStore),yield this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}za(e){return Em(this.persistence,new ta,e.initialUser,this.serializer)}ja(e,t){let n=this.persistence.referenceDelegate.garbageCollector;return new Uc(n,e.asyncQueue,t)}Ha(e,t){let n=new nc(t,this.persistence);return new tc(e.asyncQueue,n)}Ga(e){let t=nh(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?ft.withCacheSize(this.cacheSizeBytes):ft.DEFAULT;return new el(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,xm(),Ro(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new sa}},Sl=class r extends ma{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return k(this,null,function*(){yield ou(r.prototype,this,"initialize").call(this,e);let t=this.Ja.syncEngine;this.sharedClientState instanceof es&&(this.sharedClientState.syncEngine={no:Fw.bind(null,t),ro:qw.bind(null,t),io:Bw.bind(null,t),Qi:Uw.bind(null,t),eo:Ow.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.yi(n=>k(this,null,function*(){yield Lw(this.Ja.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))})}Wa(e){let t=xm();if(!es.D(t))throw new O(x.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=nh(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new es(t,e.asyncQueue,n,e.clientId,e.initialUser)}},ph=(()=>{class r{initialize(t,n){return k(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>cp(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=Vw.bind(null,this.syncEngine),yield fl(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new gl}()}createDatastore(t){let n=bs(t.databaseInfo.databaseId),i=function(o){return new al(o)}(t.databaseInfo);return function(o,u,c,h){return new ll(o,u,c,h)}(t.authCredentials,t.appCheckCredentials,i,n)}createRemoteStore(t){return function(i,s,o,u,c){return new dl(i,s,o,u,c)}(this.localStore,this.datastore,t.asyncQueue,n=>cp(this.syncEngine,n,0),function(){return oa.D()?new oa:new sl}())}createSyncEngine(t,n){return function(s,o,u,c,h,f,m){let _=new Il(s,o,u,c,h,f);return m&&(_.Qa=!0),_}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)}terminate(){return k(this,null,function*(){var t,n;yield function(s){return k(this,null,function*(){let o=j(s);L("RemoteStore","RemoteStore shutting down."),o.L_.add(5),yield ui(o),o.k_.shutdown(),o.q_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()})}}return r.provider={build:()=>new r},r})();function hp(r,e=10240){let t=0;return{read(){return k(this,null,function*(){if(t<r.byteLength){let i={value:r.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})},cancel(){return k(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var ri=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):De("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var bl=class{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new qe,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(n=>{n&&n.ua()?this.metadata.resolve(n.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.aa)}`))},n=>this.metadata.reject(n))}close(){return this.Xa.cancel()}getMetadata(){return k(this,null,function*(){return this.metadata.promise})}Ua(){return k(this,null,function*(){return yield this.getMetadata(),this.tu()})}tu(){return k(this,null,function*(){let e=yield this.nu();if(e===null)return null;let t=this.eu.decode(e),n=Number(t);isNaN(n)&&this.ru(`length string (${t}) is not valid number`);let i=yield this.iu(n);return new yl(JSON.parse(i),e.length+n)})}su(){return this.buffer.findIndex(e=>e===123)}nu(){return k(this,null,function*(){for(;this.su()<0&&!(yield this.ou()););if(this.buffer.length===0)return null;let e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}iu(e){return k(this,null,function*(){for(;this.buffer.length<e;)(yield this.ou())&&this.ru("Reached the end of bundle when more is expected.");let t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}ou(){return k(this,null,function*(){let e=yield this.Xa.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var Pl=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return k(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new O(x.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(i,s){return k(this,null,function*(){let o=j(i),u={documents:s.map(m=>ds(o.serializer,m))},c=yield o.Lo("BatchGetDocuments",o.serializer.databaseId,he.emptyPath(),u,s.length),h=new Map;c.forEach(m=>{let _=Qy(o.serializer,m);h.set(_.key.toString(),_)});let f=[];return s.forEach(m=>{let _=h.get(m.toString());H(!!_),f.push(_)}),f})}(this.datastore,e);return t.forEach(n=>this.recordVersion(n)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new bn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return k(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,n)=>{let i=z.fromPath(n);this.mutations.push(new as(i,this.precondition(i)))}),yield function(n,i){return k(this,null,function*(){let s=j(n),o={writes:i.map(u=>fs(s.serializer,u))};yield s.Mo("Commit",s.serializer.databaseId,he.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw $();t=X.min()}let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new O(x.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(X.min())?xe.exists(!1):xe.updateTime(t):xe.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(X.min()))throw new O(x.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return xe.updateTime(t)}return xe.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var Rl=class{constructor(e,t,n,i,s){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=i,this.deferred=s,this._u=n.maxAttempts,this.t_=new _s(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(()=>k(this,null,function*(){let e=new Pl(this.datastore),t=this.cu(e);t&&t.then(n=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(n)}).catch(i=>{this.lu(i)}))}).catch(n=>{this.lu(n)})}))}cu(e){try{let t=this.updateFunction(e);return!Is(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!tm(t)}return!1}};var Cl=class{constructor(e,t,n,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=Le.UNAUTHENTICATED,this.clientId=xo.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,o=>k(this,null,function*(){L("FirestoreClient","Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(n,o=>(L("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new qe;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>k(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let n=hi(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}};function Gu(r,e){return k(this,null,function*(){r.asyncQueue.verifyOperationInProgress(),L("FirestoreClient","Initializing OfflineComponentProvider");let t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(i=>k(this,null,function*(){n.isEqual(i)||(yield Am(e.localStore,i),n=i)})),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e})}function dp(r,e){return k(this,null,function*(){r.asyncQueue.verifyOperationInProgress();let t=yield mh(r);L("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>op(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>op(e.remoteStore,i)),r._onlineComponents=e})}function mh(r){return k(this,null,function*(){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){L("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Gu(r,r._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(i){return i.name==="FirebaseError"?i.code===x.FAILED_PRECONDITION||i.code===x.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;wt("Error using user provided cache. Falling back to memory cache: "+t),yield Gu(r,new Al)}}else L("FirestoreClient","Using default OfflineComponentProvider"),yield Gu(r,new Al);return r._offlineComponents})}function xa(r){return k(this,null,function*(){return r._onlineComponents||(r._uninitializedComponentsProvider?(L("FirestoreClient","Using user provided OnlineComponentProvider"),yield dp(r,r._uninitializedComponentsProvider._online)):(L("FirestoreClient","Using default OnlineComponentProvider"),yield dp(r,new ph))),r._onlineComponents})}function Bm(r){return mh(r).then(e=>e.persistence)}function gh(r){return mh(r).then(e=>e.localStore)}function jm(r){return xa(r).then(e=>e.remoteStore)}function _h(r){return xa(r).then(e=>e.syncEngine)}function zw(r){return xa(r).then(e=>e.datastore)}function ii(r){return k(this,null,function*(){let e=yield xa(r),t=e.eventManager;return t.onListen=Ew.bind(null,e.syncEngine),t.onUnlisten=Sw.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Aw.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=bw.bind(null,e.syncEngine),t})}function Gw(r){return r.asyncQueue.enqueue(()=>k(this,null,function*(){let e=yield Bm(r),t=yield jm(r);return e.setNetworkEnabled(!0),function(i){let s=j(i);return s.L_.delete(0),Ps(s)}(t)}))}function Kw(r){return r.asyncQueue.enqueue(()=>k(this,null,function*(){let e=yield Bm(r),t=yield jm(r);return e.setNetworkEnabled(!1),function(i){return k(this,null,function*(){let s=j(i);s.L_.add(0),yield ui(s),s.q_.set("Offline")})}(t)}))}function $w(r,e){let t=new qe;return r.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return function(i,s,o){return k(this,null,function*(){try{let u=yield function(h,f){let m=j(h);return m.persistence.runTransaction("read document","readonly",_=>m.localDocuments.getDocument(_,f))}(i,s);u.isFoundDocument()?o.resolve(u):u.isNoDocument()?o.resolve(null):o.reject(new O(x.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){let c=hi(u,`Failed to get document '${s} from cache`);o.reject(c)}})}(yield gh(r),e,t)})),t.promise}function zm(r,e,t={}){let n=new qe;return r.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return function(s,o,u,c,h){let f=new ri({next:_=>{f.Za(),o.enqueueAndForget(()=>ah(s,m));let v=_.docs.has(u);!v&&_.fromCache?h.reject(new O(x.UNAVAILABLE,"Failed to get document because the client is offline.")):v&&_.fromCache&&c&&c.source==="server"?h.reject(new O(x.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(_)},error:_=>h.reject(_)}),m=new ys(ai(u.path),f,{includeMetadataChanges:!0,_a:!0});return oh(s,m)}(yield ii(r),r.asyncQueue,e,t,n)})),n.promise}function Qw(r,e){let t=new qe;return r.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return function(i,s,o){return k(this,null,function*(){try{let u=yield na(i,s,!0),c=new pa(s,u.Ts),h=c.ma(u.documents),f=c.applyChanges(h,!1);o.resolve(f.snapshot)}catch(u){let c=hi(u,`Failed to execute query '${s} against cache`);o.reject(c)}})}(yield gh(r),e,t)})),t.promise}function Gm(r,e,t={}){let n=new qe;return r.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return function(s,o,u,c,h){let f=new ri({next:_=>{f.Za(),o.enqueueAndForget(()=>ah(s,m)),_.fromCache&&c.source==="server"?h.reject(new O(x.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(_)},error:_=>h.reject(_)}),m=new ys(u,f,{includeMetadataChanges:!0,_a:!0});return oh(s,m)}(yield ii(r),r.asyncQueue,e,t,n)})),n.promise}function Ww(r,e){let t=new ri(e);return r.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return function(i,s){j(i).Y_.add(s),s.next()}(yield ii(r),t)})),()=>{t.Za(),r.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return function(i,s){j(i).Y_.delete(s)}(yield ii(r),t)}))}}function Hw(r,e,t,n){let i=function(o,u){let c;return c=typeof o=="string"?rm().encode(o):o,function(f,m){return new bl(f,m)}(function(f,m){if(f instanceof Uint8Array)return hp(f,m);if(f instanceof ArrayBuffer)return hp(new Uint8Array(f),m);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),u)}(t,bs(e));r.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){jw(yield _h(r),i,n)}))}function Jw(r,e){return r.asyncQueue.enqueue(()=>k(this,null,function*(){return function(n,i){let s=j(n);return s.persistence.runTransaction("Get named query","readonly",o=>s.Gr.getNamedQuery(o,i))}(yield gh(r),e)}))}function Km(r){let e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}var fp=new Map;function yh(r,e,t){if(!t)throw new O(x.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function wh(r,e,t,n){if(e===!0&&n===!0)throw new O(x.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function pp(r){if(!z.isDocumentKey(r))throw new O(x.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function mp(r){if(z.isDocumentKey(r))throw new O(x.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function ka(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{let e=function(n){return n.constructor?n.constructor.name:null}(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":$()}function de(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new O(x.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=ka(r);throw new O(x.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function $m(r,e){if(e<=0)throw new O(x.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}var ga=class{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new O(x.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new O(x.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}wh("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Km((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new O(x.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new O(x.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new O(x.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,i){return n.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},cr=class{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ga({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new O(x.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new O(x.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ga(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new Ku;switch(n.type){case"firstParty":return new Hu(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new O(x.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return k(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let n=fp.get(t);n&&(L("ComponentProvider","Removing Datastore"),fp.delete(t),n.terminate())}(this),Promise.resolve()}};function vh(r,e,t,n={}){var i;let s=(r=de(r,cr))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&wt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),n.mockUserToken){let u,c;if(typeof n.mockUserToken=="string")u=n.mockUserToken,c=Le.MOCK_USER;else{u=qd(n.mockUserToken,(i=r._app)===null||i===void 0?void 0:i.options.projectId);let h=n.mockUserToken.sub||n.mockUserToken.user_id;if(!h)throw new O(x.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Le(h)}r._authCredentials=new $u(new Co(u,c))}}var Qe=class r{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new r(this.firestore,e,this._query)}},ve=class r{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new xt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new r(this.firestore,e,this._key)}},xt=class r extends Qe{constructor(e,t,n){super(e,t,ai(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new ve(this.firestore,null,new z(e))}withConverter(e){return new r(this.firestore,e,this._path)}};function Th(r,e,...t){if(r=be(r),yh("collection","path",e),r instanceof cr){let n=he.fromString(e,...t);return mp(n),new xt(r,null,n)}{if(!(r instanceof ve||r instanceof xt))throw new O(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(he.fromString(e,...t));return mp(n),new xt(r.firestore,null,n)}}function Qm(r,e){if(r=de(r,cr),yh("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new O(x.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Qe(r,null,function(n){return new vt(he.emptyPath(),n)}(e))}function Rs(r,e,...t){if(r=be(r),arguments.length===1&&(e=xo.newId()),yh("doc","path",e),r instanceof cr){let n=he.fromString(e,...t);return pp(n),new ve(r,null,new z(n))}{if(!(r instanceof ve||r instanceof xt))throw new O(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(he.fromString(e,...t));return pp(n),new ve(r.firestore,r instanceof xt?r.converter:null,new z(n))}}function Ih(r,e){return r=be(r),e=be(e),(r instanceof ve||r instanceof xt)&&(e instanceof ve||e instanceof xt)&&r.firestore===e.firestore&&r.path===e.path&&r.converter===e.converter}function Eh(r,e){return r=be(r),e=be(e),r instanceof Qe&&e instanceof Qe&&r.firestore===e.firestore&&As(r._query,e._query)&&r.converter===e.converter}var _a=class{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new _s(this,"async_queue_retry"),this.Vu=()=>{let n=Ro();n&&L("AsyncQueue","Visibility state changed to "+n.visibilityState),this.t_.jo()},this.mu=e;let t=Ro();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;let t=Ro();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});let t=new qe;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}pu(){return k(this,null,function*(){if(this.Pu.length!==0){try{yield this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Cn(e))throw e;L("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}})}gu(e){let t=this.mu.then(()=>(this.du=!0,e().catch(n=>{this.Eu=n,this.du=!1;let i=function(o){let u=o.message||"";return o.stack&&(u=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),u}(n);throw De("INTERNAL UNHANDLED ERROR: ",i),n}).then(n=>(this.du=!1,n))));return this.mu=t,t}enqueueAfterDelay(e,t,n){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);let i=pl.createAndSchedule(this,e,t,n,s=>this.yu(s));return this.Tu.push(i),i}fu(){this.Eu&&$()}verifyOperationInProgress(){}wu(){return k(this,null,function*(){let e;do e=this.mu,yield e;while(e!==this.mu)})}Su(e){for(let t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(let t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){let t=this.Tu.indexOf(e);this.Tu.splice(t,1)}};function xl(r){return function(t,n){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of n)if(s in i&&typeof i[s]=="function")return!0;return!1}(r,["next","error","complete"])}var kl=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new qe,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var Wm=-1,Re=class extends cr{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new _a,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return k(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new _a(e),this._firestoreClient=void 0,yield e}})}};function fI(r,e){let t=typeof r=="object"?r:so(),n=typeof r=="string"?r:e||"(default)",i=mu(t,"firestore").getImmediate({identifier:n});if(!i._initialized){let s=Ud("firestore");s&&vh(i,...s)}return i}function We(r){if(r._terminated)throw new O(x.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||Hm(r),r._firestoreClient}function Hm(r){var e,t,n;let i=r._freezeSettings(),s=function(u,c,h,f){return new rc(u,c,h,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,Km(f.experimentalLongPollingOptions),f.useFetchStreams)}(r._databaseId,((e=r._app)===null||e===void 0?void 0:e.options.appId)||"",r._persistenceKey,i);r._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=i.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),r._firestoreClient=new Cl(r._authCredentials,r._appCheckCredentials,r._queue,s,r._componentsProvider&&function(u){let c=u?._online.build();return{_offline:u?._offline.build(c),_online:c}}(r._componentsProvider))}function Jm(r,e){wt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=r._freezeSettings();return Xm(r,ph.provider,{build:n=>new ma(n,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}function Ym(r){return k(this,null,function*(){wt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=r._freezeSettings();Xm(r,ph.provider,{build:t=>new Sl(t,e.cacheSizeBytes)})})}function Xm(r,e,t){if((r=de(r,Re))._firestoreClient||r._terminated)throw new O(x.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(r._componentsProvider||r._getSettings().localCache)throw new O(x.FAILED_PRECONDITION,"SDK cache is already specified.");r._componentsProvider={_online:e,_offline:t},Hm(r)}function Zm(r){if(r._initialized&&!r._terminated)throw new O(x.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new qe;return r._queue.enqueueAndForgetEvenWhileRestricted(()=>k(this,null,function*(){try{yield function(n){return k(this,null,function*(){if(!wn.D())return Promise.resolve();let i=n+"main";yield wn.delete(i)})}(nh(r._databaseId,r._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function eg(r){return function(t){let n=new qe;return t.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return kw(yield _h(t),n)})),n.promise}(We(r=de(r,Re)))}function tg(r){return Gw(We(r=de(r,Re)))}function ng(r){return Kw(We(r=de(r,Re)))}function rg(r,e){let t=We(r=de(r,Re)),n=new kl;return Hw(t,r._databaseId,e,n),n}function ig(r,e){return Jw(We(r=de(r,Re)),e).then(t=>t?new Qe(r,null,t.query):null)}var Nt=class r{constructor(e){this._byteString=e}static fromBase64String(e){try{return new r(Me.fromBase64String(e))}catch(t){throw new O(x.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new r(Me.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var It=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new O(x.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ve(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Ht=class{constructor(e){this._methodName=e}};var lr=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new O(x.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new O(x.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return re(this._lat,e._lat)||re(this._long,e._long)}};var ws=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,i){if(n.length!==i.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}(this._values,e._values)}};var Yw=/^__.*__$/,Dl=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new Tt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Sn(e,this.data,t,this.fieldTransforms)}},ya=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Tt(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function sg(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw $()}}var wa=class r{constructor(e,t,n,i,s,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,s===void 0&&this.vu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new r(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Fu({path:n,xu:!1});return i.Ou(e),i}Nu(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Fu({path:n,xu:!1});return i.vu(),i}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return va(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(sg(this.Cu)&&Yw.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}},Vl=class{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||bs(e)}Qu(e,t,n,i=!1){return new wa({Cu:e,methodName:t,qu:n,path:Ve.emptyPath(),xu:!1,ku:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function pr(r){let e=r._freezeSettings(),t=bs(r._databaseId);return new Vl(r._databaseId,!!e.ignoreUndefinedProperties,t)}function Da(r,e,t,n,i,s={}){let o=r.Qu(s.merge||s.mergeFields?2:0,e,t,i);bh("Data must be an object, but it was:",o,n);let u=ug(n,o),c,h;if(s.merge)c=new ht(o.fieldMask),h=o.fieldTransforms;else if(s.mergeFields){let f=[];for(let m of s.mergeFields){let _=Ll(e,m,t);if(!o.contains(_))throw new O(x.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);lg(f,_)||f.push(_)}c=new ht(f),h=o.fieldTransforms.filter(m=>c.covers(m.field))}else c=null,h=o.fieldTransforms;return new Dl(new Xe(u),c,h)}var vs=class r extends Ht{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof r}};function og(r,e,t){return new wa({Cu:3,qu:e.settings.qu,methodName:r._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var Nl=class r extends Ht{_toFieldTransform(e){return new or(e.path,new En)}isEqual(e){return e instanceof r}},Ml=class r extends Ht{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=og(this,e,!0),n=this.Ku.map(s=>mr(s,t)),i=new Qt(n);return new or(e.path,i)}isEqual(e){return e instanceof r&&pu(this.Ku,e.Ku)}},Ol=class r extends Ht{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=og(this,e,!0),n=this.Ku.map(s=>mr(s,t)),i=new Wt(n);return new or(e.path,i)}isEqual(e){return e instanceof r&&pu(this.Ku,e.Ku)}},Fl=class r extends Ht{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){let t=new An(e.serializer,Wp(e.serializer,this.$u));return new or(e.path,t)}isEqual(e){return e instanceof r&&this.$u===e.$u}};function Ah(r,e,t,n){let i=r.Qu(1,e,t);bh("Data must be an object, but it was:",i,n);let s=[],o=Xe.empty();fr(n,(c,h)=>{let f=Ph(e,c,t);h=be(h);let m=i.Nu(f);if(h instanceof vs)s.push(f);else{let _=mr(h,m);_!=null&&(s.push(f),o.set(f,_))}});let u=new ht(s);return new ya(o,u,i.fieldTransforms)}function Sh(r,e,t,n,i,s){let o=r.Qu(1,e,t),u=[Ll(e,n,t)],c=[i];if(s.length%2!=0)throw new O(x.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<s.length;_+=2)u.push(Ll(e,s[_])),c.push(s[_+1]);let h=[],f=Xe.empty();for(let _=u.length-1;_>=0;--_)if(!lg(h,u[_])){let v=u[_],D=c[_];D=be(D);let M=o.Nu(v);if(D instanceof vs)h.push(v);else{let N=mr(D,M);N!=null&&(h.push(v),f.set(v,N))}}let m=new ht(h);return new ya(f,m,o.fieldTransforms)}function ag(r,e,t,n=!1){return mr(t,r.Qu(n?4:3,e))}function mr(r,e){if(cg(r=be(r)))return bh("Unsupported field value:",e,r),ug(r,e);if(r instanceof Ht)return function(n,i){if(!sg(i.Cu))throw i.Bu(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Bu(`${n._methodName}() is not currently supported inside arrays`);let s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(n,i){let s=[],o=0;for(let u of n){let c=mr(u,i.Lu(o));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),o++}return{arrayValue:{values:s}}}(r,e)}return function(n,i){if((n=be(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return Wp(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let s=Pe.fromDate(n);return{timestampValue:Hr(i.serializer,s)}}if(n instanceof Pe){let s=new Pe(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Hr(i.serializer,s)}}if(n instanceof lr)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Nt)return{bytesValue:im(i.serializer,n._byteString)};if(n instanceof ve){let s=i.databaseId,o=n.firestore._databaseId;if(!o.isEqual(s))throw i.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Zl(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof ws)return function(o,u){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(c=>{if(typeof c!="number")throw u.Bu("VectorValues must only contain numeric values.");return Xl(u.serializer,c)})}}}}}}(n,i);throw i.Bu(`Unsupported field value: ${ka(n)}`)}(r,e)}function ug(r,e){let t={};return xp(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):fr(r,(n,i)=>{let s=mr(i,e.Mu(n));s!=null&&(t[n]=s)}),{mapValue:{fields:t}}}function cg(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof Pe||r instanceof lr||r instanceof Nt||r instanceof ve||r instanceof Ht||r instanceof ws)}function bh(r,e,t){if(!cg(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let n=ka(t);throw n==="an object"?e.Bu(r+" a custom object"):e.Bu(r+" "+n)}}function Ll(r,e,t){if((e=be(e))instanceof It)return e._internalPath;if(typeof e=="string")return Ph(r,e);throw va("Field path arguments must be of type string or ",r,!1,void 0,t)}var Xw=new RegExp("[~\\*/\\[\\]]");function Ph(r,e,t){if(e.search(Xw)>=0)throw va(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new It(...e.split("."))._internalPath}catch{throw va(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function va(r,e,t,n,i){let s=n&&!n.isEmpty(),o=i!==void 0,u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${n}`),o&&(c+=` in document ${i}`),c+=")"),new O(x.INVALID_ARGUMENT,u+r+c)}function lg(r,e){return r.some(t=>t.isEqual(e))}var hr=class{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ve(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Ul(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Va("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Ul=class extends hr{data(){return super.data()}};function Va(r,e){return typeof e=="string"?Ph(r,e):e instanceof It?e._internalPath:e._delegate._internalPath}function hg(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new O(x.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Ts=class{},dr=class extends Ts{};function Xt(r,e,...t){let n=[];e instanceof Ts&&n.push(e),n=n.concat(t),function(s){let o=s.filter(c=>c instanceof ql).length,u=s.filter(c=>c instanceof Ta).length;if(o>1||o>0&&u>0)throw new O(x.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(let i of n)r=i._apply(r);return r}var Ta=class r extends dr{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=this._parse(e);return Tg(e._query,t),new Qe(e.firestore,e.converter,gc(e._query,t))}_parse(e){let t=pr(e.firestore);return function(s,o,u,c,h,f,m){let _;if(h.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new O(x.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){_p(m,f);let v=[];for(let D of m)v.push(gp(c,s,D));_={arrayValue:{values:v}}}else _=gp(c,s,m)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||_p(m,f),_=ag(u,o,m,f==="in"||f==="not-in");return ce.create(h,f,_)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function dg(r,e,t){let n=e,i=Va("where",r);return Ta._create(i,n,t)}var ql=class r extends Ts{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new r(e,t)}_parse(e){let t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:ge.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i,u=s.getFlattenedFilters();for(let c of u)Tg(o,c),o=gc(o,c)}(e._query,t),new Qe(e.firestore,e.converter,gc(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Bl=class r extends dr{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new r(e,t)}_apply(e){let t=function(i,s,o){if(i.startAt!==null)throw new O(x.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new O(x.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ir(s,o)}(e._query,this._field,this._direction);return new Qe(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new vt(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function fg(r,e="asc"){let t=e,n=Va("orderBy",r);return Bl._create(n,t)}var Ia=class r extends dr{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new r(e,t,n)}_apply(e){return new Qe(e.firestore,e.converter,qo(e._query,this._limit,this._limitType))}};function pg(r){return $m("limit",r),Ia._create("limit",r,"F")}function mg(r){return $m("limitToLast",r),Ia._create("limitToLast",r,"L")}var Ea=class r extends dr{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=vg(e,this.type,this._docOrFields,this._inclusive);return new Qe(e.firestore,e.converter,function(i,s){return new vt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};function gg(...r){return Ea._create("startAt",r,!0)}function _g(...r){return Ea._create("startAfter",r,!1)}var Aa=class r extends dr{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=vg(e,this.type,this._docOrFields,this._inclusive);return new Qe(e.firestore,e.converter,function(i,s){return new vt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};function yg(...r){return Aa._create("endBefore",r,!1)}function wg(...r){return Aa._create("endAt",r,!0)}function vg(r,e,t,n){if(t[0]=be(t[0]),t[0]instanceof hr)return function(s,o,u,c,h){if(!c)throw new O(x.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);let f=[];for(let m of Br(s))if(m.field.isKeyField())f.push(rr(o,c.key));else{let _=c.data.field(m.field);if(ba(_))throw new O(x.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+m.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(_===null){let v=m.field.canonicalString();throw new O(x.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${v}' (used as the orderBy) does not exist.`)}f.push(_)}return new Dt(f,h)}(r._query,r.firestore._databaseId,e,t[0]._document,n);{let i=pr(r.firestore);return function(o,u,c,h,f,m){let _=o.explicitOrderBy;if(f.length>_.length)throw new O(x.INVALID_ARGUMENT,`Too many arguments provided to ${h}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let v=[];for(let D=0;D<f.length;D++){let M=f[D];if(_[D].field.isKeyField()){if(typeof M!="string")throw new O(x.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${h}(), but got a ${typeof M}`);if(!Jl(o)&&M.indexOf("/")!==-1)throw new O(x.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${h}() must be a plain document ID, but '${M}' contains a slash.`);let N=o.path.child(he.fromString(M));if(!z.isDocumentKey(N))throw new O(x.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${h}() must result in a valid document path, but '${N}' is not because it contains an odd number of segments.`);let J=new z(N);v.push(rr(u,J))}else{let N=ag(c,h,M);v.push(N)}}return new Dt(v,m)}(r._query,r.firestore._databaseId,i,e,t,n)}}function gp(r,e,t){if(typeof(t=be(t))=="string"){if(t==="")throw new O(x.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Jl(e)&&t.indexOf("/")!==-1)throw new O(x.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let n=e.path.child(he.fromString(t));if(!z.isDocumentKey(n))throw new O(x.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return rr(r,new z(n))}if(t instanceof ve)return rr(r,t._key);throw new O(x.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ka(t)}.`)}function _p(r,e){if(!Array.isArray(r)||r.length===0)throw new O(x.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Tg(r,e){let t=function(i,s){for(let o of i)for(let u of o.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new O(x.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new O(x.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var si=class{convertValue(e,t="none"){switch(nr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ae(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(vn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw $()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return fr(e,(i,s)=>{n[i]=this.convertValue(s,t)}),n}convertVectorValue(e){var t,n,i;let s=(i=(n=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.map(o=>Ae(o.doubleValue));return new ws(s)}convertGeoPoint(e){return new lr(Ae(e.latitude),Ae(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=Wl(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(is(e));default:return null}}convertTimestamp(e){let t=$t(e);return new Pe(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=he.fromString(e);H(mm(n));let i=new Tn(n.get(1),n.get(3)),s=new z(n.popFirst(5));return i.isEqual(t)||De(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Na(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}var jl=class extends si{constructor(e){super(),this.firestore=e}convertBytes(e){return new Nt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ve(this.firestore,null,t)}};var Kt=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},mt=class extends hr{constructor(e,t,n,i,s,o){super(e,t,n,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new _n(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(Va("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}},_n=class extends mt{data(e={}){return super.data(e)}},Et=class{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Kt(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new _n(this._firestore,this._userDataWriter,n.key,n,new Kt(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new O(x.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(u=>{let c=new _n(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Kt(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||u.type!==3).map(u=>{let c=new _n(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Kt(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),h=-1,f=-1;return u.type!==0&&(h=o.indexOf(u.doc.key),o=o.delete(u.doc.key)),u.type!==1&&(o=o.add(u.doc),f=o.indexOf(u.doc.key)),{type:Zw(u.type),doc:c,oldIndex:h,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function Zw(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return $()}}function Rh(r,e){return r instanceof mt&&e instanceof mt?r._firestore===e._firestore&&r._key.isEqual(e._key)&&(r._document===null?e._document===null:r._document.isEqual(e._document))&&r._converter===e._converter:r instanceof Et&&e instanceof Et&&r._firestore===e._firestore&&Eh(r.query,e.query)&&r.metadata.isEqual(e.metadata)&&r._snapshot.isEqual(e._snapshot)}function Ig(r){r=de(r,ve);let e=de(r.firestore,Re);return zm(We(e),r._key).then(t=>Dh(e,r,t))}var Jt=class extends si{constructor(e){super(),this.firestore=e}convertBytes(e){return new Nt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ve(this.firestore,null,t)}};function Eg(r){r=de(r,ve);let e=de(r.firestore,Re),t=We(e),n=new Jt(e);return $w(t,r._key).then(i=>new mt(e,n,r._key,i,new Kt(i!==null&&i.hasLocalMutations,!0),r.converter))}function Ag(r){r=de(r,ve);let e=de(r.firestore,Re);return zm(We(e),r._key,{source:"server"}).then(t=>Dh(e,r,t))}function Sg(r){r=de(r,Qe);let e=de(r.firestore,Re),t=We(e),n=new Jt(e);return hg(r._query),Gm(t,r._query).then(i=>new Et(e,n,r,i))}function bg(r){r=de(r,Qe);let e=de(r.firestore,Re),t=We(e),n=new Jt(e);return Qw(t,r._query).then(i=>new Et(e,n,r,i))}function Pg(r){r=de(r,Qe);let e=de(r.firestore,Re),t=We(e),n=new Jt(e);return Gm(t,r._query,{source:"server"}).then(i=>new Et(e,n,r,i))}function Ch(r,e,t){r=de(r,ve);let n=de(r.firestore,Re),i=Na(r.converter,e,t);return di(n,[Da(pr(n),"setDoc",r._key,i,r.converter!==null,t).toMutation(r._key,xe.none())])}function xh(r,e,t,...n){r=de(r,ve);let i=de(r.firestore,Re),s=pr(i),o;return o=typeof(e=be(e))=="string"||e instanceof It?Sh(s,"updateDoc",r._key,e,t,n):Ah(s,"updateDoc",r._key,e),di(i,[o.toMutation(r._key,xe.exists(!0))])}function Rg(r){return di(de(r.firestore,Re),[new bn(r._key,xe.none())])}function Cg(r,e){let t=de(r.firestore,Re),n=Rs(r),i=Na(r.converter,e);return di(t,[Da(pr(r.firestore),"addDoc",n._key,i,r.converter!==null,{}).toMutation(n._key,xe.exists(!1))]).then(()=>n)}function kh(r,...e){var t,n,i;r=be(r);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||xl(e[o])||(s=e[o],o++);let u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(xl(e[o])){let m=e[o];e[o]=(t=m.next)===null||t===void 0?void 0:t.bind(m),e[o+1]=(n=m.error)===null||n===void 0?void 0:n.bind(m),e[o+2]=(i=m.complete)===null||i===void 0?void 0:i.bind(m)}let c,h,f;if(r instanceof ve)h=de(r.firestore,Re),f=ai(r._key.path),c={next:m=>{e[o]&&e[o](Dh(h,r,m))},error:e[o+1],complete:e[o+2]};else{let m=de(r,Qe);h=de(m.firestore,Re),f=m._query;let _=new Jt(h);c={next:v=>{e[o]&&e[o](new Et(h,_,m,v))},error:e[o+1],complete:e[o+2]},hg(r._query)}return function(_,v,D,M){let N=new ri(M),J=new ys(v,N,D);return _.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return oh(yield ii(_),J)})),()=>{N.Za(),_.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return ah(yield ii(_),J)}))}}(We(h),f,u,c)}function xg(r,e){return Ww(We(r=de(r,Re)),xl(e)?e:{next:e})}function di(r,e){return function(n,i){let s=new qe;return n.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return Pw(yield _h(n),i,s)})),s.promise}(We(r),e)}function Dh(r,e,t){let n=t.docs.get(e._key),i=new Jt(r);return new mt(r,i,e._key,n,new Kt(t.hasPendingWrites,t.fromCache),e.converter)}var ev={maxAttempts:5};var Sa=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=pr(e)}set(e,t,n){this._verifyNotCommitted();let i=mn(e,this._firestore),s=Na(i.converter,t,n),o=Da(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,n);return this._mutations.push(o.toMutation(i._key,xe.none())),this}update(e,t,n,...i){this._verifyNotCommitted();let s=mn(e,this._firestore),o;return o=typeof(t=be(t))=="string"||t instanceof It?Sh(this._dataReader,"WriteBatch.update",s._key,t,n,i):Ah(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,xe.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=mn(e,this._firestore);return this._mutations=this._mutations.concat(new bn(t._key,xe.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new O(x.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function mn(r,e){if((r=be(r)).firestore!==e)throw new O(x.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}var zl=class extends class{constructor(t,n){this._firestore=t,this._transaction=n,this._dataReader=pr(t)}get(t){let n=mn(t,this._firestore),i=new jl(this._firestore);return this._transaction.lookup([n._key]).then(s=>{if(!s||s.length!==1)return $();let o=s[0];if(o.isFoundDocument())return new hr(this._firestore,i,o.key,o,n.converter);if(o.isNoDocument())return new hr(this._firestore,i,n._key,null,n.converter);throw $()})}set(t,n,i){let s=mn(t,this._firestore),o=Na(s.converter,n,i),u=Da(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,i);return this._transaction.set(s._key,u),this}update(t,n,i,...s){let o=mn(t,this._firestore),u;return u=typeof(n=be(n))=="string"||n instanceof It?Sh(this._dataReader,"Transaction.update",o._key,n,i,s):Ah(this._dataReader,"Transaction.update",o._key,n),this._transaction.update(o._key,u),this}delete(t){let n=mn(t,this._firestore);return this._transaction.delete(n._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=mn(e,this._firestore),n=new Jt(this._firestore);return super.get(e).then(i=>new mt(this._firestore,n,t._key,i._document,new Kt(!1,!1),t.converter))}};function kg(r,e,t){r=de(r,Re);let n=Object.assign(Object.assign({},ev),t);return function(s){if(s.maxAttempts<1)throw new O(x.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,o,u){let c=new qe;return s.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){let h=yield zw(s);new Rl(s.asyncQueue,h,u,o,c).au()})),c.promise}(We(r),i=>e(new zl(r,i)),n)}function Dg(){return new vs("deleteField")}function Vg(){return new Nl("serverTimestamp")}function Ng(...r){return new Ml("arrayUnion",r)}function Mg(...r){return new Ol("arrayRemove",r)}function Og(r){return new Fl("increment",r)}(function(e,t=!0){(function(i){oi=i})(zd),Ui(new zn("firestore",(n,{instanceIdentifier:i,options:s})=>{let o=n.getProvider("app").getImmediate(),u=new Re(new Qu(n.getProvider("auth-internal")),new Yu(n.getProvider("app-check-internal")),function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new O(x.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Tn(h.options.projectId,f)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),Bt(mf,"4.7.3",e),Bt(mf,"4.7.3","esm2017")})();var tv="@firebase/firestore-compat",nv="0.3.38";function Lh(r,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new O("invalid-argument",`Invalid options passed to function ${r}(): You cannot specify both "merge" and "mergeFields".`);return e}function Fg(){if(typeof Uint8Array>"u")throw new O("unimplemented","Uint8Arrays are not available in this environment.")}function Lg(){if(!kp())throw new O("unimplemented","Blobs are unavailable in Firestore in this environment.")}var Ma=class r{constructor(e){this._delegate=e}static fromBase64String(e){return Lg(),new r(Nt.fromBase64String(e))}static fromUint8Array(e){return Fg(),new r(Nt.fromUint8Array(e))}toBase64(){return Lg(),this._delegate.toBase64()}toUint8Array(){return Fg(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function Vh(r){return rv(r,["next","error","complete"])}function rv(r,e){if(typeof r!="object"||r===null)return!1;let t=r;for(let n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}var Nh=class{enableIndexedDbPersistence(e,t){return Jm(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return Ym(e._delegate)}clearIndexedDbPersistence(e){return Zm(e._delegate)}},Oa=class{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof Tn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&wt("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,n={}){vh(this._delegate,e,t,n)}enableNetwork(){return tg(this._delegate)}disableNetwork(){return ng(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,wh("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return eg(this._delegate)}onSnapshotsInSync(e){return xg(this._delegate,e)}get app(){if(!this._appCompat)throw new O("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new mi(this,Th(this._delegate,e))}catch(t){throw ot(t,"collection()","Firestore.collection()")}}doc(e){try{return new Mt(this,Rs(this._delegate,e))}catch(t){throw ot(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new wr(this,Qm(this._delegate,e))}catch(t){throw ot(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return kg(this._delegate,t=>e(new Fa(this,t)))}batch(){return We(this._delegate),new La(new Sa(this._delegate,e=>di(this._delegate,e)))}loadBundle(e){return rg(this._delegate,e)}namedQuery(e){return ig(this._delegate,e).then(t=>t?new wr(this,t):null)}},fi=class extends si{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ma(new Nt(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return Mt.forKey(t,this.firestore,null)}};function iv(r){yp(r)}var Fa=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new fi(e)}get(e){let t=gr(e);return this._delegate.get(t).then(n=>new _r(this._firestore,new mt(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,t.converter)))}set(e,t,n){let i=gr(e);return n?(Lh("Transaction.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){let s=gr(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){let t=gr(e);return this._delegate.delete(t),this}},La=class{constructor(e){this._delegate=e}set(e,t,n){let i=gr(e);return n?(Lh("WriteBatch.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){let s=gr(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){let t=gr(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},pi=class r{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){let n=new _n(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new yr(this._firestore,n),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let n=r.INSTANCES,i=n.get(e);i||(i=new WeakMap,n.set(e,i));let s=i.get(t);return s||(s=new r(e,new fi(e),t),i.set(t,s)),s}};pi.INSTANCES=new WeakMap;var Mt=class r{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new fi(e)}static forPath(e,t,n){if(e.length%2!==0)throw new O("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new r(t,new ve(t._delegate,n,new z(e)))}static forKey(e,t,n){return new r(t,new ve(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new mi(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new mi(this.firestore,Th(this._delegate,e))}catch(t){throw ot(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=be(e),e instanceof ve?Ih(this._delegate,e):!1}set(e,t){t=Lh("DocumentReference.set",t);try{return t?Ch(this._delegate,e,t):Ch(this._delegate,e)}catch(n){throw ot(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return arguments.length===1?xh(this._delegate,e):xh(this._delegate,e,t,...n)}catch(i){throw ot(i,"updateDoc()","DocumentReference.update()")}}delete(){return Rg(this._delegate)}onSnapshot(...e){let t=Ug(e),n=qg(e,i=>new _r(this.firestore,new mt(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return kh(this._delegate,t,n)}get(e){let t;return e?.source==="cache"?t=Eg(this._delegate):e?.source==="server"?t=Ag(this._delegate):t=Ig(this._delegate),t.then(n=>new _r(this.firestore,new mt(this.firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,this._delegate.converter)))}withConverter(e){return new r(this.firestore,e?this._delegate.withConverter(pi.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function ot(r,e,t){return r.message=r.message.replace(e,t),r}function Ug(r){for(let e of r)if(typeof e=="object"&&!Vh(e))return e;return{}}function qg(r,e){var t,n;let i;return Vh(r[0])?i=r[0]:Vh(r[1])?i=r[1]:typeof r[0]=="function"?i={next:r[0],error:r[1],complete:r[2]}:i={next:r[1],error:r[2],complete:r[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(n=i.complete)===null||n===void 0?void 0:n.bind(i)}}var _r=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Mt(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Rh(this._delegate,e._delegate)}},yr=class extends _r{data(e){let t=this._delegate.data(e);return this._delegate._converter||wp(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},wr=class r{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new fi(e)}where(e,t,n){try{return new r(this.firestore,Xt(this._delegate,dg(e,t,n)))}catch(i){throw ot(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new r(this.firestore,Xt(this._delegate,fg(e,t)))}catch(n){throw ot(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new r(this.firestore,Xt(this._delegate,pg(e)))}catch(t){throw ot(t,"limit()","Query.limit()")}}limitToLast(e){try{return new r(this.firestore,Xt(this._delegate,mg(e)))}catch(t){throw ot(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new r(this.firestore,Xt(this._delegate,gg(...e)))}catch(t){throw ot(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new r(this.firestore,Xt(this._delegate,_g(...e)))}catch(t){throw ot(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new r(this.firestore,Xt(this._delegate,yg(...e)))}catch(t){throw ot(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new r(this.firestore,Xt(this._delegate,wg(...e)))}catch(t){throw ot(t,"endAt()","Query.endAt()")}}isEqual(e){return Eh(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=bg(this._delegate):e?.source==="server"?t=Pg(this._delegate):t=Sg(this._delegate),t.then(n=>new Cs(this.firestore,new Et(this.firestore._delegate,this._userDataWriter,this._delegate,n._snapshot)))}onSnapshot(...e){let t=Ug(e),n=qg(e,i=>new Cs(this.firestore,new Et(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return kh(this._delegate,t,n)}withConverter(e){return new r(this.firestore,e?this._delegate.withConverter(pi.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},Mh=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new yr(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},Cs=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new wr(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new yr(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new Mh(this._firestore,t))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new yr(this._firestore,n))})}isEqual(e){return Rh(this._delegate,e._delegate)}},mi=class r extends wr{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new Mt(this.firestore,e):null}doc(e){try{return e===void 0?new Mt(this.firestore,Rs(this._delegate)):new Mt(this.firestore,Rs(this._delegate,e))}catch(t){throw ot(t,"doc()","CollectionReference.doc()")}}add(e){return Cg(this._delegate,e).then(t=>new Mt(this.firestore,t))}isEqual(e){return Ih(this._delegate,e._delegate)}withConverter(e){return new r(this.firestore,e?this._delegate.withConverter(pi.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function gr(r){return de(r,ve)}var Oh=class r{constructor(...e){this._delegate=new It(...e)}static documentId(){return new r(Ve.keyField().canonicalString())}isEqual(e){return e=be(e),e instanceof It?this._delegate._internalPath.isEqual(e._internalPath):!1}};var Fh=class r{constructor(e){this._delegate=e}static serverTimestamp(){let e=Vg();return e._methodName="FieldValue.serverTimestamp",new r(e)}static delete(){let e=Dg();return e._methodName="FieldValue.delete",new r(e)}static arrayUnion(...e){let t=Ng(...e);return t._methodName="FieldValue.arrayUnion",new r(t)}static arrayRemove(...e){let t=Mg(...e);return t._methodName="FieldValue.arrayRemove",new r(t)}static increment(e){let t=Og(e);return t._methodName="FieldValue.increment",new r(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var sv={Firestore:Oa,GeoPoint:lr,Timestamp:Pe,Blob:Ma,Transaction:Fa,WriteBatch:La,DocumentReference:Mt,DocumentSnapshot:_r,Query:wr,QueryDocumentSnapshot:yr,QuerySnapshot:Cs,CollectionReference:mi,FieldPath:Oh,FieldValue:Fh,setLogLevel:iv,CACHE_SIZE_UNLIMITED:Wm};function ov(r,e){r.INTERNAL.registerComponent(new zn("firestore-compat",t=>{let n=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(n,i)},"PUBLIC").setServiceProps(Object.assign({},sv)))}function av(r){ov(r,(e,t)=>new Oa(e,t,new Nh)),r.registerVersion(tv,nv)}av(_t);function uv(r,e=Ys){return new on(t=>{let n;return e!=null?e.schedule(()=>{n=r.onSnapshot({includeMetadataChanges:!0},t)}):n=r.onSnapshot({includeMetadataChanges:!0},t),()=>{n?.()}})}function Bg(r,e){return uv(r,e)}function cv(r,e){return Bg(r,e).pipe(to(void 0),Zs(),ze(t=>{let[n,i]=t;return i.exists?n?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function Bh(r,e){return Bg(r,e).pipe(ze(t=>({payload:t,type:"query"})))}var Ua=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let n=this.ref.collection(e),{ref:i,query:s}=Gg(n,t);return new Ba(i,s,this.afs)}snapshotChanges(){return cv(this.ref,this.afs.schedulers.outsideAngular).pipe(rt)}valueChanges(e={}){return this.snapshotChanges().pipe(ze(({payload:t})=>e.idField?su($e({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return an(this.ref.get(e)).pipe(rt)}};function qa(r,e){return Bh(r,e).pipe(to(void 0),Zs(),ze(t=>{let[n,i]=t,s=i.payload.docChanges(),o=s.map(u=>({type:u.type,payload:u}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((u,c)=>{let h=s.find(m=>m.doc.ref.isEqual(u.ref)),f=n?.payload.docs.find(m=>m.ref.isEqual(u.ref));h&&JSON.stringify(h.doc.metadata)===JSON.stringify(u.metadata)||!h&&f&&JSON.stringify(f.metadata)===JSON.stringify(u.metadata)||o.push({type:"modified",payload:{oldIndex:c,newIndex:c,type:"modified",doc:u}})}),o}))}function jg(r,e,t){return qa(r,t).pipe(eo((n,i)=>lv(n,i.map(s=>s.payload),e),[]),Md(),ze(n=>n.map(i=>({type:i.type,payload:i}))))}function lv(r,e,t){return e.forEach(n=>{t.indexOf(n.type)>-1&&(r=hv(r,n))}),r}function Uh(r,e,t,...n){let i=r.slice();return i.splice(e,t,...n),i}function hv(r,e){switch(e.type){case"added":if(!(r[e.newIndex]&&r[e.newIndex].doc.ref.isEqual(e.doc.ref)))return Uh(r,e.newIndex,0,e);break;case"modified":if(r[e.oldIndex]==null||r[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=r.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return Uh(r,e.newIndex,1,e);break;case"removed":if(r[e.oldIndex]&&r[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Uh(r,e.oldIndex,1);break}return r}function zg(r){return(!r||r.length===0)&&(r=["added","removed","modified"]),r}var Ba=class{ref;query;afs;constructor(e,t,n){this.ref=e,this.query=t,this.afs=n}stateChanges(e){let t=qa(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(ze(n=>n.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(to(void 0),Zs(),Oi(([n,i])=>i.length>0||!n),ze(([,n])=>n),rt)}auditTrail(e){return this.stateChanges(e).pipe(eo((t,n)=>[...t,...n],[]))}snapshotChanges(e){let t=zg(e);return jg(this.query,t,this.afs.schedulers.outsideAngular).pipe(rt)}valueChanges(e={}){return Bh(this.query,this.afs.schedulers.outsideAngular).pipe(ze(t=>t.payload.docs.map(n=>e.idField?su($e({},n.data()),{[e.idField]:n.id}):n.data())),rt)}get(e){return an(this.query.get(e)).pipe(rt)}add(e){return this.ref.add(e)}doc(e){return new Ua(this.ref.doc(e),this.afs)}},qh=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?qa(this.query,this.afs.schedulers.outsideAngular).pipe(rt):qa(this.query,this.afs.schedulers.outsideAngular).pipe(ze(t=>t.filter(n=>e.indexOf(n.type)>-1)),Oi(t=>t.length>0),rt)}auditTrail(e){return this.stateChanges(e).pipe(eo((t,n)=>[...t,...n],[]))}snapshotChanges(e){let t=zg(e);return jg(this.query,t,this.afs.schedulers.outsideAngular).pipe(rt)}valueChanges(e={}){return Bh(this.query,this.afs.schedulers.outsideAngular).pipe(ze(n=>n.payload.docs.map(i=>e.idField?$e({[e.idField]:i.id},i.data()):i.data())),rt)}get(e){return an(this.query.get(e)).pipe(rt)}},dv=new tt("angularfire2.enableFirestorePersistence"),fv=new tt("angularfire2.firestore.persistenceSettings"),pv=new tt("angularfire2.firestore.settings"),mv=new tt("angularfire2.firestore.use-emulator");function Gg(r,e=t=>t){return{query:e(r),ref:r}}var Kg=(()=>{class r{schedulers;firestore;persistenceEnabled$;constructor(t,n,i,s,o,u,c,h,f,m,_,v,D,M,N,J,U){this.schedulers=c;let F=mo(t,u,n),ee=f;m&&Vu(F,u,_,D,M,N,v,J),[this.firestore,this.persistenceEnabled$]=go(`${F.name}.firestore`,"AngularFirestore",F.name,()=>{let te=u.runOutsideAngular(()=>F.firestore());if(s&&te.settings(s),ee&&te.useEmulator(...ee),i&&!no(o)){let ne=()=>{try{return an(te.enablePersistence(h||void 0).then(()=>!0,()=>!1))}catch(T){return typeof console<"u"&&console.warn(T),un(!1)}};return[te,u.runOutsideAngular(ne)]}else return[te,un(!1)]},[s,ee,i])}collection(t,n){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=Gg(i,n),u=this.schedulers.ngZone.run(()=>s);return new Ba(u,o,this)}collectionGroup(t,n){let i=n||(o=>o),s=this.firestore.collectionGroup(t);return new qh(i(s),this)}doc(t){let n;typeof t=="string"?n=this.firestore.doc(t):n=t;let i=this.schedulers.ngZone.run(()=>n);return new Ua(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(n){return new(n||r)(ue(fo),ue(po,8),ue(dv,8),ue(pv,8),ue(Fi),ue(jn),ue(ho),ue(fv,8),ue(mv,8),ue(ji,8),ue(Pu,8),ue(Ru,8),ue(Cu,8),ue(xu,8),ue(ku,8),ue(Du,8),ue(Qn,8))};static \u0275prov=cn({token:r,factory:r.\u0275fac,providedIn:"any"})}return r})();var qI=xd(jh());function xs(r){try{return Reflect.metadata("label",{libelle:r})}catch(e){console.error(e)}}var zI=xd(jh()),ja=class{getPropertyLibelle(e,t){try{let n=Reflect.getMetadata("label",this,e);if(Gn(n)){let i=n.libelle;if(ao(t)&&(t="label"),Gd(i)){if(t==="label")return i.label;if(t==="label2")return i.label2;if(t==="label3")return i.label3;if(t==="label4")return i.label4;if(t==="info")return i.info;if(t==="question"&&i.question==!0)return"?";if(t==="unite")return i.unite;if(t==="uniteInfo")return Gn(i.unite)?"en "+i.unite:""}else if(t==="label"||t==="label2"||t==="label3")return i}return null}catch(n){return console.error("Impossible de lire la propri\xE9t\xE9 "+t+" pour : "+this.constructor.name+".",e,n),null}}getPropertyInstance(e){try{let t=Reflect.getMetadata("dataType",this,e)?.libelle;return t||null}catch{return null}}};var Zt=class extends ja{id;nom;prenom;droit;constructor(e,t,n,i){super(),this.id=e||null,this.nom=t||null,this.prenom=n||null,this.droit=i||null}getId(){return this.id}setId(e){this.id=e}getNom(){return this.nom}setNom(e){this.nom=e}getPrenom(){return this.prenom}setPrenom(e){this.prenom=e}getDroit(){return this.droit}setDroit(e){this.droit=e}};Mi([xs("Identifiant")],Zt.prototype,"id",2),Mi([xs("Nom")],Zt.prototype,"nom",2),Mi([xs("Pr\xE9nom")],Zt.prototype,"prenom",2),Mi([xs("Droit")],Zt.prototype,"droit",2);var Qg=class r{constructor(e,t){this.afAuth=e;this.firestore=t}user$=new Js(null);userSelect$=new Js(null);users$=new Js(null);signIn(e,t){return this.afAuth.signInWithEmailAndPassword(e,t)}signUp(e,t){return this.afAuth.createUserWithEmailAndPassword(e,t)}signOut(){return this.user$.next(null),this.userSelect$.next(null),this.afAuth.signOut()}getCurrentUser(){return this.afAuth.authState}getUser(){let e=this.firestore.collection("/user").valueChanges();return Vd([this.afAuth.authState,e,this.user$]).pipe(ze(([t,n,i])=>{if(Gn(i))return i;{let s=n.find(o=>o.id==t?.uid);if(Gn(s)){let o=gu(Zt,s);return this.user$.next(o),o?.getDroit()==10||o?.getDroit()==2?this.getUsers(9).pipe(Xs(u=>Gn(u))).subscribe(u=>{let c=u.find(h=>h.getId()==o.getId());c?this.userSelect$.next(c):this.userSelect$.next(u.find(h=>h.getNom()=="LEFAIX"))}):this.userSelect$.next(o),o}return null}}))}getUsers(e){return this.users$.next(null),ao(e)&&(e=1),this.firestore.collection("/user",t=>{let n=t;return n=n.where("droit",">=",e),n}).valueChanges().pipe(ze(t=>{let n=[];return t?.length>0&&t.forEach(i=>{let s=gu(Zt,i);n.push(s)}),this.users$.next(n),n}))}static \u0275fac=function(t){return new(t||r)(ue(ji),ue(Kg))};static \u0275prov=cn({token:r,factory:r.\u0275fac,providedIn:"root"})};export{wu as a,Hv as b,I_ as c,Qn as d,ho as e,Jv as f,rt as g,Yv as h,Yd as i,Xd as j,fI as k,xs as l,ja as m,gu as n,Qd as o,fo as p,po as q,mo as r,go as s,XT as t,Kg as u,Qg as v};

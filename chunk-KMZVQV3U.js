import{l as a,m as d,n as C,u as y,v as I}from"./chunk-6QQKUJTI.js";import{E,I as R,L as m,l as p,qb as s,y as f}from"./chunk-QXCOODFE.js";import{g as l}from"./chunk-GOLCFQAC.js";var O=(i=>(i.TIMBRE="TIMBRE",i.BLOC="BLOC",i.CARNET="CARNET",i.COLLECTOR="COLLECTOR",i))(O||{});var n=class extends d{annees;acquis;doublon;idBloc;type;user;sort;getAnnees(){return this.annees}setAnnees(e){this.annees=e}getAcquis(){return this.acquis}setAcquis(e){this.acquis=e}getDoublon(){return this.doublon}setDoublon(e){this.doublon=e}getIdBloc(){return this.idBloc}setIdBloc(e){this.idBloc=e}getUser(){return this.user}setUser(e){this.user=e}getType(){return this.type}setType(e){this.type=e}getSort(){return this.sort}setSort(e){this.sort=e}initCritere(){this.setType(["TIMBRE","CARNET","BLOC"])}initCritereBloc(){this.setType(["CARNET","BLOC"])}};l([a("Ann\xE9e")],n.prototype,"annees",2),l([a("Acquis")],n.prototype,"acquis",2),l([a("Doublon")],n.prototype,"doublon",2),l([a("Ident bloc")],n.prototype,"idBloc",2),l([a("Type")],n.prototype,"type",2),l([a("User")],n.prototype,"user",2);var u=class extends d{idUser;key;value;constructor(e,t,r){super(),this.key=e||null,this.value=t||null,this.idUser=r||null}getIdUser(){return this.idUser}setIdUser(e){this.idUser=e}getKey(){return this.key}setKey(e){this.key=e}getValue(){return this.value}setValue(e){this.value=e}};l([a("Ident Utilisateur")],u.prototype,"idUser",2),l([a("Key")],u.prototype,"key",2),l([a("Value")],u.prototype,"value",2);var U=class h{constructor(e,t){this.firestore=e;this.authService=t}timbreCritereModel=new n;timbreCritereBlocModel=new n;getTimbreCritere(e){return this.getPreferencesByKey(e).pipe(f(),p(t=>{if(s(t)){let r=C(n,t.getValue());return e=="timbreCritere"?this.timbreCritereModel=r:e=="blocCritere"&&(this.timbreCritereBlocModel=r),r}return new n}))}getPreferencesByKey(e){let t=new u(e);return this.authService.userSelect$.pipe(f(r=>s(r)),E(r=>s(r)?(t.setIdUser(r.getId()),this.firestore.collection("/preference",i=>this.getRef(i,t)).valueChanges().pipe(f(),p(i=>{if(s(i)&&i?.length>0)return this.constructPreferences(i)[0]}))):null))}getRef(e,t){let r=e;return s(t)&&(s(t.getIdUser())&&(r=r.where("idUser","==",t.getIdUser())),s(t.getKey())&&(r=r.where("key","==",t.getKey()))),r}getPreference(e){return this.firestore.collection("/preference",t=>this.getRef(t,e)).valueChanges()}ajouter(e,t){let r=JSON.stringify(t),i=new u(e,r);this.authService.userSelect$.pipe(f(o=>s(o))).subscribe(o=>{i.setIdUser(o.getId()),this.getPreference(i).pipe(f()).subscribe(c=>{s(c)&&c?.length>0?console.error("pr\xE9f\xE9rence d\xE9j\xE0 existante"):this.firestore.collection("/preference").add(Object.assign(new Object,i)).then(g=>{}).catch(g=>{console.error("Erreur d'ajout :",g)})})})}modifier(e,t){let r=JSON.stringify(t),i=new u(e,r);this.authService.userSelect$.pipe(f(o=>s(o))).subscribe(o=>{i.setIdUser(o.getId()),this.firestore.collection("/preference",c=>this.getRef(c,i)).get().pipe().subscribe(c=>{s(c)&&c?.size>0?c.forEach(g=>{g.ref.update(Object.assign(new Object,i)).then(b=>{}).catch(b=>{console.error("Erreur de modification :",b)})}):this.ajouter(e,t)})})}supprimer(e){let t=new u(e);this.authService.userSelect$.pipe(f(r=>s(r))).subscribe(r=>{t.setIdUser(r.getId()),this.firestore.collection("/preference",i=>this.getRef(i,t)).get().pipe().subscribe(i=>{s(i)&&i?.size>0&&i.forEach(o=>{o.ref.delete().then(c=>{}).catch(c=>{console.error("Erreur de modification :",c)})})})})}supprimerTout(){let e=new u;this.authService.userSelect$.pipe(f(t=>s(t))).subscribe(t=>{e.setIdUser(t.getId()),this.firestore.collection("/preference",r=>this.getRef(r,e)).get().pipe().subscribe(r=>{s(r)&&r?.size>0&&r.forEach(i=>{i.ref.delete().then(o=>{}).catch(o=>{console.error("Erreur de modification :",o)})})})})}constructPreferences(e){let t=[];return e?.length>0&&e.forEach(r=>{t.push(new u(r.key,JSON.parse(r.value),r.idUser))}),t}getAllPreferences(){return this.firestore.collection("/preference",null).valueChanges()}static \u0275fac=function(t){return new(t||h)(m(y),m(I))};static \u0275prov=R({token:h,factory:h.\u0275fac})};export{O as a,n as b,U as c};

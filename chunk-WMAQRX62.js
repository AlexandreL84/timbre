import{a as ne,b as ve,c as Qe,d as Xe,e as Ke,f as Je,g as hi,h as ei,i as et,j as _i,k as ti,l as ii,m as ni,n as oi,o as ri,p as li,q as ai,r as mi}from"./chunk-WZIFF7SJ.js";import{d as Oe,i as Ye}from"./chunk-EXWIHGIO.js";import{A as Ut,B as jt,C as Pt,D as kt,E as qt,F as Vt,G as $t,H as Ht,I as ct,J as Wt,K as zt,M as Ze,N as Gt,O as Zt,P as Yt,Q as ie,R as Qt,S as Xt,T as Kt,U as Jt,V as ye,a as be,b as Ne,c as V,d as $,e as H,g as ee,h as W,i as Bt,j as Et,m as Dt,n as Lt,o as Ot,p as Me,r as He,w as Ge,x as Ft,y as Nt,z as Rt}from"./chunk-ZAK2VQCU.js";import{$a as vt,Ab as X,Ac as he,Bc as _e,Cc as Te,D as pe,Db as K,Dc as Ue,E as Ee,Ea as l,Eb as St,Ec as je,Fa as a,Fc as Pe,G as P,Ga as d,Gc as ke,Ha as F,Hc as qe,Ia as N,Ib as It,Ic as Ve,Jc as At,K as k,Ka as E,L as Ae,Na as f,Pa as c,Pb as st,Q as h,R as _,Sa as yt,Ua as le,Va as ae,Wa as me,Xa as w,Xd as xe,Ya as u,Za as De,Zd as te,_a as A,ab as D,ac as p,ae as We,bb as L,cb as O,d as I,ea as de,fa as Be,fb as Ct,fc as x,fe as ze,ga as s,gc as J,ha as S,hc as se,j,jb as y,k as Z,kb as v,lb as q,ld as $e,nc as Fe,oc as wt,sa as b,v as M,va as m,vc as Re,y as Mt,yb as ue,yc as fe,zb as Le,zc as ge}from"./chunk-P6L542ER.js";import"./chunk-65CH3ZW6.js";import{g as xt,i as T}from"./chunk-GV7GV3NK.js";var C=class extends J{id;idBloc;annee;monnaie;type;yt;image;imageTable;imageZoom;timbreAcquisModel;timbreBlocModel;constructor(e,t,i,n,r,g,Q,ce,ht,_t,Tt){super(),this.id=e||null,this.idBloc=t||null,this.annee=i||null,this.monnaie=n||null,this.type=r||null,this.yt=g||null,this.image=Q||null,this.imageTable=ce||null,this.imageZoom=ht||null,this.timbreAcquisModel=_t||null,this.timbreBlocModel=Tt||null}getId(){return this.id}setId(e){this.id=e}getIdBloc(){return this.idBloc}setIdBloc(e){this.idBloc=e}getAnnee(){return this.annee}setAnnee(e){this.annee=e}getMonnaie(){return this.monnaie}setMonnaie(e){this.monnaie=e}getType(){return this.type}setType(e){this.type=e}getYt(){return this.yt}setYt(e){this.yt=e}getImage(){return this.image}setImage(e){this.image=e}getImageTable(){return this.imageTable}setImageTable(e){this.imageTable=e}getImageZoom(){return this.imageZoom}setImageZoom(e){this.imageZoom=e}getTimbreAcquisModel(){return this.timbreAcquisModel}setTimbreAcquisModel(e){this.timbreAcquisModel=e}getTimbreBlocModel(){return this.timbreBlocModel}setTimbreBlocModel(e){this.timbreBlocModel=e}};T([x("Identifiant")],C.prototype,"id",2),T([x("Identifiant bloc")],C.prototype,"idBloc",2),T([x("Ann\xE9e")],C.prototype,"annee",2),T([x("Monnaie")],C.prototype,"monnaie",2),T([x("Type")],C.prototype,"type",2),T([x("R\xE9ference Yvert Tellier")],C.prototype,"yt",2),T([x("Image")],C.prototype,"image",2),T([x("Image tableau")],C.prototype,"imageTable",2),T([x("Image zoom")],C.prototype,"imageZoom",2),T([x("v\xE9rif")],C.prototype,"timbreAcquisModel",2),T([x("Bloc")],C.prototype,"timbreBlocModel",2);var Ce=class{dossier;nom;alignLabel;detail;file;getDossier(){return this.dossier}setDossier(e){this.dossier=e}getNom(){return this.nom}setNom(e){this.nom=e}getAlignLabel(){return this.alignLabel}setAlignLabel(e){this.alignLabel=e}getDetail(){return this.detail}setDetail(e){this.detail=e}getFile(){return this.file}setFile(e){this.file=e}};var oe=class{key;dossier;maxWidth;maxHeight;getKey(){return this.key}setKey(e){this.key=e}getDossier(){return this.dossier}setDossier(e){this.dossier=e}getMaxWidth(){return this.maxWidth}setMaxWidth(e){this.maxWidth=e}getMaxHeight(){return this.maxHeight}setMaxHeight(e){this.maxHeight=e}};var z=class extends J{annees;acquis;doublon;bloc;getAnnees(){return this.annees}setAnnees(e){this.annees=e}getAcquis(){return this.acquis}setAcquis(e){this.acquis=e}getDoublon(){return this.doublon}setDoublon(e){this.doublon=e}getBloc(){return this.bloc}setBloc(e){this.bloc=e}};T([x("Ann\xE9e")],z.prototype,"annees",2),T([x("Acquis")],z.prototype,"acquis",2),T([x("Doublon")],z.prototype,"doublon",2),T([x("Bloc")],z.prototype,"bloc",2);var R=class extends J{idUser;idTimbre;acquis;doublon;constructor(e,t,i,n){super(),this.idUser=e||null,this.idTimbre=t||null,this.acquis=i||!1,this.doublon=n||!1}getIdUser(){return this.idUser}setIdUser(e){this.idUser=e}getIdTimbre(){return this.idTimbre}setIdTimbre(e){this.idTimbre=e}isAcquis(){return this.acquis}setAcquis(e){this.acquis=e}isDoublon(){return this.doublon}setDoublon(e){this.doublon=e}};T([x("Identifiant Utilisateur")],R.prototype,"idUser",2),T([x("Identifiant timbre")],R.prototype,"idTimbre",2),T([x("Acquis")],R.prototype,"acquis",2),T([x("Doublon")],R.prototype,"doublon",2);var B=class extends J{id;annee;monnaie;image;imageTable;imageZoom;constructor(e,t,i,n,r,g){super(),this.id=e||null,this.annee=t||null,this.monnaie=i||null,this.image=n||null,this.imageTable=r||null,this.imageZoom=g||null}getId(){return this.id}setId(e){this.id=e}getAnnee(){return this.annee}setAnnee(e){this.annee=e}getMonnaie(){return this.monnaie}setMonnaie(e){this.monnaie=e}getImage(){return this.image}setImage(e){this.image=e}getImageTable(){return this.imageTable}setImageTable(e){this.imageTable=e}getImageZoom(){return this.imageZoom}setImageZoom(e){this.imageZoom=e}};T([x("Identifiant")],B.prototype,"id",2),T([x("Ann\xE9e")],B.prototype,"annee",2),T([x("Monnaie")],B.prototype,"monnaie",2),T([x("Image")],B.prototype,"image",2),T([x("Image tableau")],B.prototype,"imageTable",2),T([x("Image zoom")],B.prototype,"imageZoom",2);var re=class o{basePath="/timbres";basePathAcquis="/timbres_acquis";basePathBloc="/timbres_bloc";dossierImage="timbres/";static \u0275fac=function(t){return new(t||o)};static \u0275prov=pe({token:o,factory:o.\u0275fac})};var G=class o{constructor(e,t,i){this.firestore=e;this.timbreUtilsService=t;this.uploadService=i}basePathBloc="/timbres_bloc";heigthTable=50;widthTimbre=100;heightTimbre=100;widthTimbreZoom=500;heightTimbreZoom=500;timbresBlocModel$=new I(null);upload(e,t){let i=this.widthTimbre,n=this.heightTimbre;return t=="table"?(i=i*(this.heigthTable/n),n=this.heigthTable):t=="zoom"&&(i=i*(this.heightTimbreZoom/n),n=this.heightTimbreZoom),this.uploadService.processAndUploadImage(e?.getImage(),i,n,"bloc",this.getDossier(e,t))}getDossier(e,t){let i=this.timbreUtilsService.dossierImage+"/"+e.getAnnee();return p(t)&&(i=i+"/"+t),i=i+"/bloc/"+e.getId(),i}getBlocByIdAsync(e){return this.firestore.collection(this.basePathBloc,t=>t.where("id","==",e)).valueChanges().pipe(j(t=>se(B,t[0])))}getBlocsAsync(e){return this.timbresBlocModel$.next(null),this.firestore.collection(this.basePathBloc,t=>{let i=t;return p(e)&&p(e.getAnnees())&&e.getAnnees()?.length>0&&(i=i.where("annee","in",e.getAnnees())),i}).valueChanges().pipe(M(),j(t=>this.constructBlocs(t)))}constructBlocs(e){let t=[];return e?.length>0&&e.forEach(i=>{let n=se(B,i);t.push(n)}),this.timbresBlocModel$.next(t),t}getMaxIdentAsync(){let e=this.firestore.collection(this.basePathBloc).ref.orderBy("id","desc").limit(1);return Oe(e).pipe(j(t=>t.length>0?t[0].id+1:1))}addBlocSansId(e){this.getMaxIdentAsync().pipe(M()).subscribe(t=>{e.setId(t),this.addBloc(e)})}addBloc(e){this.firestore.collection(this.basePathBloc).add(Object.assign(new Object,e)),this.getBlocsAsync().pipe(M()).subscribe(t=>{})}modifierBloc(e){this.firestore.collection(this.basePathBloc).ref.where("id","==",e.getId()).get().then(t=>{t.forEach(i=>{i.ref.update(Object.assign(new Object,e)),this.getBlocsAsync().pipe(M()).subscribe(n=>{})})}).catch(t=>{console.error("Erreur de mise \xE0 jour:",t)})}deleteBloc(e){this.firestore.collection(this.basePathBloc).ref.where("id","==",e.getId()).get().then(t=>{t.forEach(i=>{i.ref.delete(),this.getBlocsAsync().pipe(M()).subscribe(n=>{})})}).catch(t=>{console.error("Erreur de suppression :",t)})}getBouchon(){let e=new B;return e.setAnnee(new Date().getFullYear()),e.setMonnaie("E"),e}static \u0275fac=function(t){return new(t||o)(P(Fe),P(re),P(ne))};static \u0275prov=pe({token:o,factory:o.\u0275fac})};var U=class o{constructor(e,t,i,n,r){this.firestore=e;this.authService=t;this.timbreBlocService=i;this.timbreUtilsService=n;this.uploadService=r}basePath="/timbres";basePathAcquis="/timbres_acquis";basePathBloc="/timbres_bloc";heigthTable=50;widthTimbre=100;heightTimbre=100;widthTimbreZoom=500;heightTimbreZoom=500;total$=new I(0);timbres$=new I(null);getAnneesAsync(){return this.firestore.collection(this.basePath,e=>{let t=e;return t=t.orderBy("annee","desc"),t}).valueChanges().pipe(j(e=>{let t=e.map(i=>Number(i.annee)).filter(i=>p(i)&&i!=0);return Array.from(new Set(t))}))}getTimbre(e){return this.firestore.collection(this.basePath,t=>t.where("id","==",e)).valueChanges()}getTimbreByIdAsync(e){return Z([this.getTimbre(e),this.timbreBlocService.getBlocsAsync()]).pipe(j(([t,i])=>this.constructTimbre(t[0],null,i)))}getNbTimbres(e){this.total$.next(null),this.getAllTimbres(e).pipe(M()).subscribe(t=>{this.total$.next(t?.length)})}getTimbres(e){this.getNbTimbres(),this.timbres$.next(null),Z([this.getAllTimbres(e),this.getTimbreAcquis(),this.timbreBlocService.getBlocsAsync(e)]).pipe(M()).subscribe(([t,i,n])=>{this.constructTimbres(t,i,n,e)})}getAllTimbres(e){return this.firestore.collection(this.basePath,t=>{let i=t;return p(e)&&(p(e.getAnnees())&&e.getAnnees()?.length>0&&(i=i.where("annee","in",e.getAnnees())),p(e.getBloc())&&e.getBloc()!="TOUS"&&(i=i.where("idBloc",e.getBloc()!="NON"?"!=":"==",null))),i=i.orderBy("id","asc"),i}).valueChanges()}getMaxIdentAsync(){let e=this.firestore.collection(this.basePath).ref.orderBy("id","desc").limit(1);return Oe(e).pipe(j(t=>t.length>0?t[0].id+1:1))}constructTimbre(e,t,i){let n=se(C,e);if(p(i)){let r=i.find(g=>g.getId()==n?.getIdBloc());p(r)&&n.setTimbreBlocModel(r)}if(p(t)){let r=t.find(g=>g.idTimbre==n.getId());p(r)?n.setTimbreAcquisModel(se(R,r)):n.setTimbreAcquisModel(new R)}return n}constructTimbres(e,t,i,n){let r=[];e?.length>0&&e.forEach(g=>{let Q=this.constructTimbre(g,t,i),ce=!0;p(n)&&(p(n.getAcquis())&&!(n.getAcquis()=="TOUS"||n.getAcquis()=="OUI"&&Q.getTimbreAcquisModel().isAcquis()||n.getAcquis()=="NON"&&!Q.getTimbreAcquisModel().isAcquis())&&(ce=!1),p(n.getDoublon())&&!(n.getDoublon()=="TOUS"||n.getDoublon()=="OUI"&&Q.getTimbreAcquisModel().isDoublon()||n.getDoublon()=="NON"&&!Q.getTimbreAcquisModel().isDoublon())&&(ce=!1)),ce==!0&&r.push(Q)}),this.timbres$.next(r)}getTimbreAcquis(){return this.authService.getUser().pipe(M(),Mt(e=>p(e)?this.getTimbreAcquisByUser(e.getId()).pipe(M(),j(t=>t)):null))}getTimbreAcquisByUser(e){return this.firestore.collection(this.basePathAcquis,t=>t.where("idUser","==",e)).valueChanges()}getTimbreBlocById(e){return this.firestore.collection(this.basePathBloc,t=>t.where("id","==",e)).valueChanges().pipe(j(t=>se(B,t[0])))}acquis(e,t){return this.authService.getUser().pipe(M(i=>p(i))).subscribe(i=>{if(p(e?.getTimbreAcquisModel()?.getIdUser()))this.firestore.collection(this.basePathAcquis).ref.where("idTimbre","==",e.getId()).where("idUser","==",i.getId()).get().then(n=>{n.forEach(r=>{let g=e.getTimbreAcquisModel();t?(g.setAcquis(!0),g.setDoublon(!g.isDoublon())):(g.setAcquis(!g.isAcquis()),g.isAcquis()||g.setDoublon(!1)),r.ref.update(Object.assign(new Object,g))})}).catch(n=>{console.error("Erreur de mise \xE0 jour:",n)});else{let n=new R;n.setIdUser(i.getId()),n.setIdTimbre(e.getId()),n.setAcquis(!0),n.setDoublon(t),e.setTimbreAcquisModel(n),this.firestore.collection(this.basePathAcquis).add(Object.assign(new Object,n))}})}addTimbreSansId(e){this.getMaxIdentAsync().pipe(M()).subscribe(t=>{e.setId(t),p(e.getIdBloc())&&(e.setAnnee(null),e.setMonnaie(null)),this.addTimbre(e)})}addTimbre(e){e.setTimbreAcquisModel(null),e.setTimbreBlocModel(null),this.firestore.collection(this.basePath).add(Object.assign(new Object,e)),this.getTimbres()}modifierTimbre(e){e.setTimbreBlocModel(null),e.setTimbreAcquisModel(null),this.firestore.collection(this.basePath).ref.where("id","==",e.getId()).get().then(t=>{t.forEach(i=>{i.ref.update(Object.assign(new Object,e)),this.getTimbres()})}).catch(t=>{console.error("Erreur de mise \xE0 jour:",t)})}deleteTimbre(e){this.authService.getUser().pipe(M(t=>p(t))).subscribe(t=>{p(e?.getTimbreAcquisModel()?.getIdUser())&&this.firestore.collection(this.basePathAcquis).ref.where("idTimbre","==",e.getId()).where("idUser","==",t.getId()).get().then(i=>{i.forEach(n=>{n.ref.delete()})}),this.firestore.collection(this.basePath).ref.where("id","==",e.getId()).get().then(i=>{i.forEach(n=>{n.ref.delete(),this.getTimbres()})}).catch(i=>{console.error("Erreur de suppression :",i)})})}getBouchon(){let e=new C;return e.setAnnee(new Date().getFullYear()),e.setMonnaie("E"),e.setType(""),e.setYt(""),e}upload(e,t){let i=this.widthTimbre,n=this.heightTimbre;return t=="table"?(i=i*(this.heigthTable/n),n=this.heigthTable):t=="zoom"&&(i=i*(this.heightTimbreZoom/n),n=this.heightTimbreZoom),this.uploadService.processAndUploadImage(e?.getImage(),i,n,e?.getId(),this.getDossier(e,t))}getDossier(e,t){let i=this.timbreUtilsService.dossierImage+"/";return p(e.getIdBloc())?i=i+e.getTimbreBlocModel().getAnnee():i=i+e.getAnnee(),p(t)&&(i=i+"/"+t),p(e.getIdBloc())&&(i=i+"/bloc/"+e.getIdBloc()),i}static \u0275fac=function(t){return new(t||o)(P(Fe),P(wt),P(G),P(re),P(ne))};static \u0275prov=pe({token:o,factory:o.\u0275fac})};var Di=["canvas"];function Li(o,e){if(o&1&&(l(0,"span",6)(1,"b"),u(2),a()()),o&2){let t=c();s(2),A("N\xB0",t.timbreModel==null?null:t.timbreModel.getId(),"")}}function Oi(o,e){o&1&&d(0,"lib-spinner",7),o&2&&m("textSpec","Chargement en cours ...")}function Fi(o,e){if(o&1&&(d(0,"mat-error",29),y(1,"async")),o&2){let t=c(2);m("innerHTML",v(1,1,t.messageError$),de)}}function Ni(o,e){if(o&1&&(l(0,"mat-option",18),u(1),a()),o&2){let t=e.$implicit;m("value",t),s(),vt(" ",t.getAnnee()," - ",t.getId()," ")}}function Ri(o,e){if(o&1){let t=E();l(0,"img",30),f("click",function(){let n;h(t);let r=c(2);return _(r.utilsService.zoom(r.timbreModel==null||(n=r.timbreModel.getTimbreBlocModel())==null?null:n.getImageZoom()))}),a()}if(o&2){let t,i=c(2);m("src",i.timbreModel==null||(t=i.timbreModel.getTimbreBlocModel())==null?null:t.getImage(),Be)}}function Ui(o,e){if(o&1){let t=E();l(0,"form",8,1),f("ngSubmit",function(){h(t);let n=w(1),r=c();return _(r.valider(n))}),l(2,"div",9),b(3,Fi,2,3,"mat-error",10),y(4,"async"),l(5,"div",11)(6,"div",12)(7,"label"),d(8,"lib-libelle-model",13),a(),l(9,"input",14),O("ngModelChange",function(n){h(t);let r=c();return L(r.timbreModel.annee,n)||(r.timbreModel.annee=n),_(n)}),f("ngModelChange",function(n){h(t);let r=c();return _(r.changeAnnee(n))}),a()(),l(10,"div",15)(11,"label"),d(12,"lib-libelle-model",13),a(),l(13,"div",16)(14,"mat-select",17),y(15,"async"),f("ngModelChange",function(n){h(t);let r=c();return _(r.changeBloc(n))}),d(16,"mat-option",18),b(17,Ni,2,3,"mat-option",19),y(18,"async"),a(),b(19,Ri,1,1,"img",20),a()()(),l(20,"div",11)(21,"div",12)(22,"label"),d(23,"lib-libelle-model",13),a(),l(24,"input",21),O("ngModelChange",function(n){h(t);let r=c();return L(r.timbreModel.type,n)||(r.timbreModel.type=n),_(n)}),a()(),l(25,"div",12)(26,"label"),d(27,"lib-libelle-model",13),a(),l(28,"input",22),O("ngModelChange",function(n){h(t);let r=c();return L(r.timbreModel.monnaie,n)||(r.timbreModel.monnaie=n),_(n)}),a()()(),l(29,"div",11)(30,"div",12)(31,"label"),d(32,"lib-libelle-model",13),a(),l(33,"input",23),O("ngModelChange",function(n){h(t);let r=c();return L(r.timbreModel.yt,n)||(r.timbreModel.yt=n),_(n)}),a()(),d(34,"div",24),a(),l(35,"lib-upload",25),f("outPutObject",function(n){h(t);let r=c();return _(r.timbreModel=n)}),a()(),l(36,"div",26)(37,"button",27),f("click",function(){h(t);let n=c();return _(n.close())}),u(38," Annuler "),a(),l(39,"button",28),u(40," Enregistrer "),a()()()}if(o&2){let t,i,n=w(1),r=c();m("ngClass",n!=null&&n.submitted?"red-color":"blue-color"),s(3),m("ngIf",v(4,31,r.messageError$)),s(5),m("object",r.timbreModel)("key","annee"),s(),D("ngModel",r.timbreModel.annee),m("max",r.maxAnnee)("zMax",r.maxAnnee)("disabled",!!(r.timbreModel!=null&&r.timbreModel.getId())),s(3),m("object",r.timbreModel)("key","timbreBlocModel"),s(2),m("ngModel",r.timbreModel.getTimbreBlocModel())("placeholder","Choix bloc")("disabled",!!(r.timbreModel!=null&&r.timbreModel.getId())||((t=v(15,33,r.timbreBlocService.timbresBlocModel$))==null?null:t.length)<=0),s(2),m("value",null),s(),m("ngForOf",v(18,35,r.timbreBlocService.timbresBlocModel$)),s(2),m("ngIf",r.timbreModel==null||(i=r.timbreModel.getTimbreBlocModel())==null?null:i.getImage()),s(4),m("object",r.timbreModel)("key","type"),s(),D("ngModel",r.timbreModel.type),s(3),m("object",r.timbreModel)("key","monnaie"),s(),D("ngModel",r.timbreModel.monnaie),m("disabled",!!r.timbreModel.getTimbreBlocModel()),s(4),m("object",r.timbreModel)("key","yt"),s(),D("ngModel",r.timbreModel.yt),s(2),m("object",r.timbreModel)("key","image")("zoom",r.timbreModel.getImageZoom())("maxWidth",r.timbreService.widthTimbre)("maxHeight",r.timbreService.heightTimbre)}}var Se=class o{constructor(e,t,i,n,r){this.httpResponseHandlerService=e;this.dialogRef=t;this.timbreService=i;this.timbreBlocService=n;this.utilsService=r}canvas;messageError$=new I(null);load$=new I(null);id;maxAnnee=new Date().getFullYear();timbreModel=new C;fileUploadModel=new Ce;ngOnInit(){this.initUpload(),this.load$.next(!1),p(this.id)?this.timbreService.getTimbreByIdAsync(this.id).subscribe(e=>{this.timbreModel=e,p(e.getTimbreBlocModel())&&(this.timbreModel.setAnnee(e.getTimbreBlocModel().getAnnee()),this.timbreModel.setMonnaie(e.getTimbreBlocModel().getMonnaie())),this.load$.next(!0)}):(this.timbreModel.setAnnee(new Date().getFullYear()),this.timbreModel.setMonnaie("E"),this.load$.next(!0)),this.changeAnnee(this.timbreModel.getAnnee())}initUpload(){this.fileUploadModel.setDossier("test"),this.fileUploadModel.setNom(new Date().getTime()?.toString());let e=new oe;e.setMaxWidth(this.timbreService.widthTimbre),e.setMaxHeight(this.timbreService.heightTimbre),e.setDossier("autre");let t=new oe;t.setMaxWidth(this.timbreService.widthTimbreZoom),t.setMaxHeight(this.timbreService.heightTimbreZoom),t.setDossier("zoom"),this.fileUploadModel.setDetail([e,t])}valider(e){if(this.messageError$.next(null),e?.valid)if(p(this.timbreModel.getImage()))this.saveData();else{this.messageError$.next("Veuillez s\xE9lectionner une image");return}}saveData(){this.load$.next(!1),p(this.timbreModel.getId())?this.save():this.addTimbre()}addTimbre(){this.timbreService.getMaxIdentAsync().pipe(M()).subscribe(e=>{this.timbreModel.setId(e),this.save(!0)})}save(e){try{Z([this.timbreService.upload(this.timbreModel,"autre"),this.timbreService.upload(this.timbreModel,"table"),this.timbreService.upload(this.timbreModel,"zoom")]).pipe(M(([t,i,n])=>p(t)&&p(n)&&p(i))).subscribe(([t,i,n])=>{p(i)&&i!="nok"&&this.timbreModel.setImage(i),p(t)&&t!="nok"&&this.timbreModel.setImageTable(t),p(n)&&n!="nok"&&this.timbreModel.setImageZoom(n),e?this.timbreService.addTimbre(this.timbreModel):this.timbreService.modifierTimbre(this.timbreModel),this.httpResponseHandlerService.showNotificationSuccess("Transaction termin\xE9e","Votre timbre a bien \xE9t\xE9 modifi\xE9e."),this.load$.next(!0),this.dialogRef.close()})}catch{this.httpResponseHandlerService.showNotificationError("Transaction non aboutie","Votre timbre n'a pas pu \xEAtre modifi\xE9."),this.load$.next(!0)}}close(){this.dialogRef.close()}changeAnnee(e){if(this.timbreModel.setTimbreBlocModel(null),p(e)){let t=new z;t.setAnnees([e]),this.timbreBlocService.getBlocsAsync(t).pipe(M()).subscribe(i=>{})}}changeBloc(e){p(e)?(this.timbreModel.setIdBloc(e.getId()),this.timbreModel.setTimbreBlocModel(e),this.timbreModel.setMonnaie(e.getMonnaie())):(this.timbreModel.setIdBloc(null),this.timbreModel.setTimbreBlocModel(null),this.timbreModel.setMonnaie("E"))}static \u0275fac=function(t){return new(t||o)(S(Ye),S(Me),S(U),S(G),S(ve))};static \u0275cmp=k({type:o,selectors:[["app-timbre-modifier"]],viewQuery:function(t,i){if(t&1&&le(Di,5),t&2){let n;ae(n=me())&&(i.canvas=n.first)}},decls:9,vars:6,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],["class","accent",4,"ngIf"],[3,"ngIf","ngIfElse"],[1,"accent"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","space-between stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","column","fxLayoutGap","20px",1,"bloc-modal"],[3,"innerHTML",4,"ngIf"],["fxLayout","row","fxLayout.lt-lg","column","fxLayoutGap","30px","fxLayoutGap.lt-lg","5px"],["fxLayout","column",1,"form-input"],[3,"object","key"],["name","page","type","number","minlength","4","maxlength","4","min","1900","zMin","1900","required","","zControl","",1,"annee",2,"width","60px !important",3,"ngModelChange","ngModel","max","zMax","disabled"],["fxLayout","column",1,"form-input","select"],["fxLayout","row","fxLayoutGap","15px"],["name","bloc",2,"width","120px !important",3,"ngModelChange","ngModel","placeholder","disabled"],[1,"selectMin",3,"value"],["class","selectMin",3,"value",4,"ngFor","ngForOf"],["style","max-height: 40px","class","click",3,"src","click",4,"ngIf"],["name","type","type","text","trim","","zControl","",3,"ngModelChange","ngModel"],["name","monnaie","type","text","trim","","minlength","1","maxlength","2","required","","zControl","",2,"width","25px !important",3,"ngModelChange","ngModel","disabled"],["name","yt","type","text","trim","","zControl","",3,"ngModelChange","ngModel"],["fxHide.lt-lg","","fxLayout","column",1,"form-input"],[3,"outPutObject","object","key","zoom","maxWidth","maxHeight"],["fxLayout","row","fxLayoutGap","10px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"],[3,"innerHTML"],[1,"click",2,"max-height","40px",3,"click","src"]],template:function(t,i){if(t&1&&(l(0,"div",2)(1,"div",3)(2,"span"),u(3),a(),b(4,Li,3,1,"span",4),a(),b(5,Oi,1,1,"ng-template",5),y(6,"async"),b(7,Ui,41,37,"ng-template",null,0,q),a()),t&2){let n=w(8);s(3),A("",i.timbreModel!=null&&i.timbreModel.getId()?"MODIFICATION":"AJOUT"," "),s(),m("ngIf",i.timbreModel==null?null:i.timbreModel.getId()),s(),m("ngIf",v(6,4,i.load$)==!1)("ngIfElse",n)}},dependencies:[te,xe,We,$e,ue,Le,X,V,$,W,ee,H,Ne,be,Te,Re,Ue,fe,ge,ke,qe,Ve,Pe,je,_e,he,ie,ye,Ze,Qe,Xe,Ke,Je,K],encapsulation:2})};var fi=xt(hi());var ui=xt(_i());var ji=()=>[10,20,50,100];function Pi(o,e){if(o&1&&(l(0,"mat-option",8),u(1),a()),o&2){let t=e.$implicit;m("value",t),s(),A(" ",t," ")}}function ki(o,e){if(o&1&&(l(0,"th",40),d(1,"lib-libelle-model",41),a()),o&2){let t=c();s(),m("object",t.timbre)("key","image")}}function qi(o,e){if(o&1){let t=E();l(0,"img",44),f("click",function(){h(t);let n=c().$implicit,r=c();return _(r.utilsService.zoom(n==null?null:n.getImageZoom()))}),a()}if(o&2){let t=c().$implicit;m("src",t==null?null:t.getImageTable(),Be)}}function Vi(o,e){if(o&1&&(l(0,"td",42),b(1,qi,1,1,"img",43),a()),o&2){let t=e.$implicit;s(),m("ngIf",t==null?null:t.getImageTable())}}function $i(o,e){if(o&1&&(l(0,"th",45),d(1,"lib-libelle-model",46),a()),o&2){let t=c();s(),m("object",t.timbre)("key","id")}}function Hi(o,e){if(o&1&&(l(0,"td",47),u(1),a()),o&2){let t=e.$implicit;s(),A(" ",t==null?null:t.getId()," ")}}function Wi(o,e){if(o&1&&(l(0,"th",45),d(1,"lib-libelle-model",46),a()),o&2){let t=c();s(),m("object",t.timbre)("key","annee")}}function zi(o,e){if(o&1&&u(0),o&2){let t,i=c().$implicit;A(" ",i==null||(t=i.getTimbreBlocModel())==null?null:t.getAnnee()," ")}}function Gi(o,e){if(o&1&&u(0),o&2){let t=c().$implicit;A(" ",t==null?null:t.getAnnee()," ")}}function Zi(o,e){if(o&1&&(l(0,"td",47),b(1,zi,1,1,"ng-template",48)(2,Gi,1,1,"ng-template",null,0,q),a()),o&2){let t=e.$implicit,i=w(3);s(),m("ngIf",t==null?null:t.getIdBloc())("ngIfElse",i)}}function Yi(o,e){if(o&1&&(l(0,"th",49),d(1,"lib-libelle-model",46),a()),o&2){let t=c();s(),m("object",t.timbre)("key","idBloc")}}function Qi(o,e){if(o&1){let t=E();l(0,"img",44),f("click",function(){let n;h(t);let r=c(2).$implicit,g=c();return _(g.utilsService.zoom(r==null||(n=r.getTimbreBlocModel())==null?null:n.getImageZoom()))}),a()}if(o&2){let t,i=c(2).$implicit;m("src",i==null||(t=i.getTimbreBlocModel())==null?null:t.getImageTable(),Be)}}function Xi(o,e){if(o&1&&b(0,Qi,1,1,"img",43),o&2){let t,i=c().$implicit;m("ngIf",i==null||(t=i.getTimbreBlocModel())==null?null:t.getImage())}}function Ki(o,e){o&1&&u(0," Non ")}function Ji(o,e){if(o&1&&(l(0,"td",47),b(1,Xi,1,1,"ng-template",48)(2,Ki,1,0,"ng-template",null,0,q),a()),o&2){let t=e.$implicit,i=w(3);s(),m("ngIf",t==null?null:t.getIdBloc())("ngIfElse",i)}}function en(o,e){if(o&1&&(l(0,"th",50),d(1,"lib-libelle-model",46),a()),o&2){let t=c();s(),m("object",t.timbre)("key","monnaie")}}function tn(o,e){if(o&1&&u(0),o&2){let t,i=c().$implicit;A(" ",(i==null||(t=i.getTimbreBlocModel())==null?null:t.getMonnaie())=="E"?"\u20AC":"Francs"," ")}}function nn(o,e){if(o&1&&u(0),o&2){let t=c().$implicit;A(" ",(t==null?null:t.getMonnaie())=="E"?"\u20AC":"Francs"," ")}}function on(o,e){if(o&1&&(l(0,"td",51),b(1,tn,1,1,"ng-template",48)(2,nn,1,1,"ng-template",null,0,q),a()),o&2){let t=e.$implicit,i=w(3);s(),m("ngIf",t==null?null:t.getIdBloc())("ngIfElse",i)}}function rn(o,e){if(o&1&&(l(0,"th",50),d(1,"lib-libelle-model",46),a()),o&2){let t=c();s(),m("object",t.timbre)("key","type")}}function ln(o,e){if(o&1&&(l(0,"td",51),u(1),a()),o&2){let t=e.$implicit;s(),A(" ",t==null?null:t.getType()," ")}}function an(o,e){if(o&1&&(l(0,"th",50),d(1,"lib-libelle-model",46),a()),o&2){let t=c();s(),m("object",t.timbre)("key","yt")}}function mn(o,e){if(o&1&&(l(0,"td",51),u(1),a()),o&2){let t=e.$implicit;s(),A(" ",t==null?null:t.getYt()," ")}}function sn(o,e){if(o&1&&(l(0,"th",45),d(1,"lib-libelle-model",46),a()),o&2){let t=c();s(),m("object",t.timbre==null?null:t.timbre.getTimbreAcquisModel())("key","acquis")}}function cn(o,e){if(o&1){let t=E();l(0,"td",42)(1,"lib-icon",52),f("click",function(){let n=h(t).$implicit,r=c();return _(r.acquis(n))}),a()()}if(o&2){let t,i,n,r=e.$implicit,g=c();s(),m("classIcone",!(r==null||(t=r.getTimbreAcquisModel())==null)&&t.isAcquis()?"accent":"primary")("type",g.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",!(r==null||(i=r.getTimbreAcquisModel())==null)&&i.isAcquis()?g.FontAwesomeEnum.CIRCLE_MINUS:g.FontAwesomeEnum.CIRCLE_PLUS)("info",!(r==null||(n=r.getTimbreAcquisModel())==null)&&n.isAcquis()?"pas acquis":"acquis")}}function pn(o,e){if(o&1&&(l(0,"th",45),d(1,"lib-libelle-model",46),a()),o&2){let t=c();s(),m("object",t.timbre==null?null:t.timbre.getTimbreAcquisModel())("key","doublon")}}function dn(o,e){if(o&1){let t=E();l(0,"td",42)(1,"lib-icon",52),f("click",function(){let n=h(t).$implicit,r=c();return _(r.doublon(n))}),a()()}if(o&2){let t,i,n,r=e.$implicit,g=c();s(),m("classIcone",!(r==null||(t=r.getTimbreAcquisModel())==null)&&t.isDoublon()?"accent":"primary")("type",g.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",!(r==null||(i=r.getTimbreAcquisModel())==null)&&i.isDoublon()?g.FontAwesomeEnum.CIRCLE_MINUS:g.FontAwesomeEnum.CIRCLE_PLUS)("info",!(r==null||(n=r.getTimbreAcquisModel())==null)&&n.isDoublon()?"pas en double":"en double")}}function un(o,e){if(o&1&&(l(0,"th",53),d(1,"lib-icon",54),a()),o&2){let t=c();s(),m("type",t.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",t.FontAwesomeEnum.PENCIL)("info","Modifier")}}function bn(o,e){if(o&1){let t=E();l(0,"td",42)(1,"lib-icon",55),f("click",function(){let n=h(t).$implicit,r=c();return _(r.modifierTimbre(n))}),a()()}if(o&2){let t=c();s(),m("type",t.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",t.FontAwesomeEnum.PENCIL)("info","Modifier")}}function fn(o,e){if(o&1&&(l(0,"th",53),d(1,"lib-icon",54),a()),o&2){let t=c();s(),m("type",t.FontAwesomeTypeEnum.TYPE_SOLID)("icone",t.FontAwesomeEnum.TRASH)("info","Modifier")}}function gn(o,e){if(o&1){let t=E();l(0,"td",42)(1,"lib-icon",55),f("click",function(){let n=h(t).$implicit,r=c();return _(r.deleteTimbre(n))}),a()()}if(o&2){let t=c();s(),m("type",t.FontAwesomeTypeEnum.TYPE_SOLID)("icone",t.FontAwesomeEnum.TRASH)("info","Supprimer")}}function hn(o,e){o&1&&d(0,"tr",56)}function _n(o,e){o&1&&d(0,"tr",57)}var Ie=class o{constructor(e,t,i){this.timbreService=e;this.dialog=t;this.utilsService=i;this.dataSource=new ct([])}paginator;sort;timbres$;total$;modif=!0;load$=new I(!1);dataSource=new ct;displayedColumns;timbreCritereModel=new z;timbre=new C;annees$;FontAwesomeEnum=Lt;FontAwesomeTypeEnum=Gt;ngOnInit(){this.annees$=this.timbreService.getAnneesAsync(),this.timbre.setTimbreAcquisModel(new R),this.displayedColumns=["image","id","annee","idBloc","monnaie","type","yt","acquis","doublon"],this.modif&&this.displayedColumns.push("modifier","supprimer"),this.load$.next(!1),this.timbres$.subscribe(e=>{this.dataSource.data=e,this.load$.next(!0)})}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.sort.active="idBloc",this.sort.direction="asc",this.dataSource.sort=this.sort}sortData(e){p(e)&&(this.dataSource.sort=this.sort)}filtreByCritere(){this.timbreCritereModel.getAcquis()=="NON"&&this.timbreCritereModel.setDoublon("TOUS"),this.timbreService.getTimbres(this.timbreCritereModel)}applyFilter(e){let t=e.target.value;this.dataSource.filter=t.trim().toLowerCase()}acquis(e){this.timbreService.acquis(e,!1)}doublon(e){this.timbreService.acquis(e,!0)}modifierTimbre(e){let t=this.dialog.open(Se,{height:"75vh",maxHeight:"750px",width:"30%"});t.componentInstance.id=e.getId(),t.afterClosed().subscribe(()=>{t.close()})}deleteTimbre(e){let t=this.dialog.open(ti,{maxHeight:"95vh",data:{titre:"Confirmation",message:"Souhaitez-vous supprimer le timbre <b>n\xB0 "+e?.getId()+"</b> ?",btnDroite:"Oui",btnGauche:"Non"}});t.afterClosed().subscribe(()=>{t.componentInstance.data.resultat==="valider"&&this.timbreService.deleteTimbre(e)})}exportTable(){let e=et.json_to_sheet(this.dataSource.data),t=et.book_new();et.book_append_sheet(t,e,"Donn\xE9es");let i=ei(t,{bookType:"xlsx",type:"array"}),n=new Blob([i],{type:"application/octet-stream"});(0,ui.saveAs)(n,"export_timbres.xlsx")}generatePDFByImage(){let e="https://firebasestorage.googleapis.com/v0/b/book-f941b.appspot.com/o/AF.png?alt=media&token=a1039f78-3cff-41ab-8569-ea1b2cefe2c1";this.generatePDF(null)}generatePDF(e){}static \u0275fac=function(t){return new(t||o)(S(U),S(He),S(ve))};static \u0275cmp=k({type:o,selectors:[["app-timbre-resultat"]],viewQuery:function(t,i){if(t&1&&(le(ze,5),le(Ge,5)),t&2){let n;ae(n=me())&&(i.paginator=n.first),ae(n=me())&&(i.sort=n.first)}},inputs:{timbres$:"timbres$",total$:"total$",modif:"modif"},decls:80,vars:41,consts:[["noBloc",""],["fxFlexFill","",3,"fxHide","textSpec"],[3,"fxHide"],["fxLayout","row","fxLayoutAlign","space-between center","fxLayoutGap","15px"],["fxFlex","",2,"font-size","1.2em"],[1,"bold"],["fxLayout","row","fxLayoutAlign","end center",1,"form-input","select",2,"width","100px"],["name","acquis",3,"ngModelChange","ngModel","placeholder"],[1,"selectMin",3,"value"],["name","doublon",1,"scrollBarAccent",3,"ngModelChange","ngModel","placeholder"],["name","bloc",1,"scrollBarAccent",3,"ngModelChange","ngModel","placeholder"],["fxLayout","row","fxLayoutAlign","end center",1,"form-input","select",2,"width","150px"],["name","anneeSelect","multiple","",3,"ngModelChange","ngModel","placeholder"],["class","selectMin",3,"value",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","end center",1,"form-input",2,"width","200px","min-height","55px","height","55px"],["placeholder","Filtrer les donn\xE9es","type","text",3,"input"],[1,"primary","click",2,"font-size","1.7em",3,"click","type","icone","info"],["id","pdf-content","mat-table","","matSort","",3,"matSortChange","dataSource"],["matColumnDef","image"],["mat-header-cell","","class","image",4,"matHeaderCellDef"],["mat-cell","","class","alignCenter",4,"matCellDef"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","annee"],["matColumnDef","idBloc"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","monnaie"],["mat-header-cell","","mat-sort-header","","class","hide-on-mobile",4,"matHeaderCellDef"],["mat-cell","","class","hide-on-mobile",4,"matCellDef"],["matColumnDef","type"],["matColumnDef","yt"],["matColumnDef","acquis"],["matColumnDef","doublon"],["matColumnDef","modifier"],["mat-header-cell","","class","alignCenter",4,"matHeaderCellDef"],["matColumnDef","supprimer"],["mat-header-row","","class","bg-primary color-white",4,"matHeaderRowDef"],["mat-row","","class","mat-row",4,"matRowDef","matRowDefColumns"],[3,"pageSize","pageSizeOptions"],["mat-header-cell","",1,"image"],[1,"hide-on-mobile",3,"object","key"],["mat-cell","",1,"alignCenter"],["class","image click",3,"src","click",4,"ngIf"],[1,"image","click",3,"click","src"],["mat-header-cell","","mat-sort-header",""],[3,"object","key"],["mat-cell",""],[3,"ngIf","ngIfElse"],["mat-header-cell",""],["mat-header-cell","","mat-sort-header","",1,"hide-on-mobile"],["mat-cell","",1,"hide-on-mobile"],[1,"click",2,"font-size","1.2em",3,"click","classIcone","type","icone","info"],["mat-header-cell","",1,"alignCenter"],[2,"font-size","1.2em",3,"type","icone","info"],[1,"primary","click",2,"font-size","1.2em",3,"click","type","icone","info"],["mat-header-row","",1,"bg-primary","color-white"],["mat-row","",1,"mat-row"]],template:function(t,i){t&1&&(d(0,"lib-spinner",1),y(1,"async"),l(2,"section",2),y(3,"async"),l(4,"div",3)(5,"div",4)(6,"span"),u(7,"Nombre de timbres : "),a(),l(8,"span",5),u(9),y(10,"async"),y(11,"async"),a()(),l(12,"div",6)(13,"mat-select",7),O("ngModelChange",function(r){return L(i.timbreCritereModel.acquis,r)||(i.timbreCritereModel.acquis=r),r}),f("ngModelChange",function(){return i.filtreByCritere()}),l(14,"mat-option",8),u(15," Oui"),a(),l(16,"mat-option",8),u(17," Non"),a(),l(18,"mat-option",8),u(19," Tous"),a()()(),l(20,"div",6)(21,"mat-select",9),O("ngModelChange",function(r){return L(i.timbreCritereModel.doublon,r)||(i.timbreCritereModel.doublon=r),r}),f("ngModelChange",function(){return i.filtreByCritere()}),l(22,"mat-option",8),u(23," Oui"),a(),l(24,"mat-option",8),u(25," Non"),a(),l(26,"mat-option",8),u(27," Tous"),a()()(),l(28,"div",6)(29,"mat-select",10),O("ngModelChange",function(r){return L(i.timbreCritereModel.bloc,r)||(i.timbreCritereModel.bloc=r),r}),f("ngModelChange",function(){return i.filtreByCritere()}),l(30,"mat-option",8),u(31," Oui"),a(),l(32,"mat-option",8),u(33," Non"),a(),l(34,"mat-option",8),u(35," Tous"),a()()(),l(36,"div",11)(37,"mat-select",12),O("ngModelChange",function(r){return L(i.timbreCritereModel.annees,r)||(i.timbreCritereModel.annees=r),r}),f("ngModelChange",function(){return i.filtreByCritere()}),b(38,Pi,2,2,"mat-option",13),y(39,"async"),a()(),l(40,"div",14)(41,"input",15),f("input",function(r){return i.applyFilter(r)}),a()(),l(42,"lib-icon",16),f("click",function(){return i.exportTable()}),a()(),l(43,"table",17),f("matSortChange",function(r){return i.sortData(r)}),F(44,18),b(45,ki,2,2,"th",19)(46,Vi,2,1,"td",20),N(),F(47,21),b(48,$i,2,2,"th",22)(49,Hi,2,1,"td",23),N(),F(50,24),b(51,Wi,2,2,"th",22)(52,Zi,4,2,"td",23),N(),F(53,25),b(54,Yi,2,2,"th",26)(55,Ji,4,2,"td",23),N(),F(56,27),b(57,en,2,2,"th",28)(58,on,4,2,"td",29),N(),F(59,30),b(60,rn,2,2,"th",28)(61,ln,2,1,"td",29),N(),F(62,31),b(63,an,2,2,"th",28)(64,mn,2,1,"td",29),N(),F(65,32),b(66,sn,2,2,"th",22)(67,cn,2,4,"td",20),N(),F(68,33),b(69,pn,2,2,"th",22)(70,dn,2,4,"td",20),N(),F(71,34),b(72,un,2,3,"th",35)(73,bn,2,3,"td",20),N(),F(74,36),b(75,fn,2,3,"th",35)(76,gn,2,3,"td",20),N(),b(77,hn,1,0,"tr",37)(78,_n,1,0,"tr",38),a(),d(79,"mat-paginator",39),a()),t&2&&(m("fxHide",v(1,30,i.load$)==!0)("textSpec","Chargement en cours ..."),s(2),m("fxHide",v(3,32,i.load$)==!1),s(7),De(v(10,34,i.total$)?v(11,36,i.total$):i.dataSource==null||i.dataSource.data==null?null:i.dataSource.data.length),s(4),D("ngModel",i.timbreCritereModel.acquis),m("placeholder","Acquis"),s(),m("value","OUI"),s(2),m("value","NON"),s(2),m("value","TOUS"),s(3),D("ngModel",i.timbreCritereModel.doublon),m("placeholder","Doublon"),s(),m("value","OUI"),s(2),m("value","NON"),s(2),m("value","TOUS"),s(3),D("ngModel",i.timbreCritereModel.bloc),m("placeholder","Bloc"),s(),m("value","OUI"),s(2),m("value","NON"),s(2),m("value","TOUS"),s(3),D("ngModel",i.timbreCritereModel.annees),m("placeholder","Ann\xE9es"),s(),m("ngForOf",v(39,38,i.annees$)),s(4),m("type",i.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",i.FontAwesomeEnum.FILE_EXEL)("info","Exporter tableauu"),s(),m("dataSource",i.dataSource),s(34),m("matHeaderRowDef",i.displayedColumns),s(),m("matRowDefColumns",i.displayedColumns),s(),m("pageSize",15)("pageSizeOptions",Ct(40,ji)))},dependencies:[We,$e,Nt,Ut,qt,jt,Rt,Vt,Pt,kt,$t,Ht,ze,Ge,Ft,Le,X,V,$,W,ee,H,Ne,fe,_e,ie,Zt,ye,K],styles:[".mat-row[_ngcontent-%COMP%]{height:35px}.image[_ngcontent-%COMP%]{max-height:30px!important}.mat-column-acquis[_ngcontent-%COMP%], .mat-column-doublon[_ngcontent-%COMP%]{width:60px!important;max-width:60px!important;padding:0!important}.mat-column-ajouter[_ngcontent-%COMP%], .mat-column-modifier[_ngcontent-%COMP%], .mat-column-supprimer[_ngcontent-%COMP%]{width:35px!important;max-width:35px!important;padding:0!important}@media screen and (max-width: 800px){.mat-row[_ngcontent-%COMP%]{height:25px}.image[_ngcontent-%COMP%]{max-height:20px!important}.mat-column-acquis[_ngcontent-%COMP%], .mat-column-doublon[_ngcontent-%COMP%]{width:50px!important;max-width:50px!important;padding:0!important}.mat-column-ajouter[_ngcontent-%COMP%], .mat-column-modifier[_ngcontent-%COMP%], .mat-column-supprimer[_ngcontent-%COMP%]{width:20px!important;max-width:20px!important;padding:0!important}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:0 5px!important}th[_ngcontent-%COMP%], .mat-row[_ngcontent-%COMP%]{font-size:.8em}.mat-column-libelle[_ngcontent-%COMP%],   .mat-column-libelle .mat-sort-header-container{width:40px!important;max-width:40px!important}.mat-column-drapeau[_ngcontent-%COMP%],   .mat-column-drapeau span{width:15px!important;max-width:15px!important}.mat-column-classeur[_ngcontent-%COMP%],   .mat-column-classeur .mat-sort-header-container, .mat-column-page[_ngcontent-%COMP%],   .mat-column-page .mat-sort-header-container{width:15px!important;max-width:15px!important}.mat-column-total[_ngcontent-%COMP%],   .mat-column-total .mat-sort-header-container{width:25px!important;max-width:25px!important}.hide-on-mobile[_ngcontent-%COMP%]{display:none}}"]})};function Tn(o,e){if(o&1&&(d(0,"lib-spinner",5),y(1,"async")),o&2){let t=c();m("textSpec",v(1,1,t.messageLoad$))}}function xn(o,e){if(o&1&&(d(0,"mat-error",15),y(1,"async")),o&2){let t=c(2);m("innerHTML",v(1,1,t.messageError$),de)}}function Mn(o,e){if(o&1&&d(0,"app-timbre-resultat",16),o&2){let t=c(2);m("timbres$",t.timbres$)("modif",!1)}}function yn(o,e){o&1&&(l(0,"button",17),u(1," Enregistrer "),a())}function vn(o,e){if(o&1){let t=E();l(0,"form",6,1),f("ngSubmit",function(){h(t);let n=w(1),r=c();return _(r.valider(n))}),l(2,"div",7),b(3,xn,2,3,"mat-error",8),y(4,"async"),b(5,Mn,1,2,"app-timbre-resultat",9),y(6,"async"),a(),l(7,"div",10)(8,"button",11),f("click",function(){h(t);let n=c();return _(n.close())}),u(9," Annuler "),a(),l(10,"input",12),f("change",function(n){h(t);let r=c();return _(r.onFileChange(n))}),a(),l(11,"button",13),f("click",function(){h(t);let n=c();return _(n.triggerFileInput())}),u(12," Choisir un fichier "),a(),b(13,yn,2,0,"button",14),y(14,"async"),a()()}if(o&2){let t,i,n=w(1),r=c();m("ngClass",n!=null&&n.submitted?"red-color":"blue-color"),s(3),m("ngIf",v(4,5,r.messageError$)),s(2),m("ngIf",((t=v(6,7,r.timbres$))==null?null:t.length)>0),s(5),yt("id",r.idFile),s(3),m("ngIf",((i=v(14,9,r.timbres$))==null?null:i.length)>0)}}var we=class o{constructor(e,t,i){this.timbreService=e;this.uploadService=t;this.dialogRef=i}timbres$=new I(null);messageError$=new I(null);messageLoad$=new I("Chargement en cours ...");load$=new I(null);idFile="fileImport";ngOnInit(){}triggerFileInput(){document.getElementById(this.idFile).click()}onFileChange(e){let t=e.target.files[0];if(t){this.load$.next(!1),this.messageLoad$.next("Chargement en cours ...");let i=new FileReader;this.saveCsv(t,i)}}saveCsv(e,t){t.onload=()=>{let i=t.result;this.parseCsv(i)},t.readAsText(e)}parseCsv(e){let t=[];this.timbres$.next(null),fi.parse(e,{header:!0,skipEmptyLines:!0,complete:i=>{p(i.data)&&i.data?.length>0&&i.data.forEach(n=>{t.push(this.setTimbre(n))}),this.timbres$.next(t),this.load$.next(!0)},error:i=>{console.error("Erreur lors du parsing du CSV :",i)}})}setTimbre(e){let t=new C;t.setId(e.CODE!="NULL"&&e.CODE!=""?Number(e.CODE):null),t.setIdBloc(e.IDENT_BLOC!="NULL"&&e.IDENT_BLOC!=""?Number(e.IDENT_BLOC):null),t.setAnnee(e.ANNEE!="NULL"&&e.ANNEE!=""?Number(e.ANNEE):null),t.setMonnaie(e.MONNAIE!="NULL"&&e.MONNAIE!=""?e.MONNAIE:null),t.setType(e.TYPE!="NULL"&&e.TYPE!=""?e.TYPE:null),t.setYt(e.YT!="NULL"&&e.YT!=""?e.YT:null);let i="/assets/images/timbres/"+t.getAnnee()+"/";return p(t.getIdBloc())&&(i+="bloc/"+t.getIdBloc()+"-"),i+=t.getId()+".png",this.uploadService.checkIfImageExists(i).pipe(M()).subscribe(n=>{n&&t.setImage(i)}),t}valider(e){this.messageError$.next(null),e?.valid&&(this.load$.next(!1),this.messageLoad$.next("Import en cours ..."),this.timbres$.pipe(M()).subscribe(t=>{if(p(t)&&t?.length>0)t.forEach((i,n)=>{this.saveTimbre(i,n==t.length-1)});else{this.messageError$.next("Donn\xE9es incorrectes");return}}))}saveTimbre(e,t){Z([this.timbreService.upload(e,"autre"),this.timbreService.upload(e,"table"),this.timbreService.upload(e,"zoom")]).pipe(M(([i,n,r])=>p(i)&&p(r)&&p(n))).subscribe(([i,n,r])=>{p(n)&&n!="nok"&&e.setImage(n),p(i)&&i!="nok"&&e.setImageTable(i),p(r)&&r!="nok"&&e.setImageZoom(r),this.timbreService.addTimbreSansId(e),t&&(this.load$.next(!0),this.close())})}close(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||o)(S(U),S(ne),S(Me))};static \u0275cmp=k({type:o,selectors:[["app-timbre-importer"]],decls:8,vars:4,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],[3,"ngIf","ngIfElse"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","start stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","column","fxLayoutGap","20px",1,"bloc-modal"],[3,"innerHTML",4,"ngIf"],[3,"timbres$","modif",4,"ngIf"],["fxLayout","row","fxLayoutGap","10px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","file","accept",".xls, .xlsx, .csv","hidden","","required","",3,"change","id"],["type","button","mat-raised-button","","color","accent",1,"rounded","large","color-white",3,"click"],["type","submit","class","rounded large color-white","mat-raised-button","","color","accent",4,"ngIf"],[3,"innerHTML"],[3,"timbres$","modif"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"]],template:function(t,i){if(t&1&&(l(0,"div",2)(1,"div",3)(2,"span"),u(3,"TIMBRE IMPORTER"),a()(),b(4,Tn,2,3,"ng-template",4),y(5,"async"),b(6,vn,15,11,"ng-template",null,0,q),a()),t&2){let n=w(7);s(4),m("ngIf",v(5,2,i.load$)==!1)("ngIfElse",n)}},dependencies:[te,xe,ue,X,V,$,W,ee,H,be,Te,ge,he,ie,Ie,K]})};var Cn=["canvas"];function Sn(o,e){o&1&&d(0,"lib-spinner",5),o&2&&m("textSpec","Chargement en cours ...")}function In(o,e){if(o&1&&(d(0,"mat-error",18),y(1,"async")),o&2){let t=c(2);m("innerHTML",v(1,1,t.messageError$),de)}}function wn(o,e){if(o&1){let t=E();l(0,"div",10)(1,"label"),d(2,"lib-libelle-model",11),a(),l(3,"input",19),O("ngModelChange",function(n){h(t);let r=c(2);return L(r.timbreBlocModel.id,n)||(r.timbreBlocModel.id=n),_(n)}),a()()}if(o&2){let t=c(2);s(2),m("object",t.timbreBlocModel)("key","id"),s(),D("ngModel",t.timbreBlocModel.id),m("disabled",!!(t.timbreBlocModel!=null&&t.timbreBlocModel.getId()))}}function Bn(o,e){if(o&1){let t=E();l(0,"form",6,1),f("ngSubmit",function(){h(t);let n=w(1),r=c();return _(r.valider(n))}),l(2,"div",7),b(3,In,2,3,"mat-error",8),y(4,"async"),b(5,wn,4,4,"div",9),l(6,"div",10)(7,"label"),d(8,"lib-libelle-model",11),a(),l(9,"input",12),O("ngModelChange",function(n){h(t);let r=c();return L(r.timbreBlocModel.annee,n)||(r.timbreBlocModel.annee=n),_(n)}),a()(),l(10,"div",10)(11,"label"),d(12,"lib-libelle-model",11),a(),l(13,"input",13),O("ngModelChange",function(n){h(t);let r=c();return L(r.timbreBlocModel.monnaie,n)||(r.timbreBlocModel.monnaie=n),_(n)}),a()(),l(14,"lib-upload",14),f("outPutObject",function(n){h(t);let r=c();return _(r.timbreBlocModel=n)}),a()(),l(15,"div",15)(16,"button",16),f("click",function(){h(t);let n=c();return _(n.close())}),u(17," Annuler "),a(),l(18,"button",17),u(19," Enregistrer "),a()()()}if(o&2){let t=w(1),i=c();m("ngClass",t!=null&&t.submitted?"red-color":"blue-color"),s(3),m("ngIf",v(4,15,i.messageError$)),s(2),m("ngIf",i.timbreBlocModel==null?null:i.timbreBlocModel.getId()),s(3),m("object",i.timbreBlocModel)("key","annee"),s(),D("ngModel",i.timbreBlocModel.annee),m("max",i.maxAnnee)("zMax",i.maxAnnee),s(3),m("object",i.timbreBlocModel)("key","monnaie"),s(),D("ngModel",i.timbreBlocModel.monnaie),s(),m("object",i.timbreBlocModel)("key","image")("maxWidth",i.timbreBlocService.widthTimbre)("maxHeight",i.timbreBlocService.heightTimbre)}}var lt=class o{constructor(e,t,i){this.httpResponseHandlerService=e;this.dialogRef=t;this.timbreBlocService=i}canvas;messageError$=new I(null);load$=new I(null);id;maxAnnee=new Date().getFullYear();timbreBlocModel=new B;fileUploadModel=new Ce;ngOnInit(){this.initUpload(),this.load$.next(!1),p(this.id)?this.timbreBlocService.getBlocByIdAsync(this.id).subscribe(e=>{this.timbreBlocModel=e,this.load$.next(!0)}):(this.timbreBlocModel.setAnnee(new Date().getFullYear()),this.timbreBlocModel.setMonnaie("E"),this.load$.next(!0))}initUpload(){this.fileUploadModel.setDossier("test"),this.fileUploadModel.setNom(new Date().getTime()?.toString());let e=new oe;e.setMaxWidth(this.timbreBlocService.widthTimbre),e.setMaxHeight(this.timbreBlocService.heightTimbre),e.setDossier("autre");let t=new oe;t.setMaxWidth(this.timbreBlocService.widthTimbreZoom),t.setMaxHeight(this.timbreBlocService.heightTimbreZoom),t.setDossier("zoom"),this.fileUploadModel.setDetail([e,t])}valider(e){if(this.messageError$.next(null),e?.valid)if(p(this.timbreBlocModel.getImage()))this.saveData();else{this.messageError$.next("Veuillez s\xE9lectionner une image");return}}saveData(){this.load$.next(!1),p(this.timbreBlocModel.getId())?this.save():this.addTimbre()}addTimbre(){this.timbreBlocService.getMaxIdentAsync().pipe(M()).subscribe(e=>{this.timbreBlocModel.setId(e),this.save(!0)})}save(e){try{Z([this.timbreBlocService.upload(this.timbreBlocModel,"autre"),this.timbreBlocService.upload(this.timbreBlocModel,"table"),this.timbreBlocService.upload(this.timbreBlocModel,"zoom")]).pipe(M(([t,i,n])=>p(t)&&p(n)&&p(i))).subscribe(([t,i,n])=>{p(i)&&i!="nok"&&this.timbreBlocModel.setImage(i),p(t)&&t!="nok"&&this.timbreBlocModel.setImageTable(t),p(n)&&n!="nok"&&this.timbreBlocModel.setImageZoom(n),e?this.timbreBlocService.addBloc(this.timbreBlocModel):this.timbreBlocService.modifierBloc(this.timbreBlocModel),this.httpResponseHandlerService.showNotificationSuccess("Transaction termin\xE9e","Votre timbre a bien \xE9t\xE9 modifi\xE9e."),this.load$.next(!0),this.dialogRef.close()})}catch{this.httpResponseHandlerService.showNotificationError("Transaction non aboutie","Votre timbre n'a pas pu \xEAtre modifi\xE9."),this.load$.next(!0)}}close(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||o)(S(Ye),S(Me),S(G))};static \u0275cmp=k({type:o,selectors:[["app-timbre-modifier-bloc"]],viewQuery:function(t,i){if(t&1&&le(Cn,5),t&2){let n;ae(n=me())&&(i.canvas=n.first)}},decls:10,vars:6,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],[3,"ngIf","ngIfElse"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","space-between stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","column","fxLayoutGap","20px",1,"bloc-modal"],[3,"innerHTML",4,"ngIf"],["fxLayout","column","class","form-input",4,"ngIf"],["fxLayout","column",1,"form-input"],[3,"object","key"],["name","page","type","number","minlength","4","maxlength","4","min","1900","zMin","1900","required","","zControl","",1,"annee",2,"width","60px !important",3,"ngModelChange","ngModel","max","zMax"],["name","monnaie","type","text","trim","","minlength","1","maxlength","2","required","","zControl","",2,"width","25px !important",3,"ngModelChange","ngModel"],[3,"outPutObject","object","key","maxWidth","maxHeight"],["fxLayout","row","fxLayoutGap","10px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"],[3,"innerHTML"],["name","code","type","text","trim","","upperCase","","noEspace","","required","","zControl","",3,"ngModelChange","ngModel","disabled"]],template:function(t,i){if(t&1&&(l(0,"div",2)(1,"div",3)(2,"span"),u(3),a(),l(4,"span"),u(5),a()(),b(6,Sn,1,1,"ng-template",4),y(7,"async"),b(8,Bn,20,17,"ng-template",null,0,q),a()),t&2){let n=w(9);s(3),A("",i.timbreBlocModel!=null&&i.timbreBlocModel.getId()?"MODIFICATION":"AJOUT"," BLOC "),s(2),De(i.timbreBlocModel==null?null:i.timbreBlocModel.getId()),s(),m("ngIf",v(7,4,i.load$)==!1)("ngIfElse",n)}},dependencies:[te,xe,ue,X,V,$,W,ee,H,be,Te,Re,Ue,fe,ge,ke,qe,Ve,Pe,je,_e,he,ie,ye,Ot,Ze,Qe,Xe,Ke,ii,Je,K],encapsulation:2})};var at=class o{constructor(e,t){this.timbreService=e;this.dialog=t}ngOnInit(){this.timbreService.getTimbres()}addTimbre(){let e=this.dialog.open(Se,{maxHeight:"95vh",width:"30%"});e.afterClosed().subscribe(()=>{e.close()})}addBloc(){let e=this.dialog.open(lt,{maxHeight:"95vh",width:"30%"});e.afterClosed().subscribe(()=>{e.close()})}addTimbreBouchon(){this.timbreService.addTimbreSansId(this.timbreService.getBouchon())}importer(){let e=this.dialog.open(we,{height:"90vh",width:"70%"});e.afterClosed().subscribe(()=>{e.close()})}static \u0275fac=function(t){return new(t||o)(S(U),S(He))};static \u0275cmp=k({type:o,selectors:[["app-timbre-layout"]],decls:17,vars:3,consts:[["fxLayout","column","fxLayoutGap","20px"],[3,"titre"],["fxLayout","row","fxLayoutAlign","space-between stretch"],["fxFlex","5"],["fxFlex","","fxLayout","column","fxLayoutGap","20px"],["fxLayout","row","fxLayoutGap","20px"],["mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["mat-raised-button","","color","accent",1,"rounded","large","color-white",3,"click"],[3,"timbres$","total$"]],template:function(t,i){t&1&&(d(0,"app-simple-notification"),l(1,"div",0),d(2,"app-header",1),l(3,"div",2),d(4,"div",3),l(5,"div",4)(6,"div",5)(7,"button",6),f("click",function(){return i.addTimbre()}),u(8," Ajouter "),a(),l(9,"button",6),f("click",function(){return i.addBloc()}),u(10," Ajouter Bloc "),a(),l(11,"button",7),f("click",function(){return i.addTimbreBouchon()}),u(12," Bouchon "),a(),l(13,"button",7),f("click",function(){return i.importer()}),u(14," Importer "),a()(),d(15,"app-timbre-resultat",8),a(),d(16,"div",3),a()()),t&2&&(s(2),m("titre",""),s(13),m("timbres$",i.timbreService.timbres$)("total$",i.timbreService.total$))},dependencies:[te,V,$,W,H,Yt,ni,Ie]})};var En=[{path:"",component:at},{path:"importer",component:we}],mt=class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=Ae({type:o});static \u0275inj=Ee({imports:[st.forChild(En),st]})};var gi=class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=Ae({type:o});static \u0275inj=Ee({providers:[ve,re,U,G,ne,It()],imports:[Wt,mt,St,Bt,Et,At,Kt,Qt,li,Jt,Xt,Dt,zt,oi,ri,ai,mi]})};export{gi as TimbreModule};

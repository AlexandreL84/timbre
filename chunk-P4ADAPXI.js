import{a as ci,b as Gt,c as Qt,d as Xt}from"./chunk-6CYXLZPC.js";import{a as P,b as Nt,c as He,d as Ne,e as Z,f as jt,g as kt,h as J,i as H,j as Wt}from"./chunk-FSASB3GE.js";import{a as K,b as O,c as Vt,d as qt,e as $t,f as Pt,g as Ht,h as Ue,i as pi,j as zt,l as Zt}from"./chunk-U3ZSWC23.js";import{C as Yt,g as Ut}from"./chunk-W3XNXTU3.js";import{b as At,d as Lt,e as X,f as Rt,g as Ft,h as Fe}from"./chunk-LMRVNFCC.js";import{a as he}from"./chunk-YKK6WNC6.js";import{A as f,Aa as ge,Ab as $,Ac as Ct,Ba as _e,Bb as mt,Bc as Mt,Ca as W,Cb as at,Cc as vt,Db as st,Dc as yt,Ec as St,Fa as G,Fc as wt,Ga as nt,Gb as ve,Gc as It,Hb as ye,Hc as Et,I as fe,Ia as ot,Ib as Se,Ic as Pe,J as me,Jb as we,Jc as Bt,K as s,Kb as Ie,Kc as Dt,L as x,Lb as ct,Lc as Ot,Mb as pt,Nb as dt,Ob as ut,Pa as $e,Pb as bt,Q as g,Qb as ft,R as m,Rb as gt,Tb as Ee,W as a,Wb as _t,X as l,Y as u,Z as S,_ as w,aa as I,ab as p,ba as _,bb as pe,c as y,ca as c,da as Je,ea as ae,f as qe,fa as se,g as F,ga as ce,gc as Be,ha as E,hc as Q,ia as d,ja as et,jc as Ae,ka as B,l as T,la as tt,lc as Le,m as Ze,ma as L,na as D,oa as R,ob as rt,p as Ke,pb as xe,q as ue,qb as Te,ra as it,rb as lt,rc as De,s as z,sb as Ce,tb as Me,u as U,ua as C,uc as Re,v as be,va as M,vb as k,wa as j,wb as V,wc as Oe,xb as q,xc as ht,yc as xt,z as b,zb as Y,zc as Tt}from"./chunk-EDS3JHJR.js";import"./chunk-65CH3ZW6.js";import{g as Xe}from"./chunk-GV7GV3NK.js";var A=class o{constructor(t,e,i,n,r,h){this.firestore=t;this.authService=e;this.timbreBlocService=i;this.uploadService=n;this.utilsService=r;this.timbreUtilsService=h}heigthTable=50;widthTimbre=100;heightTimbre=100;widthTimbreZoom=500;heightTimbreZoom=500;total$=new y(0);timbres$=new y(null);getTimbre(t){return this.firestore.collection("/timbres",e=>e.where("id","==",t)).valueChanges()}getTimbreByIdAsync(t){return F([this.getTimbre(t),this.timbreBlocService.getBlocsAsync()]).pipe(qe(([e,i])=>this.timbreUtilsService.constructTimbre(e[0],null,i)))}getTotal(t){this.total$.next(null),this.timbreUtilsService.getAllTimbres(t).pipe(T()).subscribe(e=>{this.total$.next(e?.length)})}getTimbres(t){this.getTotal(),this.timbres$.next(null),F([this.timbreUtilsService.getAllTimbres(t),this.getTimbreAcquis(),this.timbreBlocService.getBlocsAsync(t)]).pipe(T()).subscribe(([e,i,n])=>{this.timbres$.next(this.timbreUtilsService.constructTimbres(e,i,n,t))})}getTimbreAcquis(){return this.authService.getUser().pipe(T(),Ze(t=>p(t)?this.getTimbreAcquisByUser(t.getId()).pipe(T(),qe(e=>e)):null))}getTimbreAcquisByUser(t){return this.firestore.collection("/timbres_acquis",e=>e.where("idUser","==",t)).valueChanges()}acquis(t,e){return this.authService.getUser().pipe(T(i=>p(i))).subscribe(i=>{p(t?.getTimbreAcquisModel()?.getIdUser())?this.firestore.collection("/timbres_acquis").ref.where("idTimbre","==",t.getId()).where("idUser","==",i.getId()).get().then(n=>{n.forEach(r=>{let h=t.getTimbreAcquisModel();e?(h.setAcquis(!0),h.setDoublon(!h.isDoublon())):(h.setAcquis(!h.isAcquis()),h.isAcquis()||h.setDoublon(!1)),r.ref.update(Object.assign(new Object,h))})}).catch(n=>{console.error("Erreur de mise \xE0 jour:",n)}):this.addAcquis(i?.getId(),t,e)})}addAcquis(t,e,i){let n=new Z;n.setIdUser(t),n.setIdTimbre(e.getId()),n.setAcquis(!0),n.setDoublon(i),e.setTimbreAcquisModel(n),this.firestore.collection("/timbres_acquis").add(Object.assign(new Object,n))}ajouterSansId(t){this.utilsService.getMaxIdentAsync("/timbres").pipe(T()).subscribe(e=>{t.setId(e),p(t.getIdBloc())&&(t.setAnnee(null),t.setMonnaie(null)),this.ajouter(t,!0)})}ajouter(t,e){this.getTimbre(t.getId()).pipe(T()).subscribe(i=>{pe(i)||pe(i[0])||p(i[0])&&i[0]?.length==0?(t.setTimbreAcquisModel(null),t.setTimbreBlocModel(null),this.firestore.collection("/timbres").add(Object.assign(new Object,t)),e&&this.getTimbres()):console.error("timbre d\xE9j\xE0 existant")})}modifier(t){t.setTimbreBlocModel(null),t.setTimbreAcquisModel(null),this.firestore.collection("/timbres").ref.where("id","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.update(Object.assign(new Object,t)),this.getTimbres()})}).catch(e=>{console.error("Erreur de mise \xE0 jour:",e)})}supprimerTimbre(t){this.firestore.collection("/timbres").ref.where("id","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.delete(),this.getTimbres()})}).catch(e=>{console.error("Erreur de suppression :",e)})}supprimer(t){this.authService.getUser().pipe(T(e=>p(e))).subscribe(e=>{this.timbreUtilsService.supprimerTimbreAcquis(t,e.getId()),this.supprimerTimbre(t)})}getBouchon(){let t=new P;return t.setAnnee(new Date().getFullYear()),t.setMonnaie("E"),t.setType(""),t.setYt(""),t}upload(t,e){let i=this.widthTimbre,n=this.heightTimbre;return e=="table"?(i=i*(this.heigthTable/n),n=this.heigthTable):e=="zoom"&&(i=i*(this.heightTimbreZoom/n),n=this.heightTimbreZoom),this.uploadService.processAndUploadImage(t?.getImage(),i,n,t?.getId(),this.getDossier(t,e))}getDossier(t,e){let i="timbre//";return p(t.getIdBloc())?i=i+t.getTimbreBlocModel().getAnnee():i=i+t.getAnnee(),p(e)&&(i=i+"/"+e),p(t.getIdBloc())&&(i=i+"/bloc/"+t.getIdBloc()),i}static \u0275fac=function(e){return new(e||o)(z(rt),z(he),z(H),z(K),z(O),z(J))};static \u0275prov=Ke({token:o,factory:o.\u0275fac})};var xi=["canvas"];function Ti(o,t){if(o&1&&(a(0,"span",6)(1,"b"),d(2),l()()),o&2){let e=c();s(2),B("N\xB0",e.timbreModel==null?null:e.timbreModel.getId(),"")}}function Ci(o,t){o&1&&u(0,"lib-spinner",7),o&2&&m("textSpec","Chargement en cours ...")}function Mi(o,t){if(o&1&&(u(0,"mat-error",29),C(1,"async")),o&2){let e=c(2);m("innerHTML",M(1,1,e.messageError$),fe)}}function vi(o,t){if(o&1&&(a(0,"mat-option",18),d(1),l()),o&2){let e=t.$implicit;m("value",e),s(),tt(" ",e.getAnnee()," - ",e.getId()," ")}}function yi(o,t){if(o&1){let e=I();a(0,"img",30),_("click",function(){let n;b(e);let r=c(2);return f(r.utilsService.zoom(r.timbreModel==null||(n=r.timbreModel.getTimbreBlocModel())==null?null:n.getImageZoom()))}),l()}if(o&2){let e,i=c(2);m("src",i.timbreModel==null||(e=i.timbreModel.getTimbreBlocModel())==null?null:e.getImage(),me)}}function Si(o,t){if(o&1){let e=I();a(0,"form",8,1),_("ngSubmit",function(){b(e);let n=E(1),r=c();return f(r.valider(n))}),a(2,"div",9),g(3,Mi,2,3,"mat-error",10),C(4,"async"),a(5,"div",11)(6,"div",12)(7,"label"),u(8,"lib-libelle-model",13),l(),a(9,"input",14),R("ngModelChange",function(n){b(e);let r=c();return D(r.timbreModel.annee,n)||(r.timbreModel.annee=n),f(n)}),_("ngModelChange",function(n){b(e);let r=c();return f(r.changeAnnee(n))}),l()(),a(10,"div",15)(11,"label"),u(12,"lib-libelle-model",13),l(),a(13,"div",16)(14,"mat-select",17),C(15,"async"),_("ngModelChange",function(n){b(e);let r=c();return f(r.changeBloc(n))}),u(16,"mat-option",18),g(17,vi,2,3,"mat-option",19),C(18,"async"),l(),g(19,yi,1,1,"img",20),l()()(),a(20,"div",11)(21,"div",12)(22,"label"),u(23,"lib-libelle-model",13),l(),a(24,"input",21),R("ngModelChange",function(n){b(e);let r=c();return D(r.timbreModel.type,n)||(r.timbreModel.type=n),f(n)}),l()(),a(25,"div",12)(26,"label"),u(27,"lib-libelle-model",13),l(),a(28,"input",22),R("ngModelChange",function(n){b(e);let r=c();return D(r.timbreModel.monnaie,n)||(r.timbreModel.monnaie=n),f(n)}),l()()(),a(29,"div",11)(30,"div",12)(31,"label"),u(32,"lib-libelle-model",13),l(),a(33,"input",23),R("ngModelChange",function(n){b(e);let r=c();return D(r.timbreModel.yt,n)||(r.timbreModel.yt=n),f(n)}),l()(),u(34,"div",24),l(),a(35,"lib-upload",25),_("outPutObject",function(n){b(e);let r=c();return f(r.timbreModel=n)}),l()(),a(36,"div",26)(37,"button",27),_("click",function(){b(e);let n=c();return f(n.close())}),d(38," Annuler "),l(),a(39,"button",28),d(40," Enregistrer "),l()()()}if(o&2){let e,i,n=E(1),r=c();m("ngClass",n!=null&&n.submitted?"red-color":"blue-color"),s(3),m("ngIf",M(4,31,r.messageError$)),s(5),m("object",r.timbreModel)("key","annee"),s(),L("ngModel",r.timbreModel.annee),m("max",r.maxAnnee)("zMax",r.maxAnnee)("disabled",!!(r.timbreModel!=null&&r.timbreModel.getId())),s(3),m("object",r.timbreModel)("key","timbreBlocModel"),s(2),m("ngModel",r.timbreModel.getTimbreBlocModel())("placeholder","Choix bloc")("disabled",!!(r.timbreModel!=null&&r.timbreModel.getId())||((e=M(15,33,r.timbreBlocService.timbresBlocModel$))==null?null:e.length)<=0),s(2),m("value",null),s(),m("ngForOf",M(18,35,r.timbreBlocService.timbresBlocModel$)),s(2),m("ngIf",r.timbreModel==null||(i=r.timbreModel.getTimbreBlocModel())==null?null:i.getImage()),s(4),m("object",r.timbreModel)("key","type"),s(),L("ngModel",r.timbreModel.type),s(3),m("object",r.timbreModel)("key","monnaie"),s(),L("ngModel",r.timbreModel.monnaie),m("disabled",!!r.timbreModel.getTimbreBlocModel()),s(4),m("object",r.timbreModel)("key","yt"),s(),L("ngModel",r.timbreModel.yt),s(2),m("object",r.timbreModel)("key","image")("zoom",r.timbreModel.getImageZoom())("maxWidth",r.timbreService.widthTimbre)("maxHeight",r.timbreService.heightTimbre)}}var te=class o{constructor(t,e,i,n,r){this.httpResponseHandlerService=t;this.dialogRef=e;this.timbreService=i;this.timbreBlocService=n;this.utilsService=r}canvas;messageError$=new y(null);load$=new y(null);id;maxAnnee=new Date().getFullYear();timbreModel=new P;fileUploadModel=new Nt;ngOnInit(){this.initUpload(),this.load$.next(!1),p(this.id)?this.timbreService.getTimbreByIdAsync(this.id).subscribe(t=>{this.timbreModel=t,p(t.getTimbreBlocModel())&&(this.timbreModel.setAnnee(t.getTimbreBlocModel().getAnnee()),this.timbreModel.setMonnaie(t.getTimbreBlocModel().getMonnaie())),this.load$.next(!0)}):(this.timbreModel.setAnnee(new Date().getFullYear()),this.timbreModel.setMonnaie("E"),this.load$.next(!0)),this.changeAnnee(this.timbreModel.getAnnee())}initUpload(){this.fileUploadModel.setDossier("test"),this.fileUploadModel.setNom(new Date().getTime()?.toString());let t=new He;t.setMaxWidth(this.timbreService.widthTimbre),t.setMaxHeight(this.timbreService.heightTimbre),t.setDossier("autre");let e=new He;e.setMaxWidth(this.timbreService.widthTimbreZoom),e.setMaxHeight(this.timbreService.heightTimbreZoom),e.setDossier("zoom"),this.fileUploadModel.setDetail([t,e])}valider(t){if(this.messageError$.next(null),t?.valid)if(p(this.timbreModel.getImage()))this.saveData();else{this.messageError$.next("Veuillez s\xE9lectionner une image");return}}saveData(){this.load$.next(!1),p(this.timbreModel.getId())?this.save():this.ajouter()}ajouter(){this.utilsService.getMaxIdentAsync("/timbres").pipe(T()).subscribe(t=>{this.timbreModel.setId(t),this.save(!0)})}save(t){try{F([this.timbreService.upload(this.timbreModel,"autre"),this.timbreService.upload(this.timbreModel,"table"),this.timbreService.upload(this.timbreModel,"zoom")]).pipe(T(([e,i,n])=>p(e)&&p(n)&&p(i))).subscribe(([e,i,n])=>{p(i)&&i!="nok"&&this.timbreModel.setImage(i),p(e)&&e!="nok"&&this.timbreModel.setImageTable(e),p(n)&&n!="nok"&&this.timbreModel.setImageZoom(n),t?this.timbreService.ajouter(this.timbreModel,!0):this.timbreService.modifier(this.timbreModel),this.httpResponseHandlerService.showNotificationSuccess("Transaction termin\xE9e","Votre timbre a bien \xE9t\xE9 modifi\xE9e."),this.load$.next(!0),this.dialogRef.close()})}catch{this.httpResponseHandlerService.showNotificationError("Transaction non aboutie","Votre timbre n'a pas pu \xEAtre modifi\xE9."),this.load$.next(!0)}}close(){this.dialogRef.close()}changeAnnee(t){if(this.timbreModel.setTimbreBlocModel(null),p(t)){let e=new Ne;e.setAnnees([t]),this.timbreBlocService.getBlocs(e)}}changeBloc(t){p(t)?(this.timbreModel.setIdBloc(t.getId()),this.timbreModel.setTimbreBlocModel(t),this.timbreModel.setMonnaie(t.getMonnaie())):(this.timbreModel.setIdBloc(null),this.timbreModel.setTimbreBlocModel(null),this.timbreModel.setMonnaie("E"))}static \u0275fac=function(e){return new(e||o)(x(Ut),x(Ae),x(A),x(H),x(O))};static \u0275cmp=U({type:o,selectors:[["app-timbre-modifier"]],viewQuery:function(e,i){if(e&1&&ae(xi,5),e&2){let n;se(n=ce())&&(i.canvas=n.first)}},decls:9,vars:6,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],["class","accent",4,"ngIf"],[3,"ngIf","ngIfElse"],[1,"accent"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","space-between stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","column","fxLayoutGap","20px",1,"bloc-modal"],[3,"innerHTML",4,"ngIf"],["fxLayout","row","fxLayout.lt-lg","column","fxLayoutGap","30px","fxLayoutGap.lt-lg","5px"],["fxLayout","column",1,"form-input"],[3,"object","key"],["name","page","type","number","minlength","4","maxlength","4","min","1900","zMin","1900","required","","zControl","",1,"annee",2,"width","60px !important",3,"ngModelChange","ngModel","max","zMax","disabled"],["fxLayout","column",1,"form-input","select"],["fxLayout","row","fxLayoutGap","15px"],["name","bloc",2,"width","120px !important",3,"ngModelChange","ngModel","placeholder","disabled"],[1,"selectMin",3,"value"],["class","selectMin",3,"value",4,"ngFor","ngForOf"],["style","max-height: 40px","class","click",3,"src","click",4,"ngIf"],["name","type","type","text","trim","","zControl","",3,"ngModelChange","ngModel"],["name","monnaie","type","text","trim","","minlength","1","maxlength","2","required","","zControl","",2,"width","25px !important",3,"ngModelChange","ngModel","disabled"],["name","yt","type","text","trim","","zControl","",3,"ngModelChange","ngModel"],["fxHide.lt-lg","","fxLayout","column",1,"form-input"],[3,"outPutObject","object","key","zoom","maxWidth","maxHeight"],["fxLayout","row","fxLayoutGap","10px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"],[3,"innerHTML"],[1,"click",2,"max-height","40px",3,"click","src"]],template:function(e,i){if(e&1&&(a(0,"div",2)(1,"div",3)(2,"span"),d(3),l(),g(4,Ti,3,1,"span",4),l(),g(5,Ci,1,1,"ng-template",5),C(6,"async"),g(7,Si,41,37,"ng-template",null,0,j),l()),e&2){let n=E(8);s(3),B("",i.timbreModel!=null&&i.timbreModel.getId()?"MODIFICATION":"AJOUT"," "),s(),m("ngIf",i.timbreModel==null?null:i.timbreModel.getId()),s(),m("ngIf",M(6,4,i.load$)==!1)("ngIfElse",n)}},dependencies:[Q,Be,De,Ee,ge,_e,W,k,V,$,Y,q,Me,Ce,Ie,st,ct,ve,ye,ut,bt,ft,dt,pt,we,Se,X,Fe,Lt,Vt,qt,$t,Pt,G],encapsulation:2})};var mi=Xe(ci());var ri=Xe(pi());var wi=()=>[10,20,50,100];function Ii(o,t){if(o&1&&(a(0,"mat-option",32),d(1),l()),o&2){let e=t.$implicit;m("value",e),s(),B(" ",e," ")}}function Ei(o,t){if(o&1){let e=I();S(0),a(1,"div",30)(2,"mat-select",31),R("ngModelChange",function(n){b(e);let r=c();return D(r.timbreCritereModel.acquis,n)||(r.timbreCritereModel.acquis=n),f(n)}),_("ngModelChange",function(){b(e);let n=c();return f(n.filtreByCritere())}),a(3,"mat-option",32),d(4," Oui"),l(),a(5,"mat-option",32),d(6," Non"),l(),a(7,"mat-option",32),d(8," Tous"),l()()(),a(9,"div",30)(10,"mat-select",33),R("ngModelChange",function(n){b(e);let r=c();return D(r.timbreCritereModel.doublon,n)||(r.timbreCritereModel.doublon=n),f(n)}),_("ngModelChange",function(){b(e);let n=c();return f(n.filtreByCritere())}),a(11,"mat-option",32),d(12," Oui"),l(),a(13,"mat-option",32),d(14," Non"),l(),a(15,"mat-option",32),d(16," Tous"),l()()(),a(17,"div",30)(18,"mat-select",34),R("ngModelChange",function(n){b(e);let r=c();return D(r.timbreCritereModel.bloc,n)||(r.timbreCritereModel.bloc=n),f(n)}),_("ngModelChange",function(){b(e);let n=c();return f(n.filtreByCritere())}),a(19,"mat-option",32),d(20," Oui"),l(),a(21,"mat-option",32),d(22," Non"),l(),a(23,"mat-option",32),d(24," Tous"),l()()(),a(25,"div",35)(26,"mat-select",36),R("ngModelChange",function(n){b(e);let r=c();return D(r.timbreCritereModel.annees,n)||(r.timbreCritereModel.annees=n),f(n)}),_("ngModelChange",function(){b(e);let n=c();return f(n.filtreByCritere())}),g(27,Ii,2,2,"mat-option",37),C(28,"async"),l()(),a(29,"div",38)(30,"input",39),_("input",function(n){b(e);let r=c();return f(r.applyFilter(n))}),l()(),a(31,"lib-icon",40),_("click",function(){b(e);let n=c();return f(n.exportTable())}),l(),w()}if(o&2){let e=c();s(2),L("ngModel",e.timbreCritereModel.acquis),m("placeholder","Acquis"),s(),m("value","OUI"),s(2),m("value","NON"),s(2),m("value","TOUS"),s(3),L("ngModel",e.timbreCritereModel.doublon),m("placeholder","Doublon"),s(),m("value","OUI"),s(2),m("value","NON"),s(2),m("value","TOUS"),s(3),L("ngModel",e.timbreCritereModel.bloc),m("placeholder","Bloc"),s(),m("value","OUI"),s(2),m("value","NON"),s(2),m("value","TOUS"),s(3),L("ngModel",e.timbreCritereModel.annees),m("placeholder","Ann\xE9es"),s(),m("ngForOf",M(28,21,e.annees$)),s(4),m("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.FILE_EXEL)("info","Exporter tableau")}}function Bi(o,t){if(o&1&&(a(0,"th",41),u(1,"lib-libelle-model",42),l()),o&2){let e=c();s(),m("object",e.timbre)("key","image")}}function Ai(o,t){if(o&1){let e=I();a(0,"img",45),_("click",function(){b(e);let n=c().$implicit,r=c();return f(r.utilsService.zoom(n==null?null:n.getImageZoom()))}),l()}if(o&2){let e=c().$implicit;m("src",e==null?null:e.getImageTable(),me)}}function Li(o,t){if(o&1&&(a(0,"td",43),g(1,Ai,1,1,"img",44),l()),o&2){let e=t.$implicit;s(),m("ngIf",e==null?null:e.getImageTable())}}function Di(o,t){if(o&1&&(a(0,"th",46),u(1,"lib-libelle-model",47),l()),o&2){let e=c();s(),m("object",e.timbre)("key","id")}}function Ri(o,t){if(o&1&&(a(0,"td",48),d(1),l()),o&2){let e=t.$implicit;s(),B(" ",e==null?null:e.getId()," ")}}function Oi(o,t){if(o&1&&(a(0,"th",46),u(1,"lib-libelle-model",47),l()),o&2){let e=c();s(),m("object",e.timbre)("key","annee")}}function Fi(o,t){if(o&1&&d(0),o&2){let e,i=c().$implicit;B(" ",i==null||(e=i.getTimbreBlocModel())==null?null:e.getAnnee()," ")}}function Ni(o,t){if(o&1&&d(0),o&2){let e=c().$implicit;B(" ",e==null?null:e.getAnnee()," ")}}function Ui(o,t){if(o&1&&(a(0,"td",48),g(1,Fi,1,1,"ng-template",49)(2,Ni,1,1,"ng-template",null,0,j),l()),o&2){let e=t.$implicit,i=E(3);s(),m("ngIf",e==null?null:e.getIdBloc())("ngIfElse",i)}}function ji(o,t){if(o&1&&(a(0,"th",50),u(1,"lib-libelle-model",47),l()),o&2){let e=c();s(),m("object",e.timbre)("key","idBloc")}}function ki(o,t){if(o&1){let e=I();a(0,"img",45),_("click",function(){let n;b(e);let r=c(2).$implicit,h=c();return f(h.utilsService.zoom(r==null||(n=r.getTimbreBlocModel())==null?null:n.getImageZoom()))}),l()}if(o&2){let e,i=c(2).$implicit;m("src",i==null||(e=i.getTimbreBlocModel())==null?null:e.getImageTable(),me)}}function Vi(o,t){if(o&1&&g(0,ki,1,1,"img",44),o&2){let e,i=c().$implicit;m("ngIf",i==null||(e=i.getTimbreBlocModel())==null?null:e.getImage())}}function qi(o,t){o&1&&d(0," Non ")}function $i(o,t){if(o&1&&(a(0,"td",48),g(1,Vi,1,1,"ng-template",49)(2,qi,1,0,"ng-template",null,0,j),l()),o&2){let e=t.$implicit,i=E(3);s(),m("ngIf",e==null?null:e.getIdBloc())("ngIfElse",i)}}function Pi(o,t){if(o&1&&(a(0,"th",51),u(1,"lib-libelle-model",47),l()),o&2){let e=c();s(),m("object",e.timbre)("key","monnaie")}}function Hi(o,t){if(o&1&&d(0),o&2){let e,i=c().$implicit;B(" ",(i==null||(e=i.getTimbreBlocModel())==null?null:e.getMonnaie())=="E"?"\u20AC":"Francs"," ")}}function zi(o,t){if(o&1&&d(0),o&2){let e=c().$implicit;B(" ",(e==null?null:e.getMonnaie())=="E"?"\u20AC":"Francs"," ")}}function Wi(o,t){if(o&1&&(a(0,"td",52),g(1,Hi,1,1,"ng-template",49)(2,zi,1,1,"ng-template",null,0,j),l()),o&2){let e=t.$implicit,i=E(3);s(),m("ngIf",e==null?null:e.getIdBloc())("ngIfElse",i)}}function Gi(o,t){if(o&1&&(a(0,"th",51),u(1,"lib-libelle-model",47),l()),o&2){let e=c();s(),m("object",e.timbre)("key","type")}}function Yi(o,t){if(o&1&&(a(0,"td",52),d(1),l()),o&2){let e=t.$implicit;s(),B(" ",e==null?null:e.getType()," ")}}function Qi(o,t){if(o&1&&(a(0,"th",51),u(1,"lib-libelle-model",47),l()),o&2){let e=c();s(),m("object",e.timbre)("key","yt")}}function Xi(o,t){if(o&1&&(a(0,"td",52),d(1),l()),o&2){let e=t.$implicit;s(),B(" ",e==null?null:e.getYt()," ")}}function Zi(o,t){if(o&1&&(a(0,"th",46),u(1,"lib-libelle-model",47),l()),o&2){let e=c();s(),m("object",e.timbre==null?null:e.timbre.getTimbreAcquisModel())("key","acquis")}}function Ki(o,t){if(o&1){let e=I();a(0,"td",43)(1,"lib-icon",53),_("click",function(){let n=b(e).$implicit,r=c();return f(r.acquis(n))}),l()()}if(o&2){let e,i,n,r=t.$implicit,h=c();s(),m("classIcone",!(r==null||(e=r.getTimbreAcquisModel())==null)&&e.isAcquis()?"accent":"primary")("type",h.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",!(r==null||(i=r.getTimbreAcquisModel())==null)&&i.isAcquis()?h.FontAwesomeEnum.CIRCLE_MINUS:h.FontAwesomeEnum.CIRCLE_PLUS)("info",!(r==null||(n=r.getTimbreAcquisModel())==null)&&n.isAcquis()?"pas acquis":"acquis")}}function Ji(o,t){if(o&1&&(a(0,"th",46),u(1,"lib-libelle-model",47),l()),o&2){let e=c();s(),m("object",e.timbre==null?null:e.timbre.getTimbreAcquisModel())("key","doublon")}}function en(o,t){if(o&1){let e=I();a(0,"td",43)(1,"lib-icon",53),_("click",function(){let n=b(e).$implicit,r=c();return f(r.doublon(n))}),l()()}if(o&2){let e,i,n,r=t.$implicit,h=c();s(),m("classIcone",!(r==null||(e=r.getTimbreAcquisModel())==null)&&e.isDoublon()?"accent":"primary")("type",h.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",!(r==null||(i=r.getTimbreAcquisModel())==null)&&i.isDoublon()?h.FontAwesomeEnum.CIRCLE_MINUS:h.FontAwesomeEnum.CIRCLE_PLUS)("info",!(r==null||(n=r.getTimbreAcquisModel())==null)&&n.isDoublon()?"pas en double":"en double")}}function tn(o,t){if(o&1&&(a(0,"th",54),u(1,"lib-icon",55),l()),o&2){let e=c();s(),m("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.PENCIL)("info","Modifier")}}function nn(o,t){if(o&1){let e=I();a(0,"td",43)(1,"lib-icon",56),_("click",function(){let n=b(e).$implicit,r=c();return f(r.modifier(n))}),l()()}if(o&2){let e=c();s(),m("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.PENCIL)("info","Modifier")}}function on(o,t){if(o&1&&(a(0,"th",54),u(1,"lib-icon",55),l()),o&2){let e=c();s(),m("type",e.FontAwesomeTypeEnum.TYPE_SOLID)("icone",e.FontAwesomeEnum.TRASH)("info","Supprimer")}}function rn(o,t){if(o&1){let e=I();a(0,"td",43)(1,"lib-icon",56),_("click",function(){let n=b(e).$implicit,r=c();return f(r.supprimer(n))}),l()()}if(o&2){let e=c();s(),m("type",e.FontAwesomeTypeEnum.TYPE_SOLID)("icone",e.FontAwesomeEnum.TRASH)("info","Supprimer")}}function ln(o,t){o&1&&u(0,"tr",57)}function mn(o,t){o&1&&u(0,"tr",58)}var ie=class o{constructor(t,e,i,n){this.timbreService=t;this.timbreUtilsService=e;this.dialog=i;this.utilsService=n;this.dataSource=new Pe([])}paginator;sort;timbres$;total$;modif=!0;load$=new y(!1);dataSource=new Pe;displayedColumns;timbreCritereModel=new Ne;timbre=new P;annees$;FontAwesomeEnum=Te;FontAwesomeTypeEnum=xe;ngOnInit(){this.annees$=this.timbreUtilsService.getAnneesAsync("/timbres"),this.timbre.setTimbreAcquisModel(new Z),this.displayedColumns=["image","id","annee","idBloc","monnaie","type","yt","acquis","doublon"],this.modif&&this.displayedColumns.push("modifier","supprimer"),this.load$.next(!1),this.timbres$.subscribe(t=>{this.dataSource.data=t,this.load$.next(!0)})}ngAfterViewInit(){this.dataSource.paginator=this.paginator}sortData(t){p(t)&&(console.log(t),this.dataSource.sort=this.sort)}filtreByCritere(){this.timbreCritereModel.getAcquis()=="NON"&&this.timbreCritereModel.setDoublon("TOUS"),this.timbreService.getTimbres(this.timbreCritereModel)}applyFilter(t){let e=t.target.value;this.dataSource.filter=e.trim().toLowerCase()}acquis(t){this.timbreService.acquis(t,!1)}doublon(t){this.timbreService.acquis(t,!0)}modifier(t){let e=this.dialog.open(te,{height:"75vh",maxHeight:"750px",width:"30%"});e.componentInstance.id=t.getId(),e.afterClosed().subscribe(()=>{e.close()})}supprimer(t){let e=this.dialog.open(zt,{maxHeight:"95vh",data:{titre:"Confirmation",message:"Souhaitez-vous supprimer le timbre <b>n\xB0 "+t?.getId()+"</b> ?",btnDroite:"Oui",btnGauche:"Non"}});e.afterClosed().subscribe(()=>{e.componentInstance.data.resultat==="valider"&&this.timbreService.supprimer(t)})}exportTable(){let t=Ue.json_to_sheet(this.dataSource.data),e=Ue.book_new();Ue.book_append_sheet(e,t,"Donn\xE9es");let i=Ht(e,{bookType:"xlsx",type:"array"}),n=new Blob([i],{type:"application/octet-stream"});(0,ri.saveAs)(n,"export_timbres.xlsx")}generatePDFByImage(){let t="https://firebasestorage.googleapis.com/v0/b/book-f941b.appspot.com/o/AF.png?alt=media&token=a1039f78-3cff-41ab-8569-ea1b2cefe2c1";this.generatePDF(null)}generatePDF(t){}static \u0275fac=function(e){return new(e||o)(x(A),x(J),x(Le),x(O))};static \u0275cmp=U({type:o,selectors:[["app-timbre-resultat"]],viewQuery:function(e,i){if(e&1&&(ae(Re,5),ae(Oe,5)),e&2){let n;se(n=ce())&&(i.paginator=n.first),se(n=ce())&&(i.sort=n.first)}},inputs:{timbres$:"timbres$",total$:"total$",modif:"modif"},decls:50,vars:19,consts:[["noBloc",""],["fxFlexFill","",3,"fxHide","textSpec"],[3,"fxHide"],["fxLayout","row","fxLayoutAlign","space-between center","fxLayoutGap","15px",2,"height","50px"],["fxFlex","",2,"font-size","1.2em"],[1,"bold"],[4,"ngIf"],["id","pdf-content","mat-table","","matSort","",3,"matSortChange","dataSource"],["matColumnDef","image"],["mat-header-cell","","class","image",4,"matHeaderCellDef"],["mat-cell","","class","alignCenter",4,"matCellDef"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","annee"],["matColumnDef","idBloc"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","monnaie"],["mat-header-cell","","mat-sort-header","","class","hide-on-mobile",4,"matHeaderCellDef"],["mat-cell","","class","hide-on-mobile",4,"matCellDef"],["matColumnDef","type"],["matColumnDef","yt"],["matColumnDef","acquis"],["matColumnDef","doublon"],["matColumnDef","modifier"],["mat-header-cell","","class","alignCenter",4,"matHeaderCellDef"],["matColumnDef","supprimer"],["mat-header-row","","class","bg-primary color-white",4,"matHeaderRowDef"],["mat-row","","class","mat-row",4,"matRowDef","matRowDefColumns"],[3,"pageSize","pageSizeOptions"],["fxLayout","row","fxLayoutAlign","end center",1,"form-input","select",2,"width","100px"],["name","acquis",3,"ngModelChange","ngModel","placeholder"],[1,"selectMin",3,"value"],["name","doublon",1,"scrollBarAccent",3,"ngModelChange","ngModel","placeholder"],["name","bloc",1,"scrollBarAccent",3,"ngModelChange","ngModel","placeholder"],["fxLayout","row","fxLayoutAlign","end center",1,"form-input","select",2,"width","150px"],["name","anneeSelect","multiple","",3,"ngModelChange","ngModel","placeholder"],["class","selectMin",3,"value",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","end center",1,"form-input",2,"width","200px","min-height","55px","height","55px"],["placeholder","Filtrer les donn\xE9es","type","text",3,"input"],[1,"primary","click",2,"font-size","1.7em",3,"click","type","icone","info"],["mat-header-cell","",1,"image"],[1,"hide-on-mobile",3,"object","key"],["mat-cell","",1,"alignCenter"],["class","image click",3,"src","click",4,"ngIf"],[1,"image","click",3,"click","src"],["mat-header-cell","","mat-sort-header",""],[3,"object","key"],["mat-cell",""],[3,"ngIf","ngIfElse"],["mat-header-cell",""],["mat-header-cell","","mat-sort-header","",1,"hide-on-mobile"],["mat-cell","",1,"hide-on-mobile"],[1,"click",2,"font-size","1.2em",3,"click","classIcone","type","icone","info"],["mat-header-cell","",1,"alignCenter"],[2,"font-size","1.2em",3,"type","icone","info"],[1,"primary","click",2,"font-size","1.2em",3,"click","type","icone","info"],["mat-header-row","",1,"bg-primary","color-white"],["mat-row","",1,"mat-row"]],template:function(e,i){e&1&&(u(0,"lib-spinner",1),C(1,"async"),a(2,"section",2),C(3,"async"),a(4,"div",3)(5,"div",4)(6,"span"),d(7,"Nombre de timbres : "),l(),a(8,"span",5),d(9),C(10,"async"),C(11,"async"),l()(),g(12,Ei,32,23,"ng-container",6),l(),a(13,"table",7),_("matSortChange",function(r){return i.sortData(r)}),S(14,8),g(15,Bi,2,2,"th",9)(16,Li,2,1,"td",10),w(),S(17,11),g(18,Di,2,2,"th",12)(19,Ri,2,1,"td",13),w(),S(20,14),g(21,Oi,2,2,"th",12)(22,Ui,4,2,"td",13),w(),S(23,15),g(24,ji,2,2,"th",16)(25,$i,4,2,"td",13),w(),S(26,17),g(27,Pi,2,2,"th",18)(28,Wi,4,2,"td",19),w(),S(29,20),g(30,Gi,2,2,"th",18)(31,Yi,2,1,"td",19),w(),S(32,21),g(33,Qi,2,2,"th",18)(34,Xi,2,1,"td",19),w(),S(35,22),g(36,Zi,2,2,"th",12)(37,Ki,2,4,"td",10),w(),S(38,23),g(39,Ji,2,2,"th",12)(40,en,2,4,"td",10),w(),S(41,24),g(42,tn,2,3,"th",25)(43,nn,2,3,"td",10),w(),S(44,26),g(45,on,2,3,"th",25)(46,rn,2,3,"td",10),w(),g(47,ln,1,0,"tr",27)(48,mn,1,0,"tr",28),l(),u(49,"mat-paginator",29),l()),e&2&&(m("fxHide",M(1,10,i.load$)==!0)("textSpec","Chargement en cours ..."),s(2),m("fxHide",M(3,12,i.load$)==!1),s(7),et(M(10,14,i.total$)?M(11,16,i.total$):i.dataSource==null||i.dataSource.data==null?null:i.dataSource.data.length),s(3),m("ngIf",i.modif),s(),m("dataSource",i.dataSource),s(34),m("matHeaderRowDef",i.displayedColumns),s(),m("matRowDefColumns",i.displayedColumns),s(),m("pageSize",15)("pageSizeOptions",it(18,wi)))},dependencies:[De,Ee,xt,Ct,St,Mt,Tt,wt,vt,yt,It,Et,Re,Oe,ht,_e,W,k,V,$,Y,q,Me,ve,we,X,Dt,Fe,G],styles:[".mat-row[_ngcontent-%COMP%]{height:35px}.image[_ngcontent-%COMP%]{max-height:30px!important}.mat-column-acquis[_ngcontent-%COMP%], .mat-column-doublon[_ngcontent-%COMP%]{width:60px!important;max-width:60px!important;padding:0!important}.mat-column-ajouter[_ngcontent-%COMP%], .mat-column-modifier[_ngcontent-%COMP%], .mat-column-supprimer[_ngcontent-%COMP%]{width:35px!important;max-width:35px!important;padding:0!important}@media screen and (max-width: 800px){.mat-row[_ngcontent-%COMP%]{height:25px}.image[_ngcontent-%COMP%]{max-height:20px!important}.mat-column-acquis[_ngcontent-%COMP%], .mat-column-doublon[_ngcontent-%COMP%]{width:50px!important;max-width:50px!important;padding:0!important}.mat-column-ajouter[_ngcontent-%COMP%], .mat-column-modifier[_ngcontent-%COMP%], .mat-column-supprimer[_ngcontent-%COMP%]{width:20px!important;max-width:20px!important;padding:0!important}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:0 5px!important}th[_ngcontent-%COMP%], .mat-row[_ngcontent-%COMP%]{font-size:.8em}.mat-column-libelle[_ngcontent-%COMP%],   .mat-column-libelle .mat-sort-header-container{width:40px!important;max-width:40px!important}.mat-column-drapeau[_ngcontent-%COMP%],   .mat-column-drapeau span{width:15px!important;max-width:15px!important}.mat-column-classeur[_ngcontent-%COMP%],   .mat-column-classeur .mat-sort-header-container, .mat-column-page[_ngcontent-%COMP%],   .mat-column-page .mat-sort-header-container{width:15px!important;max-width:15px!important}.mat-column-total[_ngcontent-%COMP%],   .mat-column-total .mat-sort-header-container{width:25px!important;max-width:25px!important}.hide-on-mobile[_ngcontent-%COMP%]{display:none}}"]})};function an(o,t){if(o&1&&(u(0,"lib-spinner",5),C(1,"async")),o&2){let e=c();m("textSpec",M(1,1,e.messageLoad$))}}function sn(o,t){if(o&1&&(u(0,"mat-error",15),C(1,"async")),o&2){let e=c(2);m("innerHTML",M(1,1,e.messageError$),fe)}}function cn(o,t){if(o&1&&u(0,"app-timbre-resultat",16),o&2){let e=c(2);m("timbres$",e.timbres$)("modif",!1)}}function pn(o,t){o&1&&(a(0,"button",17),d(1," Enregistrer "),l())}function dn(o,t){if(o&1){let e=I();a(0,"form",6,1),_("ngSubmit",function(){b(e);let n=E(1),r=c();return f(r.valider(n))}),a(2,"div",7),g(3,sn,2,3,"mat-error",8),C(4,"async"),g(5,cn,1,2,"app-timbre-resultat",9),C(6,"async"),l(),a(7,"div",10)(8,"button",11),_("click",function(){b(e);let n=c();return f(n.close())}),d(9," Annuler "),l(),a(10,"input",12),_("change",function(n){b(e);let r=c();return f(r.onFileChange(n))}),l(),a(11,"button",13),_("click",function(){b(e);let n=c();return f(n.triggerFileInput())}),d(12," Choisir un fichier "),l(),g(13,pn,2,0,"button",14),C(14,"async"),l()()}if(o&2){let e,i,n=E(1),r=c();m("ngClass",n!=null&&n.submitted?"red-color":"blue-color"),s(3),m("ngIf",M(4,5,r.messageError$)),s(2),m("ngIf",((e=M(6,7,r.timbres$))==null?null:e.length)>0),s(5),Je("id",r.idFile),s(3),m("ngIf",((i=M(14,9,r.timbres$))==null?null:i.length)>0)}}var ne=class o{constructor(t,e,i,n,r,h){this.authService=t;this.timbreService=e;this.timbreBlocService=i;this.uploadService=n;this.utilsService=r;this.dialogRef=h}dossier="/assets/images/timbres/";timbres$=new y(null);messageError$=new y(null);messageLoad$=new y("Chargement en cours ...");load$=new y(null);idFile="fileImport";identTimbre=1;identBloc=1;timbresModel=[];timbresBlocsModel=[];triggerFileInput(){document.getElementById(this.idFile).click()}onFileChange(t){let e=t.target.files[0];e&&(this.load$.next(!1),this.messageLoad$.next("Chargement en cours ..."),this.saveCsv(e))}saveCsv(t){let e=new FileReader;e.onload=()=>{let i=e.result;this.parseCsv(i)},e.readAsText(t)}parseCsv(t){F([this.utilsService.getMaxIdentAsync("/timbres"),this.utilsService.getMaxIdentAsync("/timbres_bloc"),this.authService.getUser()]).pipe(T(([e,i,n])=>p(n))).subscribe(([e,i,n])=>{p(e)&&e>1&&(this.identTimbre=e+1),p(i)&&i>1&&(this.identBloc=i+1),this.timbresModel=[],this.timbres$.next(null),mi.parse(t,{header:!0,skipEmptyLines:!0,complete:r=>{p(r.data)&&r.data?.length>0&&(this.timbresBlocsModel=[],r.data.forEach((h,de)=>{this.timbresModel.push(this.setTimbre(h,n)),this.identTimbre++,de==r.data.length-1&&(this.timbres$.next(this.timbresModel),this.load$.next(!0))}))},error:r=>{console.error("Erreur lors du parsing du CSV :",r)}})})}setTimbre(t,e){let i=new P,n=t.CODE!="NULL"&&t.CODE!=""?Number(t.CODE):null,r=t.IDENT_BLOC!="NULL"&&t.IDENT_BLOC!=""?Number(t.IDENT_BLOC):null,h=t.ANNEE!="NULL"&&t.ANNEE!=""?Number(t.ANNEE):null,de=t.MONNAIE!="NULL"&&t.MONNAIE!=""?t.MONNAIE:null;i.setId(this.identTimbre),i.setType(t.TYPE!="NULL"&&t.TYPE!=""?t.TYPE:null),i.setYt(t.YT!="NULL"&&t.YT!=""?t.YT:null);let oe=new Z;oe.setIdTimbre(i.getId()),oe.setIdUser(e.getId()),oe.setAcquis(t.ACQUIS=="1"),oe.setDoublon(t.DOUBLON=="1"),i.setTimbreAcquisModel(oe);let N=this.dossier+h+"/",re="";if(p(r)){if(N+="bloc/"+r,re=N+".png",N+="-",i.setTimbreBlocModel(this.timbresBlocsModel.find(v=>v.getAnnee()==h&&v.idOrigine==r)),pe(i.getTimbreBlocModel())){let v=new jt;v.setId(this.identBloc),v.setAnnee(h),v.setMonnaie(de),v.idOrigine=r;let le=new kt;le.setIdBloc(this.identBloc),le.setIdUser(e.getId()),le.setAcquis(t.ACQUIS_BLOC=="1"),le.setDoublon(t.DOUBLON_BLOC=="1"),v.setTimbreBlocAcquisModel(le),this.uploadService.checkIfImageExists(re).pipe(T()).subscribe(si=>{si&&(v.setImage(re),v.setImageTable(re),v.setImageZoom(re))}),this.timbresBlocsModel.push(v),i.setTimbreBlocModel(v),this.identBloc++}i.setIdBloc(i.getTimbreBlocModel()?.getId())}else i.setAnnee(h),i.setMonnaie(de);return N+=n+".png",this.uploadService.checkIfImageExists(N).pipe(T()).subscribe(v=>{v&&(i.setImage(N),i.setImageTable(N),i.setImageZoom(N))}),i}valider(t){this.messageError$.next(null),t?.valid&&(this.load$.next(!1),this.messageLoad$.next("Import en cours ..."),p(this.timbresBlocsModel)&&this.timbresBlocsModel?.length>0&&this.timbresBlocsModel.forEach((e,i)=>{this.saveBloc(e)}),this.timbres$.pipe(T()).subscribe(e=>{if(p(e)&&e?.length>0)e.forEach((i,n)=>{this.saveTimbre(i,n==e.length-1)});else{this.messageError$.next("Donn\xE9es incorrectes");return}}))}saveBloc(t){F([this.timbreBlocService.upload(t,"autre"),this.timbreBlocService.upload(t,"table"),this.timbreBlocService.upload(t,"zoom")]).pipe(T(([e,i,n])=>p(e)&&p(n)&&p(i))).subscribe(([e,i,n])=>{p(i)&&i!="nok"&&t.setImage(i),p(e)&&e!="nok"&&t.setImageTable(e),p(n)&&n!="nok"&&t.setImageZoom(n),t?.getTimbreBlocAcquisModel()?.isAcquis()&&this.timbreBlocService.addAcquis(t?.getTimbreBlocAcquisModel()?.getIdUser(),t,t?.getTimbreBlocAcquisModel()?.isDoublon()),this.timbreBlocService.ajouter(t,!1)})}saveTimbre(t,e){F([this.timbreService.upload(t,"autre"),this.timbreService.upload(t,"table"),this.timbreService.upload(t,"zoom")]).pipe(T(([i,n,r])=>p(i)&&p(r)&&p(n))).subscribe(([i,n,r])=>{p(n)&&n!="nok"&&t.setImage(n),p(i)&&i!="nok"&&t.setImageTable(i),p(r)&&r!="nok"&&t.setImageZoom(r),t?.getTimbreAcquisModel()?.isAcquis()&&this.timbreService.addAcquis(t?.getTimbreAcquisModel()?.getIdUser(),t,t?.getTimbreAcquisModel()?.isDoublon()),this.timbreService.ajouter(t,e),e&&(this.load$.next(!0),this.close())})}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||o)(x(he),x(A),x(H),x(K),x(O),x(Ae))};static \u0275cmp=U({type:o,selectors:[["app-timbre-importer"]],decls:8,vars:4,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],[3,"ngIf","ngIfElse"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","start stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","column","fxLayoutGap","20px",1,"bloc-modal"],[3,"innerHTML",4,"ngIf"],[3,"timbres$","modif",4,"ngIf"],["fxLayout","row","fxLayoutGap","10px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","file","accept",".xls, .xlsx, .csv","hidden","","required","",3,"change","id"],["type","button","mat-raised-button","","color","accent",1,"rounded","large","color-white",3,"click"],["type","submit","class","rounded large color-white","mat-raised-button","","color","accent",4,"ngIf"],[3,"innerHTML"],[3,"timbres$","modif"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"]],template:function(e,i){if(e&1&&(a(0,"div",2)(1,"div",3)(2,"span"),d(3,"TIMBRE IMPORTER"),l()(),g(4,an,2,3,"ng-template",4),C(5,"async"),g(6,dn,15,11,"ng-template",null,0,j),l()),e&2){let n=E(7);s(4),m("ngIf",M(5,2,i.load$)==!1)("ngIfElse",n)}},dependencies:[Q,Be,ge,W,k,V,$,Y,q,Ce,Ie,ye,Se,X,ie,G]})};var ke=class o{constructor(t,e,i){this.headerService=t;this.timbreService=e;this.dialog=i}FontAwesomeTypeEnum=xe;FontAwesomeEnum=Te;ngOnInit(){this.headerService.titre$.next("TIMBRES"),this.timbreService.getTimbres()}ajouter(){let t=this.dialog.open(te,{maxHeight:"95vh",width:"30%"});t.afterClosed().subscribe(()=>{t.close()})}ajouterBloc(){let t=this.dialog.open(Wt,{maxHeight:"95vh",width:"30%"});t.afterClosed().subscribe(()=>{t.close()})}ajouterBouchon(){this.timbreService.ajouterSansId(this.timbreService.getBouchon())}importer(){let t=this.dialog.open(ne,{height:"90vh",width:"70%"});t.afterClosed().subscribe(()=>{t.close()})}static \u0275fac=function(e){return new(e||o)(x(lt),x(A),x(Le))};static \u0275cmp=U({type:o,selectors:[["app-timbre-layout"]],decls:12,vars:2,consts:[["fxLayout","row","fxLayoutAlign","space-between stretch"],["fxFlex","5"],["fxFlex","","fxLayout","column","fxLayoutGap","20px"],["fxLayout","row","fxLayoutGap","20px"],["mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["mat-raised-button","","color","accent",1,"rounded","large","color-white",3,"click"],[3,"timbres$","total$"]],template:function(e,i){e&1&&(a(0,"div",0),u(1,"div",1),a(2,"div",2)(3,"div",3)(4,"button",4),_("click",function(){return i.ajouter()}),d(5," Ajouter "),l(),a(6,"button",4),_("click",function(){return i.ajouterBloc()}),d(7," Ajouter Bloc "),l(),a(8,"button",5),_("click",function(){return i.importer()}),d(9," Importer "),l()(),u(10,"app-timbre-resultat",6),l(),u(11,"div",1),l()),e&2&&(s(10),m("timbres$",i.timbreService.timbres$)("total$",i.timbreService.total$))},dependencies:[Q,k,V,$,q,ie]})};var un=[{path:"",component:ke},{path:"importer",component:ne}],Ve=class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=be({type:o});static \u0275inj=ue({imports:[$e.forChild(un),$e]})};var ai=class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=be({type:o});static \u0275inj=ue({providers:[O,J,A,H,K,ot()],imports:[Bt,Ve,nt,mt,at,gt,Rt,Ot,Qt,Ft,_t,At,Gt,Xt,Zt,Yt]})};export{ai as TimbreModule};

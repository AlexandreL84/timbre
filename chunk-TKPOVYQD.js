import{l as f,m as d,n as C,u as y,v as I}from"./chunk-WOTJWQDQ.js";import{D as E,H as R,K as m,k as p,ob as s,x as a}from"./chunk-XHCW746T.js";import{g as l}from"./chunk-GOLCFQAC.js";var v=(i=>(i.TIMBRE="TIMBRE",i.BLOC="BLOC",i.CARNET="CARNET",i.COLLECTOR="COLLECTOR",i))(v||{});var n=class extends d{annees;acquis;doublon;idBloc;type;user;sort;getAnnees(){return this.annees}setAnnees(e){this.annees=e}getAcquis(){return this.acquis}setAcquis(e){this.acquis=e}getDoublon(){return this.doublon}setDoublon(e){this.doublon=e}getIdBloc(){return this.idBloc}setIdBloc(e){this.idBloc=e}getUser(){return this.user}setUser(e){this.user=e}getType(){return this.type}setType(e){this.type=e}getSort(){return this.sort}setSort(e){this.sort=e}initCritere(){this.setType(["TIMBRE","CARNET","BLOC"])}initCritereBloc(){this.setType(["CARNET","BLOC"])}};l([f("Ann\xE9e")],n.prototype,"annees",2),l([f("Acquis")],n.prototype,"acquis",2),l([f("Doublon")],n.prototype,"doublon",2),l([f("Ident bloc")],n.prototype,"idBloc",2),l([f("Type")],n.prototype,"type",2),l([f("User")],n.prototype,"user",2);var u=class extends d{idUser;key;value;constructor(e,r,t){super(),this.key=e||null,this.value=r||null,this.idUser=t||null}getIdUser(){return this.idUser}setIdUser(e){this.idUser=e}getKey(){return this.key}setKey(e){this.key=e}getValue(){return this.value}setValue(e){this.value=e}};l([f("Ident Utilisateur")],u.prototype,"idUser",2),l([f("Key")],u.prototype,"key",2),l([f("Value")],u.prototype,"value",2);var O=class h{constructor(e,r){this.firestore=e;this.authService=r}timbreCritereModel=new n;timbreCritereBlocModel=new n;getTimbreCritere(e){return this.getPreferencesByKey(e).pipe(a(),p(r=>{if(s(r)){let t=C(n,r.getValue());return e=="timbreCritere"?this.timbreCritereModel=t:e=="blocCritere"&&(this.timbreCritereBlocModel=t),t}return new n}))}getPreferencesByKey(e){let r=new u(e);return this.authService.userSelect$.pipe(a(t=>s(t)),E(t=>s(t)?this.firestore.collection("/preference",i=>this.getRef(i,r)).valueChanges().pipe(a(),p(i=>{if(s(i)&&i?.length>0)return this.constructPreferences(i)[0]})):null))}getPreferencesByUser(){return this.authService.userSelect$.pipe(a(e=>s(e)),E(e=>s(e)?this.firestore.collection("/preference",r=>r.where("idUser","==",e.getId())).valueChanges().pipe(a(),p(r=>this.constructPreferences(r))):null))}getRef(e,r){let t=e;return s(r)&&(s(r.getIdUser())&&(t=t.where("idUser","==",r.getIdUser())),s(r.getKey())&&(t=t.where("key","==",r.getKey()))),t}getPreference(e){return this.firestore.collection("/preference",r=>this.getRef(r,e)).valueChanges()}ajouter(e,r){let t=JSON.stringify(r);console.log(t);let i=new u(e,t);console.log(i),this.authService.userSelect$.pipe(a(o=>s(o))).subscribe(o=>{i.setIdUser(o.getId()),this.getPreference(i).pipe(a()).subscribe(c=>{s(c)&&c?.length>0?console.error("pr\xE9f\xE9rence d\xE9j\xE0 existante"):this.firestore.collection("/preference").add(Object.assign(new Object,i)).then(g=>{}).catch(g=>{console.error("Erreur d'ajout :",g)})})})}modifier(e,r){let t=JSON.stringify(r),i=new u(e,t);this.authService.userSelect$.pipe(a(o=>s(o))).subscribe(o=>{i.setIdUser(o.getId()),this.firestore.collection("/preference",c=>this.getRef(c,i)).get().pipe().subscribe(c=>{s(c)&&c?.size>0?c.forEach(g=>{g.ref.update(Object.assign(new Object,i)).then(b=>{}).catch(b=>{console.error("Erreur de modification :",b)})}):this.ajouter(e,r)})})}supprimer(e){let r=new u(e);this.authService.userSelect$.pipe(a(t=>s(t))).subscribe(t=>{r.setIdUser(t.getId()),this.firestore.collection("/preference",i=>this.getRef(i,r)).get().pipe().subscribe(i=>{s(i)&&i?.size>0&&i.forEach(o=>{o.ref.delete().then(c=>{}).catch(c=>{console.error("Erreur de modification :",c)})})})})}supprimerTout(){let e=new u;this.authService.userSelect$.pipe(a(r=>s(r))).subscribe(r=>{e.setIdUser(r.getId()),this.firestore.collection("/preference",t=>this.getRef(t,e)).get().pipe().subscribe(t=>{s(t)&&t?.size>0&&t.forEach(i=>{i.ref.delete().then(o=>{}).catch(o=>{console.error("Erreur de modification :",o)})})})})}constructPreferences(e){let r=[];return e?.length>0&&e.forEach(t=>{r.push(new u(t.key,JSON.parse(t.value),t.idUser))}),r}getAllPreferences(){return this.firestore.collection("/preference",null).valueChanges()}static \u0275fac=function(r){return new(r||h)(m(y),m(I))};static \u0275prov=R({token:h,factory:h.\u0275fac})};export{v as a,n as b,O as c};

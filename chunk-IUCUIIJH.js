import{A as O,F as j,Fa as V,Ga as C,K as W,M as L,O as S,Ra as M,b as k,d as A,e as w,f as R,g as p,i as N,j as y,k as m,l as I,m as h,n as f,q as u,r as D,t as U,u as b,v as F,x as T,z as _}from"./chunk-E6QTGJW5.js";import{a as P}from"./chunk-KBHVVLYT.js";var v="Service workers are disabled or not supported by this browser";function B(t){return y(()=>R(new Error(t)))}var d=class{constructor(r){if(this.serviceWorker=r,!r)this.worker=this.events=this.registration=B(v);else{let n=m(r,"controllerchange").pipe(p(()=>r.controller)),s=y(()=>w(r.controller)),o=N(s,n);this.worker=o.pipe(f(l=>!!l)),this.registration=this.worker.pipe(b(()=>r.getRegistration()));let g=m(r,"message").pipe(p(l=>l.data)).pipe(f(l=>l&&l.type)).pipe(U());g.connect(),this.events=g}}postMessage(r,e){return this.worker.pipe(u(1),F(n=>{n.postMessage(P({action:r},e))})).toPromise().then(()=>{})}postMessageWithOperation(r,e,n){let s=this.waitForOperationCompleted(n),o=this.postMessage(r,e);return Promise.all([o,s]).then(([,i])=>i)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(r){let e;return typeof r=="string"?e=n=>n.type===r:e=n=>r.includes(n.type),this.events.pipe(f(e))}nextEventOfType(r){return this.eventsOfType(r).pipe(u(1))}waitForOperationCompleted(r){return this.eventsOfType("OPERATION_COMPLETED").pipe(f(e=>e.nonce===r),u(1),p(e=>{if(e.result!==void 0)return e.result;throw new Error(e.error)})).toPromise()}get isEnabled(){return!!this.serviceWorker}},z=(()=>{class t{get isEnabled(){return this.sw.isEnabled}constructor(e){if(this.sw=e,this.pushManager=null,this.subscriptionChanges=new k,!e.isEnabled){this.messages=h,this.notificationClicks=h,this.subscription=h;return}this.messages=this.sw.eventsOfType("PUSH").pipe(p(s=>s.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(p(s=>s.data)),this.pushManager=this.sw.registration.pipe(p(s=>s.pushManager));let n=this.pushManager.pipe(b(s=>s.getSubscription()));this.subscription=I(n,this.subscriptionChanges)}requestSubscription(e){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(v));let n={userVisibleOnly:!0},s=this.decodeBase64(e.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),o=new Uint8Array(new ArrayBuffer(s.length));for(let i=0;i<s.length;i++)o[i]=s.charCodeAt(i);return n.applicationServerKey=o,this.pushManager.pipe(b(i=>i.subscribe(n)),u(1)).toPromise().then(i=>(this.subscriptionChanges.next(i),i))}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(v));let e=n=>{if(n===null)throw new Error("Not subscribed to push notifications.");return n.unsubscribe().then(s=>{if(!s)throw new Error("Unsubscribe failed!");this.subscriptionChanges.next(null)})};return this.subscription.pipe(u(1),b(e)).toPromise()}decodeBase64(e){return atob(e)}static{this.\u0275fac=function(n){return new(n||t)(O(d))}}static{this.\u0275prov=T({token:t,factory:t.\u0275fac})}}return t})(),Z=(()=>{class t{get isEnabled(){return this.sw.isEnabled}constructor(e){if(this.sw=e,!e.isEnabled){this.versionUpdates=h,this.unrecoverable=h;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(v));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:e},e)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(v));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:e},e)}static{this.\u0275fac=function(n){return new(n||t)(O(d))}}static{this.\u0275prov=T({token:t,factory:t.\u0275fac})}}return t})();var x=new _("");function $(t,r,e,n){return()=>{if(!(M(n)&&"serviceWorker"in navigator&&e.enabled!==!1))return;let s=t.get(L),o=t.get(C);s.runOutsideAngular(()=>{let a=navigator.serviceWorker,c=()=>a.controller?.postMessage({action:"INITIALIZE"});a.addEventListener("controllerchange",c),o.onDestroy(()=>{a.removeEventListener("controllerchange",c)})});let i;if(typeof e.registrationStrategy=="function")i=e.registrationStrategy();else{let[a,...c]=(e.registrationStrategy||"registerWhenStable:30000").split(":");switch(a){case"registerImmediately":i=w(null);break;case"registerWithDelay":i=K(+c[0]||0);break;case"registerWhenStable":let g=A(t.get(C).whenStable());i=c[0]?I(g,K(+c[0])):g;break;default:throw new Error(`Unknown ServiceWorker registration strategy: ${e.registrationStrategy}`)}}s.runOutsideAngular(()=>i.pipe(u(1)).subscribe(()=>navigator.serviceWorker.register(r,{scope:e.scope}).catch(a=>console.error("Service worker registration failed with:",a))))}}function K(t){return w(null).pipe(D(t))}function G(t,r){return new d(M(r)&&t.enabled!==!1?navigator.serviceWorker:void 0)}var E=class{};function ne(t,r={}){return j([z,Z,{provide:x,useValue:t},{provide:E,useValue:r},{provide:d,useFactory:G,deps:[E,S]},{provide:V,useFactory:$,deps:[W,x,E,S],multi:!0}])}var oe={production:!1,firebase:{apiKey:"AIzaSyAmexzxsCubIhsxjsooRnKz0a2VugWPPf8",authDomain:"book-f941b.firebaseapp.com",databaseURL:"https://book-f941b.firebaseio.com",projectId:"book-f941b",storageBucket:"book-f941b.appspot.com",messagingSenderId:"476658436575"}};export{ne as a,oe as b};

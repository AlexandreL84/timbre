import{a as le,b as Qe,c as Xe,d as Ke,e as Je,f as et,g as hi,h as ii,i as tt,j as _i,k as ni,l as it,m as oi,n as ri,o as li,p as ai,q as mi,r as si}from"./chunk-HAUWJINY.js";import{d as Fe,i as Ze}from"./chunk-A22FMLGJ.js";import{A as Pt,B as kt,C as qt,D as Vt,E as Ht,F as $t,G as Wt,H as zt,I as dt,J as Gt,K as Yt,M as Ye,N as Zt,O as Qt,P as Xt,Q as re,R as Kt,S as Jt,T as ei,U as ti,V as Se,a as he,b as Dt,c as q,d as V,e as H,g as ne,h as $,i as At,j as Lt,m as Rt,n as Ot,o as He,p as Ce,r as $e,w as Ge,x as Nt,y as Ut,z as jt}from"./chunk-ZR6T3XZ3.js";import{$a as R,Ab as Le,Ac as xe,Bb as J,Bc as Te,Cc as Me,Dc as ve,E as be,Eb as ee,Ec as Ne,F as De,Fa as l,Fb as It,Fc as Ue,Ga as a,Gc as je,H as X,Ha as d,Hc as Pe,Ia as O,Ic as ke,Ja as N,Jb as wt,Jc as qe,Kc as Ft,L as k,La as B,M as Ae,Oa as g,Qa as c,Qb as pt,R as h,S as _,Ta as yt,Va as me,Wa as se,Xa as ce,Ya as w,Yd as ye,Za as u,_a as K,_d as oe,ab as Ct,bb as D,bc as p,be as We,cb as A,d as I,db as L,fa as fe,fc as Bt,ga as ct,gb as St,gc as T,ge as ze,ha as m,hc as te,ia as M,ic as ie,j as G,k as Q,kb as C,lb as S,mb as P,md as Ve,oc as Re,pc as Et,ta as b,w as y,wa as s,wc as Oe,z as vt,zb as ge,zc as _e}from"./chunk-NLMYPIXB.js";import"./chunk-65CH3ZW6.js";import{g as Mt,i as x}from"./chunk-GV7GV3NK.js";var v=class extends te{id;idBloc;annee;monnaie;type;yt;image;imageTable;imageZoom;timbreAcquisModel;timbreBlocModel;constructor(t,e,i,n,r,f,F,de,Z,ue,Tt){super(),this.id=t||null,this.idBloc=e||null,this.annee=i||null,this.monnaie=n||null,this.type=r||null,this.yt=f||null,this.image=F||null,this.imageTable=de||null,this.imageZoom=Z||null,this.timbreAcquisModel=ue||null,this.timbreBlocModel=Tt||null}getId(){return this.id}setId(t){this.id=t}getIdBloc(){return this.idBloc}setIdBloc(t){this.idBloc=t}getAnnee(){return this.annee}setAnnee(t){this.annee=t}getMonnaie(){return this.monnaie}setMonnaie(t){this.monnaie=t}getType(){return this.type}setType(t){this.type=t}getYt(){return this.yt}setYt(t){this.yt=t}getImage(){return this.image}setImage(t){this.image=t}getImageTable(){return this.imageTable}setImageTable(t){this.imageTable=t}getImageZoom(){return this.imageZoom}setImageZoom(t){this.imageZoom=t}getTimbreAcquisModel(){return this.timbreAcquisModel}setTimbreAcquisModel(t){this.timbreAcquisModel=t}getTimbreBlocModel(){return this.timbreBlocModel}setTimbreBlocModel(t){this.timbreBlocModel=t}};x([T("Identifiant")],v.prototype,"id",2),x([T("Identifiant bloc")],v.prototype,"idBloc",2),x([T("Ann\xE9e")],v.prototype,"annee",2),x([T("Monnaie")],v.prototype,"monnaie",2),x([T("Type")],v.prototype,"type",2),x([T("R\xE9ference Yvert Tellier")],v.prototype,"yt",2),x([T("Image")],v.prototype,"image",2),x([T("Image tableau")],v.prototype,"imageTable",2),x([T("Image zoom")],v.prototype,"imageZoom",2),x([T("v\xE9rif")],v.prototype,"timbreAcquisModel",2),x([T("Bloc")],v.prototype,"timbreBlocModel",2);var Ie=class{dossier;nom;alignLabel;detail;file;getDossier(){return this.dossier}setDossier(t){this.dossier=t}getNom(){return this.nom}setNom(t){this.nom=t}getAlignLabel(){return this.alignLabel}setAlignLabel(t){this.alignLabel=t}getDetail(){return this.detail}setDetail(t){this.detail=t}getFile(){return this.file}setFile(t){this.file=t}};var ae=class{key;dossier;maxWidth;maxHeight;getKey(){return this.key}setKey(t){this.key=t}getDossier(){return this.dossier}setDossier(t){this.dossier=t}getMaxWidth(){return this.maxWidth}setMaxWidth(t){this.maxWidth=t}getMaxHeight(){return this.maxHeight}setMaxHeight(t){this.maxHeight=t}};var U=class extends te{idUser;idTimbre;acquis;doublon;constructor(t,e,i,n){super(),this.idUser=t||null,this.idTimbre=e||null,this.acquis=i||!1,this.doublon=n||!1}getIdUser(){return this.idUser}setIdUser(t){this.idUser=t}getIdTimbre(){return this.idTimbre}setIdTimbre(t){this.idTimbre=t}isAcquis(){return this.acquis}setAcquis(t){this.acquis=t}isDoublon(){return this.doublon}setDoublon(t){this.doublon=t}};x([T("Identifiant Utilisateur")],U.prototype,"idUser",2),x([T("Identifiant timbre")],U.prototype,"idTimbre",2),x([T("Acquis")],U.prototype,"acquis",2),x([T("Doublon")],U.prototype,"doublon",2);var E=class extends te{id;annee;monnaie;image;imageTable;imageZoom;constructor(t,e,i,n,r,f){super(),this.id=t||null,this.annee=e||null,this.monnaie=i||null,this.image=n||null,this.imageTable=r||null,this.imageZoom=f||null}getId(){return this.id}setId(t){this.id=t}getAnnee(){return this.annee}setAnnee(t){this.annee=t}getMonnaie(){return this.monnaie}setMonnaie(t){this.monnaie=t}getImage(){return this.image}setImage(t){this.image=t}getImageTable(){return this.imageTable}setImageTable(t){this.imageTable=t}getImageZoom(){return this.imageZoom}setImageZoom(t){this.imageZoom=t}};x([T("Identifiant")],E.prototype,"id",2),x([T("Ann\xE9e")],E.prototype,"annee",2),x([T("Monnaie")],E.prototype,"monnaie",2),x([T("Image")],E.prototype,"image",2),x([T("Image tableau")],E.prototype,"imageTable",2),x([T("Image zoom")],E.prototype,"imageZoom",2);var W=class o{basePath="/timbres";basePathAcquis="/timbres_acquis";basePathBloc="/timbres_bloc";dossierImage="timbres/";static \u0275fac=function(e){return new(e||o)};static \u0275prov=be({token:o,factory:o.\u0275fac})};var z=class o{constructor(t,e){this.firestore=t;this.timbreUtilsService=e}basePathBloc="/timbres_bloc";heigthTable=50;widthTimbre=100;heightTimbre=100;widthTimbreZoom=500;heightTimbreZoom=500;timbresBlocModel$=new I(null);getDossier(t,e){let i=this.timbreUtilsService.dossierImage+"/"+t.getAnnee();return p(e)&&(i=i+"/"+e),i=i+"/bloc/"+t.getId(),i}getBlocByIdAsync(t){return this.firestore.collection(this.basePathBloc,e=>e.where("id","==",t)).valueChanges().pipe(G(e=>ie(E,e[0])))}getBlocsAsync(t){return console.log(t),this.firestore.collection(this.basePathBloc,e=>{let i=e;return p(t)&&p(t.getAnnees())&&t.getAnnees()?.length>0&&(i=i.where("annee","==",t.getAnnees()[0])),i=i.orderBy("id","asc"),i}).valueChanges().pipe(y(),G(e=>this.constructBlocs(e)))}getBlocs(t){this.timbresBlocModel$.next(null),this.firestore.collection(this.basePathBloc,e=>{let i=e;return p(t)&&p(t.getAnnees())&&t.getAnnees()?.length>0&&(i=i.where("annee","==",t.getAnnees()[0])),i=i.orderBy("id","asc"),i}).valueChanges().pipe(y()).subscribe(e=>{this.constructBlocs(e)})}getMaxIdentAsync(){let t=this.firestore.collection(this.basePathBloc).ref.orderBy("id","desc").limit(1);return Fe(t).pipe(G(e=>e.length>0?e[0].id+1:1))}constructBlocs(t){let e=[];return t?.length>0&&t.forEach(i=>{let n=ie(E,i);e.push(n)}),this.timbresBlocModel$.next(e),e}addBloc(t){this.getMaxIdentAsync().pipe(y()).subscribe(e=>{t.setId(e),this.firestore.collection(this.basePathBloc).add(Object.assign(new Object,t)),this.getBlocs()})}modifierBloc(t){this.firestore.collection(this.basePathBloc).ref.where("id","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.update(Object.assign(new Object,t)),this.getBlocs()})}).catch(e=>{console.error("Erreur de mise \xE0 jour:",e)})}deleteBloc(t){this.firestore.collection(this.basePathBloc).ref.where("id","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.delete(),this.getBlocs()})}).catch(e=>{console.error("Erreur de suppression :",e)})}getBouchon(){let t=new E;return t.setAnnee(new Date().getFullYear()),t.setMonnaie("E"),t}static \u0275fac=function(e){return new(e||o)(X(Re),X(W))};static \u0275prov=be({token:o,factory:o.\u0275fac})};var j=class o{constructor(t,e,i,n){this.firestore=t;this.authService=e;this.timbreBlocService=i;this.timbreUtilsService=n}basePath="/timbres";basePathAcquis="/timbres_acquis";basePathBloc="/timbres_bloc";heigthTable=50;widthTimbre=100;heightTimbre=100;widthTimbreZoom=500;heightTimbreZoom=500;total$=new I(0);timbres$=new I(null);getDossier(t,e){let i=this.timbreUtilsService.dossierImage+"/"+t.getAnnee();return p(e)&&(i=i+"/"+e),p(t.getIdBloc())&&(i=i+"/bloc/"+t.getIdBloc()),i}getTimbreByIdAsync(t){return this.firestore.collection(this.basePath,e=>e.where("id","==",t)).valueChanges().pipe(G(e=>ie(v,e[0])))}getTimbres(t){this.timbres$.next(null),Q([this.getAllTimbres(t),this.getTimbreAcquis(),this.timbreBlocService.getBlocsAsync(t)]).pipe(y()).subscribe(([e,i,n])=>{this.constructTimbres(e,i,n,t)})}getAllTimbres(t){return this.firestore.collection(this.basePath,e=>{let i=e;return p(t)&&p(t.getAnnees())&&t.getAnnees()?.length>0&&(i=i.where("annee","==",t.getAnnees()[0])),i=i.orderBy("id","asc"),i}).valueChanges()}getMaxIdentAsync(){let t=this.firestore.collection(this.basePath).ref.orderBy("id","desc").limit(1);return Fe(t).pipe(G(e=>e.length>0?e[0].id+1:1))}constructTimbres(t,e,i,n){let r=[];t?.length>0&&t.forEach(f=>{let F=ie(v,f);if(p(i)){let Z=i.find(ue=>ue.getId()==F?.getIdBloc());p(Z)&&F.setTimbreBlocModel(Z)}if(p(e)){let Z=e.find(ue=>ue.idTimbre==F.getId());p(Z)?F.setTimbreAcquisModel(ie(U,Z)):F.setTimbreAcquisModel(new U)}let de=!0;p(n)&&(p(n.getAcquis())&&!(n.getAcquis()=="TOUS"||n.getAcquis()=="OUI"&&F.getTimbreAcquisModel().isAcquis()||n.getAcquis()=="NON"&&!F.getTimbreAcquisModel().isAcquis())&&(de=!1),p(n.getDoublon())&&!(n.getDoublon()=="TOUS"||n.getDoublon()=="OUI"&&F.getTimbreAcquisModel().isDoublon()||n.getDoublon()=="NON"&&!F.getTimbreAcquisModel().isDoublon())&&(de=!1)),de==!0&&r.push(F)}),this.timbres$.next(r)}getTimbreAcquis(){return this.authService.getUser().pipe(y(),vt(t=>p(t)?this.getTimbreAcquisByUser(t.getId()).pipe(y(),G(e=>e)):null))}getTimbreAcquisByUser(t){return this.firestore.collection(this.basePathAcquis,e=>e.where("idUser","==",t)).valueChanges()}getTimbreBlocById(t){return this.firestore.collection(this.basePathBloc,e=>e.where("id","==",t)).valueChanges().pipe(G(e=>ie(E,e[0])))}acquis(t,e){return this.authService.getUser().pipe(y(i=>p(i))).subscribe(i=>{if(p(t?.getTimbreAcquisModel()?.getIdUser()))this.firestore.collection(this.basePathAcquis).ref.where("idTimbre","==",t.getId()).where("idUser","==",i.getId()).get().then(n=>{n.forEach(r=>{let f=t.getTimbreAcquisModel();e?(f.setAcquis(!0),f.setDoublon(!f.isDoublon())):(f.setAcquis(!f.isAcquis()),f.isAcquis()||f.setDoublon(!1)),r.ref.update(Object.assign(new Object,f))})}).catch(n=>{console.error("Erreur de mise \xE0 jour:",n)});else{let n=new U;n.setIdUser(i.getId()),n.setIdTimbre(t.getId()),n.setAcquis(!0),n.setDoublon(e),t.setTimbreAcquisModel(n),this.firestore.collection(this.basePathAcquis).add(Object.assign(new Object,n))}})}addTimbre(t){t.setTimbreAcquisModel(null),t.setTimbreBlocModel(null),this.getMaxIdentAsync().pipe(y()).subscribe(e=>{t.setId(e),this.firestore.collection(this.basePath).add(Object.assign(new Object,t)),this.getTimbres()})}modifierTimbre(t){t.setTimbreAcquisModel(null),this.firestore.collection(this.basePath).ref.where("id","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.update(Object.assign(new Object,t)),this.getTimbres()})}).catch(e=>{console.error("Erreur de mise \xE0 jour:",e)})}deleteTimbre(t){this.authService.getUser().pipe(y(e=>p(e))).subscribe(e=>{p(t?.getTimbreAcquisModel()?.getIdUser())&&this.firestore.collection(this.basePathAcquis).ref.where("idTimbre","==",t.getId()).where("idUser","==",e.getId()).get().then(i=>{i.forEach(n=>{n.ref.delete()})}),this.firestore.collection(this.basePath).ref.where("id","==",t.getId()).get().then(i=>{i.forEach(n=>{n.ref.delete(),this.getTimbres()})}).catch(i=>{console.error("Erreur de suppression :",i)})})}getBouchon(){let t=new v;return t.setAnnee(new Date().getFullYear()),t.setMonnaie("E"),t.setType(""),t.setYt(""),t}static \u0275fac=function(e){return new(e||o)(X(Re),X(Et),X(z),X(W))};static \u0275prov=be({token:o,factory:o.\u0275fac})};var Li=["canvas"];function Fi(o,t){o&1&&d(0,"lib-spinner",6),o&2&&s("textSpec","Chargement en cours ...")}function Ri(o,t){if(o&1&&(d(0,"mat-error",23),C(1,"async")),o&2){let e=c(2);s("innerHTML",S(1,1,e.messageError$),fe)}}function Oi(o,t){if(o&1){let e=B();l(0,"div",16)(1,"label"),d(2,"lib-libelle-model",12),a(),l(3,"input",24),L("ngModelChange",function(n){h(e);let r=c(2);return A(r.timbreModel.id,n)||(r.timbreModel.id=n),_(n)}),a()()}if(o&2){let e=c(2);m(2),s("object",e.timbreModel)("key","id"),m(),D("ngModel",e.timbreModel.id),s("disabled",!!(e.timbreModel!=null&&e.timbreModel.getId()))}}function Ni(o,t){if(o&1&&(l(0,"mat-option",14),u(1),a()),o&2){let e=t.$implicit;s("value",e),m(),Ct(" ",e.getAnnee()," - ",e.getId()," ")}}function Ui(o,t){if(o&1&&(l(0,"div",16)(1,"label"),d(2,"lib-libelle-model",12),a(),l(3,"span")(4,"b"),u(5),a()()(),l(6,"div",16)(7,"label"),d(8,"lib-libelle-model",12),a(),l(9,"span")(10,"b"),u(11),a()()()),o&2){let e,i,n=c(2);m(2),s("object",n.timbreModel)("key","annee"),m(3),K(n.timbreModel==null||(e=n.timbreModel.getTimbreBlocModel())==null?null:e.getAnnee()),m(3),s("object",n.timbreModel)("key","monnaie"),m(3),K(n.timbreModel==null||(i=n.timbreModel.getTimbreBlocModel())==null?null:i.getMonnaie())}}function ji(o,t){if(o&1){let e=B();l(0,"div",16)(1,"label"),d(2,"lib-libelle-model",12),a(),l(3,"input",25),L("ngModelChange",function(n){h(e);let r=c(2);return A(r.timbreModel.annee,n)||(r.timbreModel.annee=n),_(n)}),a()(),l(4,"div",16)(5,"label"),d(6,"lib-libelle-model",12),a(),l(7,"input",26),L("ngModelChange",function(n){h(e);let r=c(2);return A(r.timbreModel.monnaie,n)||(r.timbreModel.monnaie=n),_(n)}),a()()}if(o&2){let e=c(2);m(2),s("object",e.timbreModel)("key","annee"),m(),D("ngModel",e.timbreModel.annee),s("max",e.maxAnnee)("zMax",e.maxAnnee),m(3),s("object",e.timbreModel)("key","monnaie"),m(),D("ngModel",e.timbreModel.monnaie)}}function Pi(o,t){if(o&1){let e=B();l(0,"form",7,1),g("ngSubmit",function(){h(e);let n=w(1),r=c();return _(r.valider(n))}),l(2,"div",8),b(3,Ri,2,3,"mat-error",9),C(4,"async"),b(5,Oi,4,4,"div",10),l(6,"div",11)(7,"label"),d(8,"lib-libelle-model",12),a(),l(9,"mat-select",13),g("ngModelChange",function(n){h(e);let r=c();return _(r.changeBloc(n))}),d(10,"mat-option",14),b(11,Ni,2,3,"mat-option",15),C(12,"async"),a()(),b(13,Ui,12,6,"ng-template",5)(14,ji,8,8,"ng-template",null,2,P),l(16,"div",16)(17,"label"),d(18,"lib-libelle-model",12),a(),l(19,"input",17),L("ngModelChange",function(n){h(e);let r=c();return A(r.timbreModel.type,n)||(r.timbreModel.type=n),_(n)}),a()(),l(20,"div",16)(21,"label"),d(22,"lib-libelle-model",12),a(),l(23,"input",18),L("ngModelChange",function(n){h(e);let r=c();return A(r.timbreModel.yt,n)||(r.timbreModel.yt=n),_(n)}),a()(),l(24,"lib-upload",19),g("outPutObject",function(n){h(e);let r=c();return _(r.timbreModel=n)}),a()(),l(25,"div",20)(26,"button",21),g("click",function(){h(e);let n=c();return _(n.close())}),u(27," Annuler "),a(),l(28,"button",22),u(29," Enregistrer "),a()()()}if(o&2){let e=w(1),i=w(15),n=c();s("ngClass",e!=null&&e.submitted?"red-color":"blue-color"),m(3),s("ngIf",S(4,21,n.messageError$)),m(2),s("ngIf",n.timbreModel==null?null:n.timbreModel.getId()),m(3),s("object",n.timbreModel)("key","timbreBlocModel"),m(),s("ngModel",n.timbreModel.getTimbreBlocModel())("placeholder","Choix bloc"),m(),s("value",null),m(),s("ngForOf",S(12,23,n.timbreBlocService.timbresBlocModel$)),m(2),s("ngIf",n.timbreModel.getTimbreBlocModel())("ngIfElse",i),m(5),s("object",n.timbreModel)("key","type"),m(),D("ngModel",n.timbreModel.type),m(3),s("object",n.timbreModel)("key","yt"),m(),D("ngModel",n.timbreModel.yt),m(),s("object",n.timbreModel)("key","image")("maxWidth",n.timbreService.widthTimbre)("maxHeight",n.timbreService.heightTimbre)}}var we=class o{constructor(t,e,i,n,r){this.httpResponseHandlerService=t;this.dialogRef=e;this.timbreService=i;this.timbreBlocService=n;this.uploadService=r}canvas;messageError$=new I(null);load$=new I(null);id;maxAnnee=new Date().getFullYear();timbreModel=new v;fileUploadModel=new Ie;ngOnInit(){this.initUpload(),this.load$.next(!1),p(this.id)?this.timbreService.getTimbreByIdAsync(this.id).subscribe(t=>{this.timbreModel=t,this.load$.next(!0)}):(this.timbreModel.setAnnee(new Date().getFullYear()),this.timbreModel.setMonnaie("E"),this.load$.next(!0))}initUpload(){this.fileUploadModel.setDossier("test"),this.fileUploadModel.setNom(new Date().getTime()?.toString());let t=new ae;t.setMaxWidth(this.timbreService.widthTimbre),t.setMaxHeight(this.timbreService.heightTimbre),t.setDossier("autre");let e=new ae;e.setMaxWidth(this.timbreService.widthTimbreZoom),e.setMaxHeight(this.timbreService.heightTimbreZoom),e.setDossier("zoom"),this.fileUploadModel.setDetail([t,e])}valider(t){if(this.messageError$.next(null),t?.valid)if(p(this.timbreModel.getImage()))this.saveData();else{this.messageError$.next("Veuillez s\xE9lectionner une image");return}}saveData(){this.load$.next(!1),p(this.timbreModel.getId())?this.save():this.addTimbre()}addTimbre(){this.timbreService.getMaxIdentAsync().pipe(y()).subscribe(t=>{this.timbreModel.setId(t),this.save(!0)})}save(t){try{Q([this.uploadService.processAndUploadImageByFile(this.timbreModel?.getImage(),this.timbreService.widthTimbre,this.timbreService.heightTimbre,this.timbreModel?.getId(),this.timbreService.getDossier(this.timbreModel,"autre")),this.uploadService.processAndUploadImageByFile(this.timbreModel?.getImage(),this.timbreService.widthTimbre*(this.timbreService.heigthTable/this.timbreService.heightTimbre),this.timbreService.heigthTable,this.timbreModel?.getId(),this.timbreService.getDossier(this.timbreModel,"table")),this.uploadService.processAndUploadImageByFile(this.timbreModel?.getImage(),this.timbreService.widthTimbreZoom,this.timbreService.heightTimbreZoom,this.timbreModel?.getId(),this.timbreService.getDossier(this.timbreModel,"zoom"))]).pipe(y(([e,i,n])=>p(e)&&p(n)&&p(i))).subscribe(([e,i,n])=>{p(i)&&i!="nok"&&this.timbreModel.setImage(i),p(e)&&e!="nok"&&this.timbreModel.setImageTable(e),p(n)&&n!="nok"&&this.timbreModel.setImageZoom(n),t?this.timbreService.addTimbre(this.timbreModel):this.timbreService.modifierTimbre(this.timbreModel),this.httpResponseHandlerService.showNotificationSuccess("Transaction termin\xE9e","Votre timbre a bien \xE9t\xE9 modifi\xE9e."),this.load$.next(!0),this.dialogRef.close()})}catch{this.httpResponseHandlerService.showNotificationError("Transaction non aboutie","Votre timbre n'a pas pu \xEAtre modifi\xE9."),this.load$.next(!0)}}close(){this.dialogRef.close()}changeBloc(t){p(t)?(this.timbreModel.setIdBloc(t.getId()),this.timbreModel.setTimbreBlocModel(t),this.timbreModel.setAnnee(null),this.timbreModel.setAnnee(null),this.timbreModel.setMonnaie(null)):(this.timbreModel.setIdBloc(null),this.timbreModel.setTimbreBlocModel(null),this.timbreModel.setAnnee(new Date().getFullYear()),this.timbreModel.setMonnaie("E"))}static \u0275fac=function(e){return new(e||o)(M(Ze),M(Ce),M(j),M(z),M(le))};static \u0275cmp=k({type:o,selectors:[["app-timbre-modifier"]],viewQuery:function(e,i){if(e&1&&me(Li,5),e&2){let n;se(n=ce())&&(i.canvas=n.first)}},decls:10,vars:6,consts:[["load",""],["formModif","ngForm"],["noBloc",""],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],[3,"ngIf","ngIfElse"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","space-between stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","column","fxLayoutGap","20px",1,"bloc-modal"],[3,"innerHTML",4,"ngIf"],["fxLayout","column","class","form-input",4,"ngIf"],["fxLayout","column",1,"form-input","select"],[3,"object","key"],["name","bloc",2,"width","120px !important",3,"ngModelChange","ngModel","placeholder"],[1,"selectMin",3,"value"],["class","selectMin",3,"value",4,"ngFor","ngForOf"],["fxLayout","column",1,"form-input"],["name","type","type","text","trim","","zControl","",3,"ngModelChange","ngModel"],["name","yt","type","text","trim","","zControl","",3,"ngModelChange","ngModel"],[3,"outPutObject","object","key","maxWidth","maxHeight"],["fxLayout","row","fxLayoutGap","10px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"],[3,"innerHTML"],["name","code","type","text","trim","","upperCase","","noEspace","","required","","zControl","",3,"ngModelChange","ngModel","disabled"],["name","page","type","number","minlength","4","maxlength","4","min","1900","zMin","1900","required","","zControl","",1,"annee",2,"width","60px !important",3,"ngModelChange","ngModel","max","zMax"],["name","monnaie","type","text","trim","","minlength","1","maxlength","2","required","","zControl","",2,"width","25px !important",3,"ngModelChange","ngModel"]],template:function(e,i){if(e&1&&(l(0,"div",3)(1,"div",4)(2,"span"),u(3),a(),l(4,"span"),u(5),a()(),b(6,Fi,1,1,"ng-template",5),C(7,"async"),b(8,Pi,30,25,"ng-template",null,0,P),a()),e&2){let n=w(9);m(3),R("",i.timbreModel!=null&&i.timbreModel.getId()?"MODIFICATION":"AJOUT"," "),m(2),K(i.timbreModel==null?null:i.timbreModel.getId()),m(),s("ngIf",S(7,4,i.load$)==!1)("ngIfElse",n)}},dependencies:[oe,ye,We,Ve,ge,Le,J,q,V,$,ne,H,he,ve,Oe,Ne,_e,xe,Pe,ke,qe,je,Ue,Me,Te,re,Se,He,Ye,Qe,Xe,Ke,Je,et,ee],encapsulation:2})};var fi=Mt(hi());var ui=Mt(_i());var pe=class extends te{annees;acquis;doublon;getAnnees(){return this.annees}setAnnees(t){this.annees=t}getAcquis(){return this.acquis}setAcquis(t){this.acquis=t}getDoublon(){return this.doublon}setDoublon(t){this.doublon=t}};x([T("Ann\xE9e")],pe.prototype,"annees",2),x([T("Acquis")],pe.prototype,"acquis",2),x([T("Doublon")],pe.prototype,"doublon",2);var ki=()=>[10,20,50,100];function qi(o,t){if(o&1&&(l(0,"mat-option",8),u(1),a()),o&2){let e=t.$implicit;s("value",e),m(),R(" ",e," ")}}function Vi(o,t){if(o&1&&(l(0,"th",38),d(1,"lib-libelle-model",39),a()),o&2){let e=c();m(),s("object",e.timbre)("key","image")}}function Hi(o,t){if(o&1){let e=B();l(0,"img",42),g("click",function(){h(e);let n=c().$implicit,r=c();return _(r.utilsService.zoom(n==null?null:n.getImageZoom()))}),a()}if(o&2){let e=c().$implicit;s("src",e==null?null:e.getImageTable(),ct)}}function $i(o,t){if(o&1&&(l(0,"td",40),b(1,Hi,1,1,"img",41),a()),o&2){let e=t.$implicit;m(),s("ngIf",e==null?null:e.getImageTable())}}function Wi(o,t){if(o&1&&(l(0,"th",43),d(1,"lib-libelle-model",44),a()),o&2){let e=c();m(),s("object",e.timbre)("key","id")}}function zi(o,t){if(o&1&&(l(0,"td",45),u(1),a()),o&2){let e=t.$implicit;m(),R(" ",e==null?null:e.getId()," ")}}function Gi(o,t){if(o&1&&(l(0,"th",43),d(1,"lib-libelle-model",44),a()),o&2){let e=c();m(),s("object",e.timbre)("key","annee")}}function Yi(o,t){if(o&1&&u(0),o&2){let e,i=c().$implicit;R(" ",i==null||(e=i.getTimbreBlocModel())==null?null:e.getAnnee()," ")}}function Zi(o,t){if(o&1&&u(0),o&2){let e=c().$implicit;R(" ",e==null?null:e.getAnnee()," ")}}function Qi(o,t){if(o&1&&(l(0,"td",45),b(1,Yi,1,1,"ng-template",46)(2,Zi,1,1,"ng-template",null,0,P),a()),o&2){let e=t.$implicit,i=w(3);m(),s("ngIf",e==null?null:e.getIdBloc())("ngIfElse",i)}}function Xi(o,t){if(o&1&&(l(0,"th",43),d(1,"lib-libelle-model",44),a()),o&2){let e=c();m(),s("object",e.timbre)("key","idBloc")}}function Ki(o,t){if(o&1){let e=B();l(0,"img",42),g("click",function(){let n;h(e);let r=c(2).$implicit,f=c();return _(f.utilsService.zoom(r==null||(n=r.getTimbreBlocModel())==null?null:n.getImageZoom()))}),a()}if(o&2){let e,i=c(2).$implicit;s("src",i==null||(e=i.getTimbreBlocModel())==null?null:e.getImageTable(),ct)}}function Ji(o,t){if(o&1&&b(0,Ki,1,1,"img",41),o&2){let e,i=c().$implicit;s("ngIf",i==null||(e=i.getTimbreBlocModel())==null?null:e.getImage())}}function en(o,t){o&1&&u(0," Non ")}function tn(o,t){if(o&1&&(l(0,"td",45),b(1,Ji,1,1,"ng-template",46)(2,en,1,0,"ng-template",null,0,P),a()),o&2){let e=t.$implicit,i=w(3);m(),s("ngIf",e==null?null:e.getIdBloc())("ngIfElse",i)}}function nn(o,t){if(o&1&&(l(0,"th",47),d(1,"lib-libelle-model",44),a()),o&2){let e=c();m(),s("object",e.timbre)("key","monnaie")}}function on(o,t){if(o&1&&u(0),o&2){let e,i=c().$implicit;R(" ",(i==null||(e=i.getTimbreBlocModel())==null?null:e.getMonnaie())=="E"?"\u20AC":"Francs"," ")}}function rn(o,t){if(o&1&&u(0),o&2){let e=c().$implicit;R(" ",(e==null?null:e.getMonnaie())=="E"?"\u20AC":"Francs"," ")}}function ln(o,t){if(o&1&&(l(0,"td",48),b(1,on,1,1,"ng-template",46)(2,rn,1,1,"ng-template",null,0,P),a()),o&2){let e=t.$implicit,i=w(3);m(),s("ngIf",e==null?null:e.getIdBloc())("ngIfElse",i)}}function an(o,t){if(o&1&&(l(0,"th",47),d(1,"lib-libelle-model",44),a()),o&2){let e=c();m(),s("object",e.timbre)("key","type")}}function mn(o,t){if(o&1&&(l(0,"td",48),u(1),a()),o&2){let e=t.$implicit;m(),R(" ",e==null?null:e.getType()," ")}}function sn(o,t){if(o&1&&(l(0,"th",47),d(1,"lib-libelle-model",44),a()),o&2){let e=c();m(),s("object",e.timbre)("key","yt")}}function cn(o,t){if(o&1&&(l(0,"td",48),u(1),a()),o&2){let e=t.$implicit;m(),R(" ",e==null?null:e.getYt()," ")}}function pn(o,t){if(o&1&&(l(0,"th",43),d(1,"lib-libelle-model",44),a()),o&2){let e=c();m(),s("object",e.timbre==null?null:e.timbre.getTimbreAcquisModel())("key","acquis")}}function dn(o,t){if(o&1){let e=B();l(0,"td",40)(1,"lib-icon",49),g("click",function(){let n=h(e).$implicit,r=c();return _(r.acquis(n))}),a()()}if(o&2){let e,i,n,r=t.$implicit,f=c();m(),s("classIcone",!(r==null||(e=r.getTimbreAcquisModel())==null)&&e.isAcquis()?"accent":"primary")("type",f.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",!(r==null||(i=r.getTimbreAcquisModel())==null)&&i.isAcquis()?f.FontAwesomeEnum.CIRCLE_MINUS:f.FontAwesomeEnum.CIRCLE_PLUS)("info",!(r==null||(n=r.getTimbreAcquisModel())==null)&&n.isAcquis()?"pas acquis":"acquis")}}function un(o,t){if(o&1&&(l(0,"th",43),d(1,"lib-libelle-model",44),a()),o&2){let e=c();m(),s("object",e.timbre==null?null:e.timbre.getTimbreAcquisModel())("key","doublon")}}function bn(o,t){if(o&1){let e=B();l(0,"td",40)(1,"lib-icon",49),g("click",function(){let n=h(e).$implicit,r=c();return _(r.doublon(n))}),a()()}if(o&2){let e,i,n,r=t.$implicit,f=c();m(),s("classIcone",!(r==null||(e=r.getTimbreAcquisModel())==null)&&e.isDoublon()?"accent":"primary")("type",f.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",!(r==null||(i=r.getTimbreAcquisModel())==null)&&i.isDoublon()?f.FontAwesomeEnum.CIRCLE_MINUS:f.FontAwesomeEnum.CIRCLE_PLUS)("info",!(r==null||(n=r.getTimbreAcquisModel())==null)&&n.isDoublon()?"pas en double":"en double")}}function fn(o,t){if(o&1&&(l(0,"th",50),d(1,"lib-icon",51),a()),o&2){let e=c();m(),s("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.PENCIL)("info","Modifier")}}function gn(o,t){if(o&1){let e=B();l(0,"td",40)(1,"lib-icon",52),g("click",function(){let n=h(e).$implicit,r=c();return _(r.modifierTimbre(n))}),a()()}if(o&2){let e=c();m(),s("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.PENCIL)("info","Modifier")}}function hn(o,t){if(o&1&&(l(0,"th",50),d(1,"lib-icon",51),a()),o&2){let e=c();m(),s("type",e.FontAwesomeTypeEnum.TYPE_SOLID)("icone",e.FontAwesomeEnum.TRASH)("info","Modifier")}}function _n(o,t){if(o&1){let e=B();l(0,"td",40)(1,"lib-icon",52),g("click",function(){let n=h(e).$implicit,r=c();return _(r.deleteTimbre(n))}),a()()}if(o&2){let e=c();m(),s("type",e.FontAwesomeTypeEnum.TYPE_SOLID)("icone",e.FontAwesomeEnum.TRASH)("info","Supprimer")}}function xn(o,t){o&1&&d(0,"tr",53)}function Tn(o,t){o&1&&d(0,"tr",54)}var Be=class o{constructor(t,e,i){this.timbreService=t;this.dialog=e;this.utilsService=i;this.dataSource=new dt([])}paginator;sort;timbres$;modif=!0;load$=new I(!1);dataSource=new dt;displayedColumns;timbreCritereModel=new pe;timbre=new v;FontAwesomeEnum=Ot;FontAwesomeTypeEnum=Zt;Utils=Bt;anneeMin=2e3;anneeMax=new Date().getFullYear();ngOnInit(){this.timbre.setTimbreAcquisModel(new U),this.displayedColumns=["image","id","annee","idBloc","monnaie","type","yt","acquis","doublon"],this.modif&&this.displayedColumns.push("modifier","supprimer"),this.load$.next(!1),this.timbres$.subscribe(t=>{this.dataSource.data=t,this.load$.next(!0)})}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.sort.active="idBloc",this.sort.direction="asc",this.dataSource.sort=this.sort}sortData(t){p(t)&&(this.dataSource.sort=this.sort)}filtreByCritere(){this.timbreCritereModel.getAcquis()=="NON"&&this.timbreCritereModel.setDoublon("TOUS"),this.timbreService.getTimbres(this.timbreCritereModel)}applyFilter(t){let e=t.target.value;this.dataSource.filter=e.trim().toLowerCase()}acquis(t){this.timbreService.acquis(t,!1)}doublon(t){this.timbreService.acquis(t,!0)}modifierTimbre(t){let e=this.dialog.open(we,{height:"75vh",maxHeight:"750px",width:"30%"});e.componentInstance.id=t.getId(),e.afterClosed().subscribe(()=>{e.close()})}deleteTimbre(t){let e=this.dialog.open(ni,{maxHeight:"95vh",data:{titre:"Confirmation",message:"Souhaitez-vous supprimer le timbre <b>n\xB0 "+t?.getId()+"</b> ?",btnDroite:"Oui",btnGauche:"Non"}});e.afterClosed().subscribe(()=>{e.componentInstance.data.resultat==="valider"&&this.timbreService.deleteTimbre(t)})}exportTable(){let t=tt.json_to_sheet(this.dataSource.data),e=tt.book_new();tt.book_append_sheet(e,t,"Donn\xE9es");let i=ii(e,{bookType:"xlsx",type:"array"}),n=new Blob([i],{type:"application/octet-stream"});(0,ui.saveAs)(n,"export_timbres.xlsx")}generatePDFByImage(){let t="https://firebasestorage.googleapis.com/v0/b/book-f941b.appspot.com/o/AF.png?alt=media&token=a1039f78-3cff-41ab-8569-ea1b2cefe2c1";this.generatePDF(null)}generatePDF(t){}static \u0275fac=function(e){return new(e||o)(M(j),M($e),M(it))};static \u0275cmp=k({type:o,selectors:[["app-timbre-resultat"]],viewQuery:function(e,i){if(e&1&&(me(ze,5),me(Ge,5)),e&2){let n;se(n=ce())&&(i.paginator=n.first),se(n=ce())&&(i.sort=n.first)}},inputs:{timbres$:"timbres$",modif:"modif"},decls:69,vars:30,consts:[["noBloc",""],["fxFlexFill","",3,"fxHide","textSpec"],[3,"fxHide"],["fxLayout","row","fxLayoutAlign","space-between center","fxLayoutGap","15px"],["fxFlex","",2,"font-size","1.2em"],[1,"bold"],["fxLayout","row","fxLayoutAlign","end center",1,"form-input","select",2,"width","100px"],["name","acquis",3,"ngModelChange","ngModel","placeholder"],[1,"selectMin",3,"value"],["name","doublon",1,"scrollBarAccent",3,"ngModelChange","ngModel","placeholder"],["fxLayout","row","fxLayoutAlign","end center",1,"form-input","select",2,"width","150px"],["name","anneeSelect","multiple","",3,"ngModelChange","ngModel","placeholder"],["class","selectMin",3,"value",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","end center",1,"form-input",2,"width","200px","min-height","55px","height","55px"],["placeholder","Filtrer les donn\xE9es","type","text",3,"input"],[1,"primary","click",2,"font-size","1.7em",3,"click","type","icone","info"],["id","pdf-content","mat-table","","matSort","",3,"matSortChange","dataSource"],["matColumnDef","image"],["mat-header-cell","","class","image",4,"matHeaderCellDef"],["mat-cell","","class","alignCenter",4,"matCellDef"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","annee"],["matColumnDef","idBloc"],["matColumnDef","monnaie"],["mat-header-cell","","mat-sort-header","","class","hide-on-mobile",4,"matHeaderCellDef"],["mat-cell","","class","hide-on-mobile",4,"matCellDef"],["matColumnDef","type"],["matColumnDef","yt"],["matColumnDef","acquis"],["matColumnDef","doublon"],["matColumnDef","modifier"],["mat-header-cell","","class","alignCenter",4,"matHeaderCellDef"],["matColumnDef","supprimer"],["mat-header-row","","class","bg-primary color-white",4,"matHeaderRowDef"],["mat-row","","class","mat-row",4,"matRowDef","matRowDefColumns"],[3,"pageSize","pageSizeOptions"],["mat-header-cell","",1,"image"],[1,"hide-on-mobile",3,"object","key"],["mat-cell","",1,"alignCenter"],["class","image click",3,"src","click",4,"ngIf"],[1,"image","click",3,"click","src"],["mat-header-cell","","mat-sort-header",""],[3,"object","key"],["mat-cell",""],[3,"ngIf","ngIfElse"],["mat-header-cell","","mat-sort-header","",1,"hide-on-mobile"],["mat-cell","",1,"hide-on-mobile"],[1,"click",2,"font-size","1.2em",3,"click","classIcone","type","icone","info"],["mat-header-cell","",1,"alignCenter"],[2,"font-size","1.2em",3,"type","icone","info"],[1,"primary","click",2,"font-size","1.2em",3,"click","type","icone","info"],["mat-header-row","",1,"bg-primary","color-white"],["mat-row","",1,"mat-row"]],template:function(e,i){e&1&&(d(0,"lib-spinner",1),C(1,"async"),l(2,"section",2),C(3,"async"),l(4,"div",3)(5,"div",4)(6,"span"),u(7,"Nombre de timbres : "),a(),l(8,"span",5),u(9),a()(),l(10,"div",6)(11,"mat-select",7),L("ngModelChange",function(r){return A(i.timbreCritereModel.acquis,r)||(i.timbreCritereModel.acquis=r),r}),g("ngModelChange",function(){return i.filtreByCritere()}),l(12,"mat-option",8),u(13," Oui"),a(),l(14,"mat-option",8),u(15," Non"),a(),l(16,"mat-option",8),u(17," Tous"),a()()(),l(18,"div",6)(19,"mat-select",9),L("ngModelChange",function(r){return A(i.timbreCritereModel.doublon,r)||(i.timbreCritereModel.doublon=r),r}),g("ngModelChange",function(){return i.filtreByCritere()}),l(20,"mat-option",8),u(21," Oui"),a(),l(22,"mat-option",8),u(23," Non"),a(),l(24,"mat-option",8),u(25," Tous"),a()()(),l(26,"div",10)(27,"mat-select",11),L("ngModelChange",function(r){return A(i.timbreCritereModel.annees,r)||(i.timbreCritereModel.annees=r),r}),g("ngModelChange",function(){return i.filtreByCritere()}),b(28,qi,2,2,"mat-option",12),a()(),l(29,"div",13)(30,"input",14),g("input",function(r){return i.applyFilter(r)}),a()(),l(31,"lib-icon",15),g("click",function(){return i.exportTable()}),a()(),l(32,"table",16),g("matSortChange",function(r){return i.sortData(r)}),O(33,17),b(34,Vi,2,2,"th",18)(35,$i,2,1,"td",19),N(),O(36,20),b(37,Wi,2,2,"th",21)(38,zi,2,1,"td",22),N(),O(39,23),b(40,Gi,2,2,"th",21)(41,Qi,4,2,"td",22),N(),O(42,24),b(43,Xi,2,2,"th",21)(44,tn,4,2,"td",22),N(),O(45,25),b(46,nn,2,2,"th",26)(47,ln,4,2,"td",27),N(),O(48,28),b(49,an,2,2,"th",26)(50,mn,2,1,"td",27),N(),O(51,29),b(52,sn,2,2,"th",26)(53,cn,2,1,"td",27),N(),O(54,30),b(55,pn,2,2,"th",21)(56,dn,2,4,"td",19),N(),O(57,31),b(58,un,2,2,"th",21)(59,bn,2,4,"td",19),N(),O(60,32),b(61,fn,2,3,"th",33)(62,gn,2,3,"td",19),N(),O(63,34),b(64,hn,2,3,"th",33)(65,_n,2,3,"td",19),N(),b(66,xn,1,0,"tr",35)(67,Tn,1,0,"tr",36),a(),d(68,"mat-paginator",37),a()),e&2&&(s("fxHide",S(1,25,i.load$)==!0)("textSpec","Chargement en cours ..."),m(2),s("fxHide",S(3,27,i.load$)==!1),m(7),K(i.dataSource==null||i.dataSource.data==null?null:i.dataSource.data.length),m(2),D("ngModel",i.timbreCritereModel.acquis),s("placeholder","Acquis"),m(),s("value","OUI"),m(2),s("value","NON"),m(2),s("value","TOUS"),m(3),D("ngModel",i.timbreCritereModel.doublon),s("placeholder","Doublon"),m(),s("value","OUI"),m(2),s("value","NON"),m(2),s("value","TOUS"),m(3),D("ngModel",i.timbreCritereModel.annees),s("placeholder","Ann\xE9es"),m(),s("ngForOf",i.Utils.generateRange(i.anneeMin,i.anneeMax)),m(3),s("type",i.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",i.FontAwesomeEnum.FILE_EXEL)("info","Exporter tableauu"),m(),s("dataSource",i.dataSource),m(34),s("matHeaderRowDef",i.displayedColumns),m(),s("matRowDefColumns",i.displayedColumns),m(),s("pageSize",15)("pageSizeOptions",St(29,ki)))},dependencies:[We,Ve,Ut,Pt,Ht,kt,jt,$t,qt,Vt,Wt,zt,ze,Ge,Nt,Le,J,q,V,$,ne,H,Dt,_e,Me,re,Qt,Se,ee],styles:[".mat-row[_ngcontent-%COMP%]{height:35px}.image[_ngcontent-%COMP%]{max-height:30px!important}.mat-column-acquis[_ngcontent-%COMP%], .mat-column-doublon[_ngcontent-%COMP%]{width:60px!important;max-width:60px!important;padding:0!important}.mat-column-ajouter[_ngcontent-%COMP%], .mat-column-modifier[_ngcontent-%COMP%], .mat-column-supprimer[_ngcontent-%COMP%]{width:35px!important;max-width:35px!important;padding:0!important}@media screen and (max-width: 800px){.mat-row[_ngcontent-%COMP%]{height:25px}.image[_ngcontent-%COMP%]{max-height:20px!important}.mat-column-acquis[_ngcontent-%COMP%], .mat-column-doublon[_ngcontent-%COMP%]{width:50px!important;max-width:50px!important;padding:0!important}.mat-column-ajouter[_ngcontent-%COMP%], .mat-column-modifier[_ngcontent-%COMP%], .mat-column-supprimer[_ngcontent-%COMP%]{width:20px!important;max-width:20px!important;padding:0!important}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:0 5px!important}th[_ngcontent-%COMP%], .mat-row[_ngcontent-%COMP%]{font-size:.8em}.mat-column-libelle[_ngcontent-%COMP%],   .mat-column-libelle .mat-sort-header-container{width:40px!important;max-width:40px!important}.mat-column-drapeau[_ngcontent-%COMP%],   .mat-column-drapeau span{width:15px!important;max-width:15px!important}.mat-column-classeur[_ngcontent-%COMP%],   .mat-column-classeur .mat-sort-header-container, .mat-column-page[_ngcontent-%COMP%],   .mat-column-page .mat-sort-header-container{width:15px!important;max-width:15px!important}.mat-column-total[_ngcontent-%COMP%],   .mat-column-total .mat-sort-header-container{width:25px!important;max-width:25px!important}.hide-on-mobile[_ngcontent-%COMP%]{display:none}}"]})};function Mn(o,t){if(o&1&&(d(0,"lib-spinner",5),C(1,"async")),o&2){let e=c();s("textSpec",S(1,1,e.messageLoad$))}}function vn(o,t){if(o&1&&(d(0,"mat-error",15),C(1,"async")),o&2){let e=c(2);s("innerHTML",S(1,1,e.messageError$),fe)}}function yn(o,t){if(o&1&&d(0,"app-timbre-resultat",16),o&2){let e=c(2);s("timbres$",e.timbres$)("modif",!1)}}function Cn(o,t){o&1&&(l(0,"button",17),u(1," Enregistrer "),a())}function Sn(o,t){if(o&1){let e=B();l(0,"form",6,1),g("ngSubmit",function(){h(e);let n=w(1),r=c();return _(r.valider(n))}),l(2,"div",7),b(3,vn,2,3,"mat-error",8),C(4,"async"),b(5,yn,1,2,"app-timbre-resultat",9),C(6,"async"),a(),l(7,"div",10)(8,"button",11),g("click",function(){h(e);let n=c();return _(n.close())}),u(9," Annuler "),a(),l(10,"input",12),g("change",function(n){h(e);let r=c();return _(r.onFileChange(n))}),a(),l(11,"button",13),g("click",function(){h(e);let n=c();return _(n.triggerFileInput())}),u(12," Choisir un fichier "),a(),b(13,Cn,2,0,"button",14),C(14,"async"),a()()}if(o&2){let e,i,n=w(1),r=c();s("ngClass",n!=null&&n.submitted?"red-color":"blue-color"),m(3),s("ngIf",S(4,5,r.messageError$)),m(2),s("ngIf",((e=S(6,7,r.timbres$))==null?null:e.length)>0),m(5),yt("id",r.idFile),m(3),s("ngIf",((i=S(14,9,r.timbres$))==null?null:i.length)>0)}}var Ee=class o{constructor(t,e,i,n){this.timbreService=t;this.timbreUtilsService=e;this.uploadService=i;this.dialogRef=n}timbres$=new I(null);messageError$=new I(null);messageLoad$=new I("Chargement en cours ...");load$=new I(null);idFile="fileImport";ngOnInit(){}triggerFileInput(){document.getElementById(this.idFile).click()}onFileChange(t){let e=t.target.files[0];if(e){this.load$.next(!1),this.messageLoad$.next("Chargement en cours ...");let i=new FileReader;this.saveCsv(e,i)}}saveCsv(t,e){e.onload=()=>{let i=e.result;this.parseCsv(i)},e.readAsText(t)}parseCsv(t){let e=[];this.timbres$.next(null),fi.parse(t,{header:!0,skipEmptyLines:!0,complete:i=>{p(i.data)&&i.data?.length>0&&i.data.forEach(n=>{e.push(this.setTimbre(n))}),this.timbres$.next(e),this.load$.next(!0)},error:i=>{console.error("Erreur lors du parsing du CSV :",i)}})}setTimbre(t){let e=new v;e.setId(t.CODE!="NULL"&&t.CODE!=""?t.CODE:null),e.setIdBloc(t.IDENT_BLOC!="NULL"&&t.IDENT_BLOC!=""?t.IDENT_BLOC:null),e.setAnnee(t.ANNEE!="NULL"&&t.ANNEE!=""?t.ANNEE:null),e.setMonnaie(t.MONNAIE!="NULL"&&t.MONNAIE!=""?t.MONNAIE:null),e.setType(t.TYPE!="NULL"&&t.TYPE!=""?t.TYPE:null),e.setYt(t.YT!="NULL"&&t.YT!=""?t.YT:null);let i="/assets/images/timbres/"+e.getAnnee()+"/";return p(e.getIdBloc())&&(i+="bloc/"+e.getIdBloc()+"-"),i+=e.getId()+".png",this.uploadService.checkIfImageExists(i).pipe(y()).subscribe(n=>{n&&e.setImageTable(i)}),e}valider(t){this.messageError$.next(null),t?.valid&&(this.load$.next(!1),this.messageLoad$.next("Import en cours ..."),this.timbres$.pipe(y()).subscribe(e=>{if(p(e)&&e?.length>0)e.forEach((i,n)=>{this.saveTimbre(i,n==e.length-1)});else{this.messageError$.next("Donn\xE9es incorrectes");return}}))}saveTimbre(t,e){let i=this.timbreUtilsService.dossierImage+(p(t.getIdBloc())?"bloc/":"");Q([this.uploadService.processAndUploadImage(t?.getImageTable(),this.timbreService.widthTimbre,this.timbreService.heightTimbre,t?.getId(),i+"autre"),this.uploadService.processAndUploadImage(t?.getImageTable(),this.timbreService.widthTimbre*(this.timbreService.heigthTable/this.timbreService.heightTimbre),this.timbreService.heigthTable,t?.getId(),i+"table"),this.uploadService.processAndUploadImage(t?.getImageTable(),this.timbreService.widthTimbreZoom,this.timbreService.heightTimbreZoom,t?.getId(),i+"zoom")]).pipe(y(([n,r,f])=>p(n)&&p(f)&&p(r))).subscribe(([n,r,f])=>{p(r)&&r!="nok"&&t.setImage(r),p(n)&&n!="nok"&&t.setImageTable(n),p(f)&&f!="nok"&&t.setImageZoom(f),this.timbreService.addTimbre(t),e&&(this.load$.next(!0),this.close())})}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||o)(M(j),M(W),M(le),M(Ce))};static \u0275cmp=k({type:o,selectors:[["app-timbre-importer"]],decls:8,vars:4,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],[3,"ngIf","ngIfElse"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","start stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","column","fxLayoutGap","20px",1,"bloc-modal"],[3,"innerHTML",4,"ngIf"],[3,"timbres$","modif",4,"ngIf"],["fxLayout","row","fxLayoutGap","10px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","file","accept",".xls, .xlsx, .csv","hidden","","required","",3,"change","id"],["type","button","mat-raised-button","","color","accent",1,"rounded","large","color-white",3,"click"],["type","submit","class","rounded large color-white","mat-raised-button","","color","accent",4,"ngIf"],[3,"innerHTML"],[3,"timbres$","modif"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"]],template:function(e,i){if(e&1&&(l(0,"div",2)(1,"div",3)(2,"span"),u(3,"TIMBRE IMPORTER"),a()(),b(4,Mn,2,3,"ng-template",4),C(5,"async"),b(6,Sn,15,11,"ng-template",null,0,P),a()),e&2){let n=w(7);m(4),s("ngIf",S(5,2,i.load$)==!1)("ngIfElse",n)}},dependencies:[oe,ye,ge,J,q,V,$,ne,H,he,ve,xe,Te,re,Be,ee]})};var In=["canvas"];function wn(o,t){o&1&&d(0,"lib-spinner",5),o&2&&s("textSpec","Chargement en cours ...")}function Bn(o,t){if(o&1&&(d(0,"mat-error",18),C(1,"async")),o&2){let e=c(2);s("innerHTML",S(1,1,e.messageError$),fe)}}function En(o,t){if(o&1){let e=B();l(0,"div",10)(1,"label"),d(2,"lib-libelle-model",11),a(),l(3,"input",19),L("ngModelChange",function(n){h(e);let r=c(2);return A(r.timbreBlocModel.id,n)||(r.timbreBlocModel.id=n),_(n)}),a()()}if(o&2){let e=c(2);m(2),s("object",e.timbreBlocModel)("key","id"),m(),D("ngModel",e.timbreBlocModel.id),s("disabled",!!(e.timbreBlocModel!=null&&e.timbreBlocModel.getId()))}}function Dn(o,t){if(o&1){let e=B();l(0,"form",6,1),g("ngSubmit",function(){h(e);let n=w(1),r=c();return _(r.valider(n))}),l(2,"div",7),b(3,Bn,2,3,"mat-error",8),C(4,"async"),b(5,En,4,4,"div",9),l(6,"div",10)(7,"label"),d(8,"lib-libelle-model",11),a(),l(9,"input",12),L("ngModelChange",function(n){h(e);let r=c();return A(r.timbreBlocModel.annee,n)||(r.timbreBlocModel.annee=n),_(n)}),a()(),l(10,"div",10)(11,"label"),d(12,"lib-libelle-model",11),a(),l(13,"input",13),L("ngModelChange",function(n){h(e);let r=c();return A(r.timbreBlocModel.monnaie,n)||(r.timbreBlocModel.monnaie=n),_(n)}),a()(),l(14,"lib-upload",14),g("outPutObject",function(n){h(e);let r=c();return _(r.timbreBlocModel=n)}),a()(),l(15,"div",15)(16,"button",16),g("click",function(){h(e);let n=c();return _(n.close())}),u(17," Annuler "),a(),l(18,"button",17),u(19," Enregistrer "),a()()()}if(o&2){let e=w(1),i=c();s("ngClass",e!=null&&e.submitted?"red-color":"blue-color"),m(3),s("ngIf",S(4,15,i.messageError$)),m(2),s("ngIf",i.timbreBlocModel==null?null:i.timbreBlocModel.getId()),m(3),s("object",i.timbreBlocModel)("key","annee"),m(),D("ngModel",i.timbreBlocModel.annee),s("max",i.maxAnnee)("zMax",i.maxAnnee),m(3),s("object",i.timbreBlocModel)("key","monnaie"),m(),D("ngModel",i.timbreBlocModel.monnaie),m(),s("object",i.timbreBlocModel)("key","image")("maxWidth",i.timbreBlocService.widthTimbre)("maxHeight",i.timbreBlocService.heightTimbre)}}var at=class o{constructor(t,e,i,n){this.httpResponseHandlerService=t;this.dialogRef=e;this.timbreBlocService=i;this.uploadService=n}canvas;messageError$=new I(null);load$=new I(null);id;maxAnnee=new Date().getFullYear();timbreBlocModel=new E;fileUploadModel=new Ie;ngOnInit(){this.initUpload(),this.load$.next(!1),p(this.id)?this.timbreBlocService.getBlocByIdAsync(this.id).subscribe(t=>{this.timbreBlocModel=t,this.load$.next(!0)}):(this.timbreBlocModel.setAnnee(new Date().getFullYear()),this.timbreBlocModel.setMonnaie("E"),this.load$.next(!0))}initUpload(){this.fileUploadModel.setDossier("test"),this.fileUploadModel.setNom(new Date().getTime()?.toString());let t=new ae;t.setMaxWidth(this.timbreBlocService.widthTimbre),t.setMaxHeight(this.timbreBlocService.heightTimbre),t.setDossier("autre");let e=new ae;e.setMaxWidth(this.timbreBlocService.widthTimbreZoom),e.setMaxHeight(this.timbreBlocService.heightTimbreZoom),e.setDossier("zoom"),this.fileUploadModel.setDetail([t,e])}valider(t){if(this.messageError$.next(null),t?.valid)if(p(this.timbreBlocModel.getImage()))this.saveData();else{this.messageError$.next("Veuillez s\xE9lectionner une image");return}}saveData(){this.load$.next(!1),p(this.timbreBlocModel.getId())?this.save():this.addTimbre()}addTimbre(){this.timbreBlocService.getMaxIdentAsync().pipe(y()).subscribe(t=>{this.timbreBlocModel.setId(t),this.save(!0)})}save(t){try{Q([this.uploadService.processAndUploadImageByFile(this.timbreBlocModel?.getImage(),this.timbreBlocService.widthTimbre,this.timbreBlocService.heightTimbre,this.timbreBlocModel?.getId(),this.timbreBlocService.getDossier(this.timbreBlocModel,"autre")),this.uploadService.processAndUploadImageByFile(this.timbreBlocModel?.getImage(),this.timbreBlocService.widthTimbre*(this.timbreBlocService.heigthTable/this.timbreBlocService.heightTimbre),this.timbreBlocService.heigthTable,this.timbreBlocModel?.getId(),this.timbreBlocService.getDossier(this.timbreBlocModel,"table")),this.uploadService.processAndUploadImageByFile(this.timbreBlocModel?.getImage(),this.timbreBlocService.widthTimbreZoom,this.timbreBlocService.heightTimbreZoom,this.timbreBlocModel?.getId(),this.timbreBlocService.getDossier(this.timbreBlocModel,"zoom"))]).pipe(y(([e,i,n])=>p(e)&&p(n)&&p(i))).subscribe(([e,i,n])=>{p(i)&&i!="nok"&&this.timbreBlocModel.setImage(i),p(e)&&e!="nok"&&this.timbreBlocModel.setImageTable(e),p(n)&&n!="nok"&&this.timbreBlocModel.setImageZoom(n),t?this.timbreBlocService.addBloc(this.timbreBlocModel):this.timbreBlocService.modifierBloc(this.timbreBlocModel),this.httpResponseHandlerService.showNotificationSuccess("Transaction termin\xE9e","Votre timbre a bien \xE9t\xE9 modifi\xE9e."),this.load$.next(!0),this.dialogRef.close()})}catch{this.httpResponseHandlerService.showNotificationError("Transaction non aboutie","Votre timbre n'a pas pu \xEAtre modifi\xE9."),this.load$.next(!0)}}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||o)(M(Ze),M(Ce),M(z),M(le))};static \u0275cmp=k({type:o,selectors:[["app-timbre-modifier-bloc"]],viewQuery:function(e,i){if(e&1&&me(In,5),e&2){let n;se(n=ce())&&(i.canvas=n.first)}},decls:10,vars:6,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],[3,"ngIf","ngIfElse"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","space-between stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","column","fxLayoutGap","20px",1,"bloc-modal"],[3,"innerHTML",4,"ngIf"],["fxLayout","column","class","form-input",4,"ngIf"],["fxLayout","column",1,"form-input"],[3,"object","key"],["name","page","type","number","minlength","4","maxlength","4","min","1900","zMin","1900","required","","zControl","",1,"annee",2,"width","60px !important",3,"ngModelChange","ngModel","max","zMax"],["name","monnaie","type","text","trim","","minlength","1","maxlength","2","required","","zControl","",2,"width","25px !important",3,"ngModelChange","ngModel"],[3,"outPutObject","object","key","maxWidth","maxHeight"],["fxLayout","row","fxLayoutGap","10px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"],[3,"innerHTML"],["name","code","type","text","trim","","upperCase","","noEspace","","required","","zControl","",3,"ngModelChange","ngModel","disabled"]],template:function(e,i){if(e&1&&(l(0,"div",2)(1,"div",3)(2,"span"),u(3),a(),l(4,"span"),u(5),a()(),b(6,wn,1,1,"ng-template",4),C(7,"async"),b(8,Dn,20,17,"ng-template",null,0,P),a()),e&2){let n=w(9);m(3),R("",i.timbreBlocModel!=null&&i.timbreBlocModel.getId()?"MODIFICATION":"AJOUT"," BLOC "),m(2),K(i.timbreBlocModel==null?null:i.timbreBlocModel.getId()),m(),s("ngIf",S(7,4,i.load$)==!1)("ngIfElse",n)}},dependencies:[oe,ye,ge,J,q,V,$,ne,H,he,ve,Oe,Ne,_e,xe,Pe,ke,qe,je,Ue,Me,Te,re,Se,He,Ye,Qe,Xe,Ke,Je,et,ee],encapsulation:2})};var mt=class o{constructor(t,e){this.timbreService=t;this.dialog=e}ngOnInit(){this.timbreService.getTimbres()}addTimbre(){let t=this.dialog.open(we,{maxHeight:"95vh",width:"30%"});t.afterClosed().subscribe(()=>{t.close()})}addBloc(){let t=this.dialog.open(at,{maxHeight:"95vh",width:"30%"});t.afterClosed().subscribe(()=>{t.close()})}addTimbreBouchon(){this.timbreService.addTimbre(this.timbreService.getBouchon())}importer(){let t=this.dialog.open(Ee,{height:"90vh",width:"70%"});t.afterClosed().subscribe(()=>{t.close()})}static \u0275fac=function(e){return new(e||o)(M(j),M($e))};static \u0275cmp=k({type:o,selectors:[["app-timbre-layout"]],decls:17,vars:2,consts:[["fxLayout","column","fxLayoutGap","20px"],[3,"titre"],["fxLayout","row","fxLayoutAlign","space-between stretch"],["fxFlex","5"],["fxFlex","","fxLayout","column","fxLayoutGap","20px"],["fxLayout","row","fxLayoutGap","20px"],["mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["mat-raised-button","","color","accent",1,"rounded","large","color-white",3,"click"],[3,"timbres$"]],template:function(e,i){e&1&&(d(0,"app-simple-notification"),l(1,"div",0),d(2,"app-header",1),l(3,"div",2),d(4,"div",3),l(5,"div",4)(6,"div",5)(7,"button",6),g("click",function(){return i.addTimbre()}),u(8," Ajouter "),a(),l(9,"button",6),g("click",function(){return i.addBloc()}),u(10," Ajouter Bloc "),a(),l(11,"button",7),g("click",function(){return i.addTimbreBouchon()}),u(12," Bouchon "),a(),l(13,"button",7),g("click",function(){return i.importer()}),u(14," Importer "),a()(),d(15,"app-timbre-resultat",8),a(),d(16,"div",3),a()()),e&2&&(m(2),s("titre",""),m(13),s("timbres$",i.timbreService.timbres$))},dependencies:[oe,q,V,$,H,Xt,oi,Be]})};var An=[{path:"",component:mt},{path:"importer",component:Ee}],st=class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=Ae({type:o});static \u0275inj=De({imports:[pt.forChild(An),pt]})};var gi=class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=Ae({type:o});static \u0275inj=De({providers:[it,W,j,z,le,wt()],imports:[Gt,st,It,At,Lt,Ft,ei,Kt,ai,ti,Jt,Rt,Yt,ri,li,mi,si]})};export{gi as TimbreModule};

import{a as qe,b as Y,c as yt,d as Bt,e as It,f as wt,g as si,h as Mi,i as ci,j as At,k as vi,l as pi}from"./chunk-H6PQ4AFL.js";import{B as St}from"./chunk-7DZQOIIW.js";import{a as ti,d as vt,e as pe,h as _e}from"./chunk-MCYOK5NR.js";import{a as ye}from"./chunk-JZRJWWEK.js";import{A as _,Aa as ve,Ab as se,Ac as dt,Ba as Ce,Bb as fe,Bc as bt,Ca as re,Cc as oi,Db as Zt,Dc as ft,Eb as tt,Ec as gt,Fa as G,Fc as ri,Ga as Qt,Gc as ht,Hb as we,Hc as _t,I as Me,Ib as Ae,Ic as li,J as $e,Jb as Ee,Jc as Tt,K as l,Kb as De,Kc as xt,L as B,Lb as Re,Lc as mi,Mb as it,Mc as Mt,Nb as nt,Nc as Ue,Ob as ot,Pb as rt,Pc as Ct,Q as b,Qb as lt,Qc as ai,R as s,Rb as mt,Sb as Yt,Tb as Xt,Ub as at,Vb as Kt,W as m,Wb as Jt,X as a,Xb as ei,Y as f,Z as A,_ as E,aa as O,ab as Ke,ba as M,bb as c,c as w,ca as p,cb as le,da as Wt,ea as te,f as ee,fa as ie,g as j,ga as ne,gb as x,ha as N,hb as Z,hc as Oe,ia as d,ib as xe,ic as ce,ja as Ye,jc as ii,ka as I,kc as Le,l as y,la as zt,m as Ze,ma as P,mc as st,na as H,oa as W,p as de,pb as Se,q as Pt,qb as Je,ra as Xe,rb as et,rc as ni,s as L,sb as Gt,sc as ct,tb as Be,u as Q,ua as v,ub as Ie,v as Ht,va as C,vc as ge,wa as oe,wb as me,xb as ae,xc as he,yb as be,yc as pt,z as h,zc as ut}from"./chunk-VHCJNL4V.js";import{g as $t,i as T}from"./chunk-GV7GV3NK.js";var k=class extends Z{annees;acquis;doublon;idBloc;bloc;getAnnees(){return this.annees}setAnnees(e){this.annees=e}getAcquis(){return this.acquis}setAcquis(e){this.acquis=e}getDoublon(){return this.doublon}setDoublon(e){this.doublon=e}getIdBloc(){return this.idBloc}setIdBloc(e){this.idBloc=e}getBloc(){return this.bloc}setBloc(e){this.bloc=e}};T([x("Ann\xE9e")],k.prototype,"annees",2),T([x("Acquis")],k.prototype,"acquis",2),T([x("Doublon")],k.prototype,"doublon",2),T([x("Ident bloc")],k.prototype,"idBloc",2),T([x("Bloc")],k.prototype,"bloc",2);var D=class extends Z{id;idBloc;annee;monnaie;type;yt;image;imageTable;imageZoom;timbreAcquisModel;timbreBlocModel;constructor(e,t,i,n,r,u,g,S,R,z,U){super(),this.id=e||null,this.idBloc=t||null,this.annee=i||null,this.monnaie=n||null,this.type=r||null,this.yt=u||null,this.image=g||null,this.imageTable=S||null,this.imageZoom=R||null,this.timbreAcquisModel=z||null,this.timbreBlocModel=U||null}getId(){return this.id}setId(e){this.id=e}getIdBloc(){return this.idBloc}setIdBloc(e){this.idBloc=e}getAnnee(){return this.annee}setAnnee(e){this.annee=e}getMonnaie(){return this.monnaie}setMonnaie(e){this.monnaie=e}getType(){return this.type}setType(e){this.type=e}getYt(){return this.yt}setYt(e){this.yt=e}getImage(){return this.image}setImage(e){this.image=e}getImageTable(){return this.imageTable}setImageTable(e){this.imageTable=e}getImageZoom(){return this.imageZoom}setImageZoom(e){this.imageZoom=e}getTimbreAcquisModel(){return this.timbreAcquisModel}setTimbreAcquisModel(e){this.timbreAcquisModel=e}getTimbreBlocModel(){return this.timbreBlocModel}setTimbreBlocModel(e){this.timbreBlocModel=e}};T([x("Identifiant")],D.prototype,"id",2),T([x("Identifiant bloc")],D.prototype,"idBloc",2),T([x("Ann\xE9e")],D.prototype,"annee",2),T([x("Monnaie")],D.prototype,"monnaie",2),T([x("Type")],D.prototype,"type",2),T([x("R\xE9ference Yvert Tellier")],D.prototype,"yt",2),T([x("Image")],D.prototype,"image",2),T([x("Image tableau")],D.prototype,"imageTable",2),T([x("Image zoom")],D.prototype,"imageZoom",2),T([x("v\xE9rif")],D.prototype,"timbreAcquisModel",2),T([x("Bloc")],D.prototype,"timbreBlocModel",2);var V=class extends Z{idUser;idTimbre;acquis;doublon;constructor(e,t,i,n){super(),this.idUser=e||null,this.idTimbre=t||null,this.acquis=i||!1,this.doublon=n||!1}getIdUser(){return this.idUser}setIdUser(e){this.idUser=e}getIdTimbre(){return this.idTimbre}setIdTimbre(e){this.idTimbre=e}isAcquis(){return this.acquis}setAcquis(e){this.acquis=e}isDoublon(){return this.doublon}setDoublon(e){this.doublon=e}};T([x("Identifiant Utilisateur")],V.prototype,"idUser",2),T([x("Identifiant timbre")],V.prototype,"idTimbre",2),T([x("Acquis")],V.prototype,"acquis",2),T([x("Doublon")],V.prototype,"doublon",2);var X=class o{constructor(e){this.firestore=e}timbreCritereModel=new k;getAnneesAsync(e){return this.firestore.collection(e,t=>{let i=t;return i=i.orderBy("annee","desc"),i}).valueChanges().pipe(ee(t=>{let i=t.map(n=>Number(n.annee)).filter(n=>c(n)&&n!=0);return Array.from(new Set(i))}))}getTimbresByCritereAsync(e){return this.getAllTimbres(e).pipe(ee(t=>this.constructTimbres(t,null,null)))}getAllTimbres(e){return this.firestore.collection("/timbres",t=>{let i=t;return c(e)&&(c(e.getAnnees())&&e.getAnnees()?.length>0&&(i=i.where("annee","in",e.getAnnees())),c(e.getBloc())&&e.getBloc()!="TOUS"?i=i.where("idBloc",e.getBloc()!="NON"?"!=":"==",null):c(e.getIdBloc())&&(i=i.where("idBloc","==",e.getIdBloc()))),i=i.orderBy("id","asc"),i}).valueChanges()}constructTimbres(e,t,i,n){let r=[];return e?.length>0&&e.forEach(u=>{let g=this.constructTimbre(u,t,i),S=!0;c(n)&&c(g.getTimbreAcquisModel())&&(c(n.getAcquis())&&!(n.getAcquis()=="TOUS"||n.getAcquis()=="OUI"&&g.getTimbreAcquisModel().isAcquis()||n.getAcquis()=="NON"&&!g.getTimbreAcquisModel().isAcquis())&&(S=!1),c(n.getDoublon())&&!(n.getDoublon()=="TOUS"||n.getDoublon()=="OUI"&&g.getTimbreAcquisModel().isDoublon()||n.getDoublon()=="NON"&&!g.getTimbreAcquisModel().isDoublon())&&(S=!1)),S==!0&&r.push(g)}),r}constructTimbre(e,t,i){let n=xe(D,e);if(c(i)){let r=i.find(u=>u.getId()==n?.getIdBloc());c(r)&&n.setTimbreBlocModel(r)}if(c(t)){let r=t.find(u=>u.idTimbre==n.getId());c(r)?n.setTimbreAcquisModel(xe(V,r)):n.setTimbreAcquisModel(new V)}return n}supprimerTimbreAcquis(e,t){c(e?.getTimbreAcquisModel()?.getIdUser())&&this.firestore.collection("/timbres_acquis").ref.where("idTimbre","==",e.getId()).where("idUser","==",t).get().then(i=>{i.forEach(n=>{n.ref.delete()})})}supprimerTimbre(e){this.firestore.collection("/timbres").ref.where("id","==",e.getId()).get().then(t=>{t.forEach(i=>{i.ref.delete()})}).catch(t=>{console.error("Erreur de suppression :",t)})}static \u0275fac=function(t){return new(t||o)(L(Se))};static \u0275prov=de({token:o,factory:o.\u0275fac})};var q=class extends Z{id;annee;monnaie;image;imageTable;imageZoom;timbreBlocAcquisModel;nbTimbres;idOrigine;constructor(e,t,i,n,r,u,g,S){super(),this.id=e||null,this.annee=t||null,this.monnaie=i||null,this.image=n||null,this.imageTable=r||null,this.imageZoom=u||null,this.timbreBlocAcquisModel=g||null,this.nbTimbres=S||null}getId(){return this.id}setId(e){this.id=e}getAnnee(){return this.annee}setAnnee(e){this.annee=e}getMonnaie(){return this.monnaie}setMonnaie(e){this.monnaie=e}getImage(){return this.image}setImage(e){this.image=e}getImageTable(){return this.imageTable}setImageTable(e){this.imageTable=e}getImageZoom(){return this.imageZoom}setImageZoom(e){this.imageZoom=e}getTimbreBlocAcquisModel(){return this.timbreBlocAcquisModel}setTimbreBlocAcquisModel(e){this.timbreBlocAcquisModel=e}getNbTimbres(){return this.nbTimbres}setNbTimbres(e){this.nbTimbres=e}};T([x("Identifiant")],q.prototype,"id",2),T([x("Ann\xE9e")],q.prototype,"annee",2),T([x("Monnaie")],q.prototype,"monnaie",2),T([x("Image")],q.prototype,"image",2),T([x("Image tableau")],q.prototype,"imageTable",2),T([x("Image zoom")],q.prototype,"imageZoom",2),T([x("v\xE9rif")],q.prototype,"timbreBlocAcquisModel",2),T([x("Nombre de timbres")],q.prototype,"nbTimbres",2);var K=class extends Z{idUser;idBloc;acquis;doublon;constructor(e,t,i,n){super(),this.idUser=e||null,this.idBloc=t||null,this.acquis=i||!1,this.doublon=n||!1}getIdUser(){return this.idUser}setIdUser(e){this.idUser=e}getIdBloc(){return this.idBloc}setIdBloc(e){this.idBloc=e}isAcquis(){return this.acquis}setAcquis(e){this.acquis=e}isDoublon(){return this.doublon}setDoublon(e){this.doublon=e}};T([x("Identifiant Utilisateur")],K.prototype,"idUser",2),T([x("Identifiant bloc")],K.prototype,"idBloc",2),T([x("Acquis")],K.prototype,"acquis",2),T([x("Doublon")],K.prototype,"doublon",2);var J=class o{constructor(e,t,i,n,r){this.firestore=e;this.authService=t;this.uploadService=i;this.utilsService=n;this.timbreUtilsService=r}heigthTable=50;widthTimbre=100;heightTimbre=100;widthTimbreZoom=500;heightTimbreZoom=500;total$=new w(0);timbresBlocModel$=new w(null);upload(e,t){let i=this.widthTimbre,n=this.heightTimbre;return t=="table"?(i=i*(this.heigthTable/n),n=this.heigthTable):t=="zoom"&&(i=i*(this.heightTimbreZoom/n),n=this.heightTimbreZoom),this.uploadService.processAndUploadImage(e?.getImage(),i,n,"bloc",this.getDossier(e,t))}getTotal(e){this.total$.next(null),this.getAllBlocs(e).pipe(y()).subscribe(t=>{this.total$.next(t?.length)})}getBloc(e){return this.firestore.collection("/timbres_bloc",t=>t.where("id","==",e)).valueChanges()}getBlocByIdAsync(e){return this.getBloc(e).pipe(ee(t=>xe(q,t[0])))}getAllBlocs(e){return this.firestore.collection("/timbres_bloc",t=>{let i=t;return c(e)&&c(e.getAnnees())&&e.getAnnees()?.length>0&&(i=i.where("annee","in",e.getAnnees())),i}).valueChanges()}getTimbreBlocAcquis(){return this.authService.getUser().pipe(y(),Ze(e=>c(e)?this.getTimbreBlocAcquisByUser(e.getId()).pipe(y(),ee(t=>t)):null))}getTimbreBlocAcquisByUser(e){return this.firestore.collection("/timbres_bloc_acquis",t=>t.where("idUser","==",e)).valueChanges()}getBlocs(e){this.getTotal(),this.timbresBlocModel$.next(null),j([this.getAllBlocs(e),this.getTimbreBlocAcquis()]).pipe(y()).subscribe(([t,i])=>{this.constructBlocs(t,i,e)})}getBlocsAsync(e){return this.timbresBlocModel$.next(null),this.getAllBlocs(e).pipe(y(),ee(t=>this.constructBlocs(t,null,e)))}constructBloc(e,t){let i=xe(q,e);if(c(t)){let n=t.find(r=>r.idBloc==i.getId());c(n)?i.setTimbreBlocAcquisModel(xe(K,n)):i.setTimbreBlocAcquisModel(new K)}return i}constructBlocs(e,t,i){let n=[];return e?.length>0&&e.forEach(r=>{let u=this.constructBloc(r,t);this.getTimbresByBlocAsync(u.getId()).subscribe(S=>{u.setNbTimbres(S?.length)});let g=!0;c(i)&&c(u.getTimbreBlocAcquisModel())&&(c(i.getAcquis())&&!(i.getAcquis()=="TOUS"||i.getAcquis()=="OUI"&&u.getTimbreBlocAcquisModel().isAcquis()||i.getAcquis()=="NON"&&!u.getTimbreBlocAcquisModel().isAcquis())&&(g=!1),c(i.getDoublon())&&!(i.getDoublon()=="TOUS"||i.getDoublon()=="OUI"&&u.getTimbreBlocAcquisModel().isDoublon()||i.getDoublon()=="NON"&&!u.getTimbreBlocAcquisModel().isDoublon())&&(g=!1)),g==!0&&n.push(u)}),this.timbresBlocModel$.next(n),n}acquis(e,t){return this.authService.getUser().pipe(y(i=>c(i))).subscribe(i=>{c(e?.getTimbreBlocAcquisModel()?.getIdUser())?this.firestore.collection("/timbres_bloc_acquis").ref.where("idTimbre","==",e.getId()).where("idUser","==",i.getId()).get().then(n=>{n.forEach(r=>{let u=e.getTimbreBlocAcquisModel();t?(u.setAcquis(!0),u.setDoublon(!u.isDoublon())):(u.setAcquis(!u.isAcquis()),u.isAcquis()||u.setDoublon(!1)),r.ref.update(Object.assign(new Object,u))})}).catch(n=>{console.error("Erreur de mise \xE0 jour:",n)}):this.addAcquis(i?.getId(),e,t)})}addAcquis(e,t,i){let n=new K;n.setIdUser(e),n.setIdBloc(t.getId()),n.setAcquis(!0),n.setDoublon(i),t.setTimbreBlocAcquisModel(n),this.firestore.collection("/timbres_bloc_acquis").add(Object.assign(new Object,n))}ajouterSansId(e){this.utilsService.getMaxIdentAsync("/timbres_bloc").pipe(y()).subscribe(t=>{e.setId(t),this.ajouter(e,!0)})}ajouter(e,t){this.getBloc(e.getId()).pipe(y()).subscribe(i=>{le(i)||le(i[0])||c(i[0])&&i[0]?.length==0?(e.setTimbreBlocAcquisModel(null),this.firestore.collection("/timbres_bloc").add(Object.assign(new Object,e)),t&&this.getBlocs()):console.error("bloc d\xE9j\xE0 existant")})}modifier(e){this.firestore.collection("/timbres_bloc").ref.where("id","==",e.getId()).get().then(t=>{t.forEach(i=>{i.ref.update(Object.assign(new Object,e)),this.getBlocs()})}).catch(t=>{console.error("Erreur de mise \xE0 jour:",t)})}getTimbresByBlocAsync(e){let t=new k;return t.setIdBloc(e),this.timbreUtilsService.getTimbresByCritereAsync(t)}supprimer(e){this.authService.getUser().pipe(y(t=>c(t))).subscribe(t=>{this.getTimbresByBlocAsync(e.getId()).pipe(y()).subscribe(i=>{i.forEach(n=>{this.timbreUtilsService.supprimerTimbreAcquis(n,t.getId()),this.timbreUtilsService.supprimerTimbre(n)})}),c(e?.getTimbreBlocAcquisModel()?.getIdUser())&&this.firestore.collection("/timbres_bloc_acquis").ref.where("idBloc","==",e.getId()).where("idUser","==",t.getId()).get().then(i=>{i.forEach(n=>{n.ref.delete()})}),this.firestore.collection("/timbres_bloc").ref.where("id","==",e.getId()).get().then(i=>{i.forEach(n=>{n.ref.delete(),this.getBlocs()})}).catch(i=>{console.error("Erreur de suppression :",i)})})}getDossier(e,t){let i="timbre//"+e.getAnnee();return c(t)&&(i=i+"/"+t),i=i+"/bloc/"+e.getId(),i}getBouchon(){let e=new q;return e.setAnnee(new Date().getFullYear()),e.setMonnaie("E"),e}static \u0275fac=function(t){return new(t||o)(L(Se),L(ye),L(qe),L(Y),L(X))};static \u0275prov=de({token:o,factory:o.\u0275fac})};var F=class o{constructor(e,t,i,n,r,u){this.firestore=e;this.authService=t;this.timbreBlocService=i;this.uploadService=n;this.utilsService=r;this.timbreUtilsService=u}heigthTable=50;widthTimbre=100;heightTimbre=100;widthTimbreZoom=500;heightTimbreZoom=500;total$=new w(0);timbres$=new w(null);getTimbre(e){return this.firestore.collection("/timbres",t=>t.where("id","==",e)).valueChanges()}getTimbreByIdAsync(e){return j([this.getTimbre(e),this.timbreBlocService.getBlocsAsync()]).pipe(ee(([t,i])=>this.timbreUtilsService.constructTimbre(t[0],null,i)))}getTotal(e){this.total$.next(null),this.timbreUtilsService.getAllTimbres(e).pipe(y()).subscribe(t=>{this.total$.next(t?.length)})}getTimbres(e){this.getTotal(),this.timbres$.next(null),j([this.timbreUtilsService.getAllTimbres(e),this.getTimbreAcquis(),this.timbreBlocService.getBlocsAsync(e)]).pipe(y()).subscribe(([t,i,n])=>{this.timbres$.next(this.timbreUtilsService.constructTimbres(t,i,n,e))})}getTimbreAcquis(){return this.authService.getUser().pipe(y(),Ze(e=>c(e)?this.getTimbreAcquisByUser(e.getId()).pipe(y(),ee(t=>t)):null))}getTimbreAcquisByUser(e){return this.firestore.collection("/timbres_acquis",t=>t.where("idUser","==",e)).valueChanges()}acquis(e,t){return this.authService.getUser().pipe(y(i=>c(i))).subscribe(i=>{c(e?.getTimbreAcquisModel()?.getIdUser())?this.firestore.collection("/timbres_acquis").ref.where("idTimbre","==",e.getId()).where("idUser","==",i.getId()).get().then(n=>{n.forEach(r=>{let u=e.getTimbreAcquisModel();t?(u.setAcquis(!0),u.setDoublon(!u.isDoublon())):(u.setAcquis(!u.isAcquis()),u.isAcquis()||u.setDoublon(!1)),r.ref.update(Object.assign(new Object,u))})}).catch(n=>{console.error("Erreur de mise \xE0 jour:",n)}):this.addAcquis(i?.getId(),e,t)})}addAcquis(e,t,i){let n=new V;n.setIdUser(e),n.setIdTimbre(t.getId()),n.setAcquis(!0),n.setDoublon(i),t.setTimbreAcquisModel(n),this.firestore.collection("/timbres_acquis").add(Object.assign(new Object,n))}ajouterSansId(e){this.utilsService.getMaxIdentAsync("/timbres").pipe(y()).subscribe(t=>{e.setId(t),c(e.getIdBloc())&&(e.setAnnee(null),e.setMonnaie(null)),this.ajouter(e,!0)})}ajouter(e,t){this.getTimbre(e.getId()).pipe(y()).subscribe(i=>{le(i)||le(i[0])||c(i[0])&&i[0]?.length==0?(e.setTimbreAcquisModel(null),e.setTimbreBlocModel(null),this.firestore.collection("/timbres").add(Object.assign(new Object,e)),t&&this.getTimbres()):console.error("timbre d\xE9j\xE0 existant")})}modifier(e){e.setTimbreBlocModel(null),e.setTimbreAcquisModel(null),this.firestore.collection("/timbres").ref.where("id","==",e.getId()).get().then(t=>{t.forEach(i=>{i.ref.update(Object.assign(new Object,e)),this.getTimbres()})}).catch(t=>{console.error("Erreur de mise \xE0 jour:",t)})}supprimerTimbre(e){this.firestore.collection("/timbres").ref.where("id","==",e.getId()).get().then(t=>{t.forEach(i=>{i.ref.delete(),this.getTimbres()})}).catch(t=>{console.error("Erreur de suppression :",t)})}supprimer(e){this.authService.getUser().pipe(y(t=>c(t))).subscribe(t=>{this.timbreUtilsService.supprimerTimbreAcquis(e,t.getId()),this.supprimerTimbre(e)})}getBouchon(){let e=new D;return e.setAnnee(new Date().getFullYear()),e.setMonnaie("E"),e.setType(""),e.setYt(""),e}upload(e,t){let i=this.widthTimbre,n=this.heightTimbre;return t=="table"?(i=i*(this.heigthTable/n),n=this.heigthTable):t=="zoom"&&(i=i*(this.heightTimbreZoom/n),n=this.heightTimbreZoom),this.uploadService.processAndUploadImage(e?.getImage(),i,n,e?.getId(),this.getDossier(e,t))}getDossier(e,t){let i="timbre//";return c(e.getIdBloc())?i=i+e.getTimbreBlocModel().getAnnee():i=i+e.getAnnee(),c(t)&&(i=i+"/"+t),c(e.getIdBloc())&&(i=i+"/bloc/"+e.getIdBloc()),i}static \u0275fac=function(t){return new(t||o)(L(Se),L(ye),L(J),L(qe),L(Y),L(X))};static \u0275prov=de({token:o,factory:o.\u0275fac})};var $=class extends Z{annee;nombre;acquis;doublon;nombreBloc;acquisBloc;doublonBloc;constructor(e,t,i,n,r,u,g){super(),this.annee=e||null,this.nombre=t||0,this.acquis=i||0,this.doublon=n||0,this.nombreBloc=r||0,this.acquisBloc=u||0,this.doublonBloc=g||0}getAnnee(){return this.annee}setAnnee(e){this.annee=e}getNombre(){return this.nombre}setNombre(e){this.nombre=e}getAcquis(){return this.acquis}setAcquis(e){this.acquis=e}getDoublon(){return this.doublon}setDoublon(e){this.doublon=e}getNombreBloc(){return this.nombreBloc}setNombreBloc(e){this.nombreBloc=e}getAcquisBloc(){return this.acquisBloc}setAcquisBloc(e){this.acquisBloc=e}getDoublonBloc(){return this.doublonBloc}setDoublonBloc(e){this.doublonBloc=e}};T([x("Ann\xE9e")],$.prototype,"annee",2),T([x("Total")],$.prototype,"nombre",2),T([x("Acquis")],$.prototype,"acquis",2),T([x("Doublon")],$.prototype,"doublon",2),T([x("Total bloc")],$.prototype,"nombreBloc",2),T([x("Acquis")],$.prototype,"acquisBloc",2),T([x("Doublon")],$.prototype,"doublonBloc",2);var Dt=class o{constructor(e,t,i){this.timbreService=e;this.timbreBlocService=t;this.timbreUtilsService=i}timbresResume$=new w(null);totalTimbreResume$=new w(null);getResume(e){this.timbresResume$.next(null),this.totalTimbreResume$.next(null),j([this.timbreUtilsService.getAllTimbres(e),this.timbreService.getTimbreAcquis(),this.timbreBlocService.getAllBlocs(e),this.timbreBlocService.getTimbreBlocAcquis()]).pipe(y()).subscribe(([t,i,n,r])=>{this.timbresResume$.next(this.construct(t,i,n,r))})}construct(e,t,i,n){let r=[];if(e?.length>0&&(e.forEach(u=>{let g=u.annee;if(c(i)&&le(u.annee)&&c(u.idBloc)){let R=i.find(z=>z.id==u.idBloc);c(R)&&(g=R.annee)}let S=r.find(R=>R.getAnnee()==g);if(c(S)?S.setNombre(S.getNombre()+1):(S=new $,S.setAnnee(g),S.setNombre(1),r.push(S)),c(t)){let R=t.find(z=>z.idTimbre==u.id);c(R)&&(R.acquis==!0&&S.setAcquis(S.getAcquis()+1),R.doublon==!0&&S.setDoublon(S.getDoublon()+1))}}),i.forEach(u=>{let g=r.find(S=>S.getAnnee()==u.annee);if(c(g)?g.setNombreBloc(g.getNombreBloc()+1):(g=new $,g.setAnnee(u.annee),g.setNombreBloc(1),r.push(g)),c(n)){let S=n.find(R=>R.idBloc==u.id);c(S)&&(S.acquis==!0&&g.setAcquisBloc(g.getAcquisBloc()+1),S.doublon==!0&&g.setDoublonBloc(g.getDoublonBloc()+1))}})),c(r)&&r?.length>0){let u=new $;r.forEach(g=>{u.setNombre(u.getNombre()+g.getNombre()),u.setAcquis(u.getAcquis()+g.getAcquis()),u.setDoublon(u.getDoublon()+g.getDoublon()),u.setNombreBloc(u.getNombre()+g.getNombre()),u.setAcquisBloc(u.getAcquisBloc()+g.getAcquisBloc()),u.setDoublonBloc(u.getDoublonBloc()+g.getDoublonBloc())}),this.totalTimbreResume$.next(u)}return r}static \u0275fac=function(t){return new(t||o)(L(F),L(J),L(X))};static \u0275prov=de({token:o,factory:o.\u0275fac})};var fi=class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=Ht({type:o});static \u0275inj=Pt({providers:[F],imports:[Qt,Zt,Yt,Kt,Jt,ei,Xt,ni,ii,ai,ce]})};var Ii=()=>[10,20,50,100];function wi(o,e){if(o&1&&(m(0,"th",18),f(1,"lib-libelle-model",19),a()),o&2){let t=p();l(),s("object",t.timbreResumeModel)("key","annee")}}function Ai(o,e){if(o&1&&(m(0,"td",20),d(1),a()),o&2){let t=e.$implicit;l(),I(" ",t==null?null:t.getAnnee()," ")}}function Ei(o,e){o&1&&f(0,"td",21)}function Di(o,e){if(o&1&&(m(0,"th",18),f(1,"lib-libelle-model",19),a()),o&2){let t=p();l(),s("object",t.timbreResumeModel)("key","nombre")}}function Ri(o,e){if(o&1&&(m(0,"td",20),d(1),a()),o&2){let t=e.$implicit;l(),I(" ",t==null?null:t.getNombre()," ")}}function Oi(o,e){if(o&1&&(m(0,"td",22)(1,"b"),d(2),v(3,"async"),a()()),o&2){let t,i=p();l(2),I("",(t=C(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:t.getNombre()," ")}}function Li(o,e){if(o&1&&(m(0,"th",18),f(1,"lib-libelle-model",19),a()),o&2){let t=p();l(),s("object",t.timbreResumeModel)("key","acquis")}}function Ui(o,e){if(o&1&&(m(0,"td",20),d(1),a()),o&2){let t=e.$implicit;l(),I(" ",t==null?null:t.getAcquis()," ")}}function qi(o,e){if(o&1&&(m(0,"td",22)(1,"b"),d(2),v(3,"async"),a()()),o&2){let t,i=p();l(2),I("",(t=C(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:t.getAcquis()," ")}}function Ni(o,e){if(o&1&&(m(0,"th",18),f(1,"lib-libelle-model",19),a()),o&2){let t=p();l(),s("object",t.timbreResumeModel)("key","doublon")}}function Fi(o,e){if(o&1&&(m(0,"td",20),d(1),a()),o&2){let t=e.$implicit;l(),I(" ",t==null?null:t.getDoublon()," ")}}function ji(o,e){if(o&1&&(m(0,"td",22)(1,"b"),d(2),v(3,"async"),a()()),o&2){let t,i=p();l(2),I("",(t=C(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:t.getDoublon()," ")}}function ki(o,e){if(o&1&&(m(0,"th",18),f(1,"lib-libelle-model",19),a()),o&2){let t=p();l(),s("object",t.timbreResumeModel)("key","nombreBloc")}}function Vi(o,e){if(o&1&&(m(0,"td",20),d(1),a()),o&2){let t=e.$implicit;l(),I(" ",t==null?null:t.getNombreBloc()," ")}}function $i(o,e){if(o&1&&(m(0,"td",22)(1,"b"),d(2),v(3,"async"),a()()),o&2){let t,i=p();l(2),I("",(t=C(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:t.getNombreBloc()," ")}}function Pi(o,e){if(o&1&&(m(0,"th",18),f(1,"lib-libelle-model",19),a()),o&2){let t=p();l(),s("object",t.timbreResumeModel)("key","acquisBloc")}}function Hi(o,e){if(o&1&&(m(0,"td",20),d(1),a()),o&2){let t=e.$implicit;l(),I(" ",t==null?null:t.getAcquisBloc()," ")}}function Wi(o,e){if(o&1&&(m(0,"td",22)(1,"b"),d(2),v(3,"async"),a()()),o&2){let t,i=p();l(2),I("",(t=C(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:t.getAcquisBloc()," ")}}function zi(o,e){if(o&1&&(m(0,"th",18),f(1,"lib-libelle-model",19),a()),o&2){let t=p();l(),s("object",t.timbreResumeModel)("key","doublonBloc")}}function Qi(o,e){if(o&1&&(m(0,"td",20),d(1),a()),o&2){let t=e.$implicit;l(),I(" ",t==null?null:t.getDoublonBloc()," ")}}function Gi(o,e){if(o&1&&(m(0,"td",22)(1,"b"),d(2),v(3,"async"),a()()),o&2){let t,i=p();l(2),I("",(t=C(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:t.getDoublonBloc()," ")}}function Zi(o,e){o&1&&f(0,"tr",23)}function Yi(o,e){if(o&1){let t=O();m(0,"tr",24),M("click",function(){let n=h(t).$implicit,r=p();return _(r.filtreParAnnee(n))}),a()}}function Xi(o,e){o&1&&f(0,"tr",25)}var Rt=class o{constructor(e,t,i){this.timbreResumeService=e;this.timbreService=t;this.timbreUtilsService=i;this.dataSource=new Ue([])}paginator;sort;load$=new w(!1);dataSource=new Ue;displayedColumns=["annee","nombre","acquis","doublon","nombreBloc","acquisBloc","doublonBloc"];timbreResumeModel=new $;ngOnInit(){this.timbreResumeService.getResume(),this.load$.next(!1),this.timbreResumeService.timbresResume$.subscribe(e=>{this.dataSource.data=e,this.load$.next(!0)})}ngAfterViewInit(){this.dataSource.paginator=this.paginator}sortData(e){c(e)&&(console.log(e),this.dataSource.sort=this.sort)}filtreParAnnee(e){this.timbreUtilsService.timbreCritereModel=new k,this.timbreUtilsService.timbreCritereModel.setAnnees([e.getAnnee()]),this.timbreService.getTimbres(this.timbreUtilsService.timbreCritereModel)}static \u0275fac=function(t){return new(t||o)(B(Dt),B(F),B(X))};static \u0275cmp=Q({type:o,selectors:[["app-timbre-resume"]],viewQuery:function(t,i){if(t&1&&(te(ge,5),te(he,5)),t&2){let n;ie(n=ne())&&(i.paginator=n.first),ie(n=ne())&&(i.sort=n.first)}},decls:37,vars:14,consts:[["fxFlexFill","",3,"fxHide","textSpec"],[3,"fxHide"],["id","pdf-content","mat-table","","matSort","",3,"matSortChange","dataSource"],["matColumnDef","annee"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-footer-cell","",4,"matFooterCellDef"],["matColumnDef","nombre"],["mat-footer-cell","","class","accent",4,"matFooterCellDef"],["matColumnDef","acquis"],["matColumnDef","doublon"],["matColumnDef","nombreBloc"],["matColumnDef","acquisBloc"],["matColumnDef","doublonBloc"],["mat-header-row","","class","bg-primary color-white",4,"matHeaderRowDef"],["mat-row","","class","mat-row",3,"click",4,"matRowDef","matRowDefColumns"],["mat-footer-row","",4,"matFooterRowDef"],[3,"pageSize","pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],[3,"object","key"],["mat-cell",""],["mat-footer-cell",""],["mat-footer-cell","",1,"accent"],["mat-header-row","",1,"bg-primary","color-white"],["mat-row","",1,"mat-row",3,"click"],["mat-footer-row",""]],template:function(t,i){t&1&&(f(0,"lib-spinner",0),v(1,"async"),m(2,"section",1),v(3,"async"),m(4,"table",2),M("matSortChange",function(r){return i.sortData(r)}),A(5,3),b(6,wi,2,2,"th",4)(7,Ai,2,1,"td",5)(8,Ei,1,0,"td",6),E(),A(9,7),b(10,Di,2,2,"th",4)(11,Ri,2,1,"td",5)(12,Oi,4,3,"td",8),E(),A(13,9),b(14,Li,2,2,"th",4)(15,Ui,2,1,"td",5)(16,qi,4,3,"td",8),E(),A(17,10),b(18,Ni,2,2,"th",4)(19,Fi,2,1,"td",5)(20,ji,4,3,"td",8),E(),A(21,11),b(22,ki,2,2,"th",4)(23,Vi,2,1,"td",5)(24,$i,4,3,"td",8),E(),A(25,12),b(26,Pi,2,2,"th",4)(27,Hi,2,1,"td",5)(28,Wi,4,3,"td",8),E(),A(29,13),b(30,zi,2,2,"th",4)(31,Qi,2,1,"td",5)(32,Gi,4,3,"td",8),E(),b(33,Zi,1,0,"tr",14)(34,Yi,1,0,"tr",15)(35,Xi,1,0,"tr",16),a(),f(36,"mat-paginator",17),a()),t&2&&(s("fxHide",C(1,9,i.load$)==!0)("textSpec","Chargement en cours ..."),l(2),s("fxHide",C(3,11,i.load$)==!1),l(2),s("dataSource",i.dataSource),l(29),s("matHeaderRowDef",i.displayedColumns),l(),s("matRowDefColumns",i.displayedColumns),l(),s("matFooterRowDef",i.displayedColumns),l(),s("pageSize",15)("pageSizeOptions",Xe(13,Ii)))},dependencies:[ut,bt,_t,ft,dt,Tt,oi,li,gt,ht,ri,xt,Mt,mi,ge,he,pt,se,Ie,pe,_e,G],styles:[".mat-row[_ngcontent-%COMP%]{height:35px}.image[_ngcontent-%COMP%]{max-height:30px!important}.mat-column-acquis[_ngcontent-%COMP%], .mat-column-doublon[_ngcontent-%COMP%]{width:60px!important;max-width:60px!important;padding:0!important}.mat-column-ajouter[_ngcontent-%COMP%], .mat-column-modifier[_ngcontent-%COMP%], .mat-column-supprimer[_ngcontent-%COMP%]{width:35px!important;max-width:35px!important;padding:0!important}@media screen and (max-width: 800px){.mat-row[_ngcontent-%COMP%]{height:25px}.image[_ngcontent-%COMP%]{max-height:20px!important}.mat-column-acquis[_ngcontent-%COMP%], .mat-column-doublon[_ngcontent-%COMP%]{width:50px!important;max-width:50px!important;padding:0!important}.mat-column-ajouter[_ngcontent-%COMP%], .mat-column-modifier[_ngcontent-%COMP%], .mat-column-supprimer[_ngcontent-%COMP%]{width:20px!important;max-width:20px!important;padding:0!important}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:0 5px!important}th[_ngcontent-%COMP%], .mat-row[_ngcontent-%COMP%]{font-size:.8em}.mat-column-libelle[_ngcontent-%COMP%],   .mat-column-libelle .mat-sort-header-container{width:40px!important;max-width:40px!important}.mat-column-drapeau[_ngcontent-%COMP%],   .mat-column-drapeau span{width:15px!important;max-width:15px!important}.mat-column-classeur[_ngcontent-%COMP%],   .mat-column-classeur .mat-sort-header-container, .mat-column-page[_ngcontent-%COMP%],   .mat-column-page .mat-sort-header-container{width:15px!important;max-width:15px!important}.mat-column-total[_ngcontent-%COMP%],   .mat-column-total .mat-sort-header-container{width:25px!important;max-width:25px!important}.hide-on-mobile[_ngcontent-%COMP%]{display:none}}"]})};var _i=$t(Mi());var je=class{dossier;nom;alignLabel;detail;file;getDossier(){return this.dossier}setDossier(e){this.dossier=e}getNom(){return this.nom}setNom(e){this.nom=e}getAlignLabel(){return this.alignLabel}setAlignLabel(e){this.alignLabel=e}getDetail(){return this.detail}setDetail(e){this.detail=e}getFile(){return this.file}setFile(e){this.file=e}};var Te=class{key;dossier;maxWidth;maxHeight;getKey(){return this.key}setKey(e){this.key=e}getDossier(){return this.dossier}setDossier(e){this.dossier=e}getMaxWidth(){return this.maxWidth}setMaxWidth(e){this.maxWidth=e}getMaxHeight(){return this.maxHeight}setMaxHeight(e){this.maxHeight=e}};var sn=["canvas"];function cn(o,e){if(o&1&&(m(0,"span",6)(1,"b"),d(2),a()()),o&2){let t=p();l(2),I("N\xB0",t.timbreModel==null?null:t.timbreModel.getId(),"")}}function pn(o,e){o&1&&f(0,"lib-spinner",7),o&2&&s("textSpec","Chargement en cours ...")}function un(o,e){if(o&1&&(f(0,"mat-error",29),v(1,"async")),o&2){let t=p(2);s("innerHTML",C(1,1,t.messageError$),Me)}}function dn(o,e){if(o&1&&(m(0,"mat-option",18),d(1),a()),o&2){let t=e.$implicit;s("value",t),l(),zt(" ",t.getAnnee()," - ",t.getId()," ")}}function bn(o,e){if(o&1){let t=O();m(0,"img",30),M("click",function(){let n;h(t);let r=p(2);return _(r.utilsService.zoom(r.timbreModel==null||(n=r.timbreModel.getTimbreBlocModel())==null?null:n.getImageZoom()))}),a()}if(o&2){let t,i=p(2);s("src",i.timbreModel==null||(t=i.timbreModel.getTimbreBlocModel())==null?null:t.getImage(),$e)}}function fn(o,e){if(o&1){let t=O();m(0,"form",8,1),M("ngSubmit",function(){h(t);let n=N(1),r=p();return _(r.valider(n))}),m(2,"div",9),b(3,un,2,3,"mat-error",10),v(4,"async"),m(5,"div",11)(6,"div",12)(7,"label"),f(8,"lib-libelle-model",13),a(),m(9,"input",14),W("ngModelChange",function(n){h(t);let r=p();return H(r.timbreModel.annee,n)||(r.timbreModel.annee=n),_(n)}),M("ngModelChange",function(n){h(t);let r=p();return _(r.changeAnnee(n))}),a()(),m(10,"div",15)(11,"label"),f(12,"lib-libelle-model",13),a(),m(13,"div",16)(14,"mat-select",17),v(15,"async"),M("ngModelChange",function(n){h(t);let r=p();return _(r.changeBloc(n))}),f(16,"mat-option",18),b(17,dn,2,3,"mat-option",19),v(18,"async"),a(),b(19,bn,1,1,"img",20),a()()(),m(20,"div",11)(21,"div",12)(22,"label"),f(23,"lib-libelle-model",13),a(),m(24,"input",21),W("ngModelChange",function(n){h(t);let r=p();return H(r.timbreModel.type,n)||(r.timbreModel.type=n),_(n)}),a()(),m(25,"div",12)(26,"label"),f(27,"lib-libelle-model",13),a(),m(28,"input",22),W("ngModelChange",function(n){h(t);let r=p();return H(r.timbreModel.monnaie,n)||(r.timbreModel.monnaie=n),_(n)}),a()()(),m(29,"div",11)(30,"div",12)(31,"label"),f(32,"lib-libelle-model",13),a(),m(33,"input",23),W("ngModelChange",function(n){h(t);let r=p();return H(r.timbreModel.yt,n)||(r.timbreModel.yt=n),_(n)}),a()(),f(34,"div",24),a(),m(35,"lib-upload",25),M("outPutObject",function(n){h(t);let r=p();return _(r.timbreModel=n)}),a()(),m(36,"div",26)(37,"button",27),M("click",function(){h(t);let n=p();return _(n.close())}),d(38," Annuler "),a(),m(39,"button",28),d(40," Enregistrer "),a()()()}if(o&2){let t,i,n=N(1),r=p();s("ngClass",n!=null&&n.submitted?"red-color":"blue-color"),l(3),s("ngIf",C(4,31,r.messageError$)),l(5),s("object",r.timbreModel)("key","annee"),l(),P("ngModel",r.timbreModel.annee),s("max",r.maxAnnee)("zMax",r.maxAnnee)("disabled",!!(r.timbreModel!=null&&r.timbreModel.getId())),l(3),s("object",r.timbreModel)("key","timbreBlocModel"),l(2),s("ngModel",r.timbreModel.getTimbreBlocModel())("placeholder","Choix bloc")("disabled",!!(r.timbreModel!=null&&r.timbreModel.getId())||((t=C(15,33,r.timbreBlocService.timbresBlocModel$))==null?null:t.length)<=0),l(2),s("value",null),l(),s("ngForOf",C(18,35,r.timbreBlocService.timbresBlocModel$)),l(2),s("ngIf",r.timbreModel==null||(i=r.timbreModel.getTimbreBlocModel())==null?null:i.getImage()),l(4),s("object",r.timbreModel)("key","type"),l(),P("ngModel",r.timbreModel.type),l(3),s("object",r.timbreModel)("key","monnaie"),l(),P("ngModel",r.timbreModel.monnaie),s("disabled",!!r.timbreModel.getTimbreBlocModel()),l(4),s("object",r.timbreModel)("key","yt"),l(),P("ngModel",r.timbreModel.yt),l(2),s("object",r.timbreModel)("key","image")("zoom",r.timbreModel.getImageZoom())("maxWidth",r.timbreService.widthTimbre)("maxHeight",r.timbreService.heightTimbre)}}var ke=class o{constructor(e,t,i,n,r){this.httpResponseHandlerService=e;this.dialogRef=t;this.timbreService=i;this.timbreBlocService=n;this.utilsService=r}canvas;messageError$=new w(null);load$=new w(null);id;maxAnnee=new Date().getFullYear();timbreModel=new D;fileUploadModel=new je;ngOnInit(){this.initUpload(),this.load$.next(!1),c(this.id)?this.timbreService.getTimbreByIdAsync(this.id).subscribe(e=>{this.timbreModel=e,c(e.getTimbreBlocModel())&&(this.timbreModel.setAnnee(e.getTimbreBlocModel().getAnnee()),this.timbreModel.setMonnaie(e.getTimbreBlocModel().getMonnaie())),this.load$.next(!0)}):(this.timbreModel.setAnnee(new Date().getFullYear()),this.timbreModel.setMonnaie("E"),this.load$.next(!0)),this.changeAnnee(this.timbreModel.getAnnee())}initUpload(){this.fileUploadModel.setDossier("test"),this.fileUploadModel.setNom(new Date().getTime()?.toString());let e=new Te;e.setMaxWidth(this.timbreService.widthTimbre),e.setMaxHeight(this.timbreService.heightTimbre),e.setDossier("autre");let t=new Te;t.setMaxWidth(this.timbreService.widthTimbreZoom),t.setMaxHeight(this.timbreService.heightTimbreZoom),t.setDossier("zoom"),this.fileUploadModel.setDetail([e,t])}valider(e){if(this.messageError$.next(null),e?.valid)if(c(this.timbreModel.getImage()))this.saveData();else{this.messageError$.next("Veuillez s\xE9lectionner une image");return}}saveData(){this.load$.next(!1),c(this.timbreModel.getId())?this.save():this.ajouter()}ajouter(){this.utilsService.getMaxIdentAsync("/timbres").pipe(y()).subscribe(e=>{this.timbreModel.setId(e),this.save(!0)})}save(e){try{j([this.timbreService.upload(this.timbreModel,"autre"),this.timbreService.upload(this.timbreModel,"table"),this.timbreService.upload(this.timbreModel,"zoom")]).pipe(y(([t,i,n])=>c(t)&&c(n)&&c(i))).subscribe(([t,i,n])=>{c(i)&&i!="nok"&&this.timbreModel.setImage(i),c(t)&&t!="nok"&&this.timbreModel.setImageTable(t),c(n)&&n!="nok"&&this.timbreModel.setImageZoom(n),e?this.timbreService.ajouter(this.timbreModel,!0):this.timbreService.modifier(this.timbreModel),this.httpResponseHandlerService.showNotificationSuccess("Transaction termin\xE9e","Votre timbre a bien \xE9t\xE9 modifi\xE9e."),this.load$.next(!0),this.dialogRef.close()})}catch{this.httpResponseHandlerService.showNotificationError("Transaction non aboutie","Votre timbre n'a pas pu \xEAtre modifi\xE9."),this.load$.next(!0)}}close(){this.dialogRef.close()}changeAnnee(e){if(this.timbreModel.setTimbreBlocModel(null),c(e)){let t=new k;t.setAnnees([e]),this.timbreBlocService.getBlocs(t)}}changeBloc(e){c(e)?(this.timbreModel.setIdBloc(e.getId()),this.timbreModel.setTimbreBlocModel(e),this.timbreModel.setMonnaie(e.getMonnaie())):(this.timbreModel.setIdBloc(null),this.timbreModel.setTimbreBlocModel(null),this.timbreModel.setMonnaie("E"))}static \u0275fac=function(t){return new(t||o)(B(St),B(Le),B(F),B(J),B(Y))};static \u0275cmp=Q({type:o,selectors:[["app-timbre-modifier"]],viewQuery:function(t,i){if(t&1&&te(sn,5),t&2){let n;ie(n=ne())&&(i.canvas=n.first)}},decls:9,vars:6,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],["class","accent",4,"ngIf"],[3,"ngIf","ngIfElse"],[1,"accent"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","space-between stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","column","fxLayoutGap","20px",1,"bloc-modal"],[3,"innerHTML",4,"ngIf"],["fxLayout","row","fxLayout.lt-lg","column","fxLayoutGap","30px","fxLayoutGap.lt-lg","5px"],["fxLayout","column",1,"form-input"],[3,"object","key"],["name","page","type","number","minlength","4","maxlength","4","min","1900","zMin","1900","required","","zControl","",1,"annee",2,"width","60px !important",3,"ngModelChange","ngModel","max","zMax","disabled"],["fxLayout","column",1,"form-input","select"],["fxLayout","row","fxLayoutGap","15px"],["name","bloc",2,"width","120px !important",3,"ngModelChange","ngModel","placeholder","disabled"],[1,"selectMin",3,"value"],["class","selectMin",3,"value",4,"ngFor","ngForOf"],["style","max-height: 40px","class","click",3,"src","click",4,"ngIf"],["name","type","type","text","trim","","zControl","",3,"ngModelChange","ngModel"],["name","monnaie","type","text","trim","","minlength","1","maxlength","2","required","","zControl","",2,"width","25px !important",3,"ngModelChange","ngModel","disabled"],["name","yt","type","text","trim","","zControl","",3,"ngModelChange","ngModel"],["fxHide.lt-lg","","fxLayout","column",1,"form-input"],[3,"outPutObject","object","key","zoom","maxWidth","maxHeight"],["fxLayout","row","fxLayoutGap","10px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"],[3,"innerHTML"],[1,"click",2,"max-height","40px",3,"click","src"]],template:function(t,i){if(t&1&&(m(0,"div",2)(1,"div",3)(2,"span"),d(3),a(),b(4,cn,3,1,"span",4),a(),b(5,pn,1,1,"ng-template",5),v(6,"async"),b(7,fn,41,37,"ng-template",null,0,oe),a()),t&2){let n=N(8);l(3),I("",i.timbreModel!=null&&i.timbreModel.getId()?"MODIFICATION":"AJOUT"," "),l(),s("ngIf",i.timbreModel==null?null:i.timbreModel.getId()),l(),s("ngIf",C(6,4,i.load$)==!1)("ngIfElse",n)}},dependencies:[ce,Oe,ct,at,ve,Ce,re,me,ae,fe,se,be,Ie,Be,Re,tt,it,we,Ae,rt,lt,mt,ot,nt,De,Ee,pe,_e,vt,yt,Bt,It,wt,G],encapsulation:2})};var hi=$t(vi());var hn=()=>[10,20,50,100];function _n(o,e){if(o&1&&(m(0,"mat-option",34),d(1),a()),o&2){let t=e.$implicit;s("value",t),l(),I(" ",t," ")}}function Tn(o,e){if(o&1){let t=O();m(0,"div",3)(1,"div",32)(2,"mat-select",33),W("ngModelChange",function(n){h(t);let r=p();return H(r.timbreUtilsService.timbreCritereModel.acquis,n)||(r.timbreUtilsService.timbreCritereModel.acquis=n),_(n)}),M("ngModelChange",function(){h(t);let n=p();return _(n.filtreByCritere())}),m(3,"mat-option",34),d(4," Oui"),a(),m(5,"mat-option",34),d(6," Non"),a(),m(7,"mat-option",34),d(8," Tous"),a()()(),m(9,"div",32)(10,"mat-select",35),W("ngModelChange",function(n){h(t);let r=p();return H(r.timbreUtilsService.timbreCritereModel.doublon,n)||(r.timbreUtilsService.timbreCritereModel.doublon=n),_(n)}),M("ngModelChange",function(){h(t);let n=p();return _(n.filtreByCritere())}),m(11,"mat-option",34),d(12," Oui"),a(),m(13,"mat-option",34),d(14," Non"),a(),m(15,"mat-option",34),d(16," Tous"),a()()(),m(17,"div",32)(18,"mat-select",36),W("ngModelChange",function(n){h(t);let r=p();return H(r.timbreUtilsService.timbreCritereModel.bloc,n)||(r.timbreUtilsService.timbreCritereModel.bloc=n),_(n)}),M("ngModelChange",function(){h(t);let n=p();return _(n.filtreByCritere())}),m(19,"mat-option",34),d(20," Oui"),a(),m(21,"mat-option",34),d(22," Non"),a(),m(23,"mat-option",34),d(24," Tous"),a()()(),m(25,"div",37)(26,"mat-select",38),W("ngModelChange",function(n){h(t);let r=p();return H(r.timbreUtilsService.timbreCritereModel.annees,n)||(r.timbreUtilsService.timbreCritereModel.annees=n),_(n)}),M("ngModelChange",function(){h(t);let n=p();return _(n.filtreByCritere())}),b(27,_n,2,2,"mat-option",39),v(28,"async"),a()(),m(29,"div",40)(30,"input",41),M("input",function(n){h(t);let r=p();return _(r.applyFilter(n))}),a()(),m(31,"lib-icon",42),M("click",function(){h(t);let n=p();return _(n.exportTable())}),a()()}if(o&2){let t=p();l(2),P("ngModel",t.timbreUtilsService.timbreCritereModel.acquis),s("placeholder","Acquis"),l(),s("value","OUI"),l(2),s("value","NON"),l(2),s("value","TOUS"),l(3),P("ngModel",t.timbreUtilsService.timbreCritereModel.doublon),s("placeholder","Doublon"),l(),s("value","OUI"),l(2),s("value","NON"),l(2),s("value","TOUS"),l(3),P("ngModel",t.timbreUtilsService.timbreCritereModel.bloc),s("placeholder","Bloc"),l(),s("value","OUI"),l(2),s("value","NON"),l(2),s("value","TOUS"),l(3),P("ngModel",t.timbreUtilsService.timbreCritereModel.annees),s("placeholder","Ann\xE9es"),l(),s("ngForOf",C(28,21,t.annees$)),l(4),s("type",t.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",t.FontAwesomeEnum.FILE_EXEL)("info","Exporter tableau")}}function xn(o,e){if(o&1&&(m(0,"th",43),f(1,"lib-libelle-model",44),a()),o&2){let t=p();l(),s("object",t.timbre)("key","image")}}function Mn(o,e){if(o&1){let t=O();m(0,"img",47),M("click",function(){h(t);let n=p().$implicit,r=p();return _(r.utilsService.zoom(n==null?null:n.getImageZoom()))}),a()}if(o&2){let t=p().$implicit;s("src",t==null?null:t.getImageTable(),$e)}}function vn(o,e){if(o&1&&(m(0,"td",45),b(1,Mn,1,1,"img",46),a()),o&2){let t=e.$implicit;l(),s("ngIf",t==null?null:t.getImageTable())}}function Cn(o,e){if(o&1&&(m(0,"th",48),f(1,"lib-libelle-model",49),a()),o&2){let t=p();l(),s("object",t.timbre)("key","id")}}function Sn(o,e){if(o&1&&(m(0,"td",50),d(1),a()),o&2){let t=e.$implicit;l(),I(" ",t==null?null:t.getId()," ")}}function yn(o,e){if(o&1&&(m(0,"th",48),f(1,"lib-libelle-model",49),a()),o&2){let t=p();l(),s("object",t.timbre)("key","annee")}}function Bn(o,e){if(o&1&&d(0),o&2){let t,i=p().$implicit;I(" ",i==null||(t=i.getTimbreBlocModel())==null?null:t.getAnnee()," ")}}function In(o,e){if(o&1&&d(0),o&2){let t=p().$implicit;I(" ",t==null?null:t.getAnnee()," ")}}function wn(o,e){if(o&1&&(m(0,"td",50),b(1,Bn,1,1,"ng-template",51)(2,In,1,1,"ng-template",null,0,oe),a()),o&2){let t=e.$implicit,i=N(3);l(),s("ngIf",t==null?null:t.getIdBloc())("ngIfElse",i)}}function An(o,e){if(o&1&&(m(0,"th",52),f(1,"lib-libelle-model",49),a()),o&2){let t=p();l(),s("object",t.timbre)("key","idBloc")}}function En(o,e){if(o&1){let t=O();m(0,"img",47),M("click",function(){let n;h(t);let r=p(2).$implicit,u=p();return _(u.utilsService.zoom(r==null||(n=r.getTimbreBlocModel())==null?null:n.getImageZoom()))}),a()}if(o&2){let t,i=p(2).$implicit;s("src",i==null||(t=i.getTimbreBlocModel())==null?null:t.getImageTable(),$e)}}function Dn(o,e){if(o&1&&b(0,En,1,1,"img",46),o&2){let t,i=p().$implicit;s("ngIf",i==null||(t=i.getTimbreBlocModel())==null?null:t.getImage())}}function Rn(o,e){o&1&&d(0," Non ")}function On(o,e){if(o&1&&(m(0,"td",50),b(1,Dn,1,1,"ng-template",51)(2,Rn,1,0,"ng-template",null,0,oe),a()),o&2){let t=e.$implicit,i=N(3);l(),s("ngIf",t==null?null:t.getIdBloc())("ngIfElse",i)}}function Ln(o,e){if(o&1&&(m(0,"th",53),f(1,"lib-libelle-model",49),a()),o&2){let t=p();l(),s("object",t.timbre)("key","monnaie")}}function Un(o,e){if(o&1&&d(0),o&2){let t,i=p().$implicit;I(" ",(i==null||(t=i.getTimbreBlocModel())==null?null:t.getMonnaie())=="E"?"\u20AC":"Francs"," ")}}function qn(o,e){if(o&1&&d(0),o&2){let t=p().$implicit;I(" ",(t==null?null:t.getMonnaie())=="E"?"\u20AC":"Francs"," ")}}function Nn(o,e){if(o&1&&(m(0,"td",54),b(1,Un,1,1,"ng-template",51)(2,qn,1,1,"ng-template",null,0,oe),a()),o&2){let t=e.$implicit,i=N(3);l(),s("ngIf",t==null?null:t.getIdBloc())("ngIfElse",i)}}function Fn(o,e){if(o&1&&(m(0,"th",53),f(1,"lib-libelle-model",49),a()),o&2){let t=p();l(),s("object",t.timbre)("key","type")}}function jn(o,e){if(o&1&&(m(0,"td",54),d(1),a()),o&2){let t=e.$implicit;l(),I(" ",t==null?null:t.getType()," ")}}function kn(o,e){if(o&1&&(m(0,"th",53),f(1,"lib-libelle-model",49),a()),o&2){let t=p();l(),s("object",t.timbre)("key","yt")}}function Vn(o,e){if(o&1&&(m(0,"td",54),d(1),a()),o&2){let t=e.$implicit;l(),I(" ",t==null?null:t.getYt()," ")}}function $n(o,e){if(o&1&&(m(0,"th",48),f(1,"lib-libelle-model",49),a()),o&2){let t=p();l(),s("object",t.timbre==null?null:t.timbre.getTimbreAcquisModel())("key","acquis")}}function Pn(o,e){if(o&1){let t=O();m(0,"td",45)(1,"lib-icon",55),M("click",function(){let n=h(t).$implicit,r=p();return _(r.acquis(n))}),a()()}if(o&2){let t,i,n,r=e.$implicit,u=p();l(),s("classIcone",!(r==null||(t=r.getTimbreAcquisModel())==null)&&t.isAcquis()?"accent":"primary")("type",u.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",!(r==null||(i=r.getTimbreAcquisModel())==null)&&i.isAcquis()?u.FontAwesomeEnum.CIRCLE_MINUS:u.FontAwesomeEnum.CIRCLE_PLUS)("info",!(r==null||(n=r.getTimbreAcquisModel())==null)&&n.isAcquis()?"pas acquis":"acquis")}}function Hn(o,e){if(o&1&&(m(0,"th",48),f(1,"lib-libelle-model",49),a()),o&2){let t=p();l(),s("object",t.timbre==null?null:t.timbre.getTimbreAcquisModel())("key","doublon")}}function Wn(o,e){if(o&1){let t=O();m(0,"td",45)(1,"lib-icon",55),M("click",function(){let n=h(t).$implicit,r=p();return _(r.doublon(n))}),a()()}if(o&2){let t,i,n,r=e.$implicit,u=p();l(),s("classIcone",!(r==null||(t=r.getTimbreAcquisModel())==null)&&t.isDoublon()?"accent":"primary")("type",u.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",!(r==null||(i=r.getTimbreAcquisModel())==null)&&i.isDoublon()?u.FontAwesomeEnum.CIRCLE_MINUS:u.FontAwesomeEnum.CIRCLE_PLUS)("info",!(r==null||(n=r.getTimbreAcquisModel())==null)&&n.isDoublon()?"pas en double":"en double")}}function zn(o,e){if(o&1&&(m(0,"th",56),f(1,"lib-icon",57),a()),o&2){let t=p();l(),s("type",t.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",t.FontAwesomeEnum.PENCIL)("info","Modifier")}}function Qn(o,e){if(o&1){let t=O();m(0,"td",45)(1,"lib-icon",58),M("click",function(){let n=h(t).$implicit,r=p();return _(r.modifier(n))}),a()()}if(o&2){let t=p();l(),s("type",t.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",t.FontAwesomeEnum.PENCIL)("info","Modifier")}}function Gn(o,e){if(o&1&&(m(0,"th",56),f(1,"lib-icon",57),a()),o&2){let t=p();l(),s("type",t.FontAwesomeTypeEnum.TYPE_SOLID)("icone",t.FontAwesomeEnum.TRASH)("info","Supprimer")}}function Zn(o,e){if(o&1){let t=O();m(0,"td",45)(1,"lib-icon",58),M("click",function(){let n=h(t).$implicit,r=p();return _(r.supprimer(n))}),a()()}if(o&2){let t=p();l(),s("type",t.FontAwesomeTypeEnum.TYPE_SOLID)("icone",t.FontAwesomeEnum.TRASH)("info","Supprimer")}}function Yn(o,e){o&1&&f(0,"tr",59)}function Xn(o,e){o&1&&f(0,"tr",60)}var qt=class o{constructor(e,t,i,n){this.timbreService=e;this.timbreUtilsService=t;this.dialog=i;this.utilsService=n;this.dataSource=new Ue([])}paginator;sort;timbres$;total$;modif=!0;load$=new w(!1);dataSource=new Ue;displayedColumns;timbre=new D;annees$;FontAwesomeEnum=et;FontAwesomeTypeEnum=Je;ngOnInit(){this.annees$=this.timbreUtilsService.getAnneesAsync("/timbres"),this.timbre.setTimbreAcquisModel(new V),this.displayedColumns=["image","id","annee","idBloc","monnaie","type","yt","acquis","doublon"],this.modif&&this.displayedColumns.push("modifier","supprimer"),this.load$.next(!1),this.timbres$.subscribe(e=>{this.dataSource.data=e,this.load$.next(!0)})}ngAfterViewInit(){this.dataSource.paginator=this.paginator}sortData(e){c(e)&&(console.log(e),this.dataSource.sort=this.sort)}filtreByCritere(){this.timbreUtilsService.timbreCritereModel.getAcquis()=="NON"&&this.timbreUtilsService.timbreCritereModel.setDoublon("TOUS"),this.timbreService.getTimbres(this.timbreUtilsService.timbreCritereModel)}applyFilter(e){let t=e.target.value;this.dataSource.filter=t.trim().toLowerCase()}resume(){let e=this.dialog.open(Rt,{height:"auto",maxHeight:"750px",width:"30%"});e.afterClosed().subscribe(()=>{e.close()})}acquis(e){this.timbreService.acquis(e,!1)}doublon(e){this.timbreService.acquis(e,!0)}modifier(e){let t=this.dialog.open(ke,{height:"75vh",maxHeight:"750px",width:"30%"});t.componentInstance.id=e.getId(),t.afterClosed().subscribe(()=>{t.close()})}supprimer(e){let t=this.dialog.open(pi,{maxHeight:"95vh",data:{titre:"Confirmation",message:"Souhaitez-vous supprimer le timbre <b>n\xB0 "+e?.getId()+"</b> ?",btnDroite:"Oui",btnGauche:"Non"}});t.afterClosed().subscribe(()=>{t.componentInstance.data.resultat==="valider"&&this.timbreService.supprimer(e)})}exportTable(){let e=At.json_to_sheet(this.dataSource.data),t=At.book_new();At.book_append_sheet(t,e,"Donn\xE9es");let i=ci(t,{bookType:"xlsx",type:"array"}),n=new Blob([i],{type:"application/octet-stream"});(0,hi.saveAs)(n,"export_timbres.xlsx")}generatePDFByImage(){let e="https://firebasestorage.googleapis.com/v0/b/book-f941b.appspot.com/o/AF.png?alt=media&token=a1039f78-3cff-41ab-8569-ea1b2cefe2c1";this.generatePDF(null)}generatePDF(e){}RouteEnum=Ke;static \u0275fac=function(t){return new(t||o)(B(F),B(X),B(st),B(Y))};static \u0275cmp=Q({type:o,selectors:[["app-timbre-resultat"]],viewQuery:function(t,i){if(t&1&&(te(ge,5),te(he,5)),t&2){let n;ie(n=ne())&&(i.paginator=n.first),ie(n=ne())&&(i.sort=n.first)}},inputs:{timbres$:"timbres$",total$:"total$",modif:"modif"},decls:52,vars:23,consts:[["noBloc",""],["fxFlexFill","",3,"fxHide","textSpec"],[3,"fxHide"],["fxLayout","row","fxLayoutAlign","space-between center","fxLayoutGap","15px",2,"height","50px"],["fxLayout","row","fxLayoutAlign","start center","fxLayoutGap","10px",2,"height","50px"],["fxFlex","",2,"font-size","1.2em"],[1,"bold"],[1,"accent","click",2,"font-size","2em",3,"click","icone","type","info","classInfo"],["fxLayout","row","fxLayoutAlign","space-between center","fxLayoutGap","15px","style","height: 50px",4,"ngIf"],["id","pdf-content","mat-table","","matSort","",3,"matSortChange","dataSource"],["matColumnDef","image"],["mat-header-cell","","class","image",4,"matHeaderCellDef"],["mat-cell","","class","alignCenter",4,"matCellDef"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","annee"],["matColumnDef","idBloc"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","monnaie"],["mat-header-cell","","mat-sort-header","","class","hide-on-mobile",4,"matHeaderCellDef"],["mat-cell","","class","hide-on-mobile",4,"matCellDef"],["matColumnDef","type"],["matColumnDef","yt"],["matColumnDef","acquis"],["matColumnDef","doublon"],["matColumnDef","modifier"],["mat-header-cell","","class","alignCenter",4,"matHeaderCellDef"],["matColumnDef","supprimer"],["mat-header-row","","class","bg-primary color-white",4,"matHeaderRowDef"],["mat-row","","class","mat-row",4,"matRowDef","matRowDefColumns"],[3,"pageSize","pageSizeOptions"],["fxLayout","row","fxLayoutAlign","end center",1,"form-input","select",2,"width","100px"],["name","acquis",3,"ngModelChange","ngModel","placeholder"],[1,"selectMin",3,"value"],["name","doublon",1,"scrollBarAccent",3,"ngModelChange","ngModel","placeholder"],["name","bloc",1,"scrollBarAccent",3,"ngModelChange","ngModel","placeholder"],["fxLayout","row","fxLayoutAlign","end center",1,"form-input","select",2,"width","150px"],["name","anneeSelect","multiple","",3,"ngModelChange","ngModel","placeholder"],["class","selectMin",3,"value",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","end center",1,"form-input",2,"width","200px","min-height","55px","height","55px"],["placeholder","Filtrer les donn\xE9es","type","text",3,"input"],[1,"primary","click",2,"font-size","1.7em",3,"click","type","icone","info"],["mat-header-cell","",1,"image"],[1,"hide-on-mobile",3,"object","key"],["mat-cell","",1,"alignCenter"],["class","image click",3,"src","click",4,"ngIf"],[1,"image","click",3,"click","src"],["mat-header-cell","","mat-sort-header",""],[3,"object","key"],["mat-cell",""],[3,"ngIf","ngIfElse"],["mat-header-cell",""],["mat-header-cell","","mat-sort-header","",1,"hide-on-mobile"],["mat-cell","",1,"hide-on-mobile"],[1,"click",2,"font-size","1.2em",3,"click","classIcone","type","icone","info"],["mat-header-cell","",1,"alignCenter"],[2,"font-size","1.2em",3,"type","icone","info"],[1,"primary","click",2,"font-size","1.2em",3,"click","type","icone","info"],["mat-header-row","",1,"bg-primary","color-white"],["mat-row","",1,"mat-row"]],template:function(t,i){t&1&&(f(0,"lib-spinner",1),v(1,"async"),m(2,"section",2),v(3,"async"),m(4,"div",3)(5,"div",4)(6,"div",5)(7,"span"),d(8,"Nombre de timbres : "),a(),m(9,"span",6),d(10),v(11,"async"),v(12,"async"),a()(),m(13,"lib-icon",7),M("click",function(){return i.resume()}),a()(),b(14,Tn,32,23,"div",8),a(),m(15,"table",9),M("matSortChange",function(r){return i.sortData(r)}),A(16,10),b(17,xn,2,2,"th",11)(18,vn,2,1,"td",12),E(),A(19,13),b(20,Cn,2,2,"th",14)(21,Sn,2,1,"td",15),E(),A(22,16),b(23,yn,2,2,"th",14)(24,wn,4,2,"td",15),E(),A(25,17),b(26,An,2,2,"th",18)(27,On,4,2,"td",15),E(),A(28,19),b(29,Ln,2,2,"th",20)(30,Nn,4,2,"td",21),E(),A(31,22),b(32,Fn,2,2,"th",20)(33,jn,2,1,"td",21),E(),A(34,23),b(35,kn,2,2,"th",20)(36,Vn,2,1,"td",21),E(),A(37,24),b(38,$n,2,2,"th",14)(39,Pn,2,4,"td",12),E(),A(40,25),b(41,Hn,2,2,"th",14)(42,Wn,2,4,"td",12),E(),A(43,26),b(44,zn,2,3,"th",27)(45,Qn,2,3,"td",12),E(),A(46,28),b(47,Gn,2,3,"th",27)(48,Zn,2,3,"td",12),E(),b(49,Yn,1,0,"tr",29)(50,Xn,1,0,"tr",30),a(),f(51,"mat-paginator",31),a()),t&2&&(s("fxHide",C(1,14,i.load$)==!0)("textSpec","Chargement en cours ..."),l(2),s("fxHide",C(3,16,i.load$)==!1),l(8),Ye(C(11,18,i.total$)?C(12,20,i.total$):i.dataSource==null||i.dataSource.data==null?null:i.dataSource.data.length),l(3),s("icone",i.FontAwesomeEnum.CHART_LINE_UP)("type",i.FontAwesomeTypeEnum.TYPE_SOLID)("info","D\xE9tail par ann\xE9e")("classInfo","tooltiptextDescription tooltiptextBgWhite widthAuto"),l(),s("ngIf",i.modif),l(),s("dataSource",i.dataSource),l(34),s("matHeaderRowDef",i.displayedColumns),l(),s("matRowDefColumns",i.displayedColumns),l(),s("pageSize",15)("pageSizeOptions",Xe(22,hn)))},dependencies:[ct,at,ut,bt,_t,ft,dt,Tt,gt,ht,xt,Mt,ge,he,pt,Ce,re,me,ae,fe,se,be,Ie,we,De,pe,Ct,_e,G],styles:[".mat-row[_ngcontent-%COMP%]{height:35px}.image[_ngcontent-%COMP%]{max-height:30px!important}.mat-column-acquis[_ngcontent-%COMP%], .mat-column-doublon[_ngcontent-%COMP%]{width:60px!important;max-width:60px!important;padding:0!important}.mat-column-ajouter[_ngcontent-%COMP%], .mat-column-modifier[_ngcontent-%COMP%], .mat-column-supprimer[_ngcontent-%COMP%]{width:35px!important;max-width:35px!important;padding:0!important}@media screen and (max-width: 800px){.mat-row[_ngcontent-%COMP%]{height:25px}.image[_ngcontent-%COMP%]{max-height:20px!important}.mat-column-acquis[_ngcontent-%COMP%], .mat-column-doublon[_ngcontent-%COMP%]{width:50px!important;max-width:50px!important;padding:0!important}.mat-column-ajouter[_ngcontent-%COMP%], .mat-column-modifier[_ngcontent-%COMP%], .mat-column-supprimer[_ngcontent-%COMP%]{width:20px!important;max-width:20px!important;padding:0!important}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:0 5px!important}th[_ngcontent-%COMP%], .mat-row[_ngcontent-%COMP%]{font-size:.8em}.mat-column-libelle[_ngcontent-%COMP%],   .mat-column-libelle .mat-sort-header-container{width:40px!important;max-width:40px!important}.mat-column-drapeau[_ngcontent-%COMP%],   .mat-column-drapeau span{width:15px!important;max-width:15px!important}.mat-column-classeur[_ngcontent-%COMP%],   .mat-column-classeur .mat-sort-header-container, .mat-column-page[_ngcontent-%COMP%],   .mat-column-page .mat-sort-header-container{width:15px!important;max-width:15px!important}.mat-column-total[_ngcontent-%COMP%],   .mat-column-total .mat-sort-header-container{width:25px!important;max-width:25px!important}.hide-on-mobile[_ngcontent-%COMP%]{display:none}}"]})};function Jn(o,e){if(o&1&&(f(0,"lib-spinner",5),v(1,"async")),o&2){let t=p();s("textSpec",C(1,1,t.messageLoad$))}}function eo(o,e){if(o&1&&(f(0,"mat-error",15),v(1,"async")),o&2){let t=p(2);s("innerHTML",C(1,1,t.messageError$),Me)}}function to(o,e){if(o&1&&f(0,"app-timbre-resultat",16),o&2){let t=p(2);s("timbres$",t.timbres$)("modif",!1)}}function io(o,e){o&1&&(m(0,"button",17),d(1," Enregistrer "),a())}function no(o,e){if(o&1){let t=O();m(0,"form",6,1),M("ngSubmit",function(){h(t);let n=N(1),r=p();return _(r.valider(n))}),m(2,"div",7),b(3,eo,2,3,"mat-error",8),v(4,"async"),b(5,to,1,2,"app-timbre-resultat",9),v(6,"async"),a(),m(7,"div",10)(8,"button",11),M("click",function(){h(t);let n=p();return _(n.close())}),d(9," Annuler "),a(),m(10,"input",12),M("change",function(n){h(t);let r=p();return _(r.onFileChange(n))}),a(),m(11,"button",13),M("click",function(){h(t);let n=p();return _(n.triggerFileInput())}),d(12," Choisir un fichier "),a(),b(13,io,2,0,"button",14),v(14,"async"),a()()}if(o&2){let t,i,n=N(1),r=p();s("ngClass",n!=null&&n.submitted?"red-color":"blue-color"),l(3),s("ngIf",C(4,5,r.messageError$)),l(2),s("ngIf",((t=C(6,7,r.timbres$))==null?null:t.length)>0),l(5),Wt("id",r.idFile),l(3),s("ngIf",((i=C(14,9,r.timbres$))==null?null:i.length)>0)}}var Nt=class o{constructor(e,t,i,n,r,u){this.authService=e;this.timbreService=t;this.timbreBlocService=i;this.uploadService=n;this.utilsService=r;this.dialogRef=u}dossier="/assets/images/timbres/";timbres$=new w(null);messageError$=new w(null);messageLoad$=new w("Chargement en cours ...");load$=new w(null);idFile="fileImport";identTimbre=1;identBloc=1;timbresModel=[];timbresBlocsModel=[];triggerFileInput(){document.getElementById(this.idFile).click()}onFileChange(e){let t=e.target.files[0];t&&(this.load$.next(!1),this.messageLoad$.next("Chargement en cours ..."),this.saveCsv(t))}saveCsv(e){let t=new FileReader;t.onload=()=>{let i=t.result;this.parseCsv(i)},t.readAsText(e)}parseCsv(e){j([this.utilsService.getMaxIdentAsync("/timbres"),this.utilsService.getMaxIdentAsync("/timbres_bloc"),this.authService.getUser()]).pipe(y(([t,i,n])=>c(n))).subscribe(([t,i,n])=>{c(t)&&t>1&&(this.identTimbre=t+1),c(i)&&i>1&&(this.identBloc=i+1),this.timbresModel=[],this.timbres$.next(null),_i.parse(e,{header:!0,skipEmptyLines:!0,complete:r=>{c(r.data)&&r.data?.length>0&&(this.timbresBlocsModel=[],r.data.forEach((u,g)=>{this.timbresModel.push(this.setTimbre(u,n)),this.identTimbre++,g==r.data.length-1&&(this.timbres$.next(this.timbresModel),this.load$.next(!0))}))},error:r=>{console.error("Erreur lors du parsing du CSV :",r)}})})}setTimbre(e,t){let i=new D,n=e.CODE!="NULL"&&e.CODE!=""?Number(e.CODE):null,r=e.IDENT_BLOC!="NULL"&&e.IDENT_BLOC!=""?Number(e.IDENT_BLOC):null,u=e.ANNEE!="NULL"&&e.ANNEE!=""?Number(e.ANNEE):null,g=e.MONNAIE!="NULL"&&e.MONNAIE!=""?e.MONNAIE:null;i.setId(this.identTimbre),i.setType(e.TYPE!="NULL"&&e.TYPE!=""?e.TYPE:null),i.setYt(e.YT!="NULL"&&e.YT!=""?e.YT:null);let S=new V;S.setIdTimbre(i.getId()),S.setIdUser(t.getId()),S.setAcquis(e.ACQUIS=="1"),S.setDoublon(e.DOUBLON=="1"),i.setTimbreAcquisModel(S);let R=this.dossier+u+"/",z="";if(c(r)){if(R+="bloc/"+r,z=R+".png",R+="-",i.setTimbreBlocModel(this.timbresBlocsModel.find(U=>U.getAnnee()==u&&U.idOrigine==r)),le(i.getTimbreBlocModel())){let U=new q;U.setId(this.identBloc),U.setAnnee(u),U.setMonnaie(g),U.idOrigine=r;let Ve=new K;Ve.setIdBloc(this.identBloc),Ve.setIdUser(t.getId()),Ve.setAcquis(e.ACQUIS_BLOC=="1"),Ve.setDoublon(e.DOUBLON_BLOC=="1"),U.setTimbreBlocAcquisModel(Ve),this.uploadService.checkIfImageExists(z).pipe(y()).subscribe(xi=>{xi&&(U.setImage(z),U.setImageTable(z),U.setImageZoom(z))}),this.timbresBlocsModel.push(U),i.setTimbreBlocModel(U),this.identBloc++}i.setIdBloc(i.getTimbreBlocModel()?.getId())}else i.setAnnee(u),i.setMonnaie(g);return R+=n+".png",this.uploadService.checkIfImageExists(R).pipe(y()).subscribe(U=>{U&&(i.setImage(R),i.setImageTable(R),i.setImageZoom(R))}),i}valider(e){this.messageError$.next(null),e?.valid&&(this.load$.next(!1),this.messageLoad$.next("Import en cours ..."),c(this.timbresBlocsModel)&&this.timbresBlocsModel?.length>0&&this.timbresBlocsModel.forEach((t,i)=>{this.saveBloc(t)}),this.timbres$.pipe(y()).subscribe(t=>{if(c(t)&&t?.length>0)t.forEach((i,n)=>{this.saveTimbre(i,n==t.length-1)});else{this.messageError$.next("Donn\xE9es incorrectes");return}}))}saveBloc(e){j([this.timbreBlocService.upload(e,"autre"),this.timbreBlocService.upload(e,"table"),this.timbreBlocService.upload(e,"zoom")]).pipe(y(([t,i,n])=>c(t)&&c(n)&&c(i))).subscribe(([t,i,n])=>{c(i)&&i!="nok"&&e.setImage(i),c(t)&&t!="nok"&&e.setImageTable(t),c(n)&&n!="nok"&&e.setImageZoom(n),e?.getTimbreBlocAcquisModel()?.isAcquis()&&this.timbreBlocService.addAcquis(e?.getTimbreBlocAcquisModel()?.getIdUser(),e,e?.getTimbreBlocAcquisModel()?.isDoublon()),this.timbreBlocService.ajouter(e,!1)})}saveTimbre(e,t){j([this.timbreService.upload(e,"autre"),this.timbreService.upload(e,"table"),this.timbreService.upload(e,"zoom")]).pipe(y(([i,n,r])=>c(i)&&c(r)&&c(n))).subscribe(([i,n,r])=>{c(n)&&n!="nok"&&e.setImage(n),c(i)&&i!="nok"&&e.setImageTable(i),c(r)&&r!="nok"&&e.setImageZoom(r),e?.getTimbreAcquisModel()?.isAcquis()&&this.timbreService.addAcquis(e?.getTimbreAcquisModel()?.getIdUser(),e,e?.getTimbreAcquisModel()?.isDoublon()),this.timbreService.ajouter(e,t),t&&(this.load$.next(!0),this.close())})}close(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||o)(B(ye),B(F),B(J),B(qe),B(Y),B(Le))};static \u0275cmp=Q({type:o,selectors:[["app-timbre-importer"]],decls:8,vars:4,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],[3,"ngIf","ngIfElse"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","start stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","column","fxLayoutGap","20px",1,"bloc-modal"],[3,"innerHTML",4,"ngIf"],[3,"timbres$","modif",4,"ngIf"],["fxLayout","row","fxLayoutGap","10px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","file","accept",".xls, .xlsx, .csv","hidden","","required","",3,"change","id"],["type","button","mat-raised-button","","color","accent",1,"rounded","large","color-white",3,"click"],["type","submit","class","rounded large color-white","mat-raised-button","","color","accent",4,"ngIf"],[3,"innerHTML"],[3,"timbres$","modif"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"]],template:function(t,i){if(t&1&&(m(0,"div",2)(1,"div",3)(2,"span"),d(3,"TIMBRE IMPORTER"),a()(),b(4,Jn,2,3,"ng-template",4),v(5,"async"),b(6,no,15,11,"ng-template",null,0,oe),a()),t&2){let n=N(7);l(4),s("ngIf",C(5,2,i.load$)==!1)("ngIfElse",n)}},dependencies:[ce,Oe,ve,re,me,ae,fe,se,be,Be,Re,Ae,Ee,pe,qt,G]})};var oo=["canvas"];function ro(o,e){o&1&&f(0,"lib-spinner",5),o&2&&s("textSpec","Chargement en cours ...")}function lo(o,e){if(o&1&&(f(0,"mat-error",18),v(1,"async")),o&2){let t=p(2);s("innerHTML",C(1,1,t.messageError$),Me)}}function mo(o,e){if(o&1){let t=O();m(0,"div",10)(1,"label"),f(2,"lib-libelle-model",11),a(),m(3,"input",19),W("ngModelChange",function(n){h(t);let r=p(2);return H(r.timbreBlocModel.id,n)||(r.timbreBlocModel.id=n),_(n)}),a()()}if(o&2){let t=p(2);l(2),s("object",t.timbreBlocModel)("key","id"),l(),P("ngModel",t.timbreBlocModel.id),s("disabled",!!(t.timbreBlocModel!=null&&t.timbreBlocModel.getId()))}}function ao(o,e){if(o&1){let t=O();m(0,"form",6,1),M("ngSubmit",function(){h(t);let n=N(1),r=p();return _(r.valider(n))}),m(2,"div",7),b(3,lo,2,3,"mat-error",8),v(4,"async"),b(5,mo,4,4,"div",9),m(6,"div",10)(7,"label"),f(8,"lib-libelle-model",11),a(),m(9,"input",12),W("ngModelChange",function(n){h(t);let r=p();return H(r.timbreBlocModel.annee,n)||(r.timbreBlocModel.annee=n),_(n)}),a()(),m(10,"div",10)(11,"label"),f(12,"lib-libelle-model",11),a(),m(13,"input",13),W("ngModelChange",function(n){h(t);let r=p();return H(r.timbreBlocModel.monnaie,n)||(r.timbreBlocModel.monnaie=n),_(n)}),a()(),m(14,"lib-upload",14),M("outPutObject",function(n){h(t);let r=p();return _(r.timbreBlocModel=n)}),a()(),m(15,"div",15)(16,"button",16),M("click",function(){h(t);let n=p();return _(n.close())}),d(17," Annuler "),a(),m(18,"button",17),d(19," Enregistrer "),a()()()}if(o&2){let t=N(1),i=p();s("ngClass",t!=null&&t.submitted?"red-color":"blue-color"),l(3),s("ngIf",C(4,15,i.messageError$)),l(2),s("ngIf",i.timbreBlocModel==null?null:i.timbreBlocModel.getId()),l(3),s("object",i.timbreBlocModel)("key","annee"),l(),P("ngModel",i.timbreBlocModel.annee),s("max",i.maxAnnee)("zMax",i.maxAnnee),l(3),s("object",i.timbreBlocModel)("key","monnaie"),l(),P("ngModel",i.timbreBlocModel.monnaie),l(),s("object",i.timbreBlocModel)("key","image")("maxWidth",i.timbreBlocService.widthTimbre)("maxHeight",i.timbreBlocService.heightTimbre)}}var Ft=class o{constructor(e,t,i,n){this.httpResponseHandlerService=e;this.dialogRef=t;this.utilsService=i;this.timbreBlocService=n}canvas;messageError$=new w(null);load$=new w(null);id;maxAnnee=new Date().getFullYear();timbreBlocModel=new q;fileUploadModel=new je;ngOnInit(){this.initUpload(),this.load$.next(!1),c(this.id)?this.timbreBlocService.getBlocByIdAsync(this.id).subscribe(e=>{this.timbreBlocModel=e,this.load$.next(!0)}):(this.timbreBlocModel.setAnnee(new Date().getFullYear()),this.timbreBlocModel.setMonnaie("E"),this.load$.next(!0))}initUpload(){this.fileUploadModel.setDossier("test"),this.fileUploadModel.setNom(new Date().getTime()?.toString());let e=new Te;e.setMaxWidth(this.timbreBlocService.widthTimbre),e.setMaxHeight(this.timbreBlocService.heightTimbre),e.setDossier("autre");let t=new Te;t.setMaxWidth(this.timbreBlocService.widthTimbreZoom),t.setMaxHeight(this.timbreBlocService.heightTimbreZoom),t.setDossier("zoom"),this.fileUploadModel.setDetail([e,t])}valider(e){if(this.messageError$.next(null),e?.valid)if(c(this.timbreBlocModel.getImage()))this.saveData();else{this.messageError$.next("Veuillez s\xE9lectionner une image");return}}saveData(){this.load$.next(!1),c(this.timbreBlocModel.getId())?this.save():this.ajouter()}ajouter(){this.utilsService.getMaxIdentAsync("/timbres_bloc").pipe(y()).subscribe(e=>{this.timbreBlocModel.setId(e),this.save(!0)})}save(e){try{j([this.timbreBlocService.upload(this.timbreBlocModel,"autre"),this.timbreBlocService.upload(this.timbreBlocModel,"table"),this.timbreBlocService.upload(this.timbreBlocModel,"zoom")]).pipe(y(([t,i,n])=>c(t)&&c(n)&&c(i))).subscribe(([t,i,n])=>{c(i)&&i!="nok"&&this.timbreBlocModel.setImage(i),c(t)&&t!="nok"&&this.timbreBlocModel.setImageTable(t),c(n)&&n!="nok"&&this.timbreBlocModel.setImageZoom(n),e?this.timbreBlocService.ajouter(this.timbreBlocModel,!0):this.timbreBlocService.modifier(this.timbreBlocModel),this.httpResponseHandlerService.showNotificationSuccess("Transaction termin\xE9e","Votre timbre a bien \xE9t\xE9 modifi\xE9e."),this.load$.next(!0),this.dialogRef.close()})}catch{this.httpResponseHandlerService.showNotificationError("Transaction non aboutie","Votre timbre n'a pas pu \xEAtre modifi\xE9."),this.load$.next(!0)}}close(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||o)(B(St),B(Le),B(Y),B(J))};static \u0275cmp=Q({type:o,selectors:[["app-timbre-modifier-bloc"]],viewQuery:function(t,i){if(t&1&&te(oo,5),t&2){let n;ie(n=ne())&&(i.canvas=n.first)}},decls:10,vars:6,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],[3,"ngIf","ngIfElse"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","space-between stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","column","fxLayoutGap","20px",1,"bloc-modal"],[3,"innerHTML",4,"ngIf"],["fxLayout","column","class","form-input",4,"ngIf"],["fxLayout","column",1,"form-input"],[3,"object","key"],["name","page","type","number","minlength","4","maxlength","4","min","1900","zMin","1900","required","","zControl","",1,"annee",2,"width","60px !important",3,"ngModelChange","ngModel","max","zMax"],["name","monnaie","type","text","trim","","minlength","1","maxlength","2","required","","zControl","",2,"width","25px !important",3,"ngModelChange","ngModel"],[3,"outPutObject","object","key","maxWidth","maxHeight"],["fxLayout","row","fxLayoutGap","10px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"],[3,"innerHTML"],["name","code","type","text","trim","","upperCase","","noEspace","","required","","zControl","",3,"ngModelChange","ngModel","disabled"]],template:function(t,i){if(t&1&&(m(0,"div",2)(1,"div",3)(2,"span"),d(3),a(),m(4,"span"),d(5),a()(),b(6,ro,1,1,"ng-template",4),v(7,"async"),b(8,ao,20,17,"ng-template",null,0,oe),a()),t&2){let n=N(9);l(3),I("",i.timbreBlocModel!=null&&i.timbreBlocModel.getId()?"MODIFICATION":"AJOUT"," BLOC "),l(2),Ye(i.timbreBlocModel==null?null:i.timbreBlocModel.getId()),l(),s("ngIf",C(7,4,i.load$)==!1)("ngIfElse",n)}},dependencies:[ce,Oe,ve,re,me,ae,fe,se,be,Be,Re,tt,it,we,Ae,rt,lt,mt,ot,nt,De,Ee,_e,pe,ti,vt,yt,Bt,It,si,wt,G],encapsulation:2})};function so(o,e){if(o&1){let t=O();A(0),m(1,"lib-icon",6),M("click",function(){let n=h(t).$implicit,r=p(2);return _(r.headerService.setRoute(n.getRoute()))}),a(),E()}if(o&2){let t=e.$implicit;l(),s("icone",t==null?null:t.getIcone())("type",t==null?null:t.getType())("info",t==null?null:t.getInfo())("classInfo","tooltiptextDescription tooltiptextBgWhite widthAuto")}}function co(o,e){if(o&1&&(A(0),b(1,so,2,4,"ng-container",5),v(2,"async"),E()),o&2){let t=p();l(),s("ngForOf",C(2,1,t.headerService.choixRoutesTimbre$))}}function po(o,e){if(o&1){let t=O();m(0,"button",3),M("click",function(){h(t);let n=p();return _(n.ajouter())}),d(1," Ajouter "),a()}}function uo(o,e){o&1&&(A(0),d(1,"\xA0Bloc"),E())}function bo(o,e){if(o&1){let t=O();m(0,"lib-icon",7),M("click",function(){h(t);let n=p();return _(n.importer())}),a()}if(o&2){let t=p();s("icone",t.FontAwesomeEnum.UPLOAD)("type",t.FontAwesomeTypeEnum.TYPE_SOLID)("info","Importer les timbres")("classInfo","tooltiptextDescription tooltiptextBgWhite widthAuto")}}var Ti=class o{constructor(e,t,i){this.headerService=e;this.timbreService=t;this.dialog=i}FontAwesomeEnum=et;ajouter(){let e=this.dialog.open(ke,{maxHeight:"95vh",width:"30%"});e.afterClosed().subscribe(()=>{e.close()})}ajouterBloc(){let e=this.dialog.open(Ft,{maxHeight:"95vh",width:"30%"});e.afterClosed().subscribe(()=>{e.close()})}ajouterBouchon(){this.timbreService.ajouterSansId(this.timbreService.getBouchon())}importer(){let e=this.dialog.open(Nt,{height:"90vh",width:"70%"});e.afterClosed().subscribe(()=>{e.close()})}RouteEnum=Ke;FontAwesomeTypeEnum=Je;static \u0275fac=function(t){return new(t||o)(B(Gt),B(F),B(st))};static \u0275cmp=Q({type:o,selectors:[["app-menu"]],decls:11,vars:12,consts:[["fxLayout","row","fxLayoutGap","20px"],[4,"ngIf"],["class","rounded large color-white","mat-raised-button","","color","primary",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["class","accent click","style","font-size: 2em",3,"icone","type","info","classInfo","click",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"primary","click",2,"font-size","2em",3,"click","icone","type","info","classInfo"],[1,"accent","click",2,"font-size","2em",3,"click","icone","type","info","classInfo"]],template:function(t,i){if(t&1&&(m(0,"div",0),b(1,co,3,3,"ng-container",1),v(2,"async"),b(3,po,2,0,"button",2),v(4,"async"),m(5,"button",3),M("click",function(){return i.ajouterBloc()}),d(6," Ajouter "),b(7,uo,2,0,"ng-container",1),v(8,"async"),a(),b(9,bo,1,4,"lib-icon",4),v(10,"async"),a()),t&2){let n;l(),s("ngIf",((n=C(2,4,i.headerService.choixRoutesTimbre$))==null?null:n.length)>0),l(2),s("ngIf",C(4,6,i.headerService.route$)==i.RouteEnum.TIMBRE),l(4),s("ngIf",C(8,8,i.headerService.route$)==i.RouteEnum.TIMBRE),l(2),s("ngIf",C(10,10,i.headerService.route$)==i.RouteEnum.TIMBRE)}},dependencies:[Ce,re,me,ae,Ct,ce,G],encapsulation:2})};export{k as a,q as b,K as c,X as d,J as e,F as f,Ft as g,Dt as h,Rt as i,qt as j,Nt as k,Ti as l,fi as m};

import{Bb as Rs,G as Ba,Ga as Fe,Hb as bs,Jc as Fd,Ka as dt,Kc as Bt,M as zn,Ma as gd,N as si,Na as _d,Nc as et,O as Ie,Oc as qt,P as Ut,Qc as zt,R as Is,T as qa,Ta as oe,Tb as Ga,U as oi,Ua as ae,Ub as Td,Va as fn,Vb as Id,W as hd,Wb as Ed,Wc as ui,Xb as Ad,Ya as Es,Z as dd,Za as yd,Zb as Rd,_ as fd,ab as ja,b as ad,cb as Wt,d as ud,da as md,ea as jn,ec as bd,fa as Gn,h as ii,i as Ua,jc as Ns,kc as Cd,l as cd,la as pd,lc as xd,mb as As,mc as Os,nc as Ls,oc as Wa,pa as $n,pc as Qa,qc as kd,ra as Kt,rc as Dd,sa as Me,sc as Vd,tc as Nd,ua as za,uc as Od,v as ld,vc as Ld,wb as wd,wc as Md,yb as vd}from"./chunk-W6KRSCOZ.js";import{f as Ss,h as Ps,i as ai,j as $a,k as Sd,l as Cs,n as Ka,o as tt,p as Kn,q as ue,r as Pd,s as xs,t as ks,u as Ds,v as Vs,x as Ue,y as Ha,z as Ms}from"./chunk-65CH3ZW6.js";import{a as Ma,j as Fa,k as C}from"./chunk-GV7GV3NK.js";var Ud="auth",ci=class{constructor(t){return t}},Xa=class{constructor(){return xd(Ud)}};var Ya=new Ie("angularfire2.auth-instances");function Z_(n,t){let e=Cd(Ud,n,t);return e&&new ci(e)}function ty(n){return(t,e)=>{let r=t.runOutsideAngular(()=>n(e));return new ci(r)}}var ey={provide:Xa,deps:[[new Is,Ya]]},ny={provide:ci,useFactory:Z_,deps:[[new Is,Ya],Dd]};function OI(n,...t){return Ue("angularfire",Ns.full,"auth"),hd([ny,ey,{provide:Ya,useFactory:ty(n),multi:!0,deps:[Gn,md,Ls,Vd,[new Is,Os],...t]}])}var LI=kd(Ha,!0);var ry=(n,t,e,r,i,s,o,u)=>({alert:n,error:t,warn:e,success:r,info:i,bare:s,"rtl-mode":o,"has-icon":u}),iy=n=>({width:n});function sy(n,t){n&1&&Es(0)}function oy(n,t){if(n&1&&(oe(0,"div",9),Fe(1,sy,1,0,"ng-container",10),ae()),n&2){let e=Wt(2);Kt(),dt("ngTemplateOutlet",e.title)("ngTemplateOutletContext",e.item.context)}}function ay(n,t){if(n&1&&fn(0,"div",11),n&2){let e=Wt(2);dt("innerHTML",e.title,$n)}}function uy(n,t){n&1&&Es(0)}function cy(n,t){if(n&1&&(oe(0,"div",12),Fe(1,uy,1,0,"ng-container",10),ae()),n&2){let e=Wt(2);Kt(),dt("ngTemplateOutlet",e.content)("ngTemplateOutletContext",e.item.context)}}function ly(n,t){if(n&1&&fn(0,"div",13),n&2){let e=Wt(2);dt("innerHTML",e.content,$n)}}function hy(n,t){if(n&1&&fn(0,"div",14),n&2){let e=Wt(2);dt("innerHTML",e.safeSvg,$n)}}function dy(n,t){if(n&1&&(oe(0,"div"),Fe(1,oy,2,2,"div",6)(2,ay,1,1,"ng-template",null,0,Rs)(4,cy,2,2,"div",7)(5,ly,1,1,"ng-template",null,1,Rs)(7,hy,1,1,"div",8),ae()),n&2){let e=As(3),r=As(6),i=Wt();Kt(),dt("ngIf",i.titleIsTemplate)("ngIfElse",e),Kt(3),dt("ngIf",i.contentIsTemplate)("ngIfElse",r),Kt(3),dt("ngIf",i.item.icon!=="bare")}}function fy(n,t){n&1&&Es(0)}function my(n,t){if(n&1&&(oe(0,"div",17),Fe(1,fy,1,0,"ng-container",10),ae()),n&2){let e=Wt(2);Kt(),dt("ngTemplateOutlet",e.item.html)("ngTemplateOutletContext",e.item.context)}}function py(n,t){if(n&1&&fn(0,"div",13),n&2){let e=Wt(2);dt("innerHTML",e.safeInputHtml,$n)}}function gy(n,t){if(n&1){let e=yd();oe(0,"div",18),ja("click",function(i){dd(e);let s=Wt(2);return fd(s.onClickIcon(i))}),ae()}if(n&2){let e=Wt(2);gd("icon-hover",e.clickIconToClose),dt("innerHTML",e.safeSvg,$n)}}function _y(n,t){if(n&1&&(oe(0,"div"),Fe(1,my,2,2,"div",15)(2,py,1,1,"ng-template",null,2,Rs)(4,gy,1,3,"div",16),ae()),n&2){let e=As(3),r=Wt();Kt(),dt("ngIf",r.htmlIsTemplate)("ngIfElse",e),Kt(3),dt("ngIf",r.item.icon)}}function yy(n,t){if(n&1&&(oe(0,"div",19),fn(1,"span",20),ae()),n&2){let e=Wt();Kt(),dt("ngStyle",wd(1,iy,e.progressWidth+"%"))}}function wy(n,t){if(n&1&&fn(0,"simple-notification",2),n&2){let e=t.$implicit,r=t.index,i=Wt();dt("item",e)("timeOut",i.timeOut)("clickToClose",i.clickToClose)("clickIconToClose",i.clickIconToClose)("maxLength",i.maxLength)("showProgressBar",i.showProgressBar)("pauseOnHover",i.pauseOnHover)("theClass",i.theClass)("rtl",i.rtl)("animate",i.animate)("position",r)}}var zd={alert:`
        <svg class="simple-notification-svg" xmlns="http://www.w3.org/2000/svg" fill="#ffffff" height="24" viewBox="0 0 24 24" width="24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37V8zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/>
        </svg>
    `,error:`
        <svg class="simple-notification-svg" xmlns="http://www.w3.org/2000/svg" fill="#ffffff" height="24" viewBox="0 0 24 24" width="24">
            <path d="M0 0h24v24H0V0z" fill="none"/>
            <path d="M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/>
        </svg>
    `,info:`
        <svg class="simple-notification-svg" xmlns="http://www.w3.org/2000/svg" fill="#ffffff" height="24" viewBox="0 0 24 24" width="24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M11 17h2v-6h-2v6zm1-15C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 9h2V7h-2v2z"/>
        </svg>
    `,success:`
        <svg class="simple-notification-svg" xmlns="http://www.w3.org/2000/svg" fill="#ffffff" height="24" viewBox="0 0 24 24" width="24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
        </svg>
    `,warn:`
        <svg class="simple-notification-svg" xmlns="http://www.w3.org/2000/svg" fill="#ffffff" width="64" viewBox="0 0 64 64" height="64">
          <circle cx="32.086" cy="50.142" r="2.256"/>
          <path d="M30.08 25.012V42.32c0 1.107.897 2.005 2.006 2.005s2.006-.897 2.006-2.005V25.012c0-1.107-.897-2.006-2.006-2.006s-2.006.898-2.006 2.006z"/>
          <path d="M63.766 59.234L33.856 3.082c-.697-1.308-2.844-1.308-3.54 0L.407 59.234c-.331.622-.312 1.372.051 1.975.362.605 1.015.975 1.72.975h59.816c.705 0 1.357-.369 1.721-.975.361-.603.381-1.353.051-1.975zM5.519 58.172L32.086 8.291l26.568 49.881H5.519z"/>
        </svg>
    `},Ee=function(n){return n.Success="success",n.Error="error",n.Alert="alert",n.Info="info",n.Warn="warn",n.Bare="bare",n}(Ee||{}),li=(()=>{class n{globalOptions;constructor(e){this.globalOptions=e}emitter=new ud;icons=zd;set(e,r){return e.id=e.override&&e.override.id?e.override.id:Math.random().toString(36).substring(3),e.click=new jn,e.clickIcon=new jn,e.timeoutEnd=new jn,this.emitter.next({command:"set",notification:e,add:r}),e}success(e="",r="",i,s){return this.set({title:e,content:r||"",type:Ee.Success,icon:this.icons.success,override:i,context:s},!0)}error(e="",r="",i,s){return this.set({title:e,content:r||"",type:Ee.Error,icon:this.icons.error,override:i,context:s},!0)}alert(e="",r="",i,s){return this.set({title:e,content:r||"",type:Ee.Alert,icon:this.icons.alert,override:i,context:s},!0)}info(e="",r="",i,s){return this.set({title:e,content:r||"",type:Ee.Info,icon:this.icons.info,override:i,context:s},!0)}warn(e="",r="",i,s){return this.set({title:e,content:r||"",type:Ee.Warn,icon:this.icons.warn,override:i,context:s},!0)}bare(e="",r="",i,s){return this.set({title:e,content:r||"",type:Ee.Bare,icon:"bare",override:i,context:s},!0)}create(e="",r="",i=Ee.Success,s,o){return this.set({title:e,content:r,type:i,icon:this.icons[i],override:s,context:o},!0)}html(e,r=Ee.Success,i,s="bare",o){return this.set({html:e,type:r,icon:this.icons[s],override:i,context:o},!0)}remove(e){e?this.emitter.next({command:"clean",id:e}):this.emitter.next({command:"cleanAll"})}static \u0275fac=function(r){return new(r||n)(Ut("options"))};static \u0275prov=zn({token:n,factory:n.\u0275fac})}return n})(),vy=(()=>{class n{notificationService;domSanitizer;cd;zone;timeOut;showProgressBar;pauseOnHover;clickToClose;clickIconToClose;maxLength;theClass;rtl;animate;position;item;title;content;titleIsTemplate=!1;contentIsTemplate=!1;htmlIsTemplate=!1;progressWidth=0;safeSvg;safeInputHtml;stopTime=!1;timer;framesPerSecond=40;sleepTime;startTime;endTime;pauseStart;icon;constructor(e,r,i,s){this.notificationService=e,this.domSanitizer=r,this.cd=i,this.zone=s}ngOnInit(){this.item.override&&this.attachOverrides(),this.animate&&(this.item.state=this.animate),this.timeOut!==0&&this.startTimeOut(),this.contentType(this.item.title,"title"),this.contentType(this.item.content,"content"),this.contentType(this.item.html,"html"),this.safeSvg=this.domSanitizer.bypassSecurityTrustHtml(this.icon||this.item.icon),this.safeInputHtml=this.domSanitizer.bypassSecurityTrustHtml(this.item.html)}ngOnDestroy(){clearTimeout(this.timer),this.cd.detach()}startTimeOut(){this.sleepTime=1e3/this.framesPerSecond,this.startTime=new Date().getTime(),this.endTime=this.startTime+this.timeOut,this.zone.runOutsideAngular(()=>this.timer=setTimeout(this.instance,this.sleepTime))}onEnter(){this.pauseOnHover&&(this.stopTime=!0,this.pauseStart=new Date().getTime())}onLeave(){this.pauseOnHover&&(this.stopTime=!1,this.startTime+=new Date().getTime()-this.pauseStart,this.endTime+=new Date().getTime()-this.pauseStart,this.zone.runOutsideAngular(()=>setTimeout(this.instance,this.sleepTime)))}onClick(e){this.item.click.emit(e),this.clickToClose&&this.remove()}onClickIcon(e){this.item.clickIcon.emit(e),this.clickIconToClose&&this.remove()}attachOverrides(){Object.keys(this.item.override).forEach(e=>{this.hasOwnProperty(e)&&(this[e]=this.item.override[e])})}instance=()=>{let e=new Date().getTime();this.endTime<e?(this.remove(),this.item.timeoutEnd.emit()):this.stopTime||(this.showProgressBar&&(this.progressWidth=Math.min((e-this.startTime+this.sleepTime)*100/this.timeOut,100)),this.timer=setTimeout(this.instance,this.sleepTime)),this.zone.run(()=>{this.cd.destroyed||this.cd.detectChanges()})};remove(){this.animate?(this.item.state=this.animate+"Out",setTimeout(()=>{this.notificationService.set(this.item,!1)},310)):this.notificationService.set(this.item,!1)}contentType(e,r){e instanceof za?this[r]=e:this[r]=this.domSanitizer.bypassSecurityTrustHtml(e),this[r+"IsTemplate"]=e instanceof za}static \u0275fac=function(r){return new(r||n)(Me(li),Me(bd),Me(bs),Me(Gn))};static \u0275cmp=qa({type:n,selectors:[["simple-notification"]],inputs:{timeOut:"timeOut",showProgressBar:"showProgressBar",pauseOnHover:"pauseOnHover",clickToClose:"clickToClose",clickIconToClose:"clickIconToClose",maxLength:"maxLength",theClass:"theClass",rtl:"rtl",animate:"animate",position:"position",item:"item"},decls:4,vars:16,consts:[["regularTitle",""],["regularContent",""],["regularHtml",""],[1,"simple-notification",3,"click","mouseenter","mouseleave","ngClass"],[4,"ngIf"],["class","sn-progress-loader",4,"ngIf"],["class","sn-title",4,"ngIf","ngIfElse"],["class","sn-content",4,"ngIf","ngIfElse"],["class","icon",3,"innerHTML",4,"ngIf"],[1,"sn-title"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"sn-title",3,"innerHTML"],[1,"sn-content"],[1,"sn-content",3,"innerHTML"],[1,"icon",3,"innerHTML"],["class","sn-html",4,"ngIf","ngIfElse"],["class","icon",3,"icon-hover","innerHTML","click",4,"ngIf"],[1,"sn-html"],[1,"icon",3,"click","innerHTML"],[1,"sn-progress-loader"],[3,"ngStyle"]],template:function(r,i){r&1&&(oe(0,"div",3),ja("click",function(o){return i.onClick(o)})("mouseenter",function(){return i.onEnter()})("mouseleave",function(){return i.onLeave()}),Fe(1,dy,8,5,"div",4)(2,_y,5,3,"div",4)(3,yy,2,3,"div",5),ae()),r&2&&(_d(i.theClass),dt("@enterLeave",i.item.state)("ngClass",vd(7,ry,i.item.type==="alert",i.item.type==="error",i.item.type==="warn",i.item.type==="success",i.item.type==="info",i.item.type==="bare",i.rtl,i.item.icon!=="bare")),Kt(),dt("ngIf",!i.item.html),Kt(),dt("ngIf",i.item.html),Kt(),dt("ngIf",i.showProgressBar))},dependencies:[Ga,Id,Ad,Ed],styles:[`.simple-notification{width:100%;padding:10px 20px;box-sizing:border-box;position:relative;float:left;margin-bottom:10px;color:#fff;cursor:pointer;transition:all .5s;min-height:70px}.simple-notification .sn-title,.simple-notification .sn-content,.simple-notification .sn-html{margin:0}.simple-notification .sn-title{line-height:30px;font-size:20px}.simple-notification .sn-content{font-size:16px;line-height:20px}.simple-notification.has-icon .sn-title,.simple-notification.has-icon .sn-content,.simple-notification.has-icon .sn-html{padding:0 50px 0 0}.simple-notification .icon{position:absolute;box-sizing:border-box;top:0;right:0;width:70px;height:70px;padding:10px}.simple-notification .icon.icon-hover:hover{opacity:.5}.simple-notification .icon svg{fill:#fff;width:100%;height:100%}.simple-notification .icon svg g{fill:#fff}.simple-notification.rtl-mode.has-icon .sn-title,.simple-notification.rtl-mode.has-icon .sn-content,.simple-notification.rtl-mode.has-icon .sn-html{padding:0 0 0 50px}.simple-notification.rtl-mode{direction:rtl}.simple-notification.rtl-mode .sn-content{padding:0 0 0 50px}.simple-notification.rtl-mode svg{left:0;right:auto}.simple-notification.error{background:#F44336}.simple-notification.success{background:#8BC34A}.simple-notification.alert{background:#ffdb5b}.simple-notification.info{background:#03A9F4}.simple-notification.warn{background:#ffdb5b}.simple-notification .sn-progress-loader{position:absolute;top:0;left:0;width:100%;height:5px}.simple-notification .sn-progress-loader span{float:left;height:100%}.simple-notification.success .sn-progress-loader span{background:#689F38}.simple-notification.error .sn-progress-loader span{background:#D32F2F}.simple-notification.alert .sn-progress-loader span{background:#edc242}.simple-notification.info .sn-progress-loader span{background:#0288D1}.simple-notification.warn .sn-progress-loader span{background:#edc242}.simple-notification.bare .sn-progress-loader span{background:#ccc}.simple-notification.warn div .sn-title,.simple-notification.warn div .sn-content,.simple-notification.warn div .sn-html{color:#444}
`],encapsulation:2,data:{animation:[Fd("enterLeave",[qt("fade",et({opacity:1})),zt("* => fade",[et({opacity:0}),Bt("400ms ease-in-out")]),qt("fadeOut",et({opacity:0})),zt("fade => fadeOut",[et({opacity:1}),Bt("300ms ease-in-out")]),qt("fromTop",et({opacity:1,transform:"translateY(0)"})),zt("* => fromTop",[et({opacity:0,transform:"translateY(-5%)"}),Bt("400ms ease-in-out")]),qt("fromTopOut",et({opacity:0,transform:"translateY(5%)"})),zt("fromTop => fromTopOut",[et({opacity:1,transform:"translateY(0)"}),Bt("300ms ease-in-out")]),qt("fromRight",et({opacity:1,transform:"translateX(0)"})),zt("* => fromRight",[et({opacity:0,transform:"translateX(5%)"}),Bt("400ms ease-in-out")]),qt("fromRightOut",et({opacity:0,transform:"translateX(-5%)"})),zt("fromRight => fromRightOut",[et({opacity:1,transform:"translateX(0)"}),Bt("300ms ease-in-out")]),qt("fromBottom",et({opacity:1,transform:"translateY(0)"})),zt("* => fromBottom",[et({opacity:0,transform:"translateY(5%)"}),Bt("400ms ease-in-out")]),qt("fromBottomOut",et({opacity:0,transform:"translateY(-5%)"})),zt("fromBottom => fromBottomOut",[et({opacity:1,transform:"translateY(0)"}),Bt("300ms ease-in-out")]),qt("fromLeft",et({opacity:1,transform:"translateX(0)"})),zt("* => fromLeft",[et({opacity:0,transform:"translateX(-5%)"}),Bt("400ms ease-in-out")]),qt("fromLeftOut",et({opacity:0,transform:"translateX(5%)"})),zt("fromLeft => fromLeftOut",[et({opacity:1,transform:"translateX(0)"}),Bt("300ms ease-in-out")]),qt("scale",et({opacity:1,transform:"scale(1)"})),zt("* => scale",[et({opacity:0,transform:"scale(0)"}),Bt("400ms ease-in-out")]),qt("scaleOut",et({opacity:0,transform:"scale(0)"})),zt("scale => scaleOut",[et({opacity:1,transform:"scale(1)"}),Bt("400ms ease-in-out")]),qt("rotate",et({opacity:1,transform:"rotate(0deg)"})),zt("* => rotate",[et({opacity:0,transform:"rotate(5deg)"}),Bt("400ms ease-in-out")]),qt("rotateOut",et({opacity:0,transform:"rotate(-5deg)"})),zt("rotate => rotateOut",[et({opacity:1,transform:"rotate(0deg)"}),Bt("400ms ease-in-out")])])]},changeDetection:0})}return n})(),Ja=function(n){return n.Fade="fade",n.FromTop="fromTop",n.FromRight="fromRight",n.FromBottom="fromBottom",n.FromLeft="fromLeft",n.Scale="scale",n.Rotate="rotate",n}(Ja||{}),ZI=(()=>{class n{service;cd;constructor(e,r){this.service=e,this.cd=r}set options(e){this.usingComponentOptions=!0,this.attachChanges(e)}create=new jn;destroy=new jn;notifications=[];position=["bottom","right"];lastNotificationCreated;listener;lastOnBottom=!0;maxStack=8;preventLastDuplicates=!1;preventDuplicates=!1;timeOut=0;maxLength=0;clickToClose=!0;clickIconToClose=!1;showProgressBar=!0;pauseOnHover=!0;theClass="";rtl=!1;animate=Ja.FromRight;usingComponentOptions=!1;ngOnInit(){this.usingComponentOptions||this.attachChanges(this.service.globalOptions),this.listener=this.service.emitter.subscribe(e=>{switch(e.command){case"cleanAll":this.notifications=[];break;case"clean":this.cleanSingle(e.id);break;case"set":e.add?this.add(e.notification):this.defaultBehavior(e);break;default:this.defaultBehavior(e);break}this.cd.destroyed||this.cd.detectChanges()})}ngOnDestroy(){this.listener&&this.listener.unsubscribe(),this.cd.detach()}defaultBehavior(e){this.notifications.splice(this.notifications.indexOf(e.notification),1),this.destroy.emit(this.buildEmit(e.notification,!1))}add(e){e.createdOn=new Date;let r=this.preventLastDuplicates||this.preventDuplicates?this.block(e):!1;this.lastNotificationCreated=e,e.override&&e.override.icons&&e.override.icons[e.type]&&(e.icon=e.override.icons[e.type]),r||(this.lastOnBottom?(this.notifications.length>=this.maxStack&&this.notifications.splice(0,1),this.notifications.push(e)):(this.notifications.length>=this.maxStack&&this.notifications.splice(this.notifications.length-1,1),this.notifications.splice(0,0,e)),this.create.emit(this.buildEmit(e,!0)))}block(e){let r=e.html?this.checkHtml:this.checkStandard;if(this.preventDuplicates&&this.notifications.length>0){for(let i of this.notifications)if(r(i,e))return!0}if(this.preventLastDuplicates){let i;if(this.preventLastDuplicates==="visible"&&this.notifications.length>0)this.lastOnBottom?i=this.notifications[this.notifications.length-1]:i=this.notifications[0];else if(this.preventLastDuplicates==="all"&&this.lastNotificationCreated)i=this.lastNotificationCreated;else return!1;return r(i,e)}return!1}checkStandard(e,r){return e.type===r.type&&e.title===r.title&&e.content===r.content}checkHtml(e,r){return e.html?e.type===r.type&&e.title===r.title&&e.content===r.content&&e.html===r.html:!1}attachChanges(e){for(let r in e)this.hasOwnProperty(r)?this[r]=e[r]:r==="icons"&&(this.service.icons=e[r])}buildEmit(e,r){let i={createdOn:e.createdOn,type:e.type,icon:e.icon,id:e.id};return e.html?i.html=e.html:(i.title=e.title,i.content=e.content),r||(i.destroyedOn=new Date),i}cleanSingle(e){let r=0,i=!1,s;this.notifications.forEach((o,u)=>{o.id===e&&(r=u,s=o,i=!0)}),i&&(this.notifications.splice(r,1),this.destroy.emit(this.buildEmit(s,!1)))}static \u0275fac=function(r){return new(r||n)(Me(li),Me(bs))};static \u0275cmp=qa({type:n,selectors:[["simple-notifications"]],inputs:{options:"options"},outputs:{create:"create",destroy:"destroy"},decls:2,vars:2,consts:[[1,"simple-notification-wrapper",3,"ngClass"],[3,"item","timeOut","clickToClose","clickIconToClose","maxLength","showProgressBar","pauseOnHover","theClass","rtl","animate","position",4,"ngFor","ngForOf"],[3,"item","timeOut","clickToClose","clickIconToClose","maxLength","showProgressBar","pauseOnHover","theClass","rtl","animate","position"]],template:function(r,i){r&1&&(oe(0,"div",0),Fe(1,wy,1,11,"simple-notification",1),ae()),r&2&&(dt("ngClass",i.position),Kt(),dt("ngForOf",i.notifications))},dependencies:[Ga,Td,vy],styles:[`.simple-notification-wrapper{position:fixed;width:300px;z-index:1000}.simple-notification-wrapper.left{left:20px}.simple-notification-wrapper.top{top:20px}.simple-notification-wrapper.right{right:20px}.simple-notification-wrapper.bottom{bottom:20px}.simple-notification-wrapper.center{left:50%;transform:translate(-50%)}.simple-notification-wrapper.middle{top:50%;transform:translateY(-50%)}.simple-notification-wrapper.middle.center{transform:translate(-50%,-50%)}@media (max-width: 340px){.simple-notification-wrapper{width:auto;left:20px;right:20px}}
`],encapsulation:2,changeDetection:0})}return n})(),Ty={position:["bottom","right"],timeOut:0,showProgressBar:!0,pauseOnHover:!0,lastOnBottom:!0,clickToClose:!0,clickIconToClose:!1,maxLength:0,maxStack:8,preventDuplicates:!1,preventLastDuplicates:!1,theClass:"",rtl:!1,animate:Ja.FromRight,icons:zd},Bd=new Ie("options");function Iy(n){return Ma(Ma({},Ty),n)}var tE=(()=>{class n{static forRoot(e={}){return{ngModule:n,providers:[li,{provide:Bd,useValue:e},{provide:"options",useFactory:Iy,deps:[Bd]}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=oi({type:n});static \u0275inj=si({imports:[Rd]})}return n})();var jd=class n{constructor(t){this.notificationsService=t}showNotificationError(t,e){this.notificationsService.error('<div fxLayout="column" style="width: 500px"><h5 style="color: white !important; font-size: 1em !important">'+(ui(t)?t:"")+"</h5>",'<span fxLayout="row" fxLayoutAlign="start center" class="notification" style="color: white !important;font-size: 0.750em !important;">'+e+"</span> </div>")}showNotificationWarn(t,e){this.notificationsService.warn('<div fxLayout="column" style="width: 500px"><h5 style="color: white !important; font-size: 1em !important">'+(ui(t)?t:"")+"</h5>",'<span fxLayout="row" fxLayoutAlign="start center" class="notification" style="color: white !important; font-size: 0.750em !important;">'+e+"</span> </div>")}showNotificationSuccess(t,e){this.notificationsService.success('<div fxLayout="column"  style="width: 500px"><h5 style="color: white !important; font-size: 1em !important">'+(ui(t)?t:"")+"</h5>",'<span fxLayout="row" fxLayoutAlign="start center" class="notification" style="font-size: 0.750em !important;">'+e+"</span> </div>")}showNotificationAlert(t,e){this.notificationsService.alert('<div fxLayout="column"  style="width: 500px"><h5 style="color: white !important; font-size: 1em !important">'+(ui(t)?t:"")+"</h5>",'<span fxLayout="row" fxLayoutAlign="start center" class="notification" style="font-size: 0.750em !important;">'+e+"</span> </div>")}static \u0275fac=function(e){return new(e||n)(Ut(li))};static \u0275prov=zn({token:n,factory:n.\u0275fac,providedIn:"root"})};var Jd="firebasestorage.googleapis.com",Zd="storageBucket",Ay=2*60*1e3,Ry=10*60*1e3,by=1e3;var lt=class n extends Cs{constructor(t,e,r=0){super(Za(t),`Firebase Storage: ${e} (${Za(t)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,n.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return Za(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}},at=function(n){return n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment",n}(at||{});function Za(n){return"storage/"+n}function au(){let n="An unknown error occurred, please check the error payload for server response.";return new lt(at.UNKNOWN,n)}function Sy(n){return new lt(at.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function Py(n){return new lt(at.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function Cy(){let n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new lt(at.UNAUTHENTICATED,n)}function xy(){return new lt(at.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function ky(n){return new lt(at.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function tf(){return new lt(at.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function ef(){return new lt(at.CANCELED,"User canceled the upload/download.")}function Dy(n){return new lt(at.INVALID_URL,"Invalid URL '"+n+"'.")}function Vy(n){return new lt(at.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function Ny(){return new lt(at.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Zd+"' property when initializing the app?")}function nf(){return new lt(at.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Oy(){return new lt(at.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function Ly(){return new lt(at.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function My(n){return new lt(at.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function mn(n){return new lt(at.INVALID_ARGUMENT,n)}function rf(){return new lt(at.APP_DELETED,"The Firebase app was deleted.")}function uu(n){return new lt(at.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function di(n,t){return new lt(at.INVALID_FORMAT,"String does not match format '"+n+"': "+t)}function hi(n){throw new lt(at.INTERNAL_ERROR,"Internal error: "+n)}var jt=class n{constructor(t,e){this.bucket=t,this.path_=e}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){let t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let r;try{r=n.makeFromUrl(t,e)}catch{return new n(t,"")}if(r.path==="")return r;throw Vy(t)}static makeFromUrl(t,e){let r=null,i="([A-Za-z0-9.\\-_]+)";function s(G){G.path.charAt(G.path.length-1)==="/"&&(G.path_=G.path_.slice(0,-1))}let o="(/(.*))?$",u=new RegExp("^gs://"+i+o,"i"),c={bucket:1,path:3};function h(G){G.path_=decodeURIComponent(G.path)}let f="v[A-Za-z0-9_]+",p=e.replace(/[.]/g,"\\."),_="(/([^?#]*).*)?$",E=new RegExp(`^https?://${p}/${f}/b/${i}/o${_}`,"i"),x={bucket:1,path:3},D=e===Jd?"(?:storage.googleapis.com|storage.cloud.google.com)":e,k="([^?#]*)",B=new RegExp(`^https?://${D}/${i}/${k}`,"i"),F=[{regex:u,indices:c,postModify:s},{regex:E,indices:x,postModify:h},{regex:B,indices:{bucket:1,path:2},postModify:h}];for(let G=0;G<F.length;G++){let Q=F[G],$=Q.regex.exec(t);if($){let v=$[Q.indices.bucket],g=$[Q.indices.path];g||(g=""),r=new n(v,g),Q.postModify(r);break}}if(r==null)throw Dy(t);return r}},eu=class{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}};function Fy(n,t,e){let r=1,i=null,s=null,o=!1,u=0;function c(){return u===2}let h=!1;function f(...k){h||(h=!0,t.apply(null,k))}function p(k){i=setTimeout(()=>{i=null,n(E,c())},k)}function _(){s&&clearTimeout(s)}function E(k,...B){if(h){_();return}if(k){_(),f.call(null,k,...B);return}if(c()||o){_(),f.call(null,k,...B);return}r<64&&(r*=2);let F;u===1?(u=2,F=0):F=(r+Math.random())*1e3,p(F)}let x=!1;function D(k){x||(x=!0,_(),!h&&(i!==null?(k||(u=2),clearTimeout(i),p(0)):k||(u=1)))}return p(0),s=setTimeout(()=>{o=!0,D(!0)},e),D}function Uy(n){n(!1)}function By(n){return n!==void 0}function qy(n){return typeof n=="function"}function zy(n){return typeof n=="object"&&!Array.isArray(n)}function Bs(n){return typeof n=="string"||n instanceof String}function Gd(n){return cu()&&n instanceof Blob}function cu(){return typeof Blob<"u"}function nu(n,t,e,r){if(r<t)throw mn(`Invalid value for '${n}'. Expected ${t} or greater.`);if(r>e)throw mn(`Invalid value for '${n}'. Expected ${e} or less.`)}function Be(n,t,e){let r=t;return e==null&&(r=`https://${t}`),`${e}://${r}/v0${n}`}function sf(n){let t=encodeURIComponent,e="?";for(let r in n)if(n.hasOwnProperty(r)){let i=t(r)+"="+t(n[r]);e=e+i+"&"}return e=e.slice(0,-1),e}var Hn=function(n){return n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT",n}(Hn||{});function of(n,t){let e=n>=500&&n<600,i=[408,429].indexOf(n)!==-1,s=t.indexOf(n)!==-1;return e||i||s}var ru=class{constructor(t,e,r,i,s,o,u,c,h,f,p,_=!0){this.url_=t,this.method_=e,this.headers_=r,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=o,this.callback_=u,this.errorCallback_=c,this.timeout_=h,this.progressCallback_=f,this.connectionFactory_=p,this.retry=_,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((E,x)=>{this.resolve_=E,this.reject_=x,this.start_()})}start_(){let t=(r,i)=>{if(i){r(!1,new Qn(!1,null,!0));return}let s=this.connectionFactory_();this.pendingConnection_=s;let o=u=>{let c=u.loaded,h=u.lengthComputable?u.total:-1;this.progressCallback_!==null&&this.progressCallback_(c,h)};this.progressCallback_!==null&&s.addUploadProgressListener(o),s.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(o),this.pendingConnection_=null;let u=s.getErrorCode()===Hn.NO_ERROR,c=s.getStatus();if(!u||of(c,this.additionalRetryCodes_)&&this.retry){let f=s.getErrorCode()===Hn.ABORT;r(!1,new Qn(!1,null,f));return}let h=this.successCodes_.indexOf(c)!==-1;r(!0,new Qn(h,s))})},e=(r,i)=>{let s=this.resolve_,o=this.reject_,u=i.connection;if(i.wasSuccessCode)try{let c=this.callback_(u,u.getResponse());By(c)?s(c):s()}catch(c){o(c)}else if(u!==null){let c=au();c.serverResponse=u.getErrorText(),this.errorCallback_?o(this.errorCallback_(u,c)):o(c)}else if(i.canceled){let c=this.appDelete_?rf():ef();o(c)}else{let c=tf();o(c)}};this.canceled_?e(!1,new Qn(!1,null,!0)):this.backoffId_=Fy(t,e,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&Uy(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}},Qn=class{constructor(t,e,r){this.wasSuccessCode=t,this.connection=e,this.canceled=!!r}};function jy(n,t){t!==null&&t.length>0&&(n.Authorization="Firebase "+t)}function Gy(n,t){n["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function $y(n,t){t&&(n["X-Firebase-GMPID"]=t)}function Ky(n,t){t!==null&&(n["X-Firebase-AppCheck"]=t)}function Wy(n,t,e,r,i,s,o=!0){let u=sf(n.urlParams),c=n.url+u,h=Object.assign({},n.headers);return $y(h,t),jy(h,e),Gy(h,s),Ky(h,r),new ru(c,n.method,h,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,i,o)}function Qy(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function Hy(...n){let t=Qy();if(t!==void 0){let e=new t;for(let r=0;r<n.length;r++)e.append(n[r]);return e.getBlob()}else{if(cu())return new Blob(n);throw new lt(at.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function Xy(n,t,e){return n.webkitSlice?n.webkitSlice(t,e):n.mozSlice?n.mozSlice(t,e):n.slice?n.slice(t,e):null}function Yy(n){if(typeof atob>"u")throw My("base-64");return atob(n)}var Xt={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"},fi=class{constructor(t,e){this.data=t,this.contentType=e||null}};function lu(n,t){switch(n){case Xt.RAW:return new fi(af(t));case Xt.BASE64:case Xt.BASE64URL:return new fi(uf(n,t));case Xt.DATA_URL:return new fi(Zy(t),tw(t))}throw au()}function af(n){let t=[];for(let e=0;e<n.length;e++){let r=n.charCodeAt(e);if(r<=127)t.push(r);else if(r<=2047)t.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(e<n.length-1&&(n.charCodeAt(e+1)&64512)===56320))t.push(239,191,189);else{let s=r,o=n.charCodeAt(++e);r=65536|(s&1023)<<10|o&1023,t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(t)}function Jy(n){let t;try{t=decodeURIComponent(n)}catch{throw di(Xt.DATA_URL,"Malformed data URL.")}return af(t)}function uf(n,t){switch(n){case Xt.BASE64:{let i=t.indexOf("-")!==-1,s=t.indexOf("_")!==-1;if(i||s)throw di(n,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case Xt.BASE64URL:{let i=t.indexOf("+")!==-1,s=t.indexOf("/")!==-1;if(i||s)throw di(n,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let e;try{e=Yy(t)}catch(i){throw i.message.includes("polyfill")?i:di(n,"Invalid character found")}let r=new Uint8Array(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return r}var Us=class{constructor(t){this.base64=!1,this.contentType=null;let e=t.match(/^data:([^,]+)?,/);if(e===null)throw di(Xt.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");let r=e[1]||null;r!=null&&(this.base64=ew(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=t.substring(t.indexOf(",")+1)}};function Zy(n){let t=new Us(n);return t.base64?uf(Xt.BASE64,t.rest):Jy(t.rest)}function tw(n){return new Us(n).contentType}function ew(n,t){return n.length>=t.length?n.substring(n.length-t.length)===t:!1}var pn=class n{constructor(t,e){let r=0,i="";Gd(t)?(this.data_=t,r=t.size,i=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),r=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),r=t.length),this.size_=r,this.type_=i}size(){return this.size_}type(){return this.type_}slice(t,e){if(Gd(this.data_)){let r=this.data_,i=Xy(r,t,e);return i===null?null:new n(i)}else{let r=new Uint8Array(this.data_.buffer,t,e-t);return new n(r,!0)}}static getBlob(...t){if(cu()){let e=t.map(r=>r instanceof n?r.data_:r);return new n(Hy.apply(null,e))}else{let e=t.map(o=>Bs(o)?lu(Xt.RAW,o).data:o.data_),r=0;e.forEach(o=>{r+=o.byteLength});let i=new Uint8Array(r),s=0;return e.forEach(o=>{for(let u=0;u<o.length;u++)i[s++]=o[u]}),new n(i,!0)}}uploadData(){return this.data_}};function hu(n){let t;try{t=JSON.parse(n)}catch{return null}return zy(t)?t:null}function nw(n){if(n.length===0)return null;let t=n.lastIndexOf("/");return t===-1?"":n.slice(0,t)}function rw(n,t){let e=t.split("/").filter(r=>r.length>0).join("/");return n.length===0?e:n+"/"+e}function cf(n){let t=n.lastIndexOf("/",n.length-2);return t===-1?n:n.slice(t+1)}function iw(n,t){return t}var St=class{constructor(t,e,r,i){this.server=t,this.local=e||t,this.writable=!!r,this.xform=i||iw}},Fs=null;function sw(n){return!Bs(n)||n.length<2?n:cf(n)}function gi(){if(Fs)return Fs;let n=[];n.push(new St("bucket")),n.push(new St("generation")),n.push(new St("metageneration")),n.push(new St("name","fullPath",!0));function t(s,o){return sw(o)}let e=new St("name");e.xform=t,n.push(e);function r(s,o){return o!==void 0?Number(o):o}let i=new St("size");return i.xform=r,n.push(i),n.push(new St("timeCreated")),n.push(new St("updated")),n.push(new St("md5Hash",null,!0)),n.push(new St("cacheControl",null,!0)),n.push(new St("contentDisposition",null,!0)),n.push(new St("contentEncoding",null,!0)),n.push(new St("contentLanguage",null,!0)),n.push(new St("contentType",null,!0)),n.push(new St("metadata","customMetadata",!0)),Fs=n,Fs}function ow(n,t){function e(){let r=n.bucket,i=n.fullPath,s=new jt(r,i);return t._makeStorageReference(s)}Object.defineProperty(n,"ref",{get:e})}function aw(n,t,e){let r={};r.type="file";let i=e.length;for(let s=0;s<i;s++){let o=e[s];r[o.local]=o.xform(r,t[o.server])}return ow(r,n),r}function lf(n,t,e){let r=hu(t);return r===null?null:aw(n,r,e)}function uw(n,t,e,r){let i=hu(t);if(i===null||!Bs(i.downloadTokens))return null;let s=i.downloadTokens;if(s.length===0)return null;let o=encodeURIComponent;return s.split(",").map(h=>{let f=n.bucket,p=n.fullPath,_="/b/"+o(f)+"/o/"+o(p),E=Be(_,e,r),x=sf({alt:"media",token:h});return E+x})[0]}function du(n,t){let e={},r=t.length;for(let i=0;i<r;i++){let s=t[i];s.writable&&(e[s.server]=n[s.local])}return JSON.stringify(e)}var $d="prefixes",Kd="items";function cw(n,t,e){let r={prefixes:[],items:[],nextPageToken:e.nextPageToken};if(e[$d])for(let i of e[$d]){let s=i.replace(/\/$/,""),o=n._makeStorageReference(new jt(t,s));r.prefixes.push(o)}if(e[Kd])for(let i of e[Kd]){let s=n._makeStorageReference(new jt(t,i.name));r.items.push(s)}return r}function lw(n,t,e){let r=hu(e);return r===null?null:cw(n,t,r)}var re=class{constructor(t,e,r,i){this.url=t,this.method=e,this.handler=r,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}};function ce(n){if(!n)throw au()}function qs(n,t){function e(r,i){let s=lf(n,i,t);return ce(s!==null),s}return e}function hw(n,t){function e(r,i){let s=lw(n,t,i);return ce(s!==null),s}return e}function dw(n,t){function e(r,i){let s=lf(n,i,t);return ce(s!==null),uw(s,i,n.host,n._protocol)}return e}function Jn(n){function t(e,r){let i;return e.getStatus()===401?e.getErrorText().includes("Firebase App Check token is invalid")?i=xy():i=Cy():e.getStatus()===402?i=Py(n.bucket):e.getStatus()===403?i=ky(n.path):i=r,i.status=e.getStatus(),i.serverResponse=r.serverResponse,i}return t}function zs(n){let t=Jn(n);function e(r,i){let s=t(r,i);return r.getStatus()===404&&(s=Sy(n.path)),s.serverResponse=i.serverResponse,s}return e}function hf(n,t,e){let r=t.fullServerUrl(),i=Be(r,n.host,n._protocol),s="GET",o=n.maxOperationRetryTime,u=new re(i,s,qs(n,e),o);return u.errorHandler=zs(t),u}function fw(n,t,e,r,i){let s={};t.isRoot?s.prefix="":s.prefix=t.path+"/",e&&e.length>0&&(s.delimiter=e),r&&(s.pageToken=r),i&&(s.maxResults=i);let o=t.bucketOnlyServerUrl(),u=Be(o,n.host,n._protocol),c="GET",h=n.maxOperationRetryTime,f=new re(u,c,hw(n,t.bucket),h);return f.urlParams=s,f.errorHandler=Jn(t),f}function mw(n,t,e){let r=t.fullServerUrl(),i=Be(r,n.host,n._protocol),s="GET",o=n.maxOperationRetryTime,u=new re(i,s,dw(n,e),o);return u.errorHandler=zs(t),u}function pw(n,t,e,r){let i=t.fullServerUrl(),s=Be(i,n.host,n._protocol),o="PATCH",u=du(e,r),c={"Content-Type":"application/json; charset=utf-8"},h=n.maxOperationRetryTime,f=new re(s,o,qs(n,r),h);return f.headers=c,f.body=u,f.errorHandler=zs(t),f}function gw(n,t){let e=t.fullServerUrl(),r=Be(e,n.host,n._protocol),i="DELETE",s=n.maxOperationRetryTime;function o(c,h){}let u=new re(r,i,o,s);return u.successCodes=[200,204],u.errorHandler=zs(t),u}function _w(n,t){return n&&n.contentType||t&&t.type()||"application/octet-stream"}function df(n,t,e){let r=Object.assign({},e);return r.fullPath=n.path,r.size=t.size(),r.contentType||(r.contentType=_w(null,t)),r}function ff(n,t,e,r,i){let s=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function u(){let F="";for(let G=0;G<2;G++)F=F+Math.random().toString().slice(2);return F}let c=u();o["Content-Type"]="multipart/related; boundary="+c;let h=df(t,r,i),f=du(h,e),p="--"+c+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+f+`\r
--`+c+`\r
Content-Type: `+h.contentType+`\r
\r
`,_=`\r
--`+c+"--",E=pn.getBlob(p,r,_);if(E===null)throw nf();let x={name:h.fullPath},D=Be(s,n.host,n._protocol),k="POST",B=n.maxUploadRetryTime,z=new re(D,k,qs(n,e),B);return z.urlParams=x,z.headers=o,z.body=E.uploadData(),z.errorHandler=Jn(t),z}var Xn=class{constructor(t,e,r,i){this.current=t,this.total=e,this.finalized=!!r,this.metadata=i||null}};function fu(n,t){let e=null;try{e=n.getResponseHeader("X-Goog-Upload-Status")}catch{ce(!1)}return ce(!!e&&(t||["active"]).indexOf(e)!==-1),e}function yw(n,t,e,r,i){let s=t.bucketOnlyServerUrl(),o=df(t,r,i),u={name:o.fullPath},c=Be(s,n.host,n._protocol),h="POST",f={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},p=du(o,e),_=n.maxUploadRetryTime;function E(D){fu(D);let k;try{k=D.getResponseHeader("X-Goog-Upload-URL")}catch{ce(!1)}return ce(Bs(k)),k}let x=new re(c,h,E,_);return x.urlParams=u,x.headers=f,x.body=p,x.errorHandler=Jn(t),x}function ww(n,t,e,r){let i={"X-Goog-Upload-Command":"query"};function s(h){let f=fu(h,["active","final"]),p=null;try{p=h.getResponseHeader("X-Goog-Upload-Size-Received")}catch{ce(!1)}p||ce(!1);let _=Number(p);return ce(!isNaN(_)),new Xn(_,r.size(),f==="final")}let o="POST",u=n.maxUploadRetryTime,c=new re(e,o,s,u);return c.headers=i,c.errorHandler=Jn(t),c}var Wd=256*1024;function vw(n,t,e,r,i,s,o,u){let c=new Xn(0,0);if(o?(c.current=o.current,c.total=o.total):(c.current=0,c.total=r.size()),r.size()!==c.total)throw Oy();let h=c.total-c.current,f=h;i>0&&(f=Math.min(f,i));let p=c.current,_=p+f,E="";f===0?E="finalize":h===f?E="upload, finalize":E="upload";let x={"X-Goog-Upload-Command":E,"X-Goog-Upload-Offset":`${c.current}`},D=r.slice(p,_);if(D===null)throw nf();function k(G,Q){let $=fu(G,["active","final"]),v=c.current+f,g=r.size(),w;return $==="final"?w=qs(t,s)(G,Q):w=null,new Xn(v,g,$==="final",w)}let B="POST",z=t.maxUploadRetryTime,F=new re(e,B,k,z);return F.headers=x,F.body=D.uploadData(),F.progressCallback=u||null,F.errorHandler=Jn(n),F}var mf={STATE_CHANGED:"state_changed"},Nt={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function tu(n){switch(n){case"running":case"pausing":case"canceling":return Nt.RUNNING;case"paused":return Nt.PAUSED;case"success":return Nt.SUCCESS;case"canceled":return Nt.CANCELED;case"error":return Nt.ERROR;default:return Nt.ERROR}}var iu=class{constructor(t,e,r){if(qy(t)||e!=null||r!=null)this.next=t,this.error=e??void 0,this.complete=r??void 0;else{let s=t;this.next=s.next,this.error=s.error,this.complete=s.complete}}};function Wn(n){return(...t)=>{Promise.resolve().then(()=>n(...t))}}var Qd=null,su=class{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Hn.NO_ERROR,this.sendPromise_=new Promise(t=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Hn.ABORT,t()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Hn.NETWORK_ERROR,t()}),this.xhr_.addEventListener("load",()=>{t()})})}send(t,e,r,i){if(this.sent_)throw hi("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),i!==void 0)for(let s in i)i.hasOwnProperty(s)&&this.xhr_.setRequestHeader(s,i[s].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw hi("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw hi("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw hi("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw hi("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",t)}removeUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",t)}},ou=class extends su{initXhr(){this.xhr_.responseType="text"}};function ne(){return Qd?Qd():new ou}var mi=class{constructor(t,e,r=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=t,this._blob=e,this._metadata=r,this._mappings=gi(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=i=>{if(this._request=void 0,this._chunkMultiplier=1,i._codeEquals(at.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{let s=this.isExponentialBackoffExpired();if(of(i.status,[]))if(s)i=tf();else{this.sleepTime=Math.max(this.sleepTime*2,by),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=i,this._transition("error")}},this._metadataErrorHandler=i=>{this._request=void 0,i._codeEquals(at.CANCELED)?this.completeTransitions_():(this._error=i,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((i,s)=>{this._resolve=i,this._reject=s,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){let t=this._transferred;return e=>this._updateProgress(t+e)}_shouldDoResumable(t){return t.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(t){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([e,r])=>{switch(this._state){case"running":t(e,r);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((t,e)=>{let r=yw(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(r,ne,t,e);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._uploadUrl=s,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){let t=this._uploadUrl;this._resolveToken((e,r)=>{let i=ww(this._ref.storage,this._ref._location,t,this._blob),s=this._ref.storage._makeRequest(i,ne,e,r);this._request=s,s.getPromise().then(o=>{o=o,this._request=void 0,this._updateProgress(o.current),this._needToFetchStatus=!1,o.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){let t=Wd*this._chunkMultiplier,e=new Xn(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken((i,s)=>{let o;try{o=vw(this._ref._location,this._ref.storage,r,this._blob,t,this._mappings,e,this._makeProgressCallback())}catch(c){this._error=c,this._transition("error");return}let u=this._ref.storage._makeRequest(o,ne,i,s,!1);this._request=u,u.getPromise().then(c=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(c.current),c.finalized?(this._metadata=c.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){Wd*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((t,e)=>{let r=hf(this._ref.storage,this._ref._location,this._mappings),i=this._ref.storage._makeRequest(r,ne,t,e);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((t,e)=>{let r=ff(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(r,ne,t,e);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(t){let e=this._transferred;this._transferred=t,this._transferred!==e&&this._notifyObservers()}_transition(t){if(this._state!==t)switch(t){case"canceling":case"pausing":this._state=t,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":let e=this._state==="paused";this._state=t,e&&(this._notifyObservers(),this._start());break;case"paused":this._state=t,this._notifyObservers();break;case"canceled":this._error=ef(),this._state=t,this._notifyObservers();break;case"error":this._state=t,this._notifyObservers();break;case"success":this._state=t,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){let t=tu(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:t,metadata:this._metadata,task:this,ref:this._ref}}on(t,e,r,i){let s=new iu(e||void 0,r||void 0,i||void 0);return this._addObserver(s),()=>{this._removeObserver(s)}}then(t,e){return this._promise.then(t,e)}catch(t){return this.then(null,t)}_addObserver(t){this._observers.push(t),this._notifyObserver(t)}_removeObserver(t){let e=this._observers.indexOf(t);e!==-1&&this._observers.splice(e,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(e=>{this._notifyObserver(e)})}_finishPromise(){if(this._resolve!==void 0){let t=!0;switch(tu(this._state)){case Nt.SUCCESS:Wn(this._resolve.bind(null,this.snapshot))();break;case Nt.CANCELED:case Nt.ERROR:let e=this._reject;Wn(e.bind(null,this._error))();break;default:t=!1;break}t&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(t){switch(tu(this._state)){case Nt.RUNNING:case Nt.PAUSED:t.next&&Wn(t.next.bind(t,this.snapshot))();break;case Nt.SUCCESS:t.complete&&Wn(t.complete.bind(t))();break;case Nt.CANCELED:case Nt.ERROR:t.error&&Wn(t.error.bind(t,this._error))();break;default:t.error&&Wn(t.error.bind(t,this._error))()}}resume(){let t=this._state==="paused"||this._state==="pausing";return t&&this._transition("running"),t}pause(){let t=this._state==="running";return t&&this._transition("pausing"),t}cancel(){let t=this._state==="running"||this._state==="pausing";return t&&this._transition("canceling"),t}};var Yn=class n{constructor(t,e){this._service=t,e instanceof jt?this._location=e:this._location=jt.makeFromUrl(e,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,e){return new n(t,e)}get root(){let t=new jt(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return cf(this._location.path)}get storage(){return this._service}get parent(){let t=nw(this._location.path);if(t===null)return null;let e=new jt(this._location.bucket,t);return new n(this._service,e)}_throwIfRoot(t){if(this._location.path==="")throw uu(t)}};function Tw(n,t,e){n._throwIfRoot("uploadBytes");let r=ff(n.storage,n._location,gi(),new pn(t,!0),e);return n.storage.makeRequestWithTokens(r,ne).then(i=>({metadata:i,ref:n}))}function Iw(n,t,e){return n._throwIfRoot("uploadBytesResumable"),new mi(n,new pn(t),e)}function Ew(n){let t={prefixes:[],items:[]};return pf(n,t).then(()=>t)}function pf(n,t,e){return C(this,null,function*(){let i=yield gf(n,{pageToken:e});t.prefixes.push(...i.prefixes),t.items.push(...i.items),i.nextPageToken!=null&&(yield pf(n,t,i.nextPageToken))})}function gf(n,t){t!=null&&typeof t.maxResults=="number"&&nu("options.maxResults",1,1e3,t.maxResults);let e=t||{},r=fw(n.storage,n._location,"/",e.pageToken,e.maxResults);return n.storage.makeRequestWithTokens(r,ne)}function Aw(n){n._throwIfRoot("getMetadata");let t=hf(n.storage,n._location,gi());return n.storage.makeRequestWithTokens(t,ne)}function Rw(n,t){n._throwIfRoot("updateMetadata");let e=pw(n.storage,n._location,t,gi());return n.storage.makeRequestWithTokens(e,ne)}function bw(n){n._throwIfRoot("getDownloadURL");let t=mw(n.storage,n._location,gi());return n.storage.makeRequestWithTokens(t,ne).then(e=>{if(e===null)throw Ly();return e})}function Sw(n){n._throwIfRoot("deleteObject");let t=gw(n.storage,n._location);return n.storage.makeRequestWithTokens(t,ne)}function _f(n,t){let e=rw(n._location.path,t),r=new jt(n._location.bucket,e);return new Yn(n.storage,r)}function Pw(n){return/^[A-Za-z]+:\/\//.test(n)}function Cw(n,t){return new Yn(n,t)}function yf(n,t){if(n instanceof pi){let e=n;if(e._bucket==null)throw Ny();let r=new Yn(e,e._bucket);return t!=null?yf(r,t):r}else return t!==void 0?_f(n,t):n}function xw(n,t){if(t&&Pw(t)){if(n instanceof pi)return Cw(n,t);throw mn("To use ref(service, url), the first argument must be a Storage instance.")}else return yf(n,t)}function Hd(n,t){let e=t?.[Zd];return e==null?null:jt.makeFromBucketSpec(e,n)}function kw(n,t,e,r={}){n.host=`${t}:${e}`,n._protocol="http";let{mockUserToken:i}=r;i&&(n._overrideAuthToken=typeof i=="string"?i:Ps(i,n.app.options.projectId))}var pi=class{constructor(t,e,r,i,s){this.app=t,this._authProvider=e,this._appCheckProvider=r,this._url=i,this._firebaseVersion=s,this._bucket=null,this._host=Jd,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Ay,this._maxUploadRetryTime=Ry,this._requests=new Set,i!=null?this._bucket=jt.makeFromBucketSpec(i,this._host):this._bucket=Hd(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=jt.makeFromBucketSpec(this._url,t):this._bucket=Hd(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){nu("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){nu("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}_getAuthToken(){return C(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;let t=this._authProvider.getImmediate({optional:!0});if(t){let e=yield t.getToken();if(e!==null)return e.accessToken}return null})}_getAppCheckToken(){return C(this,null,function*(){let t=this._appCheckProvider.getImmediate({optional:!0});return t?(yield t.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new Yn(this,t)}_makeRequest(t,e,r,i,s=!0){if(this._deleted)return new eu(rf());{let o=Wy(t,this._appId,r,i,e,this._firebaseVersion,s);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}makeRequestWithTokens(t,e){return C(this,null,function*(){let[r,i]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,e,r,i).getPromise()})}},Xd="@firebase/storage",Yd="0.13.1";var wf="storage";function aE(n,t,e){return n=tt(n),Tw(n,t,e)}function vf(n,t,e){return n=tt(n),Iw(n,t,e)}function Tf(n){return n=tt(n),Aw(n)}function If(n,t){return n=tt(n),Rw(n,t)}function Ef(n,t){return n=tt(n),gf(n,t)}function Af(n){return n=tt(n),Ew(n)}function Rf(n){return n=tt(n),bw(n)}function bf(n){return n=tt(n),Sw(n)}function mu(n,t){return n=tt(n),xw(n,t)}function Sf(n,t){return _f(n,t)}function uE(n=Vs(),t){n=tt(n);let r=ks(n,wf).getImmediate({identifier:t}),i=Ss("storage");return i&&pu(r,...i),r}function pu(n,t,e,r={}){kw(n,t,e,r)}function Dw(n,{instanceIdentifier:t}){let e=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),i=n.getProvider("app-check-internal");return new pi(e,r,i,t,Ds)}function Vw(){xs(new Kn(wf,Dw,"PUBLIC").setMultipleInstances(!0)),Ue(Xd,Yd,""),Ue(Xd,Yd,"esm2017")}Vw();var Zn=class{constructor(t,e,r){this._delegate=t,this.task=e,this.ref=r}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}};var js=class{constructor(t,e){this._delegate=t,this._ref=e,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new Zn(this._delegate.snapshot,this,this._ref)}then(t,e){return this._delegate.then(r=>{if(t)return t(new Zn(r,this,this._ref))},e)}on(t,e,r,i){let s;return e&&(typeof e=="function"?s=o=>e(new Zn(o,this,this._ref)):s={next:e.next?o=>e.next(new Zn(o,this,this._ref)):void 0,complete:e.complete||void 0,error:e.error||void 0}),this._delegate.on(t,s,r||void 0,i||void 0)}},Gs=class{constructor(t,e){this._delegate=t,this._service=e}get prefixes(){return this._delegate.prefixes.map(t=>new gn(t,this._service))}get items(){return this._delegate.items.map(t=>new gn(t,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}};var gn=class n{constructor(t,e){this._delegate=t,this.storage=e}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(t){let e=Sf(this._delegate,t);return new n(e,this.storage)}get root(){return new n(this._delegate.root,this.storage)}get parent(){let t=this._delegate.parent;return t==null?null:new n(t,this.storage)}put(t,e){return this._throwIfRoot("put"),new js(vf(this._delegate,t,e),this)}putString(t,e=Xt.RAW,r){this._throwIfRoot("putString");let i=lu(e,t),s=Object.assign({},r);return s.contentType==null&&i.contentType!=null&&(s.contentType=i.contentType),new js(new mi(this._delegate,new pn(i.data,!0),s),this)}listAll(){return Af(this._delegate).then(t=>new Gs(t,this.storage))}list(t){return Ef(this._delegate,t||void 0).then(e=>new Gs(e,this.storage))}getMetadata(){return Tf(this._delegate)}updateMetadata(t){return If(this._delegate,t)}getDownloadURL(){return Rf(this._delegate)}delete(){return this._throwIfRoot("delete"),bf(this._delegate)}_throwIfRoot(t){if(this._delegate._location.path==="")throw uu(t)}};var $s=class{constructor(t,e){this.app=t,this._delegate=e}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(t){if(Pf(t))throw mn("ref() expected a child path but got a URL, use refFromURL instead.");return new gn(mu(this._delegate,t),this)}refFromURL(t){if(!Pf(t))throw mn("refFromURL() expected a full URL but got a child path, use ref() instead.");try{jt.makeFromUrl(t,this._delegate.host)}catch{throw mn("refFromUrl() expected a valid full URL but got an invalid one.")}return new gn(mu(this._delegate,t),this)}setMaxUploadRetryTime(t){this._delegate.maxUploadRetryTime=t}setMaxOperationRetryTime(t){this._delegate.maxOperationRetryTime=t}useEmulator(t,e,r={}){pu(this._delegate,t,e,r)}};function Pf(n){return/^[A-Za-z]+:\/\//.test(n)}var Nw="@firebase/storage-compat",Ow="0.3.11";var Lw="storage-compat";function Mw(n,{instanceIdentifier:t}){let e=n.getProvider("app-compat").getImmediate(),r=n.getProvider("storage").getImmediate({identifier:t});return new $s(e,r)}function Fw(n){let t={TaskState:Nt,TaskEvent:mf,StringFormat:Xt,Storage:$s,Reference:gn};n.INTERNAL.registerComponent(new Kn(Lw,Mw,"PUBLIC").setServiceProps(t).setMultipleInstances(!0)),n.registerVersion(Nw,Ow)}Fw(Ms);function Uw(n){return new ad(t=>{let e=o=>t.next(o),r=o=>t.error(o),i=()=>t.complete();e(n.snapshot);let s=n.on("state_changed",e);return n.then(o=>{e(o),i()},o=>{e(n.snapshot),r(o)}),function(){s()}}).pipe(ld(0))}function Cf(n){let t=Uw(n);return{task:n,then:n.then.bind(n),catch:n.catch.bind(n),pause:n.pause.bind(n),cancel:n.cancel.bind(n),resume:n.resume.bind(n),snapshotChanges:()=>t,percentageChanges:()=>t.pipe(cd(e=>e.bytesTransferred/e.totalBytes*100))}}function Ks(n){return{getDownloadURL:()=>Ua(void 0).pipe(Wa,Ba(()=>n.getDownloadURL()),Qa),getMetadata:()=>Ua(void 0).pipe(Wa,Ba(()=>n.getMetadata()),Qa),delete:()=>ii(n.delete()),child:t=>Ks(n.child(t)),updateMetadata:t=>ii(n.updateMetadata(t)),put:(t,e)=>{let r=n.put(t,e);return Cf(r)},putString:(t,e,r)=>{let i=n.putString(t,e,r);return Cf(i)},list:t=>ii(n.list(t)),listAll:()=>ii(n.listAll())}}var Bw=new Ie("angularfire2.storageBucket"),qw=new Ie("angularfire2.storage.maxUploadRetryTime"),zw=new Ie("angularfire2.storage.maxOperationRetryTime"),jw=new Ie("angularfire2.storage.use-emulator"),Gw=(()=>{class n{storage;constructor(e,r,i,s,o,u,c,h,f,p){let _=Ld(e,o,r);this.storage=Md(`${_.name}.storage.${i}`,"AngularFireStorage",_.name,()=>{let E=o.runOutsideAngular(()=>_.storage(i||void 0)),x=f;return x&&E.useEmulator(...x),c&&E.setMaxUploadRetryTime(c),h&&E.setMaxOperationRetryTime(h),E},[c,h])}ref(e){return Ks(this.storage.ref(e))}refFromURL(e){return Ks(this.storage.refFromURL(e))}upload(e,r,i){let s=this.storage.ref(e);return Ks(s).put(r,i)}static \u0275fac=function(r){return new(r||n)(Ut(Nd),Ut(Od,8),Ut(Bw,8),Ut(pd),Ut(Gn),Ut(Ls),Ut(qw,8),Ut(zw,8),Ut(jw,8),Ut(Os,8))};static \u0275prov=zn({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var $w=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275mod=oi({type:n});static \u0275inj=si({})}return n})(),NE=(()=>{class n{constructor(){Ms.registerVersion("angularfire",Ns.full,"gcs-compat")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=oi({type:n});static \u0275inj=si({providers:[Gw],imports:[$w]})}return n})();var xf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},kf={};var qe,gu;(function(){var n;function t(v,g){function w(){}w.prototype=g.prototype,v.D=g.prototype,v.prototype=new w,v.prototype.constructor=v,v.C=function(T,I,R){for(var y=Array(arguments.length-2),we=2;we<arguments.length;we++)y[we-2]=arguments[we];return g.prototype[I].apply(T,y)}}function e(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(r,e),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(v,g,w){w||(w=0);var T=Array(16);if(typeof g=="string")for(var I=0;16>I;++I)T[I]=g.charCodeAt(w++)|g.charCodeAt(w++)<<8|g.charCodeAt(w++)<<16|g.charCodeAt(w++)<<24;else for(I=0;16>I;++I)T[I]=g[w++]|g[w++]<<8|g[w++]<<16|g[w++]<<24;g=v.g[0],w=v.g[1],I=v.g[2];var R=v.g[3],y=g+(R^w&(I^R))+T[0]+3614090360&4294967295;g=w+(y<<7&4294967295|y>>>25),y=R+(I^g&(w^I))+T[1]+3905402710&4294967295,R=g+(y<<12&4294967295|y>>>20),y=I+(w^R&(g^w))+T[2]+606105819&4294967295,I=R+(y<<17&4294967295|y>>>15),y=w+(g^I&(R^g))+T[3]+3250441966&4294967295,w=I+(y<<22&4294967295|y>>>10),y=g+(R^w&(I^R))+T[4]+4118548399&4294967295,g=w+(y<<7&4294967295|y>>>25),y=R+(I^g&(w^I))+T[5]+1200080426&4294967295,R=g+(y<<12&4294967295|y>>>20),y=I+(w^R&(g^w))+T[6]+2821735955&4294967295,I=R+(y<<17&4294967295|y>>>15),y=w+(g^I&(R^g))+T[7]+4249261313&4294967295,w=I+(y<<22&4294967295|y>>>10),y=g+(R^w&(I^R))+T[8]+1770035416&4294967295,g=w+(y<<7&4294967295|y>>>25),y=R+(I^g&(w^I))+T[9]+2336552879&4294967295,R=g+(y<<12&4294967295|y>>>20),y=I+(w^R&(g^w))+T[10]+4294925233&4294967295,I=R+(y<<17&4294967295|y>>>15),y=w+(g^I&(R^g))+T[11]+2304563134&4294967295,w=I+(y<<22&4294967295|y>>>10),y=g+(R^w&(I^R))+T[12]+1804603682&4294967295,g=w+(y<<7&4294967295|y>>>25),y=R+(I^g&(w^I))+T[13]+4254626195&4294967295,R=g+(y<<12&4294967295|y>>>20),y=I+(w^R&(g^w))+T[14]+2792965006&4294967295,I=R+(y<<17&4294967295|y>>>15),y=w+(g^I&(R^g))+T[15]+1236535329&4294967295,w=I+(y<<22&4294967295|y>>>10),y=g+(I^R&(w^I))+T[1]+4129170786&4294967295,g=w+(y<<5&4294967295|y>>>27),y=R+(w^I&(g^w))+T[6]+3225465664&4294967295,R=g+(y<<9&4294967295|y>>>23),y=I+(g^w&(R^g))+T[11]+643717713&4294967295,I=R+(y<<14&4294967295|y>>>18),y=w+(R^g&(I^R))+T[0]+3921069994&4294967295,w=I+(y<<20&4294967295|y>>>12),y=g+(I^R&(w^I))+T[5]+3593408605&4294967295,g=w+(y<<5&4294967295|y>>>27),y=R+(w^I&(g^w))+T[10]+38016083&4294967295,R=g+(y<<9&4294967295|y>>>23),y=I+(g^w&(R^g))+T[15]+3634488961&4294967295,I=R+(y<<14&4294967295|y>>>18),y=w+(R^g&(I^R))+T[4]+3889429448&4294967295,w=I+(y<<20&4294967295|y>>>12),y=g+(I^R&(w^I))+T[9]+568446438&4294967295,g=w+(y<<5&4294967295|y>>>27),y=R+(w^I&(g^w))+T[14]+3275163606&4294967295,R=g+(y<<9&4294967295|y>>>23),y=I+(g^w&(R^g))+T[3]+4107603335&4294967295,I=R+(y<<14&4294967295|y>>>18),y=w+(R^g&(I^R))+T[8]+1163531501&4294967295,w=I+(y<<20&4294967295|y>>>12),y=g+(I^R&(w^I))+T[13]+2850285829&4294967295,g=w+(y<<5&4294967295|y>>>27),y=R+(w^I&(g^w))+T[2]+4243563512&4294967295,R=g+(y<<9&4294967295|y>>>23),y=I+(g^w&(R^g))+T[7]+1735328473&4294967295,I=R+(y<<14&4294967295|y>>>18),y=w+(R^g&(I^R))+T[12]+2368359562&4294967295,w=I+(y<<20&4294967295|y>>>12),y=g+(w^I^R)+T[5]+4294588738&4294967295,g=w+(y<<4&4294967295|y>>>28),y=R+(g^w^I)+T[8]+2272392833&4294967295,R=g+(y<<11&4294967295|y>>>21),y=I+(R^g^w)+T[11]+1839030562&4294967295,I=R+(y<<16&4294967295|y>>>16),y=w+(I^R^g)+T[14]+4259657740&4294967295,w=I+(y<<23&4294967295|y>>>9),y=g+(w^I^R)+T[1]+2763975236&4294967295,g=w+(y<<4&4294967295|y>>>28),y=R+(g^w^I)+T[4]+1272893353&4294967295,R=g+(y<<11&4294967295|y>>>21),y=I+(R^g^w)+T[7]+4139469664&4294967295,I=R+(y<<16&4294967295|y>>>16),y=w+(I^R^g)+T[10]+3200236656&4294967295,w=I+(y<<23&4294967295|y>>>9),y=g+(w^I^R)+T[13]+681279174&4294967295,g=w+(y<<4&4294967295|y>>>28),y=R+(g^w^I)+T[0]+3936430074&4294967295,R=g+(y<<11&4294967295|y>>>21),y=I+(R^g^w)+T[3]+3572445317&4294967295,I=R+(y<<16&4294967295|y>>>16),y=w+(I^R^g)+T[6]+76029189&4294967295,w=I+(y<<23&4294967295|y>>>9),y=g+(w^I^R)+T[9]+3654602809&4294967295,g=w+(y<<4&4294967295|y>>>28),y=R+(g^w^I)+T[12]+3873151461&4294967295,R=g+(y<<11&4294967295|y>>>21),y=I+(R^g^w)+T[15]+530742520&4294967295,I=R+(y<<16&4294967295|y>>>16),y=w+(I^R^g)+T[2]+3299628645&4294967295,w=I+(y<<23&4294967295|y>>>9),y=g+(I^(w|~R))+T[0]+4096336452&4294967295,g=w+(y<<6&4294967295|y>>>26),y=R+(w^(g|~I))+T[7]+1126891415&4294967295,R=g+(y<<10&4294967295|y>>>22),y=I+(g^(R|~w))+T[14]+2878612391&4294967295,I=R+(y<<15&4294967295|y>>>17),y=w+(R^(I|~g))+T[5]+4237533241&4294967295,w=I+(y<<21&4294967295|y>>>11),y=g+(I^(w|~R))+T[12]+1700485571&4294967295,g=w+(y<<6&4294967295|y>>>26),y=R+(w^(g|~I))+T[3]+2399980690&4294967295,R=g+(y<<10&4294967295|y>>>22),y=I+(g^(R|~w))+T[10]+4293915773&4294967295,I=R+(y<<15&4294967295|y>>>17),y=w+(R^(I|~g))+T[1]+2240044497&4294967295,w=I+(y<<21&4294967295|y>>>11),y=g+(I^(w|~R))+T[8]+1873313359&4294967295,g=w+(y<<6&4294967295|y>>>26),y=R+(w^(g|~I))+T[15]+4264355552&4294967295,R=g+(y<<10&4294967295|y>>>22),y=I+(g^(R|~w))+T[6]+2734768916&4294967295,I=R+(y<<15&4294967295|y>>>17),y=w+(R^(I|~g))+T[13]+1309151649&4294967295,w=I+(y<<21&4294967295|y>>>11),y=g+(I^(w|~R))+T[4]+4149444226&4294967295,g=w+(y<<6&4294967295|y>>>26),y=R+(w^(g|~I))+T[11]+3174756917&4294967295,R=g+(y<<10&4294967295|y>>>22),y=I+(g^(R|~w))+T[2]+718787259&4294967295,I=R+(y<<15&4294967295|y>>>17),y=w+(R^(I|~g))+T[9]+3951481745&4294967295,v.g[0]=v.g[0]+g&4294967295,v.g[1]=v.g[1]+(I+(y<<21&4294967295|y>>>11))&4294967295,v.g[2]=v.g[2]+I&4294967295,v.g[3]=v.g[3]+R&4294967295}r.prototype.u=function(v,g){g===void 0&&(g=v.length);for(var w=g-this.blockSize,T=this.B,I=this.h,R=0;R<g;){if(I==0)for(;R<=w;)i(this,v,R),R+=this.blockSize;if(typeof v=="string"){for(;R<g;)if(T[I++]=v.charCodeAt(R++),I==this.blockSize){i(this,T),I=0;break}}else for(;R<g;)if(T[I++]=v[R++],I==this.blockSize){i(this,T),I=0;break}}this.h=I,this.o+=g},r.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var g=1;g<v.length-8;++g)v[g]=0;var w=8*this.o;for(g=v.length-8;g<v.length;++g)v[g]=w&255,w/=256;for(this.u(v),v=Array(16),g=w=0;4>g;++g)for(var T=0;32>T;T+=8)v[w++]=this.g[g]>>>T&255;return v};function s(v,g){var w=u;return Object.prototype.hasOwnProperty.call(w,v)?w[v]:w[v]=g(v)}function o(v,g){this.h=g;for(var w=[],T=!0,I=v.length-1;0<=I;I--){var R=v[I]|0;T&&R==g||(w[I]=R,T=!1)}this.g=w}var u={};function c(v){return-128<=v&&128>v?s(v,function(g){return new o([g|0],0>g?-1:0)}):new o([v|0],0>v?-1:0)}function h(v){if(isNaN(v)||!isFinite(v))return p;if(0>v)return k(h(-v));for(var g=[],w=1,T=0;v>=w;T++)g[T]=v/w|0,w*=4294967296;return new o(g,0)}function f(v,g){if(v.length==0)throw Error("number format error: empty string");if(g=g||10,2>g||36<g)throw Error("radix out of range: "+g);if(v.charAt(0)=="-")return k(f(v.substring(1),g));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=h(Math.pow(g,8)),T=p,I=0;I<v.length;I+=8){var R=Math.min(8,v.length-I),y=parseInt(v.substring(I,I+R),g);8>R?(R=h(Math.pow(g,R)),T=T.j(R).add(h(y))):(T=T.j(w),T=T.add(h(y)))}return T}var p=c(0),_=c(1),E=c(16777216);n=o.prototype,n.m=function(){if(D(this))return-k(this).m();for(var v=0,g=1,w=0;w<this.g.length;w++){var T=this.i(w);v+=(0<=T?T:4294967296+T)*g,g*=4294967296}return v},n.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(x(this))return"0";if(D(this))return"-"+k(this).toString(v);for(var g=h(Math.pow(v,6)),w=this,T="";;){var I=G(w,g).g;w=B(w,I.j(g));var R=((0<w.g.length?w.g[0]:w.h)>>>0).toString(v);if(w=I,x(w))return R+T;for(;6>R.length;)R="0"+R;T=R+T}},n.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function x(v){if(v.h!=0)return!1;for(var g=0;g<v.g.length;g++)if(v.g[g]!=0)return!1;return!0}function D(v){return v.h==-1}n.l=function(v){return v=B(this,v),D(v)?-1:x(v)?0:1};function k(v){for(var g=v.g.length,w=[],T=0;T<g;T++)w[T]=~v.g[T];return new o(w,~v.h).add(_)}n.abs=function(){return D(this)?k(this):this},n.add=function(v){for(var g=Math.max(this.g.length,v.g.length),w=[],T=0,I=0;I<=g;I++){var R=T+(this.i(I)&65535)+(v.i(I)&65535),y=(R>>>16)+(this.i(I)>>>16)+(v.i(I)>>>16);T=y>>>16,R&=65535,y&=65535,w[I]=y<<16|R}return new o(w,w[w.length-1]&-2147483648?-1:0)};function B(v,g){return v.add(k(g))}n.j=function(v){if(x(this)||x(v))return p;if(D(this))return D(v)?k(this).j(k(v)):k(k(this).j(v));if(D(v))return k(this.j(k(v)));if(0>this.l(E)&&0>v.l(E))return h(this.m()*v.m());for(var g=this.g.length+v.g.length,w=[],T=0;T<2*g;T++)w[T]=0;for(T=0;T<this.g.length;T++)for(var I=0;I<v.g.length;I++){var R=this.i(T)>>>16,y=this.i(T)&65535,we=v.i(I)>>>16,Ur=v.i(I)&65535;w[2*T+2*I]+=y*Ur,z(w,2*T+2*I),w[2*T+2*I+1]+=R*Ur,z(w,2*T+2*I+1),w[2*T+2*I+1]+=y*we,z(w,2*T+2*I+1),w[2*T+2*I+2]+=R*we,z(w,2*T+2*I+2)}for(T=0;T<g;T++)w[T]=w[2*T+1]<<16|w[2*T];for(T=g;T<2*g;T++)w[T]=0;return new o(w,0)};function z(v,g){for(;(v[g]&65535)!=v[g];)v[g+1]+=v[g]>>>16,v[g]&=65535,g++}function F(v,g){this.g=v,this.h=g}function G(v,g){if(x(g))throw Error("division by zero");if(x(v))return new F(p,p);if(D(v))return g=G(k(v),g),new F(k(g.g),k(g.h));if(D(g))return g=G(v,k(g)),new F(k(g.g),g.h);if(30<v.g.length){if(D(v)||D(g))throw Error("slowDivide_ only works with positive integers.");for(var w=_,T=g;0>=T.l(v);)w=Q(w),T=Q(T);var I=$(w,1),R=$(T,1);for(T=$(T,2),w=$(w,2);!x(T);){var y=R.add(T);0>=y.l(v)&&(I=I.add(w),R=y),T=$(T,1),w=$(w,1)}return g=B(v,I.j(g)),new F(I,g)}for(I=p;0<=v.l(g);){for(w=Math.max(1,Math.floor(v.m()/g.m())),T=Math.ceil(Math.log(w)/Math.LN2),T=48>=T?1:Math.pow(2,T-48),R=h(w),y=R.j(g);D(y)||0<y.l(v);)w-=T,R=h(w),y=R.j(g);x(R)&&(R=_),I=I.add(R),v=B(v,y)}return new F(I,v)}n.A=function(v){return G(this,v).h},n.and=function(v){for(var g=Math.max(this.g.length,v.g.length),w=[],T=0;T<g;T++)w[T]=this.i(T)&v.i(T);return new o(w,this.h&v.h)},n.or=function(v){for(var g=Math.max(this.g.length,v.g.length),w=[],T=0;T<g;T++)w[T]=this.i(T)|v.i(T);return new o(w,this.h|v.h)},n.xor=function(v){for(var g=Math.max(this.g.length,v.g.length),w=[],T=0;T<g;T++)w[T]=this.i(T)^v.i(T);return new o(w,this.h^v.h)};function Q(v){for(var g=v.g.length+1,w=[],T=0;T<g;T++)w[T]=v.i(T)<<1|v.i(T-1)>>>31;return new o(w,v.h)}function $(v,g){var w=g>>5;g%=32;for(var T=v.g.length-w,I=[],R=0;R<T;R++)I[R]=0<g?v.i(R+w)>>>g|v.i(R+w+1)<<32-g:v.i(R+w);return new o(I,v.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,gu=kf.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=f,qe=kf.Integer=o}).apply(typeof xf<"u"?xf:typeof self<"u"?self:typeof window<"u"?window:{});var Ws=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ae={};var _u,yu,tr,wu,_i,Qs,vu,Tu,Iu;(function(){var n,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,l,d){return a==Array.prototype||a==Object.prototype||(a[l]=d.value),a};function e(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ws=="object"&&Ws];for(var l=0;l<a.length;++l){var d=a[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var r=e(this);function i(a,l){if(l)t:{var d=r;a=a.split(".");for(var m=0;m<a.length-1;m++){var A=a[m];if(!(A in d))break t;d=d[A]}a=a[a.length-1],m=d[a],l=l(m),l!=m&&l!=null&&t(d,a,{configurable:!0,writable:!0,value:l})}}function s(a,l){a instanceof String&&(a+="");var d=0,m=!1,A={next:function(){if(!m&&d<a.length){var P=d++;return{value:l(P,a[P]),done:!1}}return m=!0,{done:!0,value:void 0}}};return A[Symbol.iterator]=function(){return A},A}i("Array.prototype.values",function(a){return a||function(){return s(this,function(l,d){return d})}});var o=o||{},u=this||self;function c(a){var l=typeof a;return l=l!="object"?l:a?Array.isArray(a)?"array":l:"null",l=="array"||l=="object"&&typeof a.length=="number"}function h(a){var l=typeof a;return l=="object"&&a!=null||l=="function"}function f(a,l,d){return a.call.apply(a.bind,arguments)}function p(a,l,d){if(!a)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var A=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(A,m),a.apply(l,A)}}return function(){return a.apply(l,arguments)}}function _(a,l,d){return _=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:p,_.apply(null,arguments)}function E(a,l){var d=Array.prototype.slice.call(arguments,1);return function(){var m=d.slice();return m.push.apply(m,arguments),a.apply(this,m)}}function x(a,l){function d(){}d.prototype=l.prototype,a.aa=l.prototype,a.prototype=new d,a.prototype.constructor=a,a.Qb=function(m,A,P){for(var O=Array(arguments.length-2),rt=2;rt<arguments.length;rt++)O[rt-2]=arguments[rt];return l.prototype[A].apply(m,O)}}function D(a){let l=a.length;if(0<l){let d=Array(l);for(let m=0;m<l;m++)d[m]=a[m];return d}return[]}function k(a,l){for(let d=1;d<arguments.length;d++){let m=arguments[d];if(c(m)){let A=a.length||0,P=m.length||0;a.length=A+P;for(let O=0;O<P;O++)a[A+O]=m[O]}else a.push(m)}}class B{constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function z(a){return/^[\s\xa0]*$/.test(a)}function F(){var a=u.navigator;return a&&(a=a.userAgent)?a:""}function G(a){return G[" "](a),a}G[" "]=function(){};var Q=F().indexOf("Gecko")!=-1&&!(F().toLowerCase().indexOf("webkit")!=-1&&F().indexOf("Edge")==-1)&&!(F().indexOf("Trident")!=-1||F().indexOf("MSIE")!=-1)&&F().indexOf("Edge")==-1;function $(a,l,d){for(let m in a)l.call(d,a[m],m,a)}function v(a,l){for(let d in a)l.call(void 0,a[d],d,a)}function g(a){let l={};for(let d in a)l[d]=a[d];return l}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function T(a,l){let d,m;for(let A=1;A<arguments.length;A++){m=arguments[A];for(d in m)a[d]=m[d];for(let P=0;P<w.length;P++)d=w[P],Object.prototype.hasOwnProperty.call(m,d)&&(a[d]=m[d])}}function I(a){var l=1;a=a.split(":");let d=[];for(;0<l&&a.length;)d.push(a.shift()),l--;return a.length&&d.push(a.join(":")),d}function R(a){u.setTimeout(()=>{throw a},0)}function y(){var a=da;let l=null;return a.g&&(l=a.g,a.g=a.g.next,a.g||(a.h=null),l.next=null),l}class we{constructor(){this.h=this.g=null}add(l,d){let m=Ur.get();m.set(l,d),this.h?this.h.next=m:this.g=m,this.h=m}}var Ur=new B(()=>new vg,a=>a.reset());class vg{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let Br,qr=!1,da=new we,oh=()=>{let a=u.Promise.resolve(void 0);Br=()=>{a.then(Tg)}};var Tg=()=>{for(var a;a=y();){try{a.h.call(a.g)}catch(d){R(d)}var l=Ur;l.j(a),100>l.h&&(l.h++,a.next=l.g,l.g=a)}qr=!1};function Ve(){this.s=this.s,this.C=this.C}Ve.prototype.s=!1,Ve.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ve.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function xt(a,l){this.type=a,this.g=this.target=l,this.defaultPrevented=!1}xt.prototype.h=function(){this.defaultPrevented=!0};var Ig=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var a=!1,l=Object.defineProperty({},"passive",{get:function(){a=!0}});try{let d=()=>{};u.addEventListener("test",d,l),u.removeEventListener("test",d,l)}catch{}return a}();function zr(a,l){if(xt.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var d=this.type=a.type,m=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=l,l=a.relatedTarget){if(Q){t:{try{G(l.nodeName);var A=!0;break t}catch{}A=!1}A||(l=null)}}else d=="mouseover"?l=a.fromElement:d=="mouseout"&&(l=a.toElement);this.relatedTarget=l,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=typeof a.pointerType=="string"?a.pointerType:Eg[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&zr.aa.h.call(this)}}x(zr,xt);var Eg={2:"touch",3:"pen",4:"mouse"};zr.prototype.h=function(){zr.aa.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var jr="closure_listenable_"+(1e6*Math.random()|0),Ag=0;function Rg(a,l,d,m,A){this.listener=a,this.proxy=null,this.src=l,this.type=d,this.capture=!!m,this.ha=A,this.key=++Ag,this.da=this.fa=!1}function ss(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function os(a){this.src=a,this.g={},this.h=0}os.prototype.add=function(a,l,d,m,A){var P=a.toString();a=this.g[P],a||(a=this.g[P]=[],this.h++);var O=ma(a,l,m,A);return-1<O?(l=a[O],d||(l.fa=!1)):(l=new Rg(l,this.src,P,!!m,A),l.fa=d,a.push(l)),l};function fa(a,l){var d=l.type;if(d in a.g){var m=a.g[d],A=Array.prototype.indexOf.call(m,l,void 0),P;(P=0<=A)&&Array.prototype.splice.call(m,A,1),P&&(ss(l),a.g[d].length==0&&(delete a.g[d],a.h--))}}function ma(a,l,d,m){for(var A=0;A<a.length;++A){var P=a[A];if(!P.da&&P.listener==l&&P.capture==!!d&&P.ha==m)return A}return-1}var pa="closure_lm_"+(1e6*Math.random()|0),ga={};function ah(a,l,d,m,A){if(m&&m.once)return ch(a,l,d,m,A);if(Array.isArray(l)){for(var P=0;P<l.length;P++)ah(a,l[P],d,m,A);return null}return d=va(d),a&&a[jr]?a.K(l,d,h(m)?!!m.capture:!!m,A):uh(a,l,d,!1,m,A)}function uh(a,l,d,m,A,P){if(!l)throw Error("Invalid event type");var O=h(A)?!!A.capture:!!A,rt=ya(a);if(rt||(a[pa]=rt=new os(a)),d=rt.add(l,d,m,O,P),d.proxy)return d;if(m=bg(),d.proxy=m,m.src=a,m.listener=d,a.addEventListener)Ig||(A=O),A===void 0&&(A=!1),a.addEventListener(l.toString(),m,A);else if(a.attachEvent)a.attachEvent(hh(l.toString()),m);else if(a.addListener&&a.removeListener)a.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return d}function bg(){function a(d){return l.call(a.src,a.listener,d)}let l=Sg;return a}function ch(a,l,d,m,A){if(Array.isArray(l)){for(var P=0;P<l.length;P++)ch(a,l[P],d,m,A);return null}return d=va(d),a&&a[jr]?a.L(l,d,h(m)?!!m.capture:!!m,A):uh(a,l,d,!0,m,A)}function lh(a,l,d,m,A){if(Array.isArray(l))for(var P=0;P<l.length;P++)lh(a,l[P],d,m,A);else m=h(m)?!!m.capture:!!m,d=va(d),a&&a[jr]?(a=a.i,l=String(l).toString(),l in a.g&&(P=a.g[l],d=ma(P,d,m,A),-1<d&&(ss(P[d]),Array.prototype.splice.call(P,d,1),P.length==0&&(delete a.g[l],a.h--)))):a&&(a=ya(a))&&(l=a.g[l.toString()],a=-1,l&&(a=ma(l,d,m,A)),(d=-1<a?l[a]:null)&&_a(d))}function _a(a){if(typeof a!="number"&&a&&!a.da){var l=a.src;if(l&&l[jr])fa(l.i,a);else{var d=a.type,m=a.proxy;l.removeEventListener?l.removeEventListener(d,m,a.capture):l.detachEvent?l.detachEvent(hh(d),m):l.addListener&&l.removeListener&&l.removeListener(m),(d=ya(l))?(fa(d,a),d.h==0&&(d.src=null,l[pa]=null)):ss(a)}}}function hh(a){return a in ga?ga[a]:ga[a]="on"+a}function Sg(a,l){if(a.da)a=!0;else{l=new zr(l,this);var d=a.listener,m=a.ha||a.src;a.fa&&_a(a),a=d.call(m,l)}return a}function ya(a){return a=a[pa],a instanceof os?a:null}var wa="__closure_events_fn_"+(1e9*Math.random()>>>0);function va(a){return typeof a=="function"?a:(a[wa]||(a[wa]=function(l){return a.handleEvent(l)}),a[wa])}function kt(){Ve.call(this),this.i=new os(this),this.M=this,this.F=null}x(kt,Ve),kt.prototype[jr]=!0,kt.prototype.removeEventListener=function(a,l,d,m){lh(this,a,l,d,m)};function Mt(a,l){var d,m=a.F;if(m)for(d=[];m;m=m.F)d.push(m);if(a=a.M,m=l.type||l,typeof l=="string")l=new xt(l,a);else if(l instanceof xt)l.target=l.target||a;else{var A=l;l=new xt(m,a),T(l,A)}if(A=!0,d)for(var P=d.length-1;0<=P;P--){var O=l.g=d[P];A=as(O,m,!0,l)&&A}if(O=l.g=a,A=as(O,m,!0,l)&&A,A=as(O,m,!1,l)&&A,d)for(P=0;P<d.length;P++)O=l.g=d[P],A=as(O,m,!1,l)&&A}kt.prototype.N=function(){if(kt.aa.N.call(this),this.i){var a=this.i,l;for(l in a.g){for(var d=a.g[l],m=0;m<d.length;m++)ss(d[m]);delete a.g[l],a.h--}}this.F=null},kt.prototype.K=function(a,l,d,m){return this.i.add(String(a),l,!1,d,m)},kt.prototype.L=function(a,l,d,m){return this.i.add(String(a),l,!0,d,m)};function as(a,l,d,m){if(l=a.i.g[String(l)],!l)return!0;l=l.concat();for(var A=!0,P=0;P<l.length;++P){var O=l[P];if(O&&!O.da&&O.capture==d){var rt=O.listener,bt=O.ha||O.src;O.fa&&fa(a.i,O),A=rt.call(bt,m)!==!1&&A}}return A&&!m.defaultPrevented}function dh(a,l,d){if(typeof a=="function")d&&(a=_(a,d));else if(a&&typeof a.handleEvent=="function")a=_(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<Number(l)?-1:u.setTimeout(a,l||0)}function fh(a){a.g=dh(()=>{a.g=null,a.i&&(a.i=!1,fh(a))},a.l);let l=a.h;a.h=null,a.m.apply(null,l)}class Pg extends Ve{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:fh(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Gr(a){Ve.call(this),this.h=a,this.g={}}x(Gr,Ve);var mh=[];function ph(a){$(a.g,function(l,d){this.g.hasOwnProperty(d)&&_a(l)},a),a.g={}}Gr.prototype.N=function(){Gr.aa.N.call(this),ph(this)},Gr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ta=u.JSON.stringify,Cg=u.JSON.parse,xg=class{stringify(a){return u.JSON.stringify(a,void 0)}parse(a){return u.JSON.parse(a,void 0)}};function Ia(){}Ia.prototype.h=null;function gh(a){return a.h||(a.h=a.i())}function _h(){}var $r={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ea(){xt.call(this,"d")}x(Ea,xt);function Aa(){xt.call(this,"c")}x(Aa,xt);var cn={},yh=null;function us(){return yh=yh||new kt}cn.La="serverreachability";function wh(a){xt.call(this,cn.La,a)}x(wh,xt);function Kr(a){let l=us();Mt(l,new wh(l))}cn.STAT_EVENT="statevent";function vh(a,l){xt.call(this,cn.STAT_EVENT,a),this.stat=l}x(vh,xt);function Ft(a){let l=us();Mt(l,new vh(l,a))}cn.Ma="timingevent";function Th(a,l){xt.call(this,cn.Ma,a),this.size=l}x(Th,xt);function Wr(a,l){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){a()},l)}function Qr(){this.g=!0}Qr.prototype.xa=function(){this.g=!1};function kg(a,l,d,m,A,P){a.info(function(){if(a.g)if(P)for(var O="",rt=P.split("&"),bt=0;bt<rt.length;bt++){var J=rt[bt].split("=");if(1<J.length){var Dt=J[0];J=J[1];var Vt=Dt.split("_");O=2<=Vt.length&&Vt[1]=="type"?O+(Dt+"="+J+"&"):O+(Dt+"=redacted&")}}else O=null;else O=P;return"XMLHTTP REQ ("+m+") [attempt "+A+"]: "+l+`
`+d+`
`+O})}function Dg(a,l,d,m,A,P,O){a.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+A+"]: "+l+`
`+d+`
`+P+" "+O})}function Fn(a,l,d,m){a.info(function(){return"XMLHTTP TEXT ("+l+"): "+Ng(a,d)+(m?" "+m:"")})}function Vg(a,l){a.info(function(){return"TIMEOUT: "+l})}Qr.prototype.info=function(){};function Ng(a,l){if(!a.g)return l;if(!l)return null;try{var d=JSON.parse(l);if(d){for(a=0;a<d.length;a++)if(Array.isArray(d[a])){var m=d[a];if(!(2>m.length)){var A=m[1];if(Array.isArray(A)&&!(1>A.length)){var P=A[0];if(P!="noop"&&P!="stop"&&P!="close")for(var O=1;O<A.length;O++)A[O]=""}}}}return Ta(d)}catch{return l}}var cs={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ih={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ra;function ls(){}x(ls,Ia),ls.prototype.g=function(){return new XMLHttpRequest},ls.prototype.i=function(){return{}},Ra=new ls;function Ne(a,l,d,m){this.j=a,this.i=l,this.l=d,this.R=m||1,this.U=new Gr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Eh}function Eh(){this.i=null,this.g="",this.h=!1}var Ah={},ba={};function Sa(a,l,d){a.L=1,a.v=ms(ve(l)),a.m=d,a.P=!0,Rh(a,null)}function Rh(a,l){a.F=Date.now(),hs(a),a.A=ve(a.v);var d=a.A,m=a.R;Array.isArray(m)||(m=[String(m)]),Uh(d.i,"t",m),a.C=0,d=a.j.J,a.h=new Eh,a.g=rd(a.j,d?l:null,!a.m),0<a.O&&(a.M=new Pg(_(a.Y,a,a.g),a.O)),l=a.U,d=a.g,m=a.ca;var A="readystatechange";Array.isArray(A)||(A&&(mh[0]=A.toString()),A=mh);for(var P=0;P<A.length;P++){var O=ah(d,A[P],m||l.handleEvent,!1,l.h||l);if(!O)break;l.g[O.key]=O}l=a.H?g(a.H):{},a.m?(a.u||(a.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.m,l)):(a.u="GET",a.g.ea(a.A,a.u,null,l)),Kr(),kg(a.i,a.u,a.A,a.l,a.R,a.m)}Ne.prototype.ca=function(a){a=a.target;let l=this.M;l&&Te(a)==3?l.j():this.Y(a)},Ne.prototype.Y=function(a){try{if(a==this.g)t:{let Vt=Te(this.g);var l=this.g.Ba();let qn=this.g.Z();if(!(3>Vt)&&(Vt!=3||this.g&&(this.h.h||this.g.oa()||Kh(this.g)))){this.J||Vt!=4||l==7||(l==8||0>=qn?Kr(3):Kr(2)),Pa(this);var d=this.g.Z();this.X=d;e:if(bh(this)){var m=Kh(this.g);a="";var A=m.length,P=Te(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ln(this),Hr(this);var O="";break e}this.h.i=new u.TextDecoder}for(l=0;l<A;l++)this.h.h=!0,a+=this.h.i.decode(m[l],{stream:!(P&&l==A-1)});m.length=0,this.h.g+=a,this.C=0,O=this.h.g}else O=this.g.oa();if(this.o=d==200,Dg(this.i,this.u,this.A,this.l,this.R,Vt,d),this.o){if(this.T&&!this.K){e:{if(this.g){var rt,bt=this.g;if((rt=bt.g?bt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!z(rt)){var J=rt;break e}}J=null}if(d=J)Fn(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ca(this,d);else{this.o=!1,this.s=3,Ft(12),ln(this),Hr(this);break t}}if(this.P){d=!0;let ee;for(;!this.J&&this.C<O.length;)if(ee=Og(this,O),ee==ba){Vt==4&&(this.s=4,Ft(14),d=!1),Fn(this.i,this.l,null,"[Incomplete Response]");break}else if(ee==Ah){this.s=4,Ft(15),Fn(this.i,this.l,O,"[Invalid Chunk]"),d=!1;break}else Fn(this.i,this.l,ee,null),Ca(this,ee);if(bh(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Vt!=4||O.length!=0||this.h.h||(this.s=1,Ft(16),d=!1),this.o=this.o&&d,!d)Fn(this.i,this.l,O,"[Invalid Chunked Response]"),ln(this),Hr(this);else if(0<O.length&&!this.W){this.W=!0;var Dt=this.j;Dt.g==this&&Dt.ba&&!Dt.M&&(Dt.j.info("Great, no buffering proxy detected. Bytes received: "+O.length),Oa(Dt),Dt.M=!0,Ft(11))}}else Fn(this.i,this.l,O,null),Ca(this,O);Vt==4&&ln(this),this.o&&!this.J&&(Vt==4?Zh(this.j,this):(this.o=!1,hs(this)))}else Jg(this.g),d==400&&0<O.indexOf("Unknown SID")?(this.s=3,Ft(12)):(this.s=0,Ft(13)),ln(this),Hr(this)}}}catch{}finally{}};function bh(a){return a.g?a.u=="GET"&&a.L!=2&&a.j.Ca:!1}function Og(a,l){var d=a.C,m=l.indexOf(`
`,d);return m==-1?ba:(d=Number(l.substring(d,m)),isNaN(d)?Ah:(m+=1,m+d>l.length?ba:(l=l.slice(m,m+d),a.C=m+d,l)))}Ne.prototype.cancel=function(){this.J=!0,ln(this)};function hs(a){a.S=Date.now()+a.I,Sh(a,a.I)}function Sh(a,l){if(a.B!=null)throw Error("WatchDog timer not null");a.B=Wr(_(a.ba,a),l)}function Pa(a){a.B&&(u.clearTimeout(a.B),a.B=null)}Ne.prototype.ba=function(){this.B=null;let a=Date.now();0<=a-this.S?(Vg(this.i,this.A),this.L!=2&&(Kr(),Ft(17)),ln(this),this.s=2,Hr(this)):Sh(this,this.S-a)};function Hr(a){a.j.G==0||a.J||Zh(a.j,a)}function ln(a){Pa(a);var l=a.M;l&&typeof l.ma=="function"&&l.ma(),a.M=null,ph(a.U),a.g&&(l=a.g,a.g=null,l.abort(),l.ma())}function Ca(a,l){try{var d=a.j;if(d.G!=0&&(d.g==a||xa(d.h,a))){if(!a.K&&xa(d.h,a)&&d.G==3){try{var m=d.Da.g.parse(l)}catch{m=null}if(Array.isArray(m)&&m.length==3){var A=m;if(A[0]==0){t:if(!d.u){if(d.g)if(d.g.F+3e3<a.F)ws(d),_s(d);else break t;Na(d),Ft(18)}}else d.za=A[1],0<d.za-d.T&&37500>A[2]&&d.F&&d.v==0&&!d.C&&(d.C=Wr(_(d.Za,d),6e3));if(1>=xh(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else dn(d,11)}else if((a.K||d.g==a)&&ws(d),!z(l))for(A=d.Da.g.parse(l),l=0;l<A.length;l++){let J=A[l];if(d.T=J[0],J=J[1],d.G==2)if(J[0]=="c"){d.K=J[1],d.ia=J[2];let Dt=J[3];Dt!=null&&(d.la=Dt,d.j.info("VER="+d.la));let Vt=J[4];Vt!=null&&(d.Aa=Vt,d.j.info("SVER="+d.Aa));let qn=J[5];qn!=null&&typeof qn=="number"&&0<qn&&(m=1.5*qn,d.L=m,d.j.info("backChannelRequestTimeoutMs_="+m)),m=d;let ee=a.g;if(ee){let Ts=ee.g?ee.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ts){var P=m.h;P.g||Ts.indexOf("spdy")==-1&&Ts.indexOf("quic")==-1&&Ts.indexOf("h2")==-1||(P.j=P.l,P.g=new Set,P.h&&(ka(P,P.h),P.h=null))}if(m.D){let La=ee.g?ee.g.getResponseHeader("X-HTTP-Session-Id"):null;La&&(m.ya=La,st(m.I,m.D,La))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-a.F,d.j.info("Handshake RTT: "+d.R+"ms")),m=d;var O=a;if(m.qa=nd(m,m.J?m.ia:null,m.W),O.K){kh(m.h,O);var rt=O,bt=m.L;bt&&(rt.I=bt),rt.B&&(Pa(rt),hs(rt)),m.g=O}else Yh(m);0<d.i.length&&ys(d)}else J[0]!="stop"&&J[0]!="close"||dn(d,7);else d.G==3&&(J[0]=="stop"||J[0]=="close"?J[0]=="stop"?dn(d,7):Va(d):J[0]!="noop"&&d.l&&d.l.ta(J),d.v=0)}}Kr(4)}catch{}}var Lg=class{constructor(a,l){this.g=a,this.map=l}};function Ph(a){this.l=a||10,u.PerformanceNavigationTiming?(a=u.performance.getEntriesByType("navigation"),a=0<a.length&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ch(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function xh(a){return a.h?1:a.g?a.g.size:0}function xa(a,l){return a.h?a.h==l:a.g?a.g.has(l):!1}function ka(a,l){a.g?a.g.add(l):a.h=l}function kh(a,l){a.h&&a.h==l?a.h=null:a.g&&a.g.has(l)&&a.g.delete(l)}Ph.prototype.cancel=function(){if(this.i=Dh(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let a of this.g.values())a.cancel();this.g.clear()}};function Dh(a){if(a.h!=null)return a.i.concat(a.h.D);if(a.g!=null&&a.g.size!==0){let l=a.i;for(let d of a.g.values())l=l.concat(d.D);return l}return D(a.i)}function Mg(a){if(a.V&&typeof a.V=="function")return a.V();if(typeof Map<"u"&&a instanceof Map||typeof Set<"u"&&a instanceof Set)return Array.from(a.values());if(typeof a=="string")return a.split("");if(c(a)){for(var l=[],d=a.length,m=0;m<d;m++)l.push(a[m]);return l}l=[],d=0;for(m in a)l[d++]=a[m];return l}function Fg(a){if(a.na&&typeof a.na=="function")return a.na();if(!a.V||typeof a.V!="function"){if(typeof Map<"u"&&a instanceof Map)return Array.from(a.keys());if(!(typeof Set<"u"&&a instanceof Set)){if(c(a)||typeof a=="string"){var l=[];a=a.length;for(var d=0;d<a;d++)l.push(d);return l}l=[],d=0;for(let m in a)l[d++]=m;return l}}}function Vh(a,l){if(a.forEach&&typeof a.forEach=="function")a.forEach(l,void 0);else if(c(a)||typeof a=="string")Array.prototype.forEach.call(a,l,void 0);else for(var d=Fg(a),m=Mg(a),A=m.length,P=0;P<A;P++)l.call(void 0,m[P],d&&d[P],a)}var Nh=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ug(a,l){if(a){a=a.split("&");for(var d=0;d<a.length;d++){var m=a[d].indexOf("="),A=null;if(0<=m){var P=a[d].substring(0,m);A=a[d].substring(m+1)}else P=a[d];l(P,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}function hn(a){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,a instanceof hn){this.h=a.h,ds(this,a.j),this.o=a.o,this.g=a.g,fs(this,a.s),this.l=a.l;var l=a.i,d=new Jr;d.i=l.i,l.g&&(d.g=new Map(l.g),d.h=l.h),Oh(this,d),this.m=a.m}else a&&(l=String(a).match(Nh))?(this.h=!1,ds(this,l[1]||"",!0),this.o=Xr(l[2]||""),this.g=Xr(l[3]||"",!0),fs(this,l[4]),this.l=Xr(l[5]||"",!0),Oh(this,l[6]||"",!0),this.m=Xr(l[7]||"")):(this.h=!1,this.i=new Jr(null,this.h))}hn.prototype.toString=function(){var a=[],l=this.j;l&&a.push(Yr(l,Lh,!0),":");var d=this.g;return(d||l=="file")&&(a.push("//"),(l=this.o)&&a.push(Yr(l,Lh,!0),"@"),a.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.s,d!=null&&a.push(":",String(d))),(d=this.l)&&(this.g&&d.charAt(0)!="/"&&a.push("/"),a.push(Yr(d,d.charAt(0)=="/"?zg:qg,!0))),(d=this.i.toString())&&a.push("?",d),(d=this.m)&&a.push("#",Yr(d,Gg)),a.join("")};function ve(a){return new hn(a)}function ds(a,l,d){a.j=d?Xr(l,!0):l,a.j&&(a.j=a.j.replace(/:$/,""))}function fs(a,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);a.s=l}else a.s=null}function Oh(a,l,d){l instanceof Jr?(a.i=l,$g(a.i,a.h)):(d||(l=Yr(l,jg)),a.i=new Jr(l,a.h))}function st(a,l,d){a.i.set(l,d)}function ms(a){return st(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function Xr(a,l){return a?l?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function Yr(a,l,d){return typeof a=="string"?(a=encodeURI(a).replace(l,Bg),d&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function Bg(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var Lh=/[#\/\?@]/g,qg=/[#\?:]/g,zg=/[#\?]/g,jg=/[#\?@]/g,Gg=/#/g;function Jr(a,l){this.h=this.g=null,this.i=a||null,this.j=!!l}function Oe(a){a.g||(a.g=new Map,a.h=0,a.i&&Ug(a.i,function(l,d){a.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}n=Jr.prototype,n.add=function(a,l){Oe(this),this.i=null,a=Un(this,a);var d=this.g.get(a);return d||this.g.set(a,d=[]),d.push(l),this.h+=1,this};function Mh(a,l){Oe(a),l=Un(a,l),a.g.has(l)&&(a.i=null,a.h-=a.g.get(l).length,a.g.delete(l))}function Fh(a,l){return Oe(a),l=Un(a,l),a.g.has(l)}n.forEach=function(a,l){Oe(this),this.g.forEach(function(d,m){d.forEach(function(A){a.call(l,A,m,this)},this)},this)},n.na=function(){Oe(this);let a=Array.from(this.g.values()),l=Array.from(this.g.keys()),d=[];for(let m=0;m<l.length;m++){let A=a[m];for(let P=0;P<A.length;P++)d.push(l[m])}return d},n.V=function(a){Oe(this);let l=[];if(typeof a=="string")Fh(this,a)&&(l=l.concat(this.g.get(Un(this,a))));else{a=Array.from(this.g.values());for(let d=0;d<a.length;d++)l=l.concat(a[d])}return l},n.set=function(a,l){return Oe(this),this.i=null,a=Un(this,a),Fh(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[l]),this.h+=1,this},n.get=function(a,l){return a?(a=this.V(a),0<a.length?String(a[0]):l):l};function Uh(a,l,d){Mh(a,l),0<d.length&&(a.i=null,a.g.set(Un(a,l),D(d)),a.h+=d.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let a=[],l=Array.from(this.g.keys());for(var d=0;d<l.length;d++){var m=l[d];let P=encodeURIComponent(String(m)),O=this.V(m);for(m=0;m<O.length;m++){var A=P;O[m]!==""&&(A+="="+encodeURIComponent(String(O[m]))),a.push(A)}}return this.i=a.join("&")};function Un(a,l){return l=String(l),a.j&&(l=l.toLowerCase()),l}function $g(a,l){l&&!a.j&&(Oe(a),a.i=null,a.g.forEach(function(d,m){var A=m.toLowerCase();m!=A&&(Mh(this,m),Uh(this,A,d))},a)),a.j=l}function Kg(a,l){let d=new Qr;if(u.Image){let m=new Image;m.onload=E(Le,d,"TestLoadImage: loaded",!0,l,m),m.onerror=E(Le,d,"TestLoadImage: error",!1,l,m),m.onabort=E(Le,d,"TestLoadImage: abort",!1,l,m),m.ontimeout=E(Le,d,"TestLoadImage: timeout",!1,l,m),u.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=a}else l(!1)}function Wg(a,l){let d=new Qr,m=new AbortController,A=setTimeout(()=>{m.abort(),Le(d,"TestPingServer: timeout",!1,l)},1e4);fetch(a,{signal:m.signal}).then(P=>{clearTimeout(A),P.ok?Le(d,"TestPingServer: ok",!0,l):Le(d,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(A),Le(d,"TestPingServer: error",!1,l)})}function Le(a,l,d,m,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),m(d)}catch{}}function Qg(){this.g=new xg}function Hg(a,l,d){let m=d||"";try{Vh(a,function(A,P){let O=A;h(A)&&(O=Ta(A)),l.push(m+P+"="+encodeURIComponent(O))})}catch(A){throw l.push(m+"type="+encodeURIComponent("_badmap")),A}}function Zr(a){this.l=a.Ub||null,this.j=a.eb||!1}x(Zr,Ia),Zr.prototype.g=function(){return new ps(this.l,this.j)},Zr.prototype.i=function(a){return function(){return a}}({});function ps(a,l){kt.call(this),this.D=a,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}x(ps,kt),n=ps.prototype,n.open=function(a,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=a,this.A=l,this.readyState=1,ei(this)},n.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};a&&(l.body=a),(this.D||u).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ti(this)),this.readyState=0},n.Sa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,ei(this)),this.g&&(this.readyState=3,ei(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Bh(this)}else a.text().then(this.Ra.bind(this),this.ga.bind(this))};function Bh(a){a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a))}n.Pa=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var l=a.value?a.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!a.done}))&&(this.response=this.responseText+=l)}a.done?ti(this):ei(this),this.readyState==3&&Bh(this)}},n.Ra=function(a){this.g&&(this.response=this.responseText=a,ti(this))},n.Qa=function(a){this.g&&(this.response=a,ti(this))},n.ga=function(){this.g&&ti(this)};function ti(a){a.readyState=4,a.l=null,a.j=null,a.v=null,ei(a)}n.setRequestHeader=function(a,l){this.u.append(a,l)},n.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let a=[],l=this.h.entries();for(var d=l.next();!d.done;)d=d.value,a.push(d[0]+": "+d[1]),d=l.next();return a.join(`\r
`)};function ei(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(ps.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function qh(a){let l="";return $(a,function(d,m){l+=m,l+=":",l+=d,l+=`\r
`}),l}function Da(a,l,d){t:{for(m in d){var m=!1;break t}m=!0}m||(d=qh(d),typeof a=="string"?d!=null&&encodeURIComponent(String(d)):st(a,l,d))}function ht(a){kt.call(this),this.headers=new Map,this.o=a||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}x(ht,kt);var Xg=/^https?$/i,Yg=["POST","PUT"];n=ht.prototype,n.Ha=function(a){this.J=a},n.ea=function(a,l,d,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);l=l?l.toUpperCase():"GET",this.D=a,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ra.g(),this.v=this.o?gh(this.o):gh(Ra),this.g.onreadystatechange=_(this.Ea,this);try{this.B=!0,this.g.open(l,String(a),!0),this.B=!1}catch(P){zh(this,P);return}if(a=d||"",d=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var A in m)d.set(A,m[A]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(let P of m.keys())d.set(P,m.get(P));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(d.keys()).find(P=>P.toLowerCase()=="content-type"),A=u.FormData&&a instanceof u.FormData,!(0<=Array.prototype.indexOf.call(Yg,l,void 0))||m||A||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[P,O]of d)this.g.setRequestHeader(P,O);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{$h(this),this.u=!0,this.g.send(a),this.u=!1}catch(P){zh(this,P)}};function zh(a,l){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=l,a.m=5,jh(a),gs(a)}function jh(a){a.A||(a.A=!0,Mt(a,"complete"),Mt(a,"error"))}n.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=a||7,Mt(this,"complete"),Mt(this,"abort"),gs(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),gs(this,!0)),ht.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Gh(this):this.bb())},n.bb=function(){Gh(this)};function Gh(a){if(a.h&&typeof o<"u"&&(!a.v[1]||Te(a)!=4||a.Z()!=2)){if(a.u&&Te(a)==4)dh(a.Ea,0,a);else if(Mt(a,"readystatechange"),Te(a)==4){a.h=!1;try{let O=a.Z();t:switch(O){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break t;default:l=!1}var d;if(!(d=l)){var m;if(m=O===0){var A=String(a.D).match(Nh)[1]||null;!A&&u.self&&u.self.location&&(A=u.self.location.protocol.slice(0,-1)),m=!Xg.test(A?A.toLowerCase():"")}d=m}if(d)Mt(a,"complete"),Mt(a,"success");else{a.m=6;try{var P=2<Te(a)?a.g.statusText:""}catch{P=""}a.l=P+" ["+a.Z()+"]",jh(a)}}finally{gs(a)}}}}function gs(a,l){if(a.g){$h(a);let d=a.g,m=a.v[0]?()=>{}:null;a.g=null,a.v=null,l||Mt(a,"ready");try{d.onreadystatechange=m}catch{}}}function $h(a){a.I&&(u.clearTimeout(a.I),a.I=null)}n.isActive=function(){return!!this.g};function Te(a){return a.g?a.g.readyState:0}n.Z=function(){try{return 2<Te(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(a){if(this.g){var l=this.g.responseText;return a&&l.indexOf(a)==0&&(l=l.substring(a.length)),Cg(l)}};function Kh(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.H){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function Jg(a){let l={};a=(a.g&&2<=Te(a)&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<a.length;m++){if(z(a[m]))continue;var d=I(a[m]);let A=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();let P=l[A]||[];l[A]=P,P.push(d)}v(l,function(m){return m.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ni(a,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[a]||l}function Wh(a){this.Aa=0,this.i=[],this.j=new Qr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ni("failFast",!1,a),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ni("baseRetryDelayMs",5e3,a),this.cb=ni("retryDelaySeedMs",1e4,a),this.Wa=ni("forwardChannelMaxRetries",2,a),this.wa=ni("forwardChannelRequestTimeoutMs",2e4,a),this.pa=a&&a.xmlHttpFactory||void 0,this.Xa=a&&a.Tb||void 0,this.Ca=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.h=new Ph(a&&a.concurrentRequestLimit),this.Da=new Qg,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=a&&a.Rb||!1,a&&a.xa&&this.j.xa(),a&&a.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&a&&a.detectBufferingProxy||!1,this.ja=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.ja=a.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Wh.prototype,n.la=8,n.G=1,n.connect=function(a,l,d,m){Ft(0),this.W=a,this.H=l||{},d&&m!==void 0&&(this.H.OSID=d,this.H.OAID=m),this.F=this.X,this.I=nd(this,null,this.W),ys(this)};function Va(a){if(Qh(a),a.G==3){var l=a.U++,d=ve(a.I);if(st(d,"SID",a.K),st(d,"RID",l),st(d,"TYPE","terminate"),ri(a,d),l=new Ne(a,a.j,l),l.L=2,l.v=ms(ve(d)),d=!1,u.navigator&&u.navigator.sendBeacon)try{d=u.navigator.sendBeacon(l.v.toString(),"")}catch{}!d&&u.Image&&(new Image().src=l.v,d=!0),d||(l.g=rd(l.j,null),l.g.ea(l.v)),l.F=Date.now(),hs(l)}ed(a)}function _s(a){a.g&&(Oa(a),a.g.cancel(),a.g=null)}function Qh(a){_s(a),a.u&&(u.clearTimeout(a.u),a.u=null),ws(a),a.h.cancel(),a.s&&(typeof a.s=="number"&&u.clearTimeout(a.s),a.s=null)}function ys(a){if(!Ch(a.h)&&!a.s){a.s=!0;var l=a.Ga;Br||oh(),qr||(Br(),qr=!0),da.add(l,a),a.B=0}}function Zg(a,l){return xh(a.h)>=a.h.j-(a.s?1:0)?!1:a.s?(a.i=l.D.concat(a.i),!0):a.G==1||a.G==2||a.B>=(a.Va?0:a.Wa)?!1:(a.s=Wr(_(a.Ga,a,l),td(a,a.B)),a.B++,!0)}n.Ga=function(a){if(this.s)if(this.s=null,this.G==1){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;let A=new Ne(this,this.j,a),P=this.o;if(this.S&&(P?(P=g(P),T(P,this.S)):P=this.S),this.m!==null||this.O||(A.H=P,P=null),this.P)t:{for(var l=0,d=0;d<this.i.length;d++){e:{var m=this.i[d];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break e}m=void 0}if(m===void 0)break;if(l+=m,4096<l){l=d;break t}if(l===4096||d===this.i.length-1){l=d+1;break t}}l=1e3}else l=1e3;l=Xh(this,A,l),d=ve(this.I),st(d,"RID",a),st(d,"CVER",22),this.D&&st(d,"X-HTTP-Session-Id",this.D),ri(this,d),P&&(this.O?l="headers="+encodeURIComponent(String(qh(P)))+"&"+l:this.m&&Da(d,this.m,P)),ka(this.h,A),this.Ua&&st(d,"TYPE","init"),this.P?(st(d,"$req",l),st(d,"SID","null"),A.T=!0,Sa(A,d,null)):Sa(A,d,l),this.G=2}}else this.G==3&&(a?Hh(this,a):this.i.length==0||Ch(this.h)||Hh(this))};function Hh(a,l){var d;l?d=l.l:d=a.U++;let m=ve(a.I);st(m,"SID",a.K),st(m,"RID",d),st(m,"AID",a.T),ri(a,m),a.m&&a.o&&Da(m,a.m,a.o),d=new Ne(a,a.j,d,a.B+1),a.m===null&&(d.H=a.o),l&&(a.i=l.D.concat(a.i)),l=Xh(a,d,1e3),d.I=Math.round(.5*a.wa)+Math.round(.5*a.wa*Math.random()),ka(a.h,d),Sa(d,m,l)}function ri(a,l){a.H&&$(a.H,function(d,m){st(l,m,d)}),a.l&&Vh({},function(d,m){st(l,m,d)})}function Xh(a,l,d){d=Math.min(a.i.length,d);var m=a.l?_(a.l.Na,a.l,a):null;t:{var A=a.i;let P=-1;for(;;){let O=["count="+d];P==-1?0<d?(P=A[0].g,O.push("ofs="+P)):P=0:O.push("ofs="+P);let rt=!0;for(let bt=0;bt<d;bt++){let J=A[bt].g,Dt=A[bt].map;if(J-=P,0>J)P=Math.max(0,A[bt].g-100),rt=!1;else try{Hg(Dt,O,"req"+J+"_")}catch{m&&m(Dt)}}if(rt){m=O.join("&");break t}}}return a=a.i.splice(0,d),l.D=a,m}function Yh(a){if(!a.g&&!a.u){a.Y=1;var l=a.Fa;Br||oh(),qr||(Br(),qr=!0),da.add(l,a),a.v=0}}function Na(a){return a.g||a.u||3<=a.v?!1:(a.Y++,a.u=Wr(_(a.Fa,a),td(a,a.v)),a.v++,!0)}n.Fa=function(){if(this.u=null,Jh(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var a=2*this.R;this.j.info("BP detection timer enabled: "+a),this.A=Wr(_(this.ab,this),a)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ft(10),_s(this),Jh(this))};function Oa(a){a.A!=null&&(u.clearTimeout(a.A),a.A=null)}function Jh(a){a.g=new Ne(a,a.j,"rpc",a.Y),a.m===null&&(a.g.H=a.o),a.g.O=0;var l=ve(a.qa);st(l,"RID","rpc"),st(l,"SID",a.K),st(l,"AID",a.T),st(l,"CI",a.F?"0":"1"),!a.F&&a.ja&&st(l,"TO",a.ja),st(l,"TYPE","xmlhttp"),ri(a,l),a.m&&a.o&&Da(l,a.m,a.o),a.L&&(a.g.I=a.L);var d=a.g;a=a.ia,d.L=1,d.v=ms(ve(l)),d.m=null,d.P=!0,Rh(d,a)}n.Za=function(){this.C!=null&&(this.C=null,_s(this),Na(this),Ft(19))};function ws(a){a.C!=null&&(u.clearTimeout(a.C),a.C=null)}function Zh(a,l){var d=null;if(a.g==l){ws(a),Oa(a),a.g=null;var m=2}else if(xa(a.h,l))d=l.D,kh(a.h,l),m=1;else return;if(a.G!=0){if(l.o)if(m==1){d=l.m?l.m.length:0,l=Date.now()-l.F;var A=a.B;m=us(),Mt(m,new Th(m,d)),ys(a)}else Yh(a);else if(A=l.s,A==3||A==0&&0<l.X||!(m==1&&Zg(a,l)||m==2&&Na(a)))switch(d&&0<d.length&&(l=a.h,l.i=l.i.concat(d)),A){case 1:dn(a,5);break;case 4:dn(a,10);break;case 3:dn(a,6);break;default:dn(a,2)}}}function td(a,l){let d=a.Ta+Math.floor(Math.random()*a.cb);return a.isActive()||(d*=2),d*l}function dn(a,l){if(a.j.info("Error code "+l),l==2){var d=_(a.fb,a),m=a.Xa;let A=!m;m=new hn(m||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||ds(m,"https"),ms(m),A?Kg(m.toString(),d):Wg(m.toString(),d)}else Ft(2);a.G=0,a.l&&a.l.sa(l),ed(a),Qh(a)}n.fb=function(a){a?(this.j.info("Successfully pinged google.com"),Ft(2)):(this.j.info("Failed to ping google.com"),Ft(1))};function ed(a){if(a.G=0,a.ka=[],a.l){let l=Dh(a.h);(l.length!=0||a.i.length!=0)&&(k(a.ka,l),k(a.ka,a.i),a.h.i.length=0,D(a.i),a.i.length=0),a.l.ra()}}function nd(a,l,d){var m=d instanceof hn?ve(d):new hn(d);if(m.g!="")l&&(m.g=l+"."+m.g),fs(m,m.s);else{var A=u.location;m=A.protocol,l=l?l+"."+A.hostname:A.hostname,A=+A.port;var P=new hn(null);m&&ds(P,m),l&&(P.g=l),A&&fs(P,A),d&&(P.l=d),m=P}return d=a.D,l=a.ya,d&&l&&st(m,d,l),st(m,"VER",a.la),ri(a,m),m}function rd(a,l,d){if(l&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return l=a.Ca&&!a.pa?new ht(new Zr({eb:d})):new ht(a.pa),l.Ha(a.J),l}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function id(){}n=id.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function vs(){}vs.prototype.g=function(a,l){return new Ht(a,l)};function Ht(a,l){kt.call(this),this.g=new Wh(l),this.l=a,this.h=l&&l.messageUrlParams||null,a=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(a?a["X-WebChannel-Content-Type"]=l.messageContentType:a={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(a?a["X-WebChannel-Client-Profile"]=l.va:a={"X-WebChannel-Client-Profile":l.va}),this.g.S=a,(a=l&&l.Sb)&&!z(a)&&(this.g.m=a),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!z(l)&&(this.g.D=l,a=this.h,a!==null&&l in a&&(a=this.h,l in a&&delete a[l])),this.j=new Bn(this)}x(Ht,kt),Ht.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ht.prototype.close=function(){Va(this.g)},Ht.prototype.o=function(a){var l=this.g;if(typeof a=="string"){var d={};d.__data__=a,a=d}else this.u&&(d={},d.__data__=Ta(a),a=d);l.i.push(new Lg(l.Ya++,a)),l.G==3&&ys(l)},Ht.prototype.N=function(){this.g.l=null,delete this.j,Va(this.g),delete this.g,Ht.aa.N.call(this)};function sd(a){Ea.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var l=a.__sm__;if(l){t:{for(let d in l){a=d;break t}a=void 0}(this.i=a)&&(a=this.i,l=l!==null&&a in l?l[a]:void 0),this.data=l}else this.data=a}x(sd,Ea);function od(){Aa.call(this),this.status=1}x(od,Aa);function Bn(a){this.g=a}x(Bn,id),Bn.prototype.ua=function(){Mt(this.g,"a")},Bn.prototype.ta=function(a){Mt(this.g,new sd(a))},Bn.prototype.sa=function(a){Mt(this.g,new od)},Bn.prototype.ra=function(){Mt(this.g,"b")},vs.prototype.createWebChannel=vs.prototype.g,Ht.prototype.send=Ht.prototype.o,Ht.prototype.open=Ht.prototype.m,Ht.prototype.close=Ht.prototype.close,Iu=Ae.createWebChannelTransport=function(){return new vs},Tu=Ae.getStatEventTarget=function(){return us()},vu=Ae.Event=cn,Qs=Ae.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},cs.NO_ERROR=0,cs.TIMEOUT=8,cs.HTTP_ERROR=6,_i=Ae.ErrorCode=cs,Ih.COMPLETE="complete",wu=Ae.EventType=Ih,_h.EventType=$r,$r.OPEN="a",$r.CLOSE="b",$r.ERROR="c",$r.MESSAGE="d",kt.prototype.listen=kt.prototype.K,tr=Ae.WebChannel=_h,yu=Ae.FetchXmlHttpFactory=Zr,ht.prototype.listenOnce=ht.prototype.L,ht.prototype.getLastError=ht.prototype.Ka,ht.prototype.getLastErrorCode=ht.prototype.Ba,ht.prototype.getStatus=ht.prototype.Z,ht.prototype.getResponseJson=ht.prototype.Oa,ht.prototype.getResponseText=ht.prototype.oa,ht.prototype.send=ht.prototype.ea,ht.prototype.setWithCredentials=ht.prototype.Ha,_u=Ae.XhrIo=ht}).apply(typeof Ws<"u"?Ws:typeof self<"u"?self:typeof window<"u"?window:{});var Df="@firebase/firestore";var Tt=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};Tt.UNAUTHENTICATED=new Tt(null),Tt.GOOGLE_CREDENTIALS=new Tt("google-credentials-uid"),Tt.FIRST_PARTY=new Tt("first-party-uid"),Tt.MOCK_USER=new Tt("mock-user");var Vr="10.13.1";var We=new Pd("@firebase/firestore");function sr(){return We.logLevel}function WE(n){We.setLogLevel(n)}function V(n,...t){if(We.logLevel<=ue.DEBUG){let e=t.map(Sl);We.debug(`Firestore (${Vr}): ${n}`,...e)}}function mt(n,...t){if(We.logLevel<=ue.ERROR){let e=t.map(Sl);We.error(`Firestore (${Vr}): ${n}`,...e)}}function pe(n,...t){if(We.logLevel<=ue.WARN){let e=t.map(Sl);We.warn(`Firestore (${Vr}): ${n}`,...e)}}function Sl(n){if(typeof n=="string")return n;try{return function(e){return JSON.stringify(e)}(n)}catch{return n}}function U(n="Unexpected state"){let t=`FIRESTORE (${Vr}) INTERNAL ASSERTION FAILED: `+n;throw mt(t),new Error(t)}function q(n,t){n||U()}function QE(n,t){n||U()}function L(n,t){return n}var S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},N=class extends Cs{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var It=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var so=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},Su=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(Tt.UNAUTHENTICATED))}shutdown(){}},Pu=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},Cu=class{constructor(t){this.t=t,this.currentUser=Tt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let r=this.i,i=c=>this.i!==r?(r=this.i,e(c)):Promise.resolve(),s=new It;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new It,t.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let c=s;t.enqueueRetryable(()=>C(this,null,function*(){yield c.promise,yield i(this.currentUser)}))},u=c=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?u(c):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new It)}},0),o()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(r=>this.i!==t?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(q(typeof r.accessToken=="string"),new so(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let t=this.auth&&this.auth.getUid();return q(t===null||typeof t=="string"),new Tt(t)}},xu=class{constructor(t,e,r){this.l=t,this.h=e,this.P=r,this.type="FirstParty",this.user=Tt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},ku=class{constructor(t,e,r){this.l=t,this.h=e,this.P=r}getToken(){return Promise.resolve(new xu(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable(()=>e(Tt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Du=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Vu=class{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){let r=s=>{s.error!=null&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,V("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?e(s.token):Promise.resolve()};this.o=s=>{t.enqueueRetryable(()=>r(s))};let i=s=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(q(typeof e.token=="string"),this.R=e.token,new Du(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function Kw(n){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let r=0;r<n;r++)e[r]=Math.floor(256*Math.random());return e}var oo=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,r="";for(;r.length<20;){let i=Kw(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<e&&(r+=t.charAt(i[s]%t.length))}return r}};function K(n,t){return n<t?-1:n>t?1:0}function pr(n,t,e){return n.length===t.length&&n.every((r,i)=>e(r,t[i]))}function Om(n){return n+"\0"}var pt=class n{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new N(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new N(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new N(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new N(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return n.fromMillis(Date.now())}static fromDate(t){return n.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),r=Math.floor(1e6*(t-1e3*e));return new n(e,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?K(this.nanoseconds,t.nanoseconds):K(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var j=class n{constructor(t){this.timestamp=t}static fromTimestamp(t){return new n(t)}static min(){return new n(new pt(0,0))}static max(){return new n(new pt(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var ao=class n{constructor(t,e,r){e===void 0?e=0:e>t.length&&U(),r===void 0?r=t.length-e:r>t.length-e&&U(),this.segments=t,this.offset=e,this.len=r}get length(){return this.len}isEqual(t){return n.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof n?t.forEach(r=>{e.push(r)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,r=this.limit();e<r;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let r=Math.min(t.length,e.length);for(let i=0;i<r;i++){let s=t.get(i),o=e.get(i);if(s<o)return-1;if(s>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0}},Y=class n extends ao{construct(t,e,r){return new n(t,e,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let r of t){if(r.indexOf("//")>=0)throw new N(S.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);e.push(...r.split("/").filter(i=>i.length>0))}return new n(e)}static emptyPath(){return new n([])}},Ww=/^[_a-zA-Z][_a-zA-Z0-9]*$/,At=class n extends ao{construct(t,e,r){return new n(t,e,r)}static isValidIdentifier(t){return Ww.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(t){let e=[],r="",i=0,s=()=>{if(r.length===0)throw new N(S.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""},o=!1;for(;i<t.length;){let u=t[i];if(u==="\\"){if(i+1===t.length)throw new N(S.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let c=t[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new N(S.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=c,i+=2}else u==="`"?(o=!o,i++):u!=="."||o?(r+=u,i++):(s(),i++)}if(s(),o)throw new N(S.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)}static emptyPath(){return new n([])}};var M=class n{constructor(t){this.path=t}static fromPath(t){return new n(Y.fromString(t))}static fromName(t){return new n(Y.fromString(t).popFirst(5))}static empty(){return new n(Y.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Y.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return Y.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new n(new Y(t.slice()))}};var gr=class{constructor(t,e,r,i){this.indexId=t,this.collectionGroup=e,this.fields=r,this.indexState=i}};function Nu(n){return n.fields.find(t=>t.kind===2)}function yn(n){return n.fields.filter(t=>t.kind!==2)}gr.UNKNOWN_ID=-1;var hr=class{constructor(t,e){this.fieldPath=t,this.kind=e}};var Ci=class n{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new n(0,te.min())}};function Lm(n,t){let e=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=j.fromTimestamp(r===1e9?new pt(e+1,0):new pt(e,r));return new te(i,M.empty(),t)}function Mm(n){return new te(n.readTime,n.key,-1)}var te=class n{constructor(t,e,r){this.readTime=t,this.documentKey=e,this.largestBatchId=r}static min(){return new n(j.min(),M.empty(),-1)}static max(){return new n(j.max(),M.empty(),-1)}};function Pl(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=M.comparator(n.documentKey,t.documentKey),e!==0?e:K(n.largestBatchId,t.largestBatchId))}var Fm="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",uo=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function on(n){return C(this,null,function*(){if(n.code!==S.FAILED_PRECONDITION||n.message!==Fm)throw n;V("LocalStore","Unexpectedly lost primary lease")})}var b=class n{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&U(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(t,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(e,s).next(r,i)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof n?e:n.resolve(e)}catch(e){return n.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):n.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):n.reject(e)}static resolve(t){return new n((e,r)=>{e(t)})}static reject(t){return new n((e,r)=>{r(t)})}static waitFor(t){return new n((e,r)=>{let i=0,s=0,o=!1;t.forEach(u=>{++i,u.next(()=>{++s,o&&s===i&&e()},c=>r(c))}),o=!0,s===i&&e()})}static or(t){let e=n.resolve(!1);for(let r of t)e=e.next(i=>i?n.resolve(i):r());return e}static forEach(t,e){let r=[];return t.forEach((i,s)=>{r.push(e.call(this,i,s))}),this.waitFor(r)}static mapArray(t,e){return new n((r,i)=>{let s=t.length,o=new Array(s),u=0;for(let c=0;c<s;c++){let h=c;e(t[h]).next(f=>{o[h]=f,++u,u===s&&r(o)},f=>i(f))}})}static doWhile(t,e){return new n((r,i)=>{let s=()=>{t()===!0?e().next(()=>{s()},i):r()};s()})}};var co=class n{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.V=new It,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new An(t,e.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=Cl(r.target.error);this.V.reject(new An(t,i))}}static open(t,e,r,i){try{return new n(e,t.transaction(i,r))}catch(s){throw new An(e,s)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(V("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){let e=this.transaction.objectStore(t);return new Lu(e)}},Qe=class n{constructor(t,e,r){this.name=t,this.version=e,this.p=r,n.S(ai())===12.2&&mt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return V("SimpleDb","Removing database:",t),wn(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!Sd())return!1;if(n.v())return!0;let t=ai(),e=n.S(t),r=0<e&&e<10,i=Um(t),s=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||s)}static v(){var t;return typeof process<"u"&&((t=process.__PRIVATE_env)===null||t===void 0?void 0:t.C)==="YES"}static F(t,e){return t.store(e)}static S(t){let e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(r)}M(t){return C(this,null,function*(){return this.db||(V("SimpleDb","Opening database:",this.name),this.db=yield new Promise((e,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;e(o)},i.onblocked=()=>{r(new An(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new N(S.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new N(S.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new An(t,o))},i.onupgradeneeded=s=>{V("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.O(o,i.transaction,s.oldVersion,this.version).next(()=>{V("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=e=>this.N(e)),this.db})}L(t){this.N=t,this.db&&(this.db.onversionchange=e=>t(e))}runTransaction(t,e,r,i){return C(this,null,function*(){let s=e==="readonly",o=0;for(;;){++o;try{this.db=yield this.M(t);let u=co.open(this.db,t,s?"readonly":"readwrite",r),c=i(u).next(h=>(u.g(),h)).catch(h=>(u.abort(h),b.reject(h))).toPromise();return c.catch(()=>{}),yield u.m,c}catch(u){let c=u,h=c.name!=="FirebaseError"&&o<3;if(V("SimpleDb","Transaction failed with error:",c.message,"Retrying:",h),this.close(),!h)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function Um(n){let t=n.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}var Ou=class{constructor(t){this.B=t,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(t){this.B=t}done(){this.k=!0}$(t){this.q=t}delete(){return wn(this.B.delete())}},An=class extends N{constructor(t,e){super(S.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}};function an(n){return n.name==="IndexedDbTransactionError"}var Lu=class{constructor(t){this.store=t}put(t,e){let r;return e!==void 0?(V("SimpleDb","PUT",this.store.name,t,e),r=this.store.put(e,t)):(V("SimpleDb","PUT",this.store.name,"<auto-key>",t),r=this.store.put(t)),wn(r)}add(t){return V("SimpleDb","ADD",this.store.name,t,t),wn(this.store.add(t))}get(t){return wn(this.store.get(t)).next(e=>(e===void 0&&(e=null),V("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return V("SimpleDb","DELETE",this.store.name,t),wn(this.store.delete(t))}count(){return V("SimpleDb","COUNT",this.store.name),wn(this.store.count())}U(t,e){let r=this.options(t,e),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new b((o,u)=>{s.onerror=c=>{u(c.target.error)},s.onsuccess=c=>{o(c.target.result)}})}{let s=this.cursor(r),o=[];return this.W(s,(u,c)=>{o.push(c)}).next(()=>o)}}G(t,e){let r=this.store.getAll(t,e===null?void 0:e);return new b((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}j(t,e){V("SimpleDb","DELETE ALL",this.store.name);let r=this.options(t,e);r.H=!1;let i=this.cursor(r);return this.W(i,(s,o,u)=>u.delete())}J(t,e){let r;e?r=t:(r={},e=t);let i=this.cursor(r);return this.W(i,e)}Y(t){let e=this.cursor({});return new b((r,i)=>{e.onerror=s=>{let o=Cl(s.target.error);i(o)},e.onsuccess=s=>{let o=s.target.result;o?t(o.primaryKey,o.value).next(u=>{u?o.continue():r()}):r()}})}W(t,e){let r=[];return new b((i,s)=>{t.onerror=o=>{s(o.target.error)},t.onsuccess=o=>{let u=o.target.result;if(!u)return void i();let c=new Ou(u),h=e(u.primaryKey,u.value,c);if(h instanceof b){let f=h.catch(p=>(c.done(),b.reject(p)));r.push(f)}c.isDone?i():c.K===null?u.continue():u.continue(c.K)}}).next(()=>b.waitFor(r))}options(t,e){let r;return t!==void 0&&(typeof t=="string"?r=t:e=t),{index:r,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){let r=this.store.index(t.index);return t.H?r.openKeyCursor(t.range,e):r.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}};function wn(n){return new b((t,e)=>{n.onsuccess=r=>{let i=r.target.result;t(i)},n.onerror=r=>{let i=Cl(r.target.error);e(i)}})}var Vf=!1;function Cl(n){let t=Qe.S(ai());if(t>=12.2&&t<13){let e="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(e)>=0){let r=new N("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Vf||(Vf=!0,setTimeout(()=>{throw r},0)),r}}return n}var Mu=class{constructor(t,e){this.asyncQueue=t,this.Z=e,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(t){V("IndexBackfiller",`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,()=>C(this,null,function*(){this.task=null;try{V("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(e){an(e)?V("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",e):yield on(e)}yield this.X(6e4)}))}},Fu=class{constructor(t,e){this.localStore=t,this.persistence=e}ee(t=50){return C(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.te(e,t))})}te(t,e){let r=new Set,i=e,s=!0;return b.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next(o=>{if(o!==null&&!r.has(o))return V("IndexBackfiller",`Processing collection: ${o}`),this.ne(t,o,i).next(u=>{i-=u,r.add(o)});s=!1})).next(()=>e-i)}ne(t,e,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next(i=>this.localStore.localDocuments.getNextDocuments(t,e,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(t,o).next(()=>this.re(i,s)).next(u=>(V("IndexBackfiller",`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(t,e,u))).next(()=>o.size)}))}re(t,e){let r=t;return e.changes.forEach((i,s)=>{let o=Mm(s);Pl(o,r)>0&&(r=o)}),new te(r.readTime,r.documentKey,Math.max(e.batchId,t.largestBatchId))}};var Yt=(()=>{class n{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.se&&this.se(e),e}}return n.oe=-1,n})();function Zi(n){return n==null}function xi(n){return n===0&&1/n==-1/0}function Bm(n){return typeof n=="number"&&Number.isInteger(n)&&!xi(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function Gt(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=Nf(t)),t=Qw(n.get(e),t);return Nf(t)}function Qw(n,t){let e=t,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":e+="";break;case"":e+="";break;default:e+=s}}return e}function Nf(n){return n+""}function le(n){let t=n.length;if(q(t>=2),t===2)return q(n.charAt(0)===""&&n.charAt(1)===""),Y.emptyPath();let e=t-2,r=[],i="";for(let s=0;s<t;){let o=n.indexOf("",s);switch((o<0||o>e)&&U(),n.charAt(o+1)){case"":let u=n.substring(s,o),c;i.length===0?c=u:(i+=u,c=i,i=""),r.push(c);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:U()}s=o+2}return new Y(r)}var Of=["userId","batchId"];function Zs(n,t){return[n,Gt(t)]}function qm(n,t,e){return[n,Gt(t),e]}var Hw={},Xw=["prefixPath","collectionGroup","readTime","documentId"],Yw=["prefixPath","collectionGroup","documentId"],Jw=["collectionGroup","readTime","prefixPath","documentId"],Zw=["canonicalId","targetId"],tv=["targetId","path"],ev=["path","targetId"],nv=["collectionId","parent"],rv=["indexId","uid"],iv=["uid","sequenceNumber"],sv=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ov=["indexId","uid","orderedDocumentKey"],av=["userId","collectionPath","documentId"],uv=["userId","collectionPath","largestBatchId"],cv=["userId","collectionGroup","largestBatchId"],zm=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],lv=[...zm,"documentOverlays"],jm=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Gm=jm,xl=[...Gm,"indexConfiguration","indexState","indexEntries"],hv=xl,dv=[...xl,"globals"];var ki=class extends uo{constructor(t,e){super(),this._e=t,this.currentSequenceNumber=e}};function Rt(n,t){let e=L(n);return Qe.F(e._e,t)}function Lf(n){let t=0;for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function On(n,t){for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function $m(n){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}var ot=class n{constructor(t,e){this.comparator=t,this.root=e||de.EMPTY}insert(t,e){return new n(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,de.BLACK,null,null))}remove(t){return new n(this.comparator,this.root.remove(t,this.comparator).copy(null,null,de.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let r=this.comparator(t,e.key);if(r===0)return e.value;r<0?e=e.left:r>0&&(e=e.right)}return null}indexOf(t){let e=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(t,r.key);if(i===0)return e+r.left.size;i<0?r=r.left:(e+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,r)=>(t(e,r),!1))}toString(){let t=[];return this.inorderTraversal((e,r)=>(t.push(`${e}:${r}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new lr(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new lr(this.root,t,this.comparator,!1)}getReverseIterator(){return new lr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new lr(this.root,t,this.comparator,!0)}},lr=class{constructor(t,e,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?r(t.key,e):1,e&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(s===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},de=class n{constructor(t,e,r,i,s){this.key=t,this.value=e,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,r,i,s){return new n(t??this.key,e??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,r){let i=this,s=r(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,r),null):s===0?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let r,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),e(t,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw U();let t=this.left.check();if(t!==this.right.check())throw U();return t+(this.isRed()?0:1)}};de.EMPTY=null,de.RED=!0,de.BLACK=!1;de.EMPTY=new class{constructor(){this.size=0}get key(){throw U()}get value(){throw U()}get color(){throw U()}get left(){throw U()}get right(){throw U()}copy(t,e,r,i,s){return this}insert(t,e,r){return new de(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var it=class n{constructor(t){this.comparator=t,this.data=new ot(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,r)=>(t(e),!1))}forEachInRange(t,e){let r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let r;for(r=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new lo(this.data.getIterator())}getIteratorFrom(t){return new lo(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(r=>{e=e.add(r)}),e}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.data.getIterator(),r=t.data.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new n(this.comparator);return e.data=t,e}},lo=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function er(n){return n.hasNext()?n.getNext():void 0}var Jt=class n{constructor(t){this.fields=t,t.sort(At.comparator)}static empty(){return new n([])}unionWith(t){let e=new it(At.comparator);for(let r of this.fields)e=e.add(r);for(let r of t)e=e.add(r);return new n(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return pr(this.fields,t.fields,(e,r)=>e.isEqual(r))}};var ho=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function XE(){return typeof atob<"u"}var yt=class n{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new ho("Invalid base64 string: "+s):s}}(t);return new n(e)}static fromUint8Array(t){let e=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(t);return new n(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let r=new Uint8Array(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return K(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};yt.EMPTY_BYTE_STRING=new yt("");var fv=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Se(n){if(q(!!n),typeof n=="string"){let t=0,e=fv.exec(n);if(q(!!e),e[1]){let i=e[1];i=(i+"000000000").substr(0,9),t=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:ut(n.seconds),nanos:ut(n.nanos)}}function ut(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function He(n){return typeof n=="string"?yt.fromBase64String(n):yt.fromUint8Array(n)}function na(n){var t,e;return((e=(((t=n?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="server_timestamp"}function kl(n){let t=n.mapValue.fields.__previous_value__;return na(t)?kl(t):t}function Di(n){let t=Se(n.mapValue.fields.__local_write_time__.timestampValue);return new pt(t.seconds,t.nanos)}var Uu=class{constructor(t,e,r,i,s,o,u,c,h){this.databaseId=t,this.appId=e,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=h}},_r=class n{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof n&&t.projectId===this.projectId&&t.database===this.database}};var Ke={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},to={nullValue:"NULL_VALUE"};function Rn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?na(n)?4:Km(n)?9007199254740991:ra(n)?10:11:U()}function ge(n,t){if(n===t)return!0;let e=Rn(n);if(e!==Rn(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return Di(n).isEqual(Di(t));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=Se(i.timestampValue),u=Se(s.timestampValue);return o.seconds===u.seconds&&o.nanos===u.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return function(i,s){return He(i.bytesValue).isEqual(He(s.bytesValue))}(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return function(i,s){return ut(i.geoPointValue.latitude)===ut(s.geoPointValue.latitude)&&ut(i.geoPointValue.longitude)===ut(s.geoPointValue.longitude)}(n,t);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ut(i.integerValue)===ut(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=ut(i.doubleValue),u=ut(s.doubleValue);return o===u?xi(o)===xi(u):isNaN(o)&&isNaN(u)}return!1}(n,t);case 9:return pr(n.arrayValue.values||[],t.arrayValue.values||[],ge);case 10:case 11:return function(i,s){let o=i.mapValue.fields||{},u=s.mapValue.fields||{};if(Lf(o)!==Lf(u))return!1;for(let c in o)if(o.hasOwnProperty(c)&&(u[c]===void 0||!ge(o[c],u[c])))return!1;return!0}(n,t);default:return U()}}function Vi(n,t){return(n.values||[]).find(e=>ge(e,t))!==void 0}function Xe(n,t){if(n===t)return 0;let e=Rn(n),r=Rn(t);if(e!==r)return K(e,r);switch(e){case 0:case 9007199254740991:return 0;case 1:return K(n.booleanValue,t.booleanValue);case 2:return function(s,o){let u=ut(s.integerValue||s.doubleValue),c=ut(o.integerValue||o.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1}(n,t);case 3:return Mf(n.timestampValue,t.timestampValue);case 4:return Mf(Di(n),Di(t));case 5:return K(n.stringValue,t.stringValue);case 6:return function(s,o){let u=He(s),c=He(o);return u.compareTo(c)}(n.bytesValue,t.bytesValue);case 7:return function(s,o){let u=s.split("/"),c=o.split("/");for(let h=0;h<u.length&&h<c.length;h++){let f=K(u[h],c[h]);if(f!==0)return f}return K(u.length,c.length)}(n.referenceValue,t.referenceValue);case 8:return function(s,o){let u=K(ut(s.latitude),ut(o.latitude));return u!==0?u:K(ut(s.longitude),ut(o.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return Ff(n.arrayValue,t.arrayValue);case 10:return function(s,o){var u,c,h,f;let p=s.fields||{},_=o.fields||{},E=(u=p.value)===null||u===void 0?void 0:u.arrayValue,x=(c=_.value)===null||c===void 0?void 0:c.arrayValue,D=K(((h=E?.values)===null||h===void 0?void 0:h.length)||0,((f=x?.values)===null||f===void 0?void 0:f.length)||0);return D!==0?D:Ff(E,x)}(n.mapValue,t.mapValue);case 11:return function(s,o){if(s===Ke.mapValue&&o===Ke.mapValue)return 0;if(s===Ke.mapValue)return 1;if(o===Ke.mapValue)return-1;let u=s.fields||{},c=Object.keys(u),h=o.fields||{},f=Object.keys(h);c.sort(),f.sort();for(let p=0;p<c.length&&p<f.length;++p){let _=K(c[p],f[p]);if(_!==0)return _;let E=Xe(u[c[p]],h[f[p]]);if(E!==0)return E}return K(c.length,f.length)}(n.mapValue,t.mapValue);default:throw U()}}function Mf(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return K(n,t);let e=Se(n),r=Se(t),i=K(e.seconds,r.seconds);return i!==0?i:K(e.nanos,r.nanos)}function Ff(n,t){let e=n.values||[],r=t.values||[];for(let i=0;i<e.length&&i<r.length;++i){let s=Xe(e[i],r[i]);if(s)return s}return K(e.length,r.length)}function yr(n){return Bu(n)}function Bu(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(e){let r=Se(e);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(e){return He(e).toBase64()}(n.bytesValue):"referenceValue"in n?function(e){return M.fromName(e).toString()}(n.referenceValue):"geoPointValue"in n?function(e){return`geo(${e.latitude},${e.longitude})`}(n.geoPointValue):"arrayValue"in n?function(e){let r="[",i=!0;for(let s of e.values||[])i?i=!1:r+=",",r+=Bu(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(e){let r=Object.keys(e.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${Bu(e.fields[o])}`;return i+"}"}(n.mapValue):U()}function bn(n,t){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${t.path.canonicalString()}`}}function qu(n){return!!n&&"integerValue"in n}function Ni(n){return!!n&&"arrayValue"in n}function Uf(n){return!!n&&"nullValue"in n}function Bf(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function eo(n){return!!n&&"mapValue"in n}function ra(n){var t,e;return((e=(((t=n?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="__vector__"}function Ai(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let t={mapValue:{fields:{}}};return On(n.mapValue.fields,(e,r)=>t.mapValue.fields[e]=Ai(r)),t}if(n.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=Ai(n.arrayValue.values[e]);return t}return Object.assign({},n)}function Km(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var Wm={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function mv(n){return"nullValue"in n?to:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?bn(_r.empty(),M.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?ra(n)?Wm:{mapValue:{}}:U()}function pv(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?bn(_r.empty(),M.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?Wm:"mapValue"in n?ra(n)?{mapValue:{}}:Ke:U()}function qf(n,t){let e=Xe(n.value,t.value);return e!==0?e:n.inclusive&&!t.inclusive?-1:!n.inclusive&&t.inclusive?1:0}function zf(n,t){let e=Xe(n.value,t.value);return e!==0?e:n.inclusive&&!t.inclusive?1:!n.inclusive&&t.inclusive?-1:0}var Lt=class n{constructor(t){this.value=t}static empty(){return new n({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let r=0;r<t.length-1;++r)if(e=(e.mapValue.fields||{})[t.get(r)],!eo(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Ai(e)}setAll(t){let e=At.emptyPath(),r={},i=[];t.forEach((o,u)=>{if(!e.isImmediateParentOf(u)){let c=this.getFieldsMap(e);this.applyChanges(c,r,i),r={},i=[],e=u.popLast()}o?r[u.lastSegment()]=Ai(o):i.push(u.lastSegment())});let s=this.getFieldsMap(e);this.applyChanges(s,r,i)}delete(t){let e=this.field(t.popLast());eo(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return ge(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let r=0;r<t.length;++r){let i=e.mapValue.fields[t.get(r)];eo(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(r)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,r){On(e,(i,s)=>t[i]=s);for(let i of r)delete t[i]}clone(){return new n(Ai(this.value))}};function Qm(n){let t=[];return On(n.fields,(e,r)=>{let i=new At([e]);if(eo(r)){let s=Qm(r.mapValue).fields;if(s.length===0)t.push(i);else for(let o of s)t.push(i.child(o))}else t.push(i)}),new Jt(t)}var Et=class n{constructor(t,e,r,i,s,o,u){this.key=t,this.documentType=e,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=u}static newInvalidDocument(t){return new n(t,0,j.min(),j.min(),j.min(),Lt.empty(),0)}static newFoundDocument(t,e,r,i){return new n(t,1,e,j.min(),r,i,0)}static newNoDocument(t,e){return new n(t,2,e,j.min(),j.min(),Lt.empty(),0)}static newUnknownDocument(t,e){return new n(t,3,e,j.min(),j.min(),Lt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(j.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Lt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Lt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=j.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof n&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var _e=class{constructor(t,e){this.position=t,this.inclusive=e}};function jf(n,t,e){let r=0;for(let i=0;i<n.position.length;i++){let s=t[i],o=n.position[i];if(s.field.isKeyField()?r=M.comparator(M.fromName(o.referenceValue),e.key):r=Xe(o,e.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function Gf(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!ge(n.position[e],t.position[e]))return!1;return!0}var Sn=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function gv(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}var fo=class{},H=class n extends fo{constructor(t,e,r){super(),this.field=t,this.op=e,this.value=r}static create(t,e,r){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,r):new Gu(t,e,r):e==="array-contains"?new Wu(t,r):e==="in"?new mo(t,r):e==="not-in"?new Qu(t,r):e==="array-contains-any"?new Hu(t,r):new n(t,e,r)}static createKeyFieldInFilter(t,e,r){return e==="in"?new $u(t,r):new Ku(t,r)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&this.matchesComparison(Xe(e,this.value)):e!==null&&Rn(this.value)===Rn(e)&&this.matchesComparison(Xe(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return U()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},nt=class n extends fo{constructor(t,e){super(),this.filters=t,this.op=e,this.ae=null}static create(t,e){return new n(t,e)}matches(t){return wr(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function wr(n){return n.op==="and"}function zu(n){return n.op==="or"}function Dl(n){return Hm(n)&&wr(n)}function Hm(n){for(let t of n.filters)if(t instanceof nt)return!1;return!0}function ju(n){if(n instanceof H)return n.field.canonicalString()+n.op.toString()+yr(n.value);if(Dl(n))return n.filters.map(t=>ju(t)).join(",");{let t=n.filters.map(e=>ju(e)).join(",");return`${n.op}(${t})`}}function Xm(n,t){return n instanceof H?function(r,i){return i instanceof H&&r.op===i.op&&r.field.isEqual(i.field)&&ge(r.value,i.value)}(n,t):n instanceof nt?function(r,i){return i instanceof nt&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,u)=>s&&Xm(o,i.filters[u]),!0):!1}(n,t):void U()}function Ym(n,t){let e=n.filters.concat(t);return nt.create(e,n.op)}function Jm(n){return n instanceof H?function(e){return`${e.field.canonicalString()} ${e.op} ${yr(e.value)}`}(n):n instanceof nt?function(e){return e.op.toString()+" {"+e.getFilters().map(Jm).join(" ,")+"}"}(n):"Filter"}var Gu=class extends H{constructor(t,e,r){super(t,e,r),this.key=M.fromName(r.referenceValue)}matches(t){let e=M.comparator(t.key,this.key);return this.matchesComparison(e)}},$u=class extends H{constructor(t,e){super(t,"in",e),this.keys=Zm("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},Ku=class extends H{constructor(t,e){super(t,"not-in",e),this.keys=Zm("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function Zm(n,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(r=>M.fromName(r.referenceValue))}var Wu=class extends H{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return Ni(e)&&Vi(e.arrayValue,this.value)}},mo=class extends H{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&Vi(this.value.arrayValue,e)}},Qu=class extends H{constructor(t,e){super(t,"not-in",e)}matches(t){if(Vi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&!Vi(this.value.arrayValue,e)}},Hu=class extends H{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!Ni(e)||!e.arrayValue.values)&&e.arrayValue.values.some(r=>Vi(this.value.arrayValue,r))}};var Xu=class{constructor(t,e=null,r=[],i=[],s=null,o=null,u=null){this.path=t,this.collectionGroup=e,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=u,this.ue=null}};function Yu(n,t=null,e=[],r=[],i=null,s=null,o=null){return new Xu(n,t,e,r,i,s,o)}function Pn(n){let t=L(n);if(t.ue===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(r=>ju(r)).join(","),e+="|ob:",e+=t.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),Zi(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(r=>yr(r)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(r=>yr(r)).join(",")),t.ue=e}return t.ue}function ts(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!gv(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!Xm(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!Gf(n.startAt,t.startAt)&&Gf(n.endAt,t.endAt)}function po(n){return M.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function go(n,t){return n.filters.filter(e=>e instanceof H&&e.field.isEqual(t))}function $f(n,t,e){let r=to,i=!0;for(let s of go(n,t)){let o=to,u=!0;switch(s.op){case"<":case"<=":o=mv(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,u=!1;break;case"!=":case"not-in":o=to}qf({value:r,inclusive:i},{value:o,inclusive:u})<0&&(r=o,i=u)}if(e!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(t)){let o=e.position[s];qf({value:r,inclusive:i},{value:o,inclusive:e.inclusive})<0&&(r=o,i=e.inclusive);break}}return{value:r,inclusive:i}}function Kf(n,t,e){let r=Ke,i=!0;for(let s of go(n,t)){let o=Ke,u=!0;switch(s.op){case">=":case">":o=pv(s.value),u=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,u=!1;break;case"!=":case"not-in":o=Ke}zf({value:r,inclusive:i},{value:o,inclusive:u})>0&&(r=o,i=u)}if(e!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(t)){let o=e.position[s];zf({value:r,inclusive:i},{value:o,inclusive:e.inclusive})>0&&(r=o,i=e.inclusive);break}}return{value:r,inclusive:i}}var ie=class{constructor(t,e=null,r=[],i=[],s=null,o="F",u=null,c=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=u,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function tp(n,t,e,r,i,s,o,u){return new ie(n,t,e,r,i,s,o,u)}function Nr(n){return new ie(n)}function Wf(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Vl(n){return n.collectionGroup!==null}function dr(n){let t=L(n);if(t.ce===null){t.ce=[];let e=new Set;for(let s of t.explicitOrderBy)t.ce.push(s),e.add(s.field.canonicalString());let r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(o){let u=new it(At.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(h=>{h.isInequality()&&(u=u.add(h.field))})}),u})(t).forEach(s=>{e.has(s.canonicalString())||s.isKeyField()||t.ce.push(new Sn(s,r))}),e.has(At.keyField().canonicalString())||t.ce.push(new Sn(At.keyField(),r))}return t.ce}function $t(n){let t=L(n);return t.le||(t.le=_v(t,dr(n))),t.le}function _v(n,t){if(n.limitType==="F")return Yu(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Sn(i.field,s)});let e=n.endAt?new _e(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new _e(n.startAt.position,n.startAt.inclusive):null;return Yu(n.path,n.collectionGroup,t,n.filters,n.limit,e,r)}}function Ju(n,t){let e=n.filters.concat([t]);return new ie(n.path,n.collectionGroup,n.explicitOrderBy.slice(),e,n.limit,n.limitType,n.startAt,n.endAt)}function _o(n,t,e){return new ie(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function es(n,t){return ts($t(n),$t(t))&&n.limitType===t.limitType}function ep(n){return`${Pn($t(n))}|lt:${n.limitType}`}function or(n){return`Query(target=${function(e){let r=e.path.canonicalString();return e.collectionGroup!==null&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=`, filters: [${e.filters.map(i=>Jm(i)).join(", ")}]`),Zi(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=`, orderBy: [${e.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(i=>yr(i)).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(i=>yr(i)).join(",")),`Target(${r})`}($t(n))}; limitType=${n.limitType})`}function ns(n,t){return t.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):M.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,t)&&function(r,i){for(let s of dr(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,t)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,t)&&function(r,i){return!(r.startAt&&!function(o,u,c){let h=jf(o,u,c);return o.inclusive?h<=0:h<0}(r.startAt,dr(r),i)||r.endAt&&!function(o,u,c){let h=jf(o,u,c);return o.inclusive?h>=0:h>0}(r.endAt,dr(r),i))}(n,t)}function np(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function rp(n){return(t,e)=>{let r=!1;for(let i of dr(n)){let s=yv(i,t,e);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function yv(n,t,e){let r=n.field.isKeyField()?M.comparator(t.key,e.key):function(s,o,u){let c=o.data.field(s),h=u.data.field(s);return c!==null&&h!==null?Xe(c,h):U()}(n.field,t,e);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return U()}}var ye=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,t))return s}}has(t){return this.get(t)!==void 0}set(t,e){let r=this.mapKeyFn(t),i=this.inner[r];if(i===void 0)return this.inner[r]=[[t,e]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],t))return void(i[s]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return r.length===1?delete this.inner[e]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(t){On(this.inner,(e,r)=>{for(let[i,s]of r)t(i,s)})}isEmpty(){return $m(this.inner)}size(){return this.innerSize}};var wv=new ot(M.comparator);function Qt(){return wv}var ip=new ot(M.comparator);function Ii(...n){let t=ip;for(let e of n)t=t.insert(e.key,e);return t}function sp(n){let t=ip;return n.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function he(){return Ri()}function op(){return Ri()}function Ri(){return new ye(n=>n.toString(),(n,t)=>n.isEqual(t))}var vv=new ot(M.comparator),Tv=new it(M.comparator);function W(...n){let t=Tv;for(let e of n)t=t.add(e);return t}var Iv=new it(K);function Nl(){return Iv}function Ol(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:xi(t)?"-0":t}}function ap(n){return{integerValue:""+n}}function up(n,t){return Bm(t)?ap(t):Ol(n,t)}var vr=class{constructor(){this._=void 0}};function Ev(n,t,e){return n instanceof Ye?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&na(s)&&(s=kl(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(e,t):n instanceof Pe?lp(n,t):n instanceof Ce?hp(n,t):function(i,s){let o=cp(i,s),u=Qf(o)+Qf(i.Pe);return qu(o)&&qu(i.Pe)?ap(u):Ol(i.serializer,u)}(n,t)}function Av(n,t,e){return n instanceof Pe?lp(n,t):n instanceof Ce?hp(n,t):e}function cp(n,t){return n instanceof Je?function(r){return qu(r)||function(s){return!!s&&"doubleValue"in s}(r)}(t)?t:{integerValue:0}:null}var Ye=class extends vr{},Pe=class extends vr{constructor(t){super(),this.elements=t}};function lp(n,t){let e=dp(t);for(let r of n.elements)e.some(i=>ge(i,r))||e.push(r);return{arrayValue:{values:e}}}var Ce=class extends vr{constructor(t){super(),this.elements=t}};function hp(n,t){let e=dp(t);for(let r of n.elements)e=e.filter(i=>!ge(i,r));return{arrayValue:{values:e}}}var Je=class extends vr{constructor(t,e){super(),this.serializer=t,this.Pe=e}};function Qf(n){return ut(n.integerValue||n.doubleValue)}function dp(n){return Ni(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var Cn=class{constructor(t,e){this.field=t,this.transform=e}};function Rv(n,t){return n.field.isEqual(t.field)&&function(r,i){return r instanceof Pe&&i instanceof Pe||r instanceof Ce&&i instanceof Ce?pr(r.elements,i.elements,ge):r instanceof Je&&i instanceof Je?ge(r.Pe,i.Pe):r instanceof Ye&&i instanceof Ye}(n.transform,t.transform)}var Zu=class{constructor(t,e){this.version=t,this.transformResults=e}},ft=class n{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new n}static exists(t){return new n(void 0,t)}static updateTime(t){return new n(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function no(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}var Tr=class{};function fp(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new tn(n.key,ft.none()):new Ze(n.key,n.data,ft.none());{let e=n.data,r=Lt.empty(),i=new it(At.comparator);for(let s of t.fields)if(!i.has(s)){let o=e.field(s);o===null&&s.length>1&&(s=s.popLast(),o=e.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new se(n.key,r,new Jt(i.toArray()),ft.none())}}function bv(n,t,e){n instanceof Ze?function(i,s,o){let u=i.value.clone(),c=Xf(i.fieldTransforms,s,o.transformResults);u.setAll(c),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,t,e):n instanceof se?function(i,s,o){if(!no(i.precondition,s))return void s.convertToUnknownDocument(o.version);let u=Xf(i.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(mp(i)),c.setAll(u),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,t,e):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,t,e)}function bi(n,t,e,r){return n instanceof Ze?function(s,o,u,c){if(!no(s.precondition,o))return u;let h=s.value.clone(),f=Yf(s.fieldTransforms,c,o);return h.setAll(f),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null}(n,t,e,r):n instanceof se?function(s,o,u,c){if(!no(s.precondition,o))return u;let h=Yf(s.fieldTransforms,c,o),f=o.data;return f.setAll(mp(s)),f.setAll(h),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),u===null?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(p=>p.field))}(n,t,e,r):function(s,o,u){return no(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):u}(n,t,e)}function Sv(n,t){let e=null;for(let r of n.fieldTransforms){let i=t.data.field(r.field),s=cp(r.transform,i||null);s!=null&&(e===null&&(e=Lt.empty()),e.set(r.field,s))}return e||null}function Hf(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&pr(r,i,(s,o)=>Rv(s,o))}(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}var Ze=class extends Tr{constructor(t,e,r,i=[]){super(),this.key=t,this.value=e,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},se=class extends Tr{constructor(t,e,r,i,s=[]){super(),this.key=t,this.data=e,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function mp(n){let t=new Map;return n.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let r=n.data.field(e);t.set(e,r)}}),t}function Xf(n,t,e){let r=new Map;q(n.length===e.length);for(let i=0;i<e.length;i++){let s=n[i],o=s.transform,u=t.data.field(s.field);r.set(s.field,Av(o,u,e[i]))}return r}function Yf(n,t,e){let r=new Map;for(let i of n){let s=i.transform,o=e.data.field(i.field);r.set(i.field,Ev(s,o,t))}return r}var tn=class extends Tr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Oi=class extends Tr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Li=class{constructor(t,e,r,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(t,e){let r=e.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(t.key)&&bv(s,t,r[i])}}applyToLocalView(t,e){for(let r of this.baseMutations)r.key.isEqual(t.key)&&(e=bi(r,t,e,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(t.key)&&(e=bi(r,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let r=op();return this.mutations.forEach(i=>{let s=t.get(i.key),o=s.overlayedDocument,u=this.applyToLocalView(o,s.mutatedFields);u=e.has(i.key)?null:u;let c=fp(o,u);c!==null&&r.set(i.key,c),o.isValidDocument()||o.convertToNoDocument(j.min())}),r}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),W())}isEqual(t){return this.batchId===t.batchId&&pr(this.mutations,t.mutations,(e,r)=>Hf(e,r))&&pr(this.baseMutations,t.baseMutations,(e,r)=>Hf(e,r))}},tc=class n{constructor(t,e,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=r,this.docVersions=i}static from(t,e,r){q(t.mutations.length===r.length);let i=function(){return vv}(),s=t.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(t,e,r,i)}};var Mi=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var ec=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var wt,X;function pp(n){switch(n){default:return U();case S.CANCELLED:case S.UNKNOWN:case S.DEADLINE_EXCEEDED:case S.RESOURCE_EXHAUSTED:case S.INTERNAL:case S.UNAVAILABLE:case S.UNAUTHENTICATED:return!1;case S.INVALID_ARGUMENT:case S.NOT_FOUND:case S.ALREADY_EXISTS:case S.PERMISSION_DENIED:case S.FAILED_PRECONDITION:case S.ABORTED:case S.OUT_OF_RANGE:case S.UNIMPLEMENTED:case S.DATA_LOSS:return!0}}function gp(n){if(n===void 0)return mt("GRPC error has no .code"),S.UNKNOWN;switch(n){case wt.OK:return S.OK;case wt.CANCELLED:return S.CANCELLED;case wt.UNKNOWN:return S.UNKNOWN;case wt.DEADLINE_EXCEEDED:return S.DEADLINE_EXCEEDED;case wt.RESOURCE_EXHAUSTED:return S.RESOURCE_EXHAUSTED;case wt.INTERNAL:return S.INTERNAL;case wt.UNAVAILABLE:return S.UNAVAILABLE;case wt.UNAUTHENTICATED:return S.UNAUTHENTICATED;case wt.INVALID_ARGUMENT:return S.INVALID_ARGUMENT;case wt.NOT_FOUND:return S.NOT_FOUND;case wt.ALREADY_EXISTS:return S.ALREADY_EXISTS;case wt.PERMISSION_DENIED:return S.PERMISSION_DENIED;case wt.FAILED_PRECONDITION:return S.FAILED_PRECONDITION;case wt.ABORTED:return S.ABORTED;case wt.OUT_OF_RANGE:return S.OUT_OF_RANGE;case wt.UNIMPLEMENTED:return S.UNIMPLEMENTED;case wt.DATA_LOSS:return S.DATA_LOSS;default:return U()}}(X=wt||(wt={}))[X.OK=0]="OK",X[X.CANCELLED=1]="CANCELLED",X[X.UNKNOWN=2]="UNKNOWN",X[X.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",X[X.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",X[X.NOT_FOUND=5]="NOT_FOUND",X[X.ALREADY_EXISTS=6]="ALREADY_EXISTS",X[X.PERMISSION_DENIED=7]="PERMISSION_DENIED",X[X.UNAUTHENTICATED=16]="UNAUTHENTICATED",X[X.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",X[X.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",X[X.ABORTED=10]="ABORTED",X[X.OUT_OF_RANGE=11]="OUT_OF_RANGE",X[X.UNIMPLEMENTED=12]="UNIMPLEMENTED",X[X.INTERNAL=13]="INTERNAL",X[X.UNAVAILABLE=14]="UNAVAILABLE",X[X.DATA_LOSS=15]="DATA_LOSS";var Jf=null;function _p(){return new TextEncoder}var Pv=new qe([4294967295,4294967295],0);function Zf(n){let t=_p().encode(n),e=new gu;return e.update(t),new Uint8Array(e.digest())}function tm(n){let t=new DataView(n.buffer),e=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new qe([e,r],0),new qe([i,s],0)]}var nc=class n{constructor(t,e,r){if(this.bitmap=t,this.padding=e,this.hashCount=r,e<0||e>=8)throw new En(`Invalid padding: ${e}`);if(r<0)throw new En(`Invalid hash count: ${r}`);if(t.length>0&&this.hashCount===0)throw new En(`Invalid hash count: ${r}`);if(t.length===0&&e!==0)throw new En(`Invalid padding when bitmap length is 0: ${e}`);this.Ie=8*t.length-e,this.Te=qe.fromNumber(this.Ie)}Ee(t,e,r){let i=t.add(e.multiply(qe.fromNumber(r)));return i.compare(Pv)===1&&(i=new qe([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(t){return(this.bitmap[Math.floor(t/8)]&1<<t%8)!=0}mightContain(t){if(this.Ie===0)return!1;let e=Zf(t),[r,i]=tm(e);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);if(!this.de(o))return!1}return!0}static create(t,e,r){let i=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),o=new n(s,i,e);return r.forEach(u=>o.insert(u)),o}insert(t){if(this.Ie===0)return;let e=Zf(t),[r,i]=tm(e);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);this.Ae(o)}}Ae(t){let e=Math.floor(t/8),r=t%8;this.bitmap[e]|=1<<r}},En=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Fi=class n{constructor(t,e,r,i,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,r){let i=new Map;return i.set(t,Ui.createSynthesizedTargetChangeForCurrentChange(t,e,r)),new n(j.min(),i,new ot(K),Qt(),W())}},Ui=class n{constructor(t,e,r,i,s){this.resumeToken=t,this.current=e,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,r){return new n(r,e,W(),W(),W())}};var fr=class{constructor(t,e,r,i){this.Re=t,this.removedTargetIds=e,this.key=r,this.Ve=i}},yo=class{constructor(t,e){this.targetId=t,this.me=e}},wo=class{constructor(t,e,r=yt.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=r,this.cause=i}},vo=class{constructor(){this.fe=0,this.ge=nm(),this.pe=yt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}ve(){let t=W(),e=W(),r=W();return this.ge.forEach((i,s)=>{switch(s){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:r=r.add(i);break;default:U()}}),new Ui(this.pe,this.ye,t,e,r)}Ce(){this.we=!1,this.ge=nm()}Fe(t,e){this.we=!0,this.ge=this.ge.insert(t,e)}Me(t){this.we=!0,this.ge=this.ge.remove(t)}xe(){this.fe+=1}Oe(){this.fe-=1,q(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},rc=class{constructor(t){this.Le=t,this.Be=new Map,this.ke=Qt(),this.qe=em(),this.Qe=new ot(K)}Ke(t){for(let e of t.Re)t.Ve&&t.Ve.isFoundDocument()?this.$e(e,t.Ve):this.Ue(e,t.key,t.Ve);for(let e of t.removedTargetIds)this.Ue(e,t.key,t.Ve)}We(t){this.forEachTarget(t,e=>{let r=this.Ge(e);switch(t.state){case 0:this.ze(e)&&r.De(t.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(t.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(e);break;case 3:this.ze(e)&&(r.Ne(),r.De(t.resumeToken));break;case 4:this.ze(e)&&(this.je(e),r.De(t.resumeToken));break;default:U()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Be.forEach((r,i)=>{this.ze(i)&&e(i)})}He(t){let e=t.targetId,r=t.me.count,i=this.Je(e);if(i){let s=i.target;if(po(s))if(r===0){let o=new M(s.path);this.Ue(e,o,Et.newNoDocument(o,j.min()))}else q(r===1);else{let o=this.Ye(e);if(o!==r){let u=this.Ze(t),c=u?this.Xe(u,t,o):1;if(c!==0){this.je(e);let h=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(e,h)}Jf?.et(function(f,p,_,E,x){var D,k,B,z,F,G;let Q={localCacheCount:f,existenceFilterCount:p.count,databaseId:_.database,projectId:_.projectId},$=p.unchangedNames;return $&&(Q.bloomFilter={applied:x===0,hashCount:(D=$?.hashCount)!==null&&D!==void 0?D:0,bitmapLength:(z=(B=(k=$?.bits)===null||k===void 0?void 0:k.bitmap)===null||B===void 0?void 0:B.length)!==null&&z!==void 0?z:0,padding:(G=(F=$?.bits)===null||F===void 0?void 0:F.padding)!==null&&G!==void 0?G:0,mightContain:v=>{var g;return(g=E?.mightContain(v))!==null&&g!==void 0&&g}}),Q}(o,t.me,this.Le.tt(),u,c))}}}}Ze(t){let e=t.me.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=e,o,u;try{o=He(r).toUint8Array()}catch(c){if(c instanceof ho)return pe("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new nc(o,i,s)}catch(c){return pe(c instanceof En?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return u.Ie===0?null:u}Xe(t,e,r){return e.me.count===r-this.nt(t,e.targetId)?0:2}nt(t,e){let r=this.Le.getRemoteKeysForTarget(e),i=0;return r.forEach(s=>{let o=this.Le.tt(),u=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;t.mightContain(u)||(this.Ue(e,s,null),i++)}),i}rt(t){let e=new Map;this.Be.forEach((s,o)=>{let u=this.Je(o);if(u){if(s.current&&po(u.target)){let c=new M(u.target.path);this.ke.get(c)!==null||this.it(o,c)||this.Ue(o,c,Et.newNoDocument(c,t))}s.be&&(e.set(o,s.ve()),s.Ce())}});let r=W();this.qe.forEach((s,o)=>{let u=!0;o.forEachWhile(c=>{let h=this.Je(c);return!h||h.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(r=r.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(t));let i=new Fi(t,e,this.Qe,this.ke,r);return this.ke=Qt(),this.qe=em(),this.Qe=new ot(K),i}$e(t,e){if(!this.ze(t))return;let r=this.it(t,e.key)?2:0;this.Ge(t).Fe(e.key,r),this.ke=this.ke.insert(e.key,e),this.qe=this.qe.insert(e.key,this.st(e.key).add(t))}Ue(t,e,r){if(!this.ze(t))return;let i=this.Ge(t);this.it(t,e)?i.Fe(e,1):i.Me(e),this.qe=this.qe.insert(e,this.st(e).delete(t)),r&&(this.ke=this.ke.insert(e,r))}removeTarget(t){this.Be.delete(t)}Ye(t){let e=this.Ge(t).ve();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}xe(t){this.Ge(t).xe()}Ge(t){let e=this.Be.get(t);return e||(e=new vo,this.Be.set(t,e)),e}st(t){let e=this.qe.get(t);return e||(e=new it(K),this.qe=this.qe.insert(t,e)),e}ze(t){let e=this.Je(t)!==null;return e||V("WatchChangeAggregator","Detected inactive target",t),e}Je(t){let e=this.Be.get(t);return e&&e.Se?null:this.Le.ot(t)}je(t){this.Be.set(t,new vo),this.Le.getRemoteKeysForTarget(t).forEach(e=>{this.Ue(t,e,null)})}it(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}};function em(){return new ot(M.comparator)}function nm(){return new ot(M.comparator)}var Cv={asc:"ASCENDING",desc:"DESCENDING"},xv={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},kv={and:"AND",or:"OR"},ic=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function sc(n,t){return n.useProto3Json||Zi(t)?t:{value:t}}function Ir(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function yp(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function Dv(n,t){return Ir(n,t.toTimestamp())}function gt(n){return q(!!n),j.fromTimestamp(function(e){let r=Se(e);return new pt(r.seconds,r.nanos)}(n))}function Ll(n,t){return oc(n,t).canonicalString()}function oc(n,t){let e=function(i){return new Y(["projects",i.projectId,"databases",i.database])}(n).child("documents");return t===void 0?e:e.child(t)}function wp(n){let t=Y.fromString(n);return q(Cp(t)),t}function Bi(n,t){return Ll(n.databaseId,t.path)}function fe(n,t){let e=wp(t);if(e.get(1)!==n.databaseId.projectId)throw new N(S.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new N(S.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new M(Ip(e))}function vp(n,t){return Ll(n.databaseId,t)}function Tp(n){let t=wp(n);return t.length===4?Y.emptyPath():Ip(t)}function ac(n){return new Y(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Ip(n){return q(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function rm(n,t,e){return{name:Bi(n,t),fields:e.value.mapValue.fields}}function Ep(n,t,e){let r=fe(n,t.name),i=gt(t.updateTime),s=t.createTime?gt(t.createTime):j.min(),o=new Lt({mapValue:{fields:t.fields}}),u=Et.newFoundDocument(r,i,s,o);return e&&u.setHasCommittedMutations(),e?u.setHasCommittedMutations():u}function Vv(n,t){return"found"in t?function(r,i){q(!!i.found),i.found.name,i.found.updateTime;let s=fe(r,i.found.name),o=gt(i.found.updateTime),u=i.found.createTime?gt(i.found.createTime):j.min(),c=new Lt({mapValue:{fields:i.found.fields}});return Et.newFoundDocument(s,o,u,c)}(n,t):"missing"in t?function(r,i){q(!!i.missing),q(!!i.readTime);let s=fe(r,i.missing),o=gt(i.readTime);return Et.newNoDocument(s,o)}(n,t):U()}function Nv(n,t){let e;if("targetChange"in t){t.targetChange;let r=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:U()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(h,f){return h.useProto3Json?(q(f===void 0||typeof f=="string"),yt.fromBase64String(f||"")):(q(f===void 0||f instanceof Buffer||f instanceof Uint8Array),yt.fromUint8Array(f||new Uint8Array))}(n,t.targetChange.resumeToken),o=t.targetChange.cause,u=o&&function(h){let f=h.code===void 0?S.UNKNOWN:gp(h.code);return new N(f,h.message||"")}(o);e=new wo(r,i,s,u||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=fe(n,r.document.name),s=gt(r.document.updateTime),o=r.document.createTime?gt(r.document.createTime):j.min(),u=new Lt({mapValue:{fields:r.document.fields}}),c=Et.newFoundDocument(i,s,o,u),h=r.targetIds||[],f=r.removedTargetIds||[];e=new fr(h,f,c.key,c)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=fe(n,r.document),s=r.readTime?gt(r.readTime):j.min(),o=Et.newNoDocument(i,s),u=r.removedTargetIds||[];e=new fr([],u,o.key,o)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=fe(n,r.document),s=r.removedTargetIds||[];e=new fr([],s,i,null)}else{if(!("filter"in t))return U();{t.filter;let r=t.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new ec(i,s),u=r.targetId;e=new yo(u,o)}}return e}function qi(n,t){let e;if(t instanceof Ze)e={update:rm(n,t.key,t.value)};else if(t instanceof tn)e={delete:Bi(n,t.key)};else if(t instanceof se)e={update:rm(n,t.key,t.data),updateMask:Bv(t.fieldMask)};else{if(!(t instanceof Oi))return U();e={verify:Bi(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(r=>function(s,o){let u=o.transform;if(u instanceof Ye)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Pe)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Ce)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Je)return{fieldPath:o.field.canonicalString(),increment:u.Pe};throw U()}(0,r))),t.precondition.isNone||(e.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:Dv(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:U()}(n,t.precondition)),e}function uc(n,t){let e=t.currentDocument?function(s){return s.updateTime!==void 0?ft.updateTime(gt(s.updateTime)):s.exists!==void 0?ft.exists(s.exists):ft.none()}(t.currentDocument):ft.none(),r=t.updateTransforms?t.updateTransforms.map(i=>function(o,u){let c=null;if("setToServerValue"in u)q(u.setToServerValue==="REQUEST_TIME"),c=new Ye;else if("appendMissingElements"in u){let f=u.appendMissingElements.values||[];c=new Pe(f)}else if("removeAllFromArray"in u){let f=u.removeAllFromArray.values||[];c=new Ce(f)}else"increment"in u?c=new Je(o,u.increment):U();let h=At.fromServerFormat(u.fieldPath);return new Cn(h,c)}(n,i)):[];if(t.update){t.update.name;let i=fe(n,t.update.name),s=new Lt({mapValue:{fields:t.update.fields}});if(t.updateMask){let o=function(c){let h=c.fieldPaths||[];return new Jt(h.map(f=>At.fromServerFormat(f)))}(t.updateMask);return new se(i,s,o,e,r)}return new Ze(i,s,e,r)}if(t.delete){let i=fe(n,t.delete);return new tn(i,e)}if(t.verify){let i=fe(n,t.verify);return new Oi(i,e)}return U()}function Ov(n,t){return n&&n.length>0?(q(t!==void 0),n.map(e=>function(i,s){let o=i.updateTime?gt(i.updateTime):gt(s);return o.isEqual(j.min())&&(o=gt(s)),new Zu(o,i.transformResults||[])}(e,t))):[]}function Ap(n,t){return{documents:[vp(n,t.path)]}}function Rp(n,t){let e={structuredQuery:{}},r=t.path,i;t.collectionGroup!==null?(i=r,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),e.structuredQuery.from=[{collectionId:r.lastSegment()}]),e.parent=vp(n,i);let s=function(h){if(h.length!==0)return Pp(nt.create(h,"and"))}(t.filters);s&&(e.structuredQuery.where=s);let o=function(h){if(h.length!==0)return h.map(f=>function(_){return{field:ar(_.field),direction:Mv(_.dir)}}(f))}(t.orderBy);o&&(e.structuredQuery.orderBy=o);let u=sc(n,t.limit);return u!==null&&(e.structuredQuery.limit=u),t.startAt&&(e.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(t.endAt)),{_t:e,parent:i}}function bp(n){let t=Tp(n.parent),e=n.structuredQuery,r=e.from?e.from.length:0,i=null;if(r>0){q(r===1);let f=e.from[0];f.allDescendants?i=f.collectionId:t=t.child(f.collectionId)}let s=[];e.where&&(s=function(p){let _=Sp(p);return _ instanceof nt&&Dl(_)?_.getFilters():[_]}(e.where));let o=[];e.orderBy&&(o=function(p){return p.map(_=>function(x){return new Sn(ur(x.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(x.direction))}(_))}(e.orderBy));let u=null;e.limit&&(u=function(p){let _;return _=typeof p=="object"?p.value:p,Zi(_)?null:_}(e.limit));let c=null;e.startAt&&(c=function(p){let _=!!p.before,E=p.values||[];return new _e(E,_)}(e.startAt));let h=null;return e.endAt&&(h=function(p){let _=!p.before,E=p.values||[];return new _e(E,_)}(e.endAt)),tp(t,i,o,s,u,"F",c,h)}function Lv(n,t){let e=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return U()}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function Sp(n){return n.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let r=ur(e.unaryFilter.field);return H.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=ur(e.unaryFilter.field);return H.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=ur(e.unaryFilter.field);return H.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=ur(e.unaryFilter.field);return H.create(o,"!=",{nullValue:"NULL_VALUE"});default:return U()}}(n):n.fieldFilter!==void 0?function(e){return H.create(ur(e.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return U()}}(e.fieldFilter.op),e.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(e){return nt.create(e.compositeFilter.filters.map(r=>Sp(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return U()}}(e.compositeFilter.op))}(n):U()}function Mv(n){return Cv[n]}function Fv(n){return xv[n]}function Uv(n){return kv[n]}function ar(n){return{fieldPath:n.canonicalString()}}function ur(n){return At.fromServerFormat(n.fieldPath)}function Pp(n){return n instanceof H?function(e){if(e.op==="=="){if(Bf(e.value))return{unaryFilter:{field:ar(e.field),op:"IS_NAN"}};if(Uf(e.value))return{unaryFilter:{field:ar(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(Bf(e.value))return{unaryFilter:{field:ar(e.field),op:"IS_NOT_NAN"}};if(Uf(e.value))return{unaryFilter:{field:ar(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ar(e.field),op:Fv(e.op),value:e.value}}}(n):n instanceof nt?function(e){let r=e.getFilters().map(i=>Pp(i));return r.length===1?r[0]:{compositeFilter:{op:Uv(e.op),filters:r}}}(n):U()}function Bv(n){let t=[];return n.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Cp(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Er=class n{constructor(t,e,r,i,s=j.min(),o=j.min(),u=yt.EMPTY_BYTE_STRING,c=null){this.target=t,this.targetId=e,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(t){return new n(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var To=class{constructor(t){this.ct=t}};function qv(n,t){let e;if(t.document)e=Ep(n.ct,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let r=M.fromSegments(t.noDocument.path),i=kn(t.noDocument.readTime);e=Et.newNoDocument(r,i),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return U();{let r=M.fromSegments(t.unknownDocument.path),i=kn(t.unknownDocument.version);e=Et.newUnknownDocument(r,i)}}return t.readTime&&e.setReadTime(function(i){let s=new pt(i[0],i[1]);return j.fromTimestamp(s)}(t.readTime)),e}function im(n,t){let e=t.key,r={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:Io(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(s,o){return{name:Bi(s,o.key),fields:o.data.value.mapValue.fields,updateTime:Ir(s,o.version.toTimestamp()),createTime:Ir(s,o.createTime.toTimestamp())}}(n.ct,t);else if(t.isNoDocument())r.noDocument={path:e.path.toArray(),readTime:xn(t.version)};else{if(!t.isUnknownDocument())return U();r.unknownDocument={path:e.path.toArray(),version:xn(t.version)}}return r}function Io(n){let t=n.toTimestamp();return[t.seconds,t.nanoseconds]}function xn(n){let t=n.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function kn(n){let t=new pt(n.seconds,n.nanoseconds);return j.fromTimestamp(t)}function vn(n,t){let e=(t.baseMutations||[]).map(s=>uc(n.ct,s));for(let s=0;s<t.mutations.length-1;++s){let o=t.mutations[s];if(s+1<t.mutations.length&&t.mutations[s+1].transform!==void 0){let u=t.mutations[s+1];o.updateTransforms=u.transform.fieldTransforms,t.mutations.splice(s+1,1),++s}}let r=t.mutations.map(s=>uc(n.ct,s)),i=pt.fromMillis(t.localWriteTimeMs);return new Li(t.batchId,i,e,r)}function Ei(n){let t=kn(n.readTime),e=n.lastLimboFreeSnapshotVersion!==void 0?kn(n.lastLimboFreeSnapshotVersion):j.min(),r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){return q(s.documents.length===1),$t(Nr(Tp(s.documents[0])))}(n.query):function(s){return $t(bp(s))}(n.query),new Er(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,t,e,yt.fromBase64String(n.resumeToken))}function xp(n,t){let e=xn(t.snapshotVersion),r=xn(t.lastLimboFreeSnapshotVersion),i;i=po(t.target)?Ap(n.ct,t.target):Rp(n.ct,t.target)._t;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Pn(t.target),readTime:e,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Ml(n){let t=bp({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?_o(t,t.limit,"L"):t}function Eu(n,t){return new Mi(t.largestBatchId,uc(n.ct,t.overlayMutation))}function sm(n,t){let e=t.path.lastSegment();return[n,Gt(t.path.popLast()),e]}function om(n,t,e,r){return{indexId:n,uid:t,sequenceNumber:e,readTime:xn(r.readTime),documentKey:Gt(r.documentKey.path),largestBatchId:r.largestBatchId}}var cc=class{getBundleMetadata(t,e){return am(t).get(e).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:kn(s.createTime),version:s.version}}(r)})}saveBundleMetadata(t,e){return am(t).put(function(i){return{bundleId:i.id,createTime:xn(gt(i.createTime)),version:i.version}}(e))}getNamedQuery(t,e){return um(t).get(e).next(r=>{if(r)return function(s){return{name:s.name,query:Ml(s.bundledQuery),readTime:kn(s.readTime)}}(r)})}saveNamedQuery(t,e){return um(t).put(function(i){return{name:i.name,readTime:xn(gt(i.readTime)),bundledQuery:i.bundledQuery}}(e))}};function am(n){return Rt(n,"bundles")}function um(n){return Rt(n,"namedQueries")}var Eo=class n{constructor(t,e){this.serializer=t,this.userId=e}static lt(t,e){let r=e.uid||"";return new n(t,r)}getOverlay(t,e){return yi(t).get(sm(this.userId,e)).next(r=>r?Eu(this.serializer,r):null)}getOverlays(t,e){let r=he();return b.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(t,e,r){let i=[];return r.forEach((s,o)=>{let u=new Mi(e,o);i.push(this.ht(t,u))}),b.waitFor(i)}removeOverlaysForBatchId(t,e,r){let i=new Set;e.forEach(o=>i.add(Gt(o.getCollectionPath())));let s=[];return i.forEach(o=>{let u=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(yi(t).j("collectionPathOverlayIndex",u))}),b.waitFor(s)}getOverlaysForCollection(t,e,r){let i=he(),s=Gt(e),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return yi(t).U("collectionPathOverlayIndex",o).next(u=>{for(let c of u){let h=Eu(this.serializer,c);i.set(h.getKey(),h)}return i})}getOverlaysForCollectionGroup(t,e,r,i){let s=he(),o,u=IDBKeyRange.bound([this.userId,e,r],[this.userId,e,Number.POSITIVE_INFINITY],!0);return yi(t).J({index:"collectionGroupOverlayIndex",range:u},(c,h,f)=>{let p=Eu(this.serializer,h);s.size()<i||p.largestBatchId===o?(s.set(p.getKey(),p),o=p.largestBatchId):f.done()}).next(()=>s)}ht(t,e){return yi(t).put(function(i,s,o){let[u,c,h]=sm(s,o.mutation.key);return{userId:s,collectionPath:c,documentId:h,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:qi(i.ct,o.mutation)}}(this.serializer,this.userId,e))}};function yi(n){return Rt(n,"documentOverlays")}var lc=class{Pt(t){return Rt(t,"globals")}getSessionToken(t){return this.Pt(t).get("sessionToken").next(e=>{let r=e?.value;return r?yt.fromUint8Array(r):yt.EMPTY_BYTE_STRING})}setSessionToken(t,e){return this.Pt(t).put({name:"sessionToken",value:e.toUint8Array()})}};var Re=class{constructor(){}It(t,e){this.Tt(t,e),e.Et()}Tt(t,e){if("nullValue"in t)this.dt(e,5);else if("booleanValue"in t)this.dt(e,10),e.At(t.booleanValue?1:0);else if("integerValue"in t)this.dt(e,15),e.At(ut(t.integerValue));else if("doubleValue"in t){let r=ut(t.doubleValue);isNaN(r)?this.dt(e,13):(this.dt(e,15),xi(r)?e.At(0):e.At(r))}else if("timestampValue"in t){let r=t.timestampValue;this.dt(e,20),typeof r=="string"&&(r=Se(r)),e.Rt(`${r.seconds||""}`),e.At(r.nanos||0)}else if("stringValue"in t)this.Vt(t.stringValue,e),this.ft(e);else if("bytesValue"in t)this.dt(e,30),e.gt(He(t.bytesValue)),this.ft(e);else if("referenceValue"in t)this.yt(t.referenceValue,e);else if("geoPointValue"in t){let r=t.geoPointValue;this.dt(e,45),e.At(r.latitude||0),e.At(r.longitude||0)}else"mapValue"in t?Km(t)?this.dt(e,Number.MAX_SAFE_INTEGER):ra(t)?this.wt(t.mapValue,e):(this.St(t.mapValue,e),this.ft(e)):"arrayValue"in t?(this.bt(t.arrayValue,e),this.ft(e)):U()}Vt(t,e){this.dt(e,25),this.Dt(t,e)}Dt(t,e){e.Rt(t)}St(t,e){let r=t.fields||{};this.dt(e,55);for(let i of Object.keys(r))this.Vt(i,e),this.Tt(r[i],e)}wt(t,e){var r,i;let s=t.fields||{};this.dt(e,53);let o="value",u=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.dt(e,15),e.At(ut(u)),this.Vt(o,e),this.Tt(s[o],e)}bt(t,e){let r=t.values||[];this.dt(e,50);for(let i of r)this.Tt(i,e)}yt(t,e){this.dt(e,37),M.fromName(t).path.forEach(r=>{this.dt(e,60),this.Dt(r,e)})}dt(t,e){t.At(e)}ft(t){t.At(2)}};Re.vt=new Re;function zv(n){if(n===0)return 8;let t=0;return!(n>>4)&&(t+=4,n<<=4),!(n>>6)&&(t+=2,n<<=2),!(n>>7)&&(t+=1),t}function cm(n){let t=64-function(r){let i=0;for(let s=0;s<8;++s){let o=zv(255&r[s]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(t/8)}var hc=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(t){let e=t[Symbol.iterator](),r=e.next();for(;!r.done;)this.Ft(r.value),r=e.next();this.Mt()}xt(t){let e=t[Symbol.iterator](),r=e.next();for(;!r.done;)this.Ot(r.value),r=e.next();this.Nt()}Lt(t){for(let e of t){let r=e.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(e<"\uD800"||"\uDBFF"<e)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{let i=e.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Bt(t){for(let e of t){let r=e.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(e<"\uD800"||"\uDBFF"<e)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{let i=e.codePointAt(0);this.Ot(240|i>>>18),this.Ot(128|63&i>>>12),this.Ot(128|63&i>>>6),this.Ot(128|63&i)}}this.Nt()}kt(t){let e=this.qt(t),r=cm(e);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let i=e.length-r;i<e.length;++i)this.buffer[this.position++]=255&e[i]}Kt(t){let e=this.qt(t),r=cm(e);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let i=e.length-r;i<e.length;++i)this.buffer[this.position++]=~(255&e[i])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(t){this.Qt(t.length),this.buffer.set(t,this.position),this.position+=t.length}zt(){return this.buffer.slice(0,this.position)}qt(t){let e=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(t),r=(128&e[0])!=0;e[0]^=r?255:128;for(let i=1;i<e.length;++i)e[i]^=r?255:0;return e}Ft(t){let e=255&t;e===0?(this.Ut(0),this.Ut(255)):e===255?(this.Ut(255),this.Ut(0)):this.Ut(e)}Ot(t){let e=255&t;e===0?(this.Gt(0),this.Gt(255)):e===255?(this.Gt(255),this.Gt(0)):this.Gt(t)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(t){this.Qt(1),this.buffer[this.position++]=t}Gt(t){this.Qt(1),this.buffer[this.position++]=~t}Qt(t){let e=t+this.position;if(e<=this.buffer.length)return;let r=2*this.buffer.length;r<e&&(r=e);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},dc=class{constructor(t){this.jt=t}gt(t){this.jt.Ct(t)}Rt(t){this.jt.Lt(t)}At(t){this.jt.kt(t)}Et(){this.jt.$t()}},fc=class{constructor(t){this.jt=t}gt(t){this.jt.xt(t)}Rt(t){this.jt.Bt(t)}At(t){this.jt.Kt(t)}Et(){this.jt.Wt()}},Tn=class{constructor(){this.jt=new hc,this.Ht=new dc(this.jt),this.Jt=new fc(this.jt)}seed(t){this.jt.seed(t)}Yt(t){return t===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}};var In=class n{constructor(t,e,r,i){this.indexId=t,this.documentKey=e,this.arrayValue=r,this.directionalValue=i}Zt(){let t=this.directionalValue.length,e=t===0||this.directionalValue[t-1]===255?t+1:t,r=new Uint8Array(e);return r.set(this.directionalValue,0),e!==t?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function ze(n,t){let e=n.indexId-t.indexId;return e!==0?e:(e=lm(n.arrayValue,t.arrayValue),e!==0?e:(e=lm(n.directionalValue,t.directionalValue),e!==0?e:M.comparator(n.documentKey,t.documentKey)))}function lm(n,t){for(let e=0;e<n.length&&e<t.length;++e){let r=n[e]-t[e];if(r!==0)return r}return n.length-t.length}var Ao=class{constructor(t){this.Xt=new it((e,r)=>At.comparator(e.field,r.field)),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.en=t.orderBy,this.tn=[];for(let e of t.filters){let r=e;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(t){if(q(t.collectionGroup===this.collectionId),this.nn)return!1;let e=Nu(t);if(e!==void 0&&!this.sn(e))return!1;let r=yn(t),i=new Set,s=0,o=0;for(;s<r.length&&this.sn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Xt.size>0){let u=this.Xt.getIterator().getNext();if(!i.has(u.field.canonicalString())){let c=r[s];if(!this.on(u,c)||!this._n(this.en[o++],c))return!1}++s}for(;s<r.length;++s){let u=r[s];if(o>=this.en.length||!this._n(this.en[o++],u))return!1}return!0}an(){if(this.nn)return null;let t=new it(At.comparator),e=[];for(let r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")e.push(new hr(r.field,2));else{if(t.has(r.field))continue;t=t.add(r.field),e.push(new hr(r.field,0))}for(let r of this.en)r.field.isKeyField()||t.has(r.field)||(t=t.add(r.field),e.push(new hr(r.field,r.dir==="asc"?0:1)));return new gr(gr.UNKNOWN_ID,this.collectionId,e,Ci.empty())}sn(t){for(let e of this.tn)if(this.on(e,t))return!0;return!1}on(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;let r=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===r}_n(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}};function kp(n){var t,e;if(q(n instanceof H||n instanceof nt),n instanceof H){if(n instanceof mo){let i=((e=(t=n.value.arrayValue)===null||t===void 0?void 0:t.values)===null||e===void 0?void 0:e.map(s=>H.create(n.field,"==",s)))||[];return nt.create(i,"or")}return n}let r=n.filters.map(i=>kp(i));return nt.create(r,n.op)}function jv(n){if(n.getFilters().length===0)return[];let t=gc(kp(n));return q(Dp(t)),mc(t)||pc(t)?[t]:t.getFilters()}function mc(n){return n instanceof H}function pc(n){return n instanceof nt&&Dl(n)}function Dp(n){return mc(n)||pc(n)||function(e){if(e instanceof nt&&zu(e)){for(let r of e.getFilters())if(!mc(r)&&!pc(r))return!1;return!0}return!1}(n)}function gc(n){if(q(n instanceof H||n instanceof nt),n instanceof H)return n;if(n.filters.length===1)return gc(n.filters[0]);let t=n.filters.map(r=>gc(r)),e=nt.create(t,n.op);return e=Ro(e),Dp(e)?e:(q(e instanceof nt),q(wr(e)),q(e.filters.length>1),e.filters.reduce((r,i)=>Fl(r,i)))}function Fl(n,t){let e;return q(n instanceof H||n instanceof nt),q(t instanceof H||t instanceof nt),e=n instanceof H?t instanceof H?function(i,s){return nt.create([i,s],"and")}(n,t):hm(n,t):t instanceof H?hm(t,n):function(i,s){if(q(i.filters.length>0&&s.filters.length>0),wr(i)&&wr(s))return Ym(i,s.getFilters());let o=zu(i)?i:s,u=zu(i)?s:i,c=o.filters.map(h=>Fl(h,u));return nt.create(c,"or")}(n,t),Ro(e)}function hm(n,t){if(wr(t))return Ym(t,n.getFilters());{let e=t.filters.map(r=>Fl(n,r));return nt.create(e,"or")}}function Ro(n){if(q(n instanceof H||n instanceof nt),n instanceof H)return n;let t=n.getFilters();if(t.length===1)return Ro(t[0]);if(Hm(n))return n;let e=t.map(i=>Ro(i)),r=[];return e.forEach(i=>{i instanceof H?r.push(i):i instanceof nt&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:nt.create(r,n.op)}var _c=class{constructor(){this.un=new zi}addToCollectionParentIndex(t,e){return this.un.add(e),b.resolve()}getCollectionParents(t,e){return b.resolve(this.un.getEntries(e))}addFieldIndex(t,e){return b.resolve()}deleteFieldIndex(t,e){return b.resolve()}deleteAllFieldIndexes(t){return b.resolve()}createTargetIndexes(t,e){return b.resolve()}getDocumentsMatchingTarget(t,e){return b.resolve(null)}getIndexType(t,e){return b.resolve(0)}getFieldIndexes(t,e){return b.resolve([])}getNextCollectionGroupToUpdate(t){return b.resolve(null)}getMinOffset(t,e){return b.resolve(te.min())}getMinOffsetFromCollectionGroup(t,e){return b.resolve(te.min())}updateCollectionGroup(t,e,r){return b.resolve()}updateIndexEntries(t,e){return b.resolve()}},zi=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),r=t.popLast(),i=this.index[e]||new it(Y.comparator),s=!i.has(r);return this.index[e]=i.add(r),s}has(t){let e=t.lastSegment(),r=t.popLast(),i=this.index[e];return i&&i.has(r)}getEntries(t){return(this.index[t]||new it(Y.comparator)).toArray()}};var Hs=new Uint8Array(0),yc=class{constructor(t,e){this.databaseId=e,this.cn=new zi,this.ln=new ye(r=>Pn(r),(r,i)=>ts(r,i)),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.cn.has(e)){let r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(()=>{this.cn.add(e)});let s={collectionId:r,parent:Gt(i)};return dm(t).put(s)}return b.resolve()}getCollectionParents(t,e){let r=[],i=IDBKeyRange.bound([e,""],[Om(e),""],!1,!0);return dm(t).U(i).next(s=>{for(let o of s){if(o.collectionId!==e)break;r.push(le(o.parent))}return r})}addFieldIndex(t,e){let r=wi(t),i=function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(e);delete i.indexId;let s=r.add(i);if(e.indexState){let o=rr(t);return s.next(u=>{o.put(om(u,this.uid,e.indexState.sequenceNumber,e.indexState.offset))})}return s.next()}deleteFieldIndex(t,e){let r=wi(t),i=rr(t),s=nr(t);return r.delete(e.indexId).next(()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))}deleteAllFieldIndexes(t){let e=wi(t),r=nr(t),i=rr(t);return e.j().next(()=>r.j()).next(()=>i.j())}createTargetIndexes(t,e){return b.forEach(this.hn(e),r=>this.getIndexType(t,r).next(i=>{if(i===0||i===1){let s=new Ao(r).an();if(s!=null)return this.addFieldIndex(t,s)}}))}getDocumentsMatchingTarget(t,e){let r=nr(t),i=!0,s=new Map;return b.forEach(this.hn(e),o=>this.Pn(t,o).next(u=>{i&&(i=!!u),s.set(o,u)})).next(()=>{if(i){let o=W(),u=[];return b.forEach(s,(c,h)=>{V("IndexedDbIndexManager",`Using index ${function(F){return`id=${F.indexId}|cg=${F.collectionGroup}|f=${F.fields.map(G=>`${G.fieldPath}:${G.kind}`).join(",")}`}(c)} to execute ${Pn(e)}`);let f=function(F,G){let Q=Nu(G);if(Q===void 0)return null;for(let $ of go(F,Q.fieldPath))switch($.op){case"array-contains-any":return $.value.arrayValue.values||[];case"array-contains":return[$.value]}return null}(h,c),p=function(F,G){let Q=new Map;for(let $ of yn(G))for(let v of go(F,$.fieldPath))switch(v.op){case"==":case"in":Q.set($.fieldPath.canonicalString(),v.value);break;case"not-in":case"!=":return Q.set($.fieldPath.canonicalString(),v.value),Array.from(Q.values())}return null}(h,c),_=function(F,G){let Q=[],$=!0;for(let v of yn(G)){let g=v.kind===0?$f(F,v.fieldPath,F.startAt):Kf(F,v.fieldPath,F.startAt);Q.push(g.value),$&&($=g.inclusive)}return new _e(Q,$)}(h,c),E=function(F,G){let Q=[],$=!0;for(let v of yn(G)){let g=v.kind===0?Kf(F,v.fieldPath,F.endAt):$f(F,v.fieldPath,F.endAt);Q.push(g.value),$&&($=g.inclusive)}return new _e(Q,$)}(h,c),x=this.In(c,h,_),D=this.In(c,h,E),k=this.Tn(c,h,p),B=this.En(c.indexId,f,x,_.inclusive,D,E.inclusive,k);return b.forEach(B,z=>r.G(z,e.limit).next(F=>{F.forEach(G=>{let Q=M.fromSegments(G.documentKey);o.has(Q)||(o=o.add(Q),u.push(Q))})}))}).next(()=>u)}return b.resolve(null)})}hn(t){let e=this.ln.get(t);return e||(t.filters.length===0?e=[t]:e=jv(nt.create(t.filters,"and")).map(r=>Yu(t.path,t.collectionGroup,t.orderBy,r.getFilters(),t.limit,t.startAt,t.endAt)),this.ln.set(t,e),e)}En(t,e,r,i,s,o,u){let c=(e!=null?e.length:1)*Math.max(r.length,s.length),h=c/(e!=null?e.length:1),f=[];for(let p=0;p<c;++p){let _=e?this.dn(e[p/h]):Hs,E=this.An(t,_,r[p%h],i),x=this.Rn(t,_,s[p%h],o),D=u.map(k=>this.An(t,_,k,!0));f.push(...this.createRange(E,x,D))}return f}An(t,e,r,i){let s=new In(t,M.empty(),e,r);return i?s:s.Zt()}Rn(t,e,r,i){let s=new In(t,M.empty(),e,r);return i?s.Zt():s}Pn(t,e){let r=new Ao(e),i=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,i).next(s=>{let o=null;for(let u of s)r.rn(u)&&(!o||u.fields.length>o.fields.length)&&(o=u);return o})}getIndexType(t,e){let r=2,i=this.hn(e);return b.forEach(i,s=>this.Pn(t,s).next(o=>{o?r!==0&&o.fields.length<function(c){let h=new it(At.comparator),f=!1;for(let p of c.filters)for(let _ of p.getFlattenedFilters())_.field.isKeyField()||(_.op==="array-contains"||_.op==="array-contains-any"?f=!0:h=h.add(_.field));for(let p of c.orderBy)p.field.isKeyField()||(h=h.add(p.field));return h.size+(f?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(e)&&i.length>1&&r===2?1:r)}Vn(t,e){let r=new Tn;for(let i of yn(t)){let s=e.data.field(i.fieldPath);if(s==null)return null;let o=r.Yt(i.kind);Re.vt.It(s,o)}return r.zt()}dn(t){let e=new Tn;return Re.vt.It(t,e.Yt(0)),e.zt()}mn(t,e){let r=new Tn;return Re.vt.It(bn(this.databaseId,e),r.Yt(function(s){let o=yn(s);return o.length===0?0:o[o.length-1].kind}(t))),r.zt()}Tn(t,e,r){if(r===null)return[];let i=[];i.push(new Tn);let s=0;for(let o of yn(t)){let u=r[s++];for(let c of i)if(this.fn(e,o.fieldPath)&&Ni(u))i=this.gn(i,o,u);else{let h=c.Yt(o.kind);Re.vt.It(u,h)}}return this.pn(i)}In(t,e,r){return this.Tn(t,e,r.position)}pn(t){let e=[];for(let r=0;r<t.length;++r)e[r]=t[r].zt();return e}gn(t,e,r){let i=[...t],s=[];for(let o of r.arrayValue.values||[])for(let u of i){let c=new Tn;c.seed(u.zt()),Re.vt.It(o,c.Yt(e.kind)),s.push(c)}return s}fn(t,e){return!!t.filters.find(r=>r instanceof H&&r.field.isEqual(e)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(t,e){let r=wi(t),i=rr(t);return(e?r.U("collectionGroupIndex",IDBKeyRange.bound(e,e)):r.U()).next(s=>{let o=[];return b.forEach(s,u=>i.get([u.indexId,this.uid]).next(c=>{o.push(function(f,p){let _=p?new Ci(p.sequenceNumber,new te(kn(p.readTime),new M(le(p.documentKey)),p.largestBatchId)):Ci.empty(),E=f.fields.map(([x,D])=>new hr(At.fromServerFormat(x),D));return new gr(f.indexId,f.collectionGroup,E,_)}(u,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next(e=>e.length===0?null:(e.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:K(r.collectionGroup,i.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(t,e,r){let i=wi(t),s=rr(t);return this.yn(t).next(o=>i.U("collectionGroupIndex",IDBKeyRange.bound(e,e)).next(u=>b.forEach(u,c=>s.put(om(c.indexId,this.uid,o,r)))))}updateIndexEntries(t,e){let r=new Map;return b.forEach(e,(i,s)=>{let o=r.get(i.collectionGroup);return(o?b.resolve(o):this.getFieldIndexes(t,i.collectionGroup)).next(u=>(r.set(i.collectionGroup,u),b.forEach(u,c=>this.wn(t,i,c).next(h=>{let f=this.Sn(s,c);return h.isEqual(f)?b.resolve():this.bn(t,s,c,h,f)}))))})}Dn(t,e,r,i){return nr(t).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.mn(r,e.key),documentKey:e.key.path.toArray()})}vn(t,e,r,i){return nr(t).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.mn(r,e.key),e.key.path.toArray()])}wn(t,e,r){let i=nr(t),s=new it(ze);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,e)])},(o,u)=>{s=s.add(new In(r.indexId,e,u.arrayValue,u.directionalValue))}).next(()=>s)}Sn(t,e){let r=new it(ze),i=this.Vn(e,t);if(i==null)return r;let s=Nu(e);if(s!=null){let o=t.data.field(s.fieldPath);if(Ni(o))for(let u of o.arrayValue.values||[])r=r.add(new In(e.indexId,t.key,this.dn(u),i))}else r=r.add(new In(e.indexId,t.key,Hs,i));return r}bn(t,e,r,i,s){V("IndexedDbIndexManager","Updating index entries for document '%s'",e.key);let o=[];return function(c,h,f,p,_){let E=c.getIterator(),x=h.getIterator(),D=er(E),k=er(x);for(;D||k;){let B=!1,z=!1;if(D&&k){let F=f(D,k);F<0?z=!0:F>0&&(B=!0)}else D!=null?z=!0:B=!0;B?(p(k),k=er(x)):z?(_(D),D=er(E)):(D=er(E),k=er(x))}}(i,s,ze,u=>{o.push(this.Dn(t,e,r,u))},u=>{o.push(this.vn(t,e,r,u))}),b.waitFor(o)}yn(t){let e=1;return rr(t).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),e=i.sequenceNumber+1}).next(()=>e)}createRange(t,e,r){r=r.sort((o,u)=>ze(o,u)).filter((o,u,c)=>!u||ze(o,c[u-1])!==0);let i=[];i.push(t);for(let o of r){let u=ze(o,t),c=ze(o,e);if(u===0)i[0]=t.Zt();else if(u>0&&c<0)i.push(o),i.push(o.Zt());else if(c>0)break}i.push(e);let s=[];for(let o=0;o<i.length;o+=2){if(this.Cn(i[o],i[o+1]))return[];let u=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Hs,[]],c=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Hs,[]];s.push(IDBKeyRange.bound(u,c))}return s}Cn(t,e){return ze(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(fm)}getMinOffset(t,e){return b.mapArray(this.hn(e),r=>this.Pn(t,r).next(i=>i||U())).next(fm)}};function dm(n){return Rt(n,"collectionParents")}function nr(n){return Rt(n,"indexEntries")}function wi(n){return Rt(n,"indexConfiguration")}function rr(n){return Rt(n,"indexState")}function fm(n){q(n.length!==0);let t=n[0].indexState.offset,e=t.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;Pl(i,t)<0&&(t=i),e<i.largestBatchId&&(e=i.largestBatchId)}return new te(t.readTime,t.documentKey,e)}var mm={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Zt=class n{constructor(t,e,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=r}static withCacheSize(t){return new n(t,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function Vp(n,t,e){let r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(e.batchId),u=0,c=r.J({range:o},(f,p,_)=>(u++,_.delete()));s.push(c.next(()=>{q(u===1)}));let h=[];for(let f of e.mutations){let p=qm(t,f.key.path,e.batchId);s.push(i.delete(p)),h.push(f.key)}return b.waitFor(s).next(()=>h)}function bo(n){if(!n)return 0;let t;if(n.document)t=n.document;else if(n.unknownDocument)t=n.unknownDocument;else{if(!n.noDocument)throw U();t=n.noDocument}return JSON.stringify(t).length}Zt.DEFAULT_COLLECTION_PERCENTILE=10,Zt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Zt.DEFAULT=new Zt(41943040,Zt.DEFAULT_COLLECTION_PERCENTILE,Zt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Zt.DISABLED=new Zt(-1,0,0);var So=class n{constructor(t,e,r,i){this.userId=t,this.serializer=e,this.indexManager=r,this.referenceDelegate=i,this.Fn={}}static lt(t,e,r,i){q(t.uid!=="");let s=t.isAuthenticated()?t.uid:"";return new n(s,e,r,i)}checkEmpty(t){let e=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return je(t).J({index:"userMutationsIndex",range:r},(i,s,o)=>{e=!1,o.done()}).next(()=>e)}addMutationBatch(t,e,r,i){let s=cr(t),o=je(t);return o.add({}).next(u=>{q(typeof u=="number");let c=new Li(u,e,r,i),h=function(E,x,D){let k=D.baseMutations.map(z=>qi(E.ct,z)),B=D.mutations.map(z=>qi(E.ct,z));return{userId:x,batchId:D.batchId,localWriteTimeMs:D.localWriteTime.toMillis(),baseMutations:k,mutations:B}}(this.serializer,this.userId,c),f=[],p=new it((_,E)=>K(_.canonicalString(),E.canonicalString()));for(let _ of i){let E=qm(this.userId,_.key.path,u);p=p.add(_.key.path.popLast()),f.push(o.put(h)),f.push(s.put(E,Hw))}return p.forEach(_=>{f.push(this.indexManager.addToCollectionParentIndex(t,_))}),t.addOnCommittedListener(()=>{this.Fn[u]=c.keys()}),b.waitFor(f).next(()=>c)})}lookupMutationBatch(t,e){return je(t).get(e).next(r=>r?(q(r.userId===this.userId),vn(this.serializer,r)):null)}Mn(t,e){return this.Fn[e]?b.resolve(this.Fn[e]):this.lookupMutationBatch(t,e).next(r=>{if(r){let i=r.keys();return this.Fn[e]=i,i}return null})}getNextMutationBatchAfterBatchId(t,e){let r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return je(t).J({index:"userMutationsIndex",range:i},(o,u,c)=>{u.userId===this.userId&&(q(u.batchId>=r),s=vn(this.serializer,u)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(t){let e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return je(t).J({index:"userMutationsIndex",range:e,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(t){let e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return je(t).U("userMutationsIndex",e).next(r=>r.map(i=>vn(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(t,e){let r=Zs(this.userId,e.path),i=IDBKeyRange.lowerBound(r),s=[];return cr(t).J({range:i},(o,u,c)=>{let[h,f,p]=o,_=le(f);if(h===this.userId&&e.path.isEqual(_))return je(t).get(p).next(E=>{if(!E)throw U();q(E.userId===this.userId),s.push(vn(this.serializer,E))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new it(K),i=[];return e.forEach(s=>{let o=Zs(this.userId,s.path),u=IDBKeyRange.lowerBound(o),c=cr(t).J({range:u},(h,f,p)=>{let[_,E,x]=h,D=le(E);_===this.userId&&s.path.isEqual(D)?r=r.add(x):p.done()});i.push(c)}),b.waitFor(i).next(()=>this.xn(t,r))}getAllMutationBatchesAffectingQuery(t,e){let r=e.path,i=r.length+1,s=Zs(this.userId,r),o=IDBKeyRange.lowerBound(s),u=new it(K);return cr(t).J({range:o},(c,h,f)=>{let[p,_,E]=c,x=le(_);p===this.userId&&r.isPrefixOf(x)?x.length===i&&(u=u.add(E)):f.done()}).next(()=>this.xn(t,u))}xn(t,e){let r=[],i=[];return e.forEach(s=>{i.push(je(t).get(s).next(o=>{if(o===null)throw U();q(o.userId===this.userId),r.push(vn(this.serializer,o))}))}),b.waitFor(i).next(()=>r)}removeMutationBatch(t,e){return Vp(t._e,this.userId,e).next(r=>(t.addOnCommittedListener(()=>{this.On(e.batchId)}),b.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(t,i))))}On(t){delete this.Fn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return b.resolve();let r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return cr(t).J({range:r},(s,o,u)=>{if(s[0]===this.userId){let c=le(s[1]);i.push(c)}else u.done()}).next(()=>{q(i.length===0)})})}containsKey(t,e){return Np(t,this.userId,e)}Nn(t){return Op(t).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function Np(n,t,e){let r=Zs(t,e.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return cr(n).J({range:s,H:!0},(u,c,h)=>{let[f,p,_]=u;f===t&&p===i&&(o=!0),h.done()}).next(()=>o)}function je(n){return Rt(n,"mutations")}function cr(n){return Rt(n,"documentMutations")}function Op(n){return Rt(n,"mutationQueues")}var Ar=class n{constructor(t){this.Ln=t}next(){return this.Ln+=2,this.Ln}static Bn(){return new n(0)}static kn(){return new n(-1)}};var wc=class{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.qn(t).next(e=>{let r=new Ar(e.highestTargetId);return e.highestTargetId=r.next(),this.Qn(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.qn(t).next(e=>j.fromTimestamp(new pt(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.qn(t).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,e,r){return this.qn(t).next(i=>(i.highestListenSequenceNumber=e,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),this.Qn(t,i)))}addTargetData(t,e){return this.Kn(t,e).next(()=>this.qn(t).next(r=>(r.targetCount+=1,this.$n(e,r),this.Qn(t,r))))}updateTargetData(t,e){return this.Kn(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>ir(t).delete(e.targetId)).next(()=>this.qn(t)).next(r=>(q(r.targetCount>0),r.targetCount-=1,this.Qn(t,r)))}removeTargets(t,e,r){let i=0,s=[];return ir(t).J((o,u)=>{let c=Ei(u);c.sequenceNumber<=e&&r.get(c.targetId)===null&&(i++,s.push(this.removeTargetData(t,c)))}).next(()=>b.waitFor(s)).next(()=>i)}forEachTarget(t,e){return ir(t).J((r,i)=>{let s=Ei(i);e(s)})}qn(t){return pm(t).get("targetGlobalKey").next(e=>(q(e!==null),e))}Qn(t,e){return pm(t).put("targetGlobalKey",e)}Kn(t,e){return ir(t).put(xp(this.serializer,e))}$n(t,e){let r=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,r=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,r=!0),r}getTargetCount(t){return this.qn(t).next(e=>e.targetCount)}getTargetData(t,e){let r=Pn(e),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return ir(t).J({range:i,index:"queryTargetsIndex"},(o,u,c)=>{let h=Ei(u);ts(e,h.target)&&(s=h,c.done())}).next(()=>s)}addMatchingKeys(t,e,r){let i=[],s=Ge(t);return e.forEach(o=>{let u=Gt(o.path);i.push(s.put({targetId:r,path:u})),i.push(this.referenceDelegate.addReference(t,r,o))}),b.waitFor(i)}removeMatchingKeys(t,e,r){let i=Ge(t);return b.forEach(e,s=>{let o=Gt(s.path);return b.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(t,r,s)])})}removeMatchingKeysForTargetId(t,e){let r=Ge(t),i=IDBKeyRange.bound([e],[e+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(t,e){let r=IDBKeyRange.bound([e],[e+1],!1,!0),i=Ge(t),s=W();return i.J({range:r,H:!0},(o,u,c)=>{let h=le(o[1]),f=new M(h);s=s.add(f)}).next(()=>s)}containsKey(t,e){let r=Gt(e.path),i=IDBKeyRange.bound([r],[Om(r)],!1,!0),s=0;return Ge(t).J({index:"documentTargetsIndex",H:!0,range:i},([o,u],c,h)=>{o!==0&&(s++,h.done())}).next(()=>s>0)}ot(t,e){return ir(t).get(e).next(r=>r?Ei(r):null)}};function ir(n){return Rt(n,"targets")}function pm(n){return Rt(n,"targetGlobal")}function Ge(n){return Rt(n,"targetDocuments")}function gm([n,t],[e,r]){let i=K(n,e);return i===0?K(t,r):i}var vc=class{constructor(t){this.Un=t,this.buffer=new it(gm),this.Wn=0}Gn(){return++this.Wn}zn(t){let e=[t,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(e);else{let r=this.buffer.last();gm(e,r)<0&&(this.buffer=this.buffer.delete(r).add(e))}}get maxValue(){return this.buffer.last()[0]}},Tc=class{constructor(t,e,r){this.garbageCollector=t,this.asyncQueue=e,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(t){V("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>C(this,null,function*(){this.jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){an(e)?V("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):yield on(e)}yield this.Hn(3e5)}))}},Ic=class{constructor(t,e){this.Jn=t,this.params=e}calculateTargetCount(t,e){return this.Jn.Yn(t).next(r=>Math.floor(e/100*r))}nthSequenceNumber(t,e){if(e===0)return b.resolve(Yt.oe);let r=new vc(e);return this.Jn.forEachTarget(t,i=>r.zn(i.sequenceNumber)).next(()=>this.Jn.Zn(t,i=>r.zn(i))).next(()=>r.maxValue)}removeTargets(t,e,r){return this.Jn.removeTargets(t,e,r)}removeOrphanedDocuments(t,e){return this.Jn.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(V("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(mm)):this.getCacheSize(t).next(r=>r<this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),mm):this.Xn(t,e))}getCacheSize(t){return this.Jn.getCacheSize(t)}Xn(t,e){let r,i,s,o,u,c,h,f=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(V("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),i=this.params.maximumSequenceNumbersToCollect):i=p,o=Date.now(),this.nthSequenceNumber(t,i))).next(p=>(r=p,u=Date.now(),this.removeTargets(t,r,e))).next(p=>(s=p,c=Date.now(),this.removeOrphanedDocuments(t,r))).next(p=>(h=Date.now(),sr()<=ue.DEBUG&&V("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-f}ms
	Determined least recently used ${i} in `+(u-o)+`ms
	Removed ${s} targets in `+(c-u)+`ms
	Removed ${p} documents in `+(h-c)+`ms
Total Duration: ${h-f}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:p})))}};function Gv(n,t){return new Ic(n,t)}var Ec=class{constructor(t,e){this.db=t,this.garbageCollector=Gv(this,e)}Yn(t){let e=this.er(t);return this.db.getTargetCache().getTargetCount(t).next(r=>e.next(i=>r+i))}er(t){let e=0;return this.Zn(t,r=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}Zn(t,e){return this.tr(t,(r,i)=>e(i))}addReference(t,e,r){return Xs(t,r)}removeReference(t,e,r){return Xs(t,r)}removeTargets(t,e,r){return this.db.getTargetCache().removeTargets(t,e,r)}markPotentiallyOrphaned(t,e){return Xs(t,e)}nr(t,e){return function(i,s){let o=!1;return Op(i).Y(u=>Np(i,u,s).next(c=>(c&&(o=!0),b.resolve(!c)))).next(()=>o)}(t,e)}removeOrphanedDocuments(t,e){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.tr(t,(o,u)=>{if(u<=e){let c=this.nr(t,o).next(h=>{if(!h)return s++,r.getEntry(t,o).next(()=>(r.removeEntry(o,j.min()),Ge(t).delete(function(p){return[0,Gt(p.path)]}(o))))});i.push(c)}}).next(()=>b.waitFor(i)).next(()=>r.apply(t)).next(()=>s)}removeTarget(t,e){let r=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,r)}updateLimboDocument(t,e){return Xs(t,e)}tr(t,e){let r=Ge(t),i,s=Yt.oe;return r.J({index:"documentTargetsIndex"},([o,u],{path:c,sequenceNumber:h})=>{o===0?(s!==Yt.oe&&e(new M(le(i)),s),s=h,i=c):s=Yt.oe}).next(()=>{s!==Yt.oe&&e(new M(le(i)),s)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}};function Xs(n,t){return Ge(n).put(function(r,i){return{targetId:0,path:Gt(r.path),sequenceNumber:i}}(t,n.currentSequenceNumber))}var Po=class{constructor(){this.changes=new ye(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Et.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let r=this.changes.get(e);return r!==void 0?b.resolve(r):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var Ac=class{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,r){return _n(t).put(r)}removeEntry(t,e,r){return _n(t).delete(function(s,o){let u=s.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Io(o),u[u.length-1]]}(e,r))}updateMetadata(t,e){return this.getMetadata(t).next(r=>(r.byteSize+=e,this.rr(t,r)))}getEntry(t,e){let r=Et.newInvalidDocument(e);return _n(t).J({index:"documentKeyIndex",range:IDBKeyRange.only(vi(e))},(i,s)=>{r=this.ir(e,s)}).next(()=>r)}sr(t,e){let r={size:0,document:Et.newInvalidDocument(e)};return _n(t).J({index:"documentKeyIndex",range:IDBKeyRange.only(vi(e))},(i,s)=>{r={document:this.ir(e,s),size:bo(s)}}).next(()=>r)}getEntries(t,e){let r=Qt();return this._r(t,e,(i,s)=>{let o=this.ir(i,s);r=r.insert(i,o)}).next(()=>r)}ar(t,e){let r=Qt(),i=new ot(M.comparator);return this._r(t,e,(s,o)=>{let u=this.ir(s,o);r=r.insert(s,u),i=i.insert(s,bo(o))}).next(()=>({documents:r,ur:i}))}_r(t,e,r){if(e.isEmpty())return b.resolve();let i=new it(wm);e.forEach(c=>i=i.add(c));let s=IDBKeyRange.bound(vi(i.first()),vi(i.last())),o=i.getIterator(),u=o.getNext();return _n(t).J({index:"documentKeyIndex",range:s},(c,h,f)=>{let p=M.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;u&&wm(u,p)<0;)r(u,null),u=o.getNext();u&&u.isEqual(p)&&(r(u,h),u=o.hasNext()?o.getNext():null),u?f.$(vi(u)):f.done()}).next(()=>{for(;u;)r(u,null),u=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(t,e,r,i,s){let o=e.path,u=[o.popLast().toArray(),o.lastSegment(),Io(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return _n(t).U(IDBKeyRange.bound(u,c,!0)).next(h=>{s?.incrementDocumentReadCount(h.length);let f=Qt();for(let p of h){let _=this.ir(M.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);_.isFoundDocument()&&(ns(e,_)||i.has(_.key))&&(f=f.insert(_.key,_))}return f})}getAllFromCollectionGroup(t,e,r,i){let s=Qt(),o=ym(e,r),u=ym(e,te.max());return _n(t).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,u,!0)},(c,h,f)=>{let p=this.ir(M.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);s=s.insert(p.key,p),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(t){return new Rc(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(e=>e.byteSize)}getMetadata(t){return _m(t).get("remoteDocumentGlobalKey").next(e=>(q(!!e),e))}rr(t,e){return _m(t).put("remoteDocumentGlobalKey",e)}ir(t,e){if(e){let r=qv(this.serializer,e);if(!(r.isNoDocument()&&r.version.isEqual(j.min())))return r}return Et.newInvalidDocument(t)}};function Lp(n){return new Ac(n)}var Rc=class extends Po{constructor(t,e){super(),this.cr=t,this.trackRemovals=e,this.lr=new ye(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(t){let e=[],r=0,i=new it((s,o)=>K(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let u=this.lr.get(s);if(e.push(this.cr.removeEntry(t,s,u.readTime)),o.isValidDocument()){let c=im(this.cr.serializer,o);i=i.add(s.path.popLast());let h=bo(c);r+=h-u.size,e.push(this.cr.addEntry(t,s,c))}else if(r-=u.size,this.trackRemovals){let c=im(this.cr.serializer,o.convertToNoDocument(j.min()));e.push(this.cr.addEntry(t,s,c))}}),i.forEach(s=>{e.push(this.cr.indexManager.addToCollectionParentIndex(t,s))}),e.push(this.cr.updateMetadata(t,r)),b.waitFor(e)}getFromCache(t,e){return this.cr.sr(t,e).next(r=>(this.lr.set(e,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(t,e){return this.cr.ar(t,e).next(({documents:r,ur:i})=>(i.forEach((s,o)=>{this.lr.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function _m(n){return Rt(n,"remoteDocumentGlobal")}function _n(n){return Rt(n,"remoteDocumentsV14")}function vi(n){let t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function ym(n,t){let e=t.documentKey.path.toArray();return[n,Io(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function wm(n,t){let e=n.path.toArray(),r=t.path.toArray(),i=0;for(let s=0;s<e.length-2&&s<r.length-2;++s)if(i=K(e[s],r[s]),i)return i;return i=K(e.length,r.length),i||(i=K(e[e.length-2],r[r.length-2]),i||K(e[e.length-1],r[r.length-1]))}var bc=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var Co=class{constructor(t,e,r,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=r,this.indexManager=i}getDocument(t,e){let r=null;return this.documentOverlayCache.getOverlay(t,e).next(i=>(r=i,this.remoteDocumentCache.getEntry(t,e))).next(i=>(r!==null&&bi(r.mutation,i,Jt.empty(),pt.now()),i))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.getLocalViewOfDocuments(t,r,W()).next(()=>r))}getLocalViewOfDocuments(t,e,r=W()){let i=he();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,r).next(s=>{let o=Ii();return s.forEach((u,c)=>{o=o.insert(u,c.overlayedDocument)}),o}))}getOverlayedDocuments(t,e){let r=he();return this.populateOverlays(t,r,e).next(()=>this.computeViews(t,e,r,W()))}populateOverlays(t,e,r){let i=[];return r.forEach(s=>{e.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(t,i).next(s=>{s.forEach((o,u)=>{e.set(o,u)})})}computeViews(t,e,r,i){let s=Qt(),o=Ri(),u=function(){return Ri()}();return e.forEach((c,h)=>{let f=r.get(h.key);i.has(h.key)&&(f===void 0||f.mutation instanceof se)?s=s.insert(h.key,h):f!==void 0?(o.set(h.key,f.mutation.getFieldMask()),bi(f.mutation,h,f.mutation.getFieldMask(),pt.now())):o.set(h.key,Jt.empty())}),this.recalculateAndSaveOverlays(t,s).next(c=>(c.forEach((h,f)=>o.set(h,f)),e.forEach((h,f)=>{var p;return u.set(h,new bc(f,(p=o.get(h))!==null&&p!==void 0?p:null))}),u))}recalculateAndSaveOverlays(t,e){let r=Ri(),i=new ot((o,u)=>o-u),s=W();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(o=>{for(let u of o)u.keys().forEach(c=>{let h=e.get(c);if(h===null)return;let f=r.get(c)||Jt.empty();f=u.applyToLocalView(h,f),r.set(c,f);let p=(i.get(u.batchId)||W()).add(c);i=i.insert(u.batchId,p)})}).next(()=>{let o=[],u=i.getReverseIterator();for(;u.hasNext();){let c=u.getNext(),h=c.key,f=c.value,p=op();f.forEach(_=>{if(!s.has(_)){let E=fp(e.get(_),r.get(_));E!==null&&p.set(_,E),s=s.add(_)}}),o.push(this.documentOverlayCache.saveOverlays(t,h,p))}return b.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.recalculateAndSaveOverlays(t,r))}getDocumentsMatchingQuery(t,e,r,i){return function(o){return M.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Vl(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,r,i):this.getDocumentsMatchingCollectionQuery(t,e,r,i)}getNextDocuments(t,e,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,r.largestBatchId,i-s.size):b.resolve(he()),u=-1,c=s;return o.next(h=>b.forEach(h,(f,p)=>(u<p.largestBatchId&&(u=p.largestBatchId),s.get(f)?b.resolve():this.remoteDocumentCache.getEntry(t,f).next(_=>{c=c.insert(f,_)}))).next(()=>this.populateOverlays(t,h,s)).next(()=>this.computeViews(t,c,h,W())).next(f=>({batchId:u,changes:sp(f)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new M(e)).next(r=>{let i=Ii();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(t,e,r,i){let s=e.collectionGroup,o=Ii();return this.indexManager.getCollectionParents(t,s).next(u=>b.forEach(u,c=>{let h=function(p,_){return new ie(_,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(e,c.child(s));return this.getDocumentsMatchingCollectionQuery(t,h,r,i).next(f=>{f.forEach((p,_)=>{o=o.insert(p,_)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(t,e,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,r,s,i))).next(o=>{s.forEach((c,h)=>{let f=h.getKey();o.get(f)===null&&(o=o.insert(f,Et.newInvalidDocument(f)))});let u=Ii();return o.forEach((c,h)=>{let f=s.get(c);f!==void 0&&bi(f.mutation,h,Jt.empty(),pt.now()),ns(e,h)&&(u=u.insert(c,h))}),u})}};var Sc=class{constructor(t){this.serializer=t,this.hr=new Map,this.Pr=new Map}getBundleMetadata(t,e){return b.resolve(this.hr.get(e))}saveBundleMetadata(t,e){return this.hr.set(e.id,function(i){return{id:i.id,version:i.version,createTime:gt(i.createTime)}}(e)),b.resolve()}getNamedQuery(t,e){return b.resolve(this.Pr.get(e))}saveNamedQuery(t,e){return this.Pr.set(e.name,function(i){return{name:i.name,query:Ml(i.bundledQuery),readTime:gt(i.readTime)}}(e)),b.resolve()}};var Pc=class{constructor(){this.overlays=new ot(M.comparator),this.Ir=new Map}getOverlay(t,e){return b.resolve(this.overlays.get(e))}getOverlays(t,e){let r=he();return b.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(t,e,r){return r.forEach((i,s)=>{this.ht(t,e,s)}),b.resolve()}removeOverlaysForBatchId(t,e,r){let i=this.Ir.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(r)),b.resolve()}getOverlaysForCollection(t,e,r){let i=he(),s=e.length+1,o=new M(e.child("")),u=this.overlays.getIteratorFrom(o);for(;u.hasNext();){let c=u.getNext().value,h=c.getKey();if(!e.isPrefixOf(h.path))break;h.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return b.resolve(i)}getOverlaysForCollectionGroup(t,e,r,i){let s=new ot((h,f)=>h-f),o=this.overlays.getIterator();for(;o.hasNext();){let h=o.getNext().value;if(h.getKey().getCollectionGroup()===e&&h.largestBatchId>r){let f=s.get(h.largestBatchId);f===null&&(f=he(),s=s.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}let u=he(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((h,f)=>u.set(h,f)),!(u.size()>=i)););return b.resolve(u)}ht(t,e,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.Ir.get(i.largestBatchId).delete(r.key);this.Ir.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Mi(e,r));let s=this.Ir.get(e);s===void 0&&(s=W(),this.Ir.set(e,s)),this.Ir.set(e,s.add(r.key))}};var Cc=class{constructor(){this.sessionToken=yt.EMPTY_BYTE_STRING}getSessionToken(t){return b.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,b.resolve()}};var ji=class{constructor(){this.Tr=new it(vt.Er),this.dr=new it(vt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(t,e){let r=new vt(t,e);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(t,e){t.forEach(r=>this.addReference(r,e))}removeReference(t,e){this.Vr(new vt(t,e))}mr(t,e){t.forEach(r=>this.removeReference(r,e))}gr(t){let e=new M(new Y([])),r=new vt(e,t),i=new vt(e,t+1),s=[];return this.dr.forEachInRange([r,i],o=>{this.Vr(o),s.push(o.key)}),s}pr(){this.Tr.forEach(t=>this.Vr(t))}Vr(t){this.Tr=this.Tr.delete(t),this.dr=this.dr.delete(t)}yr(t){let e=new M(new Y([])),r=new vt(e,t),i=new vt(e,t+1),s=W();return this.dr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(t){let e=new vt(t,0),r=this.Tr.firstAfterOrEqual(e);return r!==null&&t.isEqual(r.key)}},vt=class{constructor(t,e){this.key=t,this.wr=e}static Er(t,e){return M.comparator(t.key,e.key)||K(t.wr,e.wr)}static Ar(t,e){return K(t.wr,e.wr)||M.comparator(t.key,e.key)}};var xc=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.Sr=1,this.br=new it(vt.Er)}checkEmpty(t){return b.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,r,i){let s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Li(s,e,r,i);this.mutationQueue.push(o);for(let u of i)this.br=this.br.add(new vt(u.key,s)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast());return b.resolve(o)}lookupMutationBatch(t,e){return b.resolve(this.Dr(e))}getNextMutationBatchAfterBatchId(t,e){let r=e+1,i=this.vr(r),s=i<0?0:i;return b.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(t){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let r=new vt(e,0),i=new vt(e,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([r,i],o=>{let u=this.Dr(o.wr);s.push(u)}),b.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new it(K);return e.forEach(i=>{let s=new vt(i,0),o=new vt(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,o],u=>{r=r.add(u.wr)})}),b.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(t,e){let r=e.path,i=r.length+1,s=r;M.isDocumentKey(s)||(s=s.child(""));let o=new vt(new M(s),0),u=new it(K);return this.br.forEachWhile(c=>{let h=c.key.path;return!!r.isPrefixOf(h)&&(h.length===i&&(u=u.add(c.wr)),!0)},o),b.resolve(this.Cr(u))}Cr(t){let e=[];return t.forEach(r=>{let i=this.Dr(r);i!==null&&e.push(i)}),e}removeMutationBatch(t,e){q(this.Fr(e.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return b.forEach(e.mutations,i=>{let s=new vt(i.key,e.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(()=>{this.br=r})}On(t){}containsKey(t,e){let r=new vt(e,0),i=this.br.firstAfterOrEqual(r);return b.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,b.resolve()}Fr(t,e){return this.vr(t)}vr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Dr(t){let e=this.vr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var kc=class{constructor(t){this.Mr=t,this.docs=function(){return new ot(M.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let r=e.key,i=this.docs.get(r),s=i?i.size:0,o=this.Mr(e);return this.docs=this.docs.insert(r,{document:e.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let r=this.docs.get(e);return b.resolve(r?r.document.mutableCopy():Et.newInvalidDocument(e))}getEntries(t,e){let r=Qt();return e.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Et.newInvalidDocument(i))}),b.resolve(r)}getDocumentsMatchingQuery(t,e,r,i){let s=Qt(),o=e.path,u=new M(o.child("")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){let{key:h,value:{document:f}}=c.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||Pl(Mm(f),r)<=0||(i.has(f.key)||ns(e,f))&&(s=s.insert(f.key,f.mutableCopy()))}return b.resolve(s)}getAllFromCollectionGroup(t,e,r,i){U()}Or(t,e){return b.forEach(this.docs,r=>e(r))}newChangeBuffer(t){return new Dc(this)}getSize(t){return b.resolve(this.size)}},Dc=class extends Po{constructor(t){super(),this.cr=t}applyChanges(t){let e=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?e.push(this.cr.addEntry(t,i)):this.cr.removeEntry(r)}),b.waitFor(e)}getFromCache(t,e){return this.cr.getEntry(t,e)}getAllFromCache(t,e){return this.cr.getEntries(t,e)}};var Vc=class{constructor(t){this.persistence=t,this.Nr=new ye(e=>Pn(e),ts),this.lastRemoteSnapshotVersion=j.min(),this.highestTargetId=0,this.Lr=0,this.Br=new ji,this.targetCount=0,this.kr=Ar.Bn()}forEachTarget(t,e){return this.Nr.forEach((r,i)=>e(i)),b.resolve()}getLastRemoteSnapshotVersion(t){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return b.resolve(this.Lr)}allocateTargetId(t){return this.highestTargetId=this.kr.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(t,e,r){return r&&(this.lastRemoteSnapshotVersion=r),e>this.Lr&&(this.Lr=e),b.resolve()}Kn(t){this.Nr.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.kr=new Ar(e),this.highestTargetId=e),t.sequenceNumber>this.Lr&&(this.Lr=t.sequenceNumber)}addTargetData(t,e){return this.Kn(e),this.targetCount+=1,b.resolve()}updateTargetData(t,e){return this.Kn(e),b.resolve()}removeTargetData(t,e){return this.Nr.delete(e.target),this.Br.gr(e.targetId),this.targetCount-=1,b.resolve()}removeTargets(t,e,r){let i=0,s=[];return this.Nr.forEach((o,u)=>{u.sequenceNumber<=e&&r.get(u.targetId)===null&&(this.Nr.delete(o),s.push(this.removeMatchingKeysForTargetId(t,u.targetId)),i++)}),b.waitFor(s).next(()=>i)}getTargetCount(t){return b.resolve(this.targetCount)}getTargetData(t,e){let r=this.Nr.get(e)||null;return b.resolve(r)}addMatchingKeys(t,e,r){return this.Br.Rr(e,r),b.resolve()}removeMatchingKeys(t,e,r){this.Br.mr(e,r);let i=this.persistence.referenceDelegate,s=[];return i&&e.forEach(o=>{s.push(i.markPotentiallyOrphaned(t,o))}),b.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Br.gr(e),b.resolve()}getMatchingKeysForTargetId(t,e){let r=this.Br.yr(e);return b.resolve(r)}containsKey(t,e){return b.resolve(this.Br.containsKey(e))}};var xo=class{constructor(t,e){this.qr={},this.overlays={},this.Qr=new Yt(0),this.Kr=!1,this.Kr=!0,this.$r=new Cc,this.referenceDelegate=t(this),this.Ur=new Vc(this),this.indexManager=new _c,this.remoteDocumentCache=function(i){return new kc(i)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new To(e),this.Gr=new Sc(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Pc,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let r=this.qr[t.toKey()];return r||(r=new xc(e,this.referenceDelegate),this.qr[t.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(t,e,r){V("MemoryPersistence","Starting transaction:",t);let i=new Nc(this.Qr.next());return this.referenceDelegate.zr(),r(i).next(s=>this.referenceDelegate.jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Hr(t,e){return b.or(Object.values(this.qr).map(r=>()=>r.containsKey(t,e)))}},Nc=class extends uo{constructor(t){super(),this.currentSequenceNumber=t}},ko=class n{constructor(t){this.persistence=t,this.Jr=new ji,this.Yr=null}static Zr(t){return new n(t)}get Xr(){if(this.Yr)return this.Yr;throw U()}addReference(t,e,r){return this.Jr.addReference(r,e),this.Xr.delete(r.toString()),b.resolve()}removeReference(t,e,r){return this.Jr.removeReference(r,e),this.Xr.add(r.toString()),b.resolve()}markPotentiallyOrphaned(t,e){return this.Xr.add(e.toString()),b.resolve()}removeTarget(t,e){this.Jr.gr(e.targetId).forEach(i=>this.Xr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(i=>{i.forEach(s=>this.Xr.add(s.toString()))}).next(()=>r.removeTargetData(t,e))}zr(){this.Yr=new Set}jr(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.Xr,r=>{let i=M.fromPath(r);return this.ei(t,i).next(s=>{s||e.removeEntry(i,j.min())})}).next(()=>(this.Yr=null,e.apply(t)))}updateLimboDocument(t,e){return this.ei(t,e).next(r=>{r?this.Xr.delete(e.toString()):this.Xr.add(e.toString())})}Wr(t){return 0}ei(t,e){return b.or([()=>b.resolve(this.Jr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Hr(t,e)])}};var Oc=class{constructor(t){this.serializer=t}O(t,e,r,i){let s=new co("createOrUpgrade",e);r<1&&i>=1&&(function(c){c.createObjectStore("owner")}(t),function(c){c.createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Of,{unique:!0}),c.createObjectStore("documentMutations")}(t),vm(t),function(c){c.createObjectStore("remoteDocuments")}(t));let o=b.resolve();return r<3&&i>=3&&(r!==0&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(t),vm(t)),o=o.next(()=>function(c){let h=c.store("targetGlobal"),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:j.min().toTimestamp(),targetCount:0};return h.put("targetGlobalKey",f)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(c,h){return h.store("mutations").U().next(f=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Of,{unique:!0});let p=h.store("mutations"),_=f.map(E=>p.put(E));return b.waitFor(_)})}(t,s))),o=o.next(()=>{(function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})})(t)})),r<5&&i>=5&&(o=o.next(()=>this.ni(s))),r<6&&i>=6&&(o=o.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(t),this.ri(s)))),r<7&&i>=7&&(o=o.next(()=>this.ii(s))),r<8&&i>=8&&(o=o.next(()=>this.si(t,s))),r<9&&i>=9&&(o=o.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(t)})),r<10&&i>=10&&(o=o.next(()=>this.oi(s))),r<11&&i>=11&&(o=o.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(t),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(t)})),r<12&&i>=12&&(o=o.next(()=>{(function(c){let h=c.createObjectStore("documentOverlays",{keyPath:av});h.createIndex("collectionPathOverlayIndex",uv,{unique:!1}),h.createIndex("collectionGroupOverlayIndex",cv,{unique:!1})})(t)})),r<13&&i>=13&&(o=o.next(()=>function(c){let h=c.createObjectStore("remoteDocumentsV14",{keyPath:Xw});h.createIndex("documentKeyIndex",Yw),h.createIndex("collectionGroupIndex",Jw)}(t)).next(()=>this._i(t,s)).next(()=>t.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.ai(t,s))),r<15&&i>=15&&(o=o.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:rv}).createIndex("sequenceNumberIndex",iv,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:sv}).createIndex("documentKeyIndex",ov,{unique:!1})}(t))),r<16&&i>=16&&(o=o.next(()=>{e.objectStore("indexState").clear()}).next(()=>{e.objectStore("indexEntries").clear()})),r<17&&i>=17&&(o=o.next(()=>{(function(c){c.createObjectStore("globals",{keyPath:"name"})})(t)})),o}ri(t){let e=0;return t.store("remoteDocuments").J((r,i)=>{e+=bo(i)}).next(()=>{let r={byteSize:e};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(t){let e=t.store("mutationQueues"),r=t.store("mutations");return e.U().next(i=>b.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(u=>b.forEach(u,c=>{q(c.userId===s.userId);let h=vn(this.serializer,c);return Vp(t,s.userId,h).next(()=>{})}))}))}ii(t){let e=t.store("targetDocuments"),r=t.store("remoteDocuments");return t.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return r.J((o,u)=>{let c=new Y(o),h=function(p){return[0,Gt(p)]}(c);s.push(e.get(h).next(f=>f?b.resolve():(p=>e.put({targetId:0,path:Gt(p),sequenceNumber:i.highestListenSequenceNumber}))(c)))}).next(()=>b.waitFor(s))})}si(t,e){t.createObjectStore("collectionParents",{keyPath:nv});let r=e.store("collectionParents"),i=new zi,s=o=>{if(i.add(o)){let u=o.lastSegment(),c=o.popLast();return r.put({collectionId:u,parent:Gt(c)})}};return e.store("remoteDocuments").J({H:!0},(o,u)=>{let c=new Y(o);return s(c.popLast())}).next(()=>e.store("documentMutations").J({H:!0},([o,u,c],h)=>{let f=le(u);return s(f.popLast())}))}oi(t){let e=t.store("targets");return e.J((r,i)=>{let s=Ei(i),o=xp(this.serializer,s);return e.put(o)})}_i(t,e){let r=e.store("remoteDocuments"),i=[];return r.J((s,o)=>{let u=e.store("remoteDocumentsV14"),c=function(p){return p.document?new M(Y.fromString(p.document.name).popFirst(5)):p.noDocument?M.fromSegments(p.noDocument.path):p.unknownDocument?M.fromSegments(p.unknownDocument.path):U()}(o).path.toArray(),h={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(u.put(h))}).next(()=>b.waitFor(i))}ai(t,e){let r=e.store("mutations"),i=Lp(this.serializer),s=new xo(ko.Zr,this.serializer.ct);return r.U().next(o=>{let u=new Map;return o.forEach(c=>{var h;let f=(h=u.get(c.userId))!==null&&h!==void 0?h:W();vn(this.serializer,c).keys().forEach(p=>f=f.add(p)),u.set(c.userId,f)}),b.forEach(u,(c,h)=>{let f=new Tt(h),p=Eo.lt(this.serializer,f),_=s.getIndexManager(f),E=So.lt(f,this.serializer,_,s.referenceDelegate);return new Co(i,E,p,_).recalculateAndSaveOverlaysForDocumentKeys(new ki(e,Yt.oe),c).next()})})}};function vm(n){n.createObjectStore("targetDocuments",{keyPath:tv}).createIndex("documentTargetsIndex",ev,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Zw,{unique:!0}),n.createObjectStore("targetGlobal")}var Au="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Lc=class n{constructor(t,e,r,i,s,o,u,c,h,f,p=17){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=r,this.ui=s,this.window=o,this.document=u,this.ci=h,this.li=f,this.hi=p,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=_=>Promise.resolve(),!n.D())throw new N(S.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Ec(this,i),this.Ai=e+"main",this.serializer=new To(c),this.Ri=new Qe(this.Ai,this.hi,new Oc(this.serializer)),this.$r=new lc,this.Ur=new wc(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Lp(this.serializer),this.Gr=new cc,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,f===!1&&mt("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new N(S.FAILED_PRECONDITION,Au);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.Ur.getHighestSequenceNumber(t))}).then(t=>{this.Qr=new Yt(t,this.ci)}).then(()=>{this.Kr=!0}).catch(t=>(this.Ri&&this.Ri.close(),Promise.reject(t)))}yi(t){return this.di=e=>C(this,null,function*(){if(this.started)return t(e)}),t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ri.L(e=>C(this,null,function*(){e.newVersion===null&&(yield t())}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.ui.enqueueAndForget(()=>C(this,null,function*(){this.started&&(yield this.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Ys(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(t).next(e=>{e||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(t)).next(e=>this.isPrimary&&!e?this.bi(t).next(()=>!1):!!e&&this.Di(t).next(()=>!0))).catch(t=>{if(an(t))return V("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return V("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.ui.enqueueRetryable(()=>this.di(t)),this.isPrimary=t})}wi(t){return Ti(t).get("owner").next(e=>b.resolve(this.vi(e)))}Ci(t){return Ys(t).delete(this.clientId)}Fi(){return C(this,null,function*(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();let t=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let r=Rt(e,"clientMetadata");return r.U().next(i=>{let s=this.xi(i,18e5),o=i.filter(u=>s.indexOf(u)===-1);return b.forEach(o,u=>r.delete(u.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(let e of t)this.Vi.removeItem(this.Oi(e.clientId))}})}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(t){return!!t&&t.ownerId===this.clientId}Si(t){return this.li?b.resolve(!0):Ti(t).get("owner").next(e=>{if(e!==null&&this.Mi(e.leaseTimestampMs,5e3)&&!this.Ni(e.ownerId)){if(this.vi(e)&&this.networkEnabled)return!0;if(!this.vi(e)){if(!e.allowTabSynchronization)throw new N(S.FAILED_PRECONDITION,Au);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ys(t).U().next(r=>this.xi(r,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,u=this.networkEnabled===i.networkEnabled;if(s||o&&u)return!0}return!1})===void 0)}).next(e=>(this.isPrimary!==e&&V("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}shutdown(){return C(this,null,function*(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),yield this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{let e=new ki(t,Yt.oe);return this.bi(e).next(()=>this.Ci(e))}),this.Ri.close(),this.qi()})}xi(t,e){return t.filter(r=>this.Mi(r.updateTimeMs,e)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",t=>Ys(t).U().next(e=>this.xi(e,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(t,e){return So.lt(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new yc(t,this.serializer.ct.databaseId)}getDocumentOverlayCache(t){return Eo.lt(this.serializer,t)}getBundleCache(){return this.Gr}runTransaction(t,e,r){V("IndexedDbPersistence","Starting transaction:",t);let i=e==="readonly"?"readonly":"readwrite",s=function(c){return c===17?dv:c===16?hv:c===15?xl:c===14?Gm:c===13?jm:c===12?lv:c===11?zm:void U()}(this.hi),o;return this.Ri.runTransaction(t,i,s,u=>(o=new ki(u,this.Qr?this.Qr.next():Yt.oe),e==="readwrite-primary"?this.wi(o).next(c=>!!c||this.Si(o)).next(c=>{if(!c)throw mt(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new N(S.FAILED_PRECONDITION,Fm);return r(o)}).next(c=>this.Di(o).next(()=>c)):this.Ki(o).next(()=>r(o)))).then(u=>(o.raiseOnCommittedEvent(),u))}Ki(t){return Ti(t).get("owner").next(e=>{if(e!==null&&this.Mi(e.leaseTimestampMs,5e3)&&!this.Ni(e.ownerId)&&!this.vi(e)&&!(this.li||this.allowTabSynchronization&&e.allowTabSynchronization))throw new N(S.FAILED_PRECONDITION,Au)})}Di(t){let e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ti(t).put("owner",e)}static D(){return Qe.D()}bi(t){let e=Ti(t);return e.get("owner").next(r=>this.vi(r)?(V("IndexedDbPersistence","Releasing primary lease."),e.delete("owner")):b.resolve())}Mi(t,e){let r=Date.now();return!(t<r-e)&&(!(t>r)||(mt(`Detected an update time that is in the future: ${t} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var t;typeof((t=this.window)===null||t===void 0?void 0:t.addEventListener)=="function"&&(this.Pi=()=>{this.Li();let e=/(?:Version|Mobile)\/1[456]/;$a()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(t){var e;try{let r=((e=this.Vi)===null||e===void 0?void 0:e.getItem(this.Oi(t)))!==null;return V("IndexedDbPersistence",`Client '${t}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return mt("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(t){mt("Failed to set zombie client id.",t)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(t){return`firestore_zombie_${this.persistenceKey}_${t}`}};function Ti(n){return Rt(n,"owner")}function Ys(n){return Rt(n,"clientMetadata")}function Ul(n,t){let e=n.projectId;return n.isDefaultDatabase||(e+="."+n.database),"firestore/"+t+"/"+e+"/"}var Mc=class n{constructor(t,e,r,i){this.targetId=t,this.fromCache=e,this.$i=r,this.Ui=i}static Wi(t,e){let r=W(),i=W();for(let s of e.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(t,e.fromCache,r,i)}};var Fc=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var Do=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return $a()?8:Um(ai())>0?6:4}()}initialize(t,e){this.Ji=t,this.indexManager=e,this.Gi=!0}getDocumentsMatchingQuery(t,e,r,i){let s={result:null};return this.Yi(t,e).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Zi(t,e,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Fc;return this.Xi(t,e,o).next(u=>{if(s.result=u,this.zi)return this.es(t,e,o,u.size)})}).next(()=>s.result)}es(t,e,r,i){return r.documentReadCount<this.ji?(sr()<=ue.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",or(e),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),b.resolve()):(sr()<=ue.DEBUG&&V("QueryEngine","Query:",or(e),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Hi*i?(sr()<=ue.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",or(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,$t(e))):b.resolve())}Yi(t,e){if(Wf(e))return b.resolve(null);let r=$t(e);return this.indexManager.getIndexType(t,r).next(i=>i===0?null:(e.limit!==null&&i===1&&(e=_o(e,null,"F"),r=$t(e)),this.indexManager.getDocumentsMatchingTarget(t,r).next(s=>{let o=W(...s);return this.Ji.getDocuments(t,o).next(u=>this.indexManager.getMinOffset(t,r).next(c=>{let h=this.ts(e,u);return this.ns(e,h,o,c.readTime)?this.Yi(t,_o(e,null,"F")):this.rs(t,h,e,c)}))})))}Zi(t,e,r,i){return Wf(e)||i.isEqual(j.min())?b.resolve(null):this.Ji.getDocuments(t,r).next(s=>{let o=this.ts(e,s);return this.ns(e,o,r,i)?b.resolve(null):(sr()<=ue.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),or(e)),this.rs(t,o,e,Lm(i,-1)).next(u=>u))})}ts(t,e){let r=new it(rp(t));return e.forEach((i,s)=>{ns(t,s)&&(r=r.add(s))}),r}ns(t,e,r,i){if(t.limit===null)return!1;if(r.size!==e.size)return!0;let s=t.limitType==="F"?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(t,e,r){return sr()<=ue.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",or(e)),this.Ji.getDocumentsMatchingQuery(t,e,te.min(),r)}rs(t,e,r,i){return this.Ji.getDocumentsMatchingQuery(t,r,i).next(s=>(e.forEach(o=>{s=s.insert(o.key,o)}),s))}};var Uc=class{constructor(t,e,r,i){this.persistence=t,this.ss=e,this.serializer=i,this.os=new ot(K),this._s=new ye(s=>Pn(s),ts),this.us=new Map,this.cs=t.getRemoteDocumentCache(),this.Ur=t.getTargetCache(),this.Gr=t.getBundleCache(),this.ls(r)}ls(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Co(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.os))}};function Mp(n,t,e,r){return new Uc(n,t,e,r)}function Fp(n,t){return C(this,null,function*(){let e=L(n);return yield e.persistence.runTransaction("Handle user change","readonly",r=>{let i;return e.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,e.ls(t),e.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],u=[],c=W();for(let h of i){o.push(h.batchId);for(let f of h.mutations)c=c.add(f.key)}for(let h of s){u.push(h.batchId);for(let f of h.mutations)c=c.add(f.key)}return e.localDocuments.getDocuments(r,c).next(h=>({hs:h,removedBatchIds:o,addedBatchIds:u}))})})})}function $v(n,t){let e=L(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=t.batch.keys(),s=e.cs.newChangeBuffer({trackRemovals:!0});return function(u,c,h,f){let p=h.batch,_=p.keys(),E=b.resolve();return _.forEach(x=>{E=E.next(()=>f.getEntry(c,x)).next(D=>{let k=h.docVersions.get(x);q(k!==null),D.version.compareTo(k)<0&&(p.applyToRemoteDocument(D,h),D.isValidDocument()&&(D.setReadTime(h.commitVersion),f.addEntry(D)))})}),E.next(()=>u.mutationQueue.removeMutationBatch(c,p))}(e,r,t,s).next(()=>s.apply(r)).next(()=>e.mutationQueue.performConsistencyCheck(r)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(r,i,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(u){let c=W();for(let h=0;h<u.mutationResults.length;++h)u.mutationResults[h].transformResults.length>0&&(c=c.add(u.batch.mutations[h].key));return c}(t))).next(()=>e.localDocuments.getDocuments(r,i))})}function Up(n){let t=L(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Ur.getLastRemoteSnapshotVersion(e))}function Kv(n,t){let e=L(n),r=t.snapshotVersion,i=e.os;return e.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=e.cs.newChangeBuffer({trackRemovals:!0});i=e.os;let u=[];t.targetChanges.forEach((f,p)=>{let _=i.get(p);if(!_)return;u.push(e.Ur.removeMatchingKeys(s,f.removedDocuments,p).next(()=>e.Ur.addMatchingKeys(s,f.addedDocuments,p)));let E=_.withSequenceNumber(s.currentSequenceNumber);t.targetMismatches.get(p)!==null?E=E.withResumeToken(yt.EMPTY_BYTE_STRING,j.min()).withLastLimboFreeSnapshotVersion(j.min()):f.resumeToken.approximateByteSize()>0&&(E=E.withResumeToken(f.resumeToken,r)),i=i.insert(p,E),function(D,k,B){return D.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-D.snapshotVersion.toMicroseconds()>=3e8?!0:B.addedDocuments.size+B.modifiedDocuments.size+B.removedDocuments.size>0}(_,E,f)&&u.push(e.Ur.updateTargetData(s,E))});let c=Qt(),h=W();if(t.documentUpdates.forEach(f=>{t.resolvedLimboDocuments.has(f)&&u.push(e.persistence.referenceDelegate.updateLimboDocument(s,f))}),u.push(Bp(s,o,t.documentUpdates).next(f=>{c=f.Ps,h=f.Is})),!r.isEqual(j.min())){let f=e.Ur.getLastRemoteSnapshotVersion(s).next(p=>e.Ur.setTargetsMetadata(s,s.currentSequenceNumber,r));u.push(f)}return b.waitFor(u).next(()=>o.apply(s)).next(()=>e.localDocuments.getLocalViewOfDocuments(s,c,h)).next(()=>c)}).then(s=>(e.os=i,s))}function Bp(n,t,e){let r=W(),i=W();return e.forEach(s=>r=r.add(s)),t.getEntries(n,r).next(s=>{let o=Qt();return e.forEach((u,c)=>{let h=s.get(u);c.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(u)),c.isNoDocument()&&c.version.isEqual(j.min())?(t.removeEntry(u,c.readTime),o=o.insert(u,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||c.version.compareTo(h.version)===0&&h.hasPendingWrites?(t.addEntry(c),o=o.insert(u,c)):V("LocalStore","Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version)}),{Ps:o,Is:i}})}function Wv(n,t){let e=L(n);return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(t===void 0&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}function Rr(n,t){let e=L(n);return e.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return e.Ur.getTargetData(r,t).next(s=>s?(i=s,b.resolve(i)):e.Ur.allocateTargetId(r).next(o=>(i=new Er(t,o,"TargetPurposeListen",r.currentSequenceNumber),e.Ur.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=e.os.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(e.os=e.os.insert(r.targetId,r),e._s.set(t,r.targetId)),r})}function br(n,t,e){return C(this,null,function*(){let r=L(n),i=r.os.get(t),s=e?"readwrite":"readwrite-primary";try{e||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!an(o))throw o;V("LocalStore",`Failed to update sequence numbers for target ${t}: ${o}`)}r.os=r.os.remove(t),r._s.delete(i.target)})}function Vo(n,t,e){let r=L(n),i=j.min(),s=W();return r.persistence.runTransaction("Execute query","readwrite",o=>function(c,h,f){let p=L(c),_=p._s.get(f);return _!==void 0?b.resolve(p.os.get(_)):p.Ur.getTargetData(h,f)}(r,o,$t(t)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,u.targetId).next(c=>{s=c})}).next(()=>r.ss.getDocumentsMatchingQuery(o,t,e?i:j.min(),e?s:W())).next(u=>(jp(r,np(t),u),{documents:u,Ts:s})))}function qp(n,t){let e=L(n),r=L(e.Ur),i=e.os.get(t);return i?Promise.resolve(i.target):e.persistence.runTransaction("Get target data","readonly",s=>r.ot(s,t).next(o=>o?o.target:null))}function zp(n,t){let e=L(n),r=e.us.get(t)||j.min();return e.persistence.runTransaction("Get new document changes","readonly",i=>e.cs.getAllFromCollectionGroup(i,t,Lm(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(jp(e,t,i),i))}function jp(n,t,e){let r=n.us.get(t)||j.min();e.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.us.set(t,r)}function Qv(n,t,e,r){return C(this,null,function*(){let i=L(n),s=W(),o=Qt();for(let h of e){let f=t.Es(h.metadata.name);h.document&&(s=s.add(f));let p=t.ds(h);p.setReadTime(t.As(h.metadata.readTime)),o=o.insert(f,p)}let u=i.cs.newChangeBuffer({trackRemovals:!0}),c=yield Rr(i,function(f){return $t(Nr(Y.fromString(`__bundle__/docs/${f}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",h=>Bp(h,u,o).next(f=>(u.apply(h),f)).next(f=>i.Ur.removeMatchingKeysForTargetId(h,c.targetId).next(()=>i.Ur.addMatchingKeys(h,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(h,f.Ps,f.Is)).next(()=>f.Ps)))})}function Hv(r,i){return C(this,arguments,function*(n,t,e=W()){let s=yield Rr(n,$t(Ml(t.bundledQuery))),o=L(n);return o.persistence.runTransaction("Save named query","readwrite",u=>{let c=gt(t.readTime);if(s.snapshotVersion.compareTo(c)>=0)return o.Gr.saveNamedQuery(u,t);let h=s.withResumeToken(yt.EMPTY_BYTE_STRING,c);return o.os=o.os.insert(h.targetId,h),o.Ur.updateTargetData(u,h).next(()=>o.Ur.removeMatchingKeysForTargetId(u,s.targetId)).next(()=>o.Ur.addMatchingKeys(u,e,s.targetId)).next(()=>o.Gr.saveNamedQuery(u,t))})})}function Tm(n,t){return`firestore_clients_${n}_${t}`}function Im(n,t,e){let r=`firestore_mutations_${n}_${e}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function Ru(n,t){return`firestore_targets_${n}_${t}`}var No=class n{constructor(t,e,r,i){this.user=t,this.batchId=e,this.state=r,this.error=i}static Rs(t,e,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new N(i.error.code,i.error.message))),o?new n(t,e,i.state,s):(mt("SharedClientState",`Failed to parse mutation state for ID '${e}': ${r}`),null)}Vs(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},Si=class n{constructor(t,e,r){this.targetId=t,this.state=e,this.error=r}static Rs(t,e){let r=JSON.parse(e),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new N(r.error.code,r.error.message))),s?new n(t,r.state,i):(mt("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}Vs(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},Oo=class n{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Rs(t,e){let r=JSON.parse(e),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=Nl();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=Bm(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(t,s):(mt("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}},Bc=class n{constructor(t,e){this.clientId=t,this.onlineState=e}static Rs(t){let e=JSON.parse(t);return typeof e=="object"&&["Unknown","Online","Offline"].indexOf(e.onlineState)!==-1&&typeof e.clientId=="string"?new n(e.clientId,e.onlineState):(mt("SharedClientState",`Failed to parse online state: ${t}`),null)}},Gi=class{constructor(){this.activeTargetIds=Nl()}fs(t){this.activeTargetIds=this.activeTargetIds.add(t)}gs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Vs(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}},Pi=class{constructor(t,e,r,i,s){this.window=t,this.ui=e,this.persistenceKey=r,this.ps=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new ot(K),this.started=!1,this.bs=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ds=Tm(this.persistenceKey,this.ps),this.vs=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new Gi),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this.Os=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(t){return!(!t||!t.localStorage)}start(){return C(this,null,function*(){let t=yield this.syncEngine.Qi();for(let r of t){if(r===this.ps)continue;let i=this.getItem(Tm(this.persistenceKey,r));if(i){let s=Oo.Rs(r,i);s&&(this.Ss=this.Ss.insert(s.clientId,s))}}this.Ns();let e=this.storage.getItem(this.xs);if(e){let r=this.Ls(e);r&&this.Bs(r)}for(let r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(t){this.setItem(this.vs,JSON.stringify(t))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(t){let e=!1;return this.Ss.forEach((r,i)=>{i.activeTargetIds.has(t)&&(e=!0)}),e}addPendingMutation(t){this.qs(t,"pending")}updateMutationState(t,e,r){this.qs(t,e,r),this.Qs(t)}addLocalQueryTarget(t){let e="not-current";if(this.isActiveQueryTarget(t)){let r=this.storage.getItem(Ru(this.persistenceKey,t));if(r){let i=Si.Rs(t,r);i&&(e=i.state)}}return this.Ks.fs(t),this.Ns(),e}removeLocalQueryTarget(t){this.Ks.gs(t),this.Ns()}isLocalQueryTarget(t){return this.Ks.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(Ru(this.persistenceKey,t))}updateQueryState(t,e,r){this.$s(t,e,r)}handleUserChange(t,e,r){e.forEach(i=>{this.Qs(i)}),this.currentUser=t,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(t){this.Us(t)}notifyBundleLoaded(t){this.Ws(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(t){let e=this.storage.getItem(t);return V("SharedClientState","READ",t,e),e}setItem(t,e){V("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){V("SharedClientState","REMOVE",t),this.storage.removeItem(t)}ws(t){let e=t;if(e.storageArea===this.storage){if(V("SharedClientState","EVENT",e.key,e.newValue),e.key===this.Ds)return void mt("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(()=>C(this,null,function*(){if(this.started){if(e.key!==null){if(this.Cs.test(e.key)){if(e.newValue==null){let r=this.Gs(e.key);return this.zs(r,null)}{let r=this.js(e.key,e.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(e.key)){if(e.newValue!==null){let r=this.Hs(e.key,e.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(e.key)){if(e.newValue!==null){let r=this.Ys(e.key,e.newValue);if(r)return this.Zs(r)}}else if(e.key===this.xs){if(e.newValue!==null){let r=this.Ls(e.newValue);if(r)return this.Bs(r)}}else if(e.key===this.vs){let r=function(s){let o=Yt.oe;if(s!=null)try{let u=JSON.parse(s);q(typeof u=="number"),o=u}catch(u){mt("SharedClientState","Failed to read sequence number from WebStorage",u)}return o}(e.newValue);r!==Yt.oe&&this.sequenceNumberHandler(r)}else if(e.key===this.Os){let r=this.Xs(e.newValue);yield Promise.all(r.map(i=>this.syncEngine.eo(i)))}}}else this.bs.push(e)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(t,e,r){let i=new No(this.currentUser,t,e,r),s=Im(this.persistenceKey,this.currentUser,t);this.setItem(s,i.Vs())}Qs(t){let e=Im(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Us(t){let e={clientId:this.ps,onlineState:t};this.storage.setItem(this.xs,JSON.stringify(e))}$s(t,e,r){let i=Ru(this.persistenceKey,t),s=new Si(t,e,r);this.setItem(i,s.Vs())}Ws(t){let e=JSON.stringify(Array.from(t));this.setItem(this.Os,e)}Gs(t){let e=this.Cs.exec(t);return e?e[1]:null}js(t,e){let r=this.Gs(t);return Oo.Rs(r,e)}Hs(t,e){let r=this.Fs.exec(t),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return No.Rs(new Tt(s),i,e)}Ys(t,e){let r=this.Ms.exec(t),i=Number(r[1]);return Si.Rs(i,e)}Ls(t){return Bc.Rs(t)}Xs(t){return JSON.parse(t)}Js(t){return C(this,null,function*(){if(t.user.uid===this.currentUser.uid)return this.syncEngine.no(t.batchId,t.state,t.error);V("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)})}Zs(t){return this.syncEngine.ro(t.targetId,t.state,t.error)}zs(t,e){let r=e?this.Ss.insert(t,e):this.Ss.remove(t),i=this.ks(this.Ss),s=this.ks(r),o=[],u=[];return s.forEach(c=>{i.has(c)||o.push(c)}),i.forEach(c=>{s.has(c)||u.push(c)}),this.syncEngine.io(o,u).then(()=>{this.Ss=r})}Bs(t){this.Ss.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}ks(t){let e=Nl();return t.forEach((r,i)=>{e=e.unionWith(i.activeTargetIds)}),e}},Lo=class{constructor(){this.so=new Gi,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,r){}addLocalQueryTarget(t){return this.so.fs(t),this.oo[t]||"not-current"}updateQueryState(t,e,r){this.oo[t]=e}removeLocalQueryTarget(t){this.so.gs(t)}isLocalQueryTarget(t){return this.so.activeTargetIds.has(t)}clearQueryState(t){delete this.oo[t]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(t){return this.so.activeTargetIds.has(t)}start(){return this.so=new Gi,Promise.resolve()}handleUserChange(t,e,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var qc=class{_o(t){}shutdown(){}};var Mo=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(t){this.ho.push(t)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){V("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let t of this.ho)t(0)}lo(){V("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let t of this.ho)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Js=null;function bu(){return Js===null?Js=function(){return 268435456+Math.round(2147483648*Math.random())}():Js++,"0x"+Js.toString(16)}var Xv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var zc=class{constructor(t){this.Io=t.Io,this.To=t.To}Eo(t){this.Ao=t}Ro(t){this.Vo=t}mo(t){this.fo=t}onMessage(t){this.po=t}close(){this.To()}send(t){this.Io(t)}yo(){this.Ao()}wo(){this.Vo()}So(t){this.fo(t)}bo(t){this.po(t)}};var Ot="WebChannelConnection",jc=class extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let r=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+e.host,this.vo=`projects/${i}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Fo(){return!1}Mo(e,r,i,s,o){let u=bu(),c=this.xo(e,r.toUriEncodedString());V("RestConnection",`Sending RPC '${e}' ${u}:`,c,i);let h={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(h,s,o),this.No(e,c,h,i).then(f=>(V("RestConnection",`Received RPC '${e}' ${u}: `,f),f),f=>{throw pe("RestConnection",`RPC '${e}' ${u} failed with error: `,f,"url: ",c,"request:",i),f})}Lo(e,r,i,s,o,u){return this.Mo(e,r,i,s,o)}Oo(e,r,i){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Vr}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>e[o]=s),i&&i.headers.forEach((s,o)=>e[o]=s)}xo(e,r){let i=Xv[e];return`${this.Do}/v1/${r}:${i}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}No(t,e,r,i){let s=bu();return new Promise((o,u)=>{let c=new _u;c.setWithCredentials(!0),c.listenOnce(wu.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case _i.NO_ERROR:let f=c.getResponseJson();V(Ot,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(f)),o(f);break;case _i.TIMEOUT:V(Ot,`RPC '${t}' ${s} timed out`),u(new N(S.DEADLINE_EXCEEDED,"Request time out"));break;case _i.HTTP_ERROR:let p=c.getStatus();if(V(Ot,`RPC '${t}' ${s} failed with status:`,p,"response text:",c.getResponseText()),p>0){let _=c.getResponseJson();Array.isArray(_)&&(_=_[0]);let E=_?.error;if(E&&E.status&&E.message){let x=function(k){let B=k.toLowerCase().replace(/_/g,"-");return Object.values(S).indexOf(B)>=0?B:S.UNKNOWN}(E.status);u(new N(x,E.message))}else u(new N(S.UNKNOWN,"Server responded with status "+c.getStatus()))}else u(new N(S.UNAVAILABLE,"Connection failed."));break;default:U()}}finally{V(Ot,`RPC '${t}' ${s} completed.`)}});let h=JSON.stringify(i);V(Ot,`RPC '${t}' ${s} sending request:`,i),c.send(e,"POST",h,r,15)})}Bo(t,e,r){let i=bu(),s=[this.Do,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=Iu(),u=Tu(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(c.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(c.xmlHttpFactory=new yu({})),this.Oo(c.initMessageHeaders,e,r),c.encodeInitMessageHeaders=!0;let f=s.join("");V(Ot,`Creating RPC '${t}' stream ${i}: ${f}`,c);let p=o.createWebChannel(f,c),_=!1,E=!1,x=new zc({Io:k=>{E?V(Ot,`Not sending because RPC '${t}' stream ${i} is closed:`,k):(_||(V(Ot,`Opening RPC '${t}' stream ${i} transport.`),p.open(),_=!0),V(Ot,`RPC '${t}' stream ${i} sending:`,k),p.send(k))},To:()=>p.close()}),D=(k,B,z)=>{k.listen(B,F=>{try{z(F)}catch(G){setTimeout(()=>{throw G},0)}})};return D(p,tr.EventType.OPEN,()=>{E||(V(Ot,`RPC '${t}' stream ${i} transport opened.`),x.yo())}),D(p,tr.EventType.CLOSE,()=>{E||(E=!0,V(Ot,`RPC '${t}' stream ${i} transport closed`),x.So())}),D(p,tr.EventType.ERROR,k=>{E||(E=!0,pe(Ot,`RPC '${t}' stream ${i} transport errored:`,k),x.So(new N(S.UNAVAILABLE,"The operation could not be completed")))}),D(p,tr.EventType.MESSAGE,k=>{var B;if(!E){let z=k.data[0];q(!!z);let F=z,G=F.error||((B=F[0])===null||B===void 0?void 0:B.error);if(G){V(Ot,`RPC '${t}' stream ${i} received error:`,G);let Q=G.status,$=function(w){let T=wt[w];if(T!==void 0)return gp(T)}(Q),v=G.message;$===void 0&&($=S.INTERNAL,v="Unknown error status: "+Q+" with message "+G.message),E=!0,x.So(new N($,v)),p.close()}else V(Ot,`RPC '${t}' stream ${i} received:`,z),x.bo(z)}}),D(u,vu.STAT_EVENT,k=>{k.stat===Qs.PROXY?V(Ot,`RPC '${t}' stream ${i} detected buffering proxy`):k.stat===Qs.NOPROXY&&V(Ot,`RPC '${t}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{x.wo()},0),x}};function Gp(){return typeof window<"u"?window:null}function ro(){return typeof document<"u"?document:null}function rs(n){return new ic(n,!0)}var $i=class{constructor(t,e,r=1e3,i=1.5,s=6e4){this.ui=t,this.timerId=e,this.ko=r,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(t){this.cancel();let e=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),i=Math.max(0,e-r);i>0&&V("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${e} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),t())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var Fo=class{constructor(t,e,r,i,s,o,u,c){this.ui=t,this.Ho=r,this.Jo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new $i(t,e)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return C(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(t){this.u_(),this.stream.send(t)}__(){return C(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(t,e){return C(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,t!==4?this.t_.reset():e&&e.code===S.RESOURCE_EXHAUSTED?(mt(e.toString()),mt("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):e&&e.code===S.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.mo(e)})}l_(){}auth(){this.state=1;let t=this.h_(this.Yo),e=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Yo===e&&this.P_(r,i)},r=>{t(()=>{let i=new N(S.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(i)})})}P_(t,e){let r=this.h_(this.Yo);this.stream=this.T_(t,e),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{r(()=>this.I_(i))}),this.stream.onMessage(i=>{r(()=>++this.e_==1?this.E_(i):this.onNext(i))})}i_(){this.state=5,this.t_.Go(()=>C(this,null,function*(){this.state=0,this.start()}))}I_(t){return V("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}h_(t){return e=>{this.ui.enqueueAndForget(()=>this.Yo===t?e():(V("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Gc=class extends Fo{constructor(t,e,r,i,s,o){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,r,i,o),this.serializer=s}T_(t,e){return this.connection.Bo("Listen",t,e)}E_(t){return this.onNext(t)}onNext(t){this.t_.reset();let e=Nv(this.serializer,t),r=function(s){if(!("targetChange"in s))return j.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?j.min():o.readTime?gt(o.readTime):j.min()}(t);return this.listener.d_(e,r)}A_(t){let e={};e.database=ac(this.serializer),e.addTarget=function(s,o){let u,c=o.target;if(u=po(c)?{documents:Ap(s,c)}:{query:Rp(s,c)._t},u.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){u.resumeToken=yp(s,o.resumeToken);let h=sc(s,o.expectedCount);h!==null&&(u.expectedCount=h)}else if(o.snapshotVersion.compareTo(j.min())>0){u.readTime=Ir(s,o.snapshotVersion.toTimestamp());let h=sc(s,o.expectedCount);h!==null&&(u.expectedCount=h)}return u}(this.serializer,t);let r=Lv(this.serializer,t);r&&(e.labels=r),this.a_(e)}R_(t){let e={};e.database=ac(this.serializer),e.removeTarget=t,this.a_(e)}},$c=class extends Fo{constructor(t,e,r,i,s,o){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,r,i,o),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(t,e){return this.connection.Bo("Write",t,e)}E_(t){return q(!!t.streamToken),this.lastStreamToken=t.streamToken,q(!t.writeResults||t.writeResults.length===0),this.listener.f_()}onNext(t){q(!!t.streamToken),this.lastStreamToken=t.streamToken,this.t_.reset();let e=Ov(t.writeResults,t.commitTime),r=gt(t.commitTime);return this.listener.g_(r,e)}p_(){let t={};t.database=ac(this.serializer),this.a_(t)}m_(t){let e={streamToken:this.lastStreamToken,writes:t.map(r=>qi(this.serializer,r))};this.a_(e)}};var Kc=class extends class{}{constructor(t,e,r,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=r,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new N(S.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(t,e,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Mo(t,oc(e,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new N(S.UNKNOWN,s.toString())})}Lo(t,e,r,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,u])=>this.connection.Lo(t,oc(e,r),i,o,u,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new N(S.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},Wc=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(t){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.C_("Offline")))}set(t){this.x_(),this.S_=0,t==="Online"&&(this.D_=!1),this.C_(t)}C_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}F_(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(mt(e),this.D_=!1):V("OnlineStateTracker",e)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var Qc=class{constructor(t,e,r,i,s){this.localStore=t,this.datastore=e,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(o=>{r.enqueueAndForget(()=>C(this,null,function*(){un(this)&&(V("RemoteStore","Restarting streams for network reachability change."),yield function(c){return C(this,null,function*(){let h=L(c);h.L_.add(4),yield Or(h),h.q_.set("Unknown"),h.L_.delete(4),yield is(h)})}(this))}))}),this.q_=new Wc(r,i)}};function is(n){return C(this,null,function*(){if(un(n))for(let t of n.B_)yield t(!0)})}function Or(n){return C(this,null,function*(){for(let t of n.B_)yield t(!1)})}function ia(n,t){let e=L(n);e.N_.has(t.targetId)||(e.N_.set(t.targetId,t),zl(e)?ql(e):Mr(e).r_()&&Bl(e,t))}function Sr(n,t){let e=L(n),r=Mr(e);e.N_.delete(t),r.r_()&&$p(e,t),e.N_.size===0&&(r.r_()?r.o_():un(e)&&e.q_.set("Unknown"))}function Bl(n,t){if(n.Q_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(j.min())>0){let e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}Mr(n).A_(t)}function $p(n,t){n.Q_.xe(t),Mr(n).R_(t)}function ql(n){n.Q_=new rc({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>n.N_.get(t)||null,tt:()=>n.datastore.serializer.databaseId}),Mr(n).start(),n.q_.v_()}function zl(n){return un(n)&&!Mr(n).n_()&&n.N_.size>0}function un(n){return L(n).L_.size===0}function Kp(n){n.Q_=void 0}function Yv(n){return C(this,null,function*(){n.q_.set("Online")})}function Jv(n){return C(this,null,function*(){n.N_.forEach((t,e)=>{Bl(n,t)})})}function Zv(n,t){return C(this,null,function*(){Kp(n),zl(n)?(n.q_.M_(t),ql(n)):n.q_.set("Unknown")})}function tT(n,t,e){return C(this,null,function*(){if(n.q_.set("Online"),t instanceof wo&&t.state===2&&t.cause)try{yield function(i,s){return C(this,null,function*(){let o=s.cause;for(let u of s.targetIds)i.N_.has(u)&&(yield i.remoteSyncer.rejectListen(u,o),i.N_.delete(u),i.Q_.removeTarget(u))})}(n,t)}catch(r){V("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),r),yield Uo(n,r)}else if(t instanceof fr?n.Q_.Ke(t):t instanceof yo?n.Q_.He(t):n.Q_.We(t),!e.isEqual(j.min()))try{let r=yield Up(n.localStore);e.compareTo(r)>=0&&(yield function(s,o){let u=s.Q_.rt(o);return u.targetChanges.forEach((c,h)=>{if(c.resumeToken.approximateByteSize()>0){let f=s.N_.get(h);f&&s.N_.set(h,f.withResumeToken(c.resumeToken,o))}}),u.targetMismatches.forEach((c,h)=>{let f=s.N_.get(c);if(!f)return;s.N_.set(c,f.withResumeToken(yt.EMPTY_BYTE_STRING,f.snapshotVersion)),$p(s,c);let p=new Er(f.target,c,h,f.sequenceNumber);Bl(s,p)}),s.remoteSyncer.applyRemoteEvent(u)}(n,e))}catch(r){V("RemoteStore","Failed to raise snapshot:",r),yield Uo(n,r)}})}function Uo(n,t,e){return C(this,null,function*(){if(!an(t))throw t;n.L_.add(1),yield Or(n),n.q_.set("Offline"),e||(e=()=>Up(n.localStore)),n.asyncQueue.enqueueRetryable(()=>C(this,null,function*(){V("RemoteStore","Retrying IndexedDB access"),yield e(),n.L_.delete(1),yield is(n)}))})}function Wp(n,t){return t().catch(e=>Uo(n,e,t))}function Lr(n){return C(this,null,function*(){let t=L(n),e=en(t),r=t.O_.length>0?t.O_[t.O_.length-1].batchId:-1;for(;eT(t);)try{let i=yield Wv(t.localStore,r);if(i===null){t.O_.length===0&&e.o_();break}r=i.batchId,nT(t,i)}catch(i){yield Uo(t,i)}Qp(t)&&Hp(t)})}function eT(n){return un(n)&&n.O_.length<10}function nT(n,t){n.O_.push(t);let e=en(n);e.r_()&&e.V_&&e.m_(t.mutations)}function Qp(n){return un(n)&&!en(n).n_()&&n.O_.length>0}function Hp(n){en(n).start()}function rT(n){return C(this,null,function*(){en(n).p_()})}function iT(n){return C(this,null,function*(){let t=en(n);for(let e of n.O_)t.m_(e.mutations)})}function sT(n,t,e){return C(this,null,function*(){let r=n.O_.shift(),i=tc.from(r,t,e);yield Wp(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Lr(n)})}function oT(n,t){return C(this,null,function*(){t&&en(n).V_&&(yield function(r,i){return C(this,null,function*(){if(function(o){return pp(o)&&o!==S.ABORTED}(i.code)){let s=r.O_.shift();en(r).s_(),yield Wp(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Lr(r)}})}(n,t)),Qp(n)&&Hp(n)})}function Em(n,t){return C(this,null,function*(){let e=L(n);e.asyncQueue.verifyOperationInProgress(),V("RemoteStore","RemoteStore received new credentials");let r=un(e);e.L_.add(3),yield Or(e),r&&e.q_.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.L_.delete(3),yield is(e)})}function Hc(n,t){return C(this,null,function*(){let e=L(n);t?(e.L_.delete(2),yield is(e)):t||(e.L_.add(2),yield Or(e),e.q_.set("Unknown"))})}function Mr(n){return n.K_||(n.K_=function(e,r,i){let s=L(e);return s.w_(),new Gc(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Eo:Yv.bind(null,n),Ro:Jv.bind(null,n),mo:Zv.bind(null,n),d_:tT.bind(null,n)}),n.B_.push(t=>C(this,null,function*(){t?(n.K_.s_(),zl(n)?ql(n):n.q_.set("Unknown")):(yield n.K_.stop(),Kp(n))}))),n.K_}function en(n){return n.U_||(n.U_=function(e,r,i){let s=L(e);return s.w_(),new $c(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:rT.bind(null,n),mo:oT.bind(null,n),f_:iT.bind(null,n),g_:sT.bind(null,n)}),n.B_.push(t=>C(this,null,function*(){t?(n.U_.s_(),yield Lr(n)):(yield n.U_.stop(),n.O_.length>0&&(V("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))}))),n.U_}var Xc=class n{constructor(t,e,r,i,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new It,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,r,i,s){let o=Date.now()+r,u=new n(t,e,o,i,s);return u.start(r),u}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new N(S.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Fr(n,t){if(mt("AsyncQueue",`${t}: ${n}`),an(n))return new N(S.UNAVAILABLE,`${t}: ${n}`);throw n}var Bo=class n{constructor(t){this.comparator=t?(e,r)=>t(e,r)||M.comparator(e.key,r.key):(e,r)=>M.comparator(e.key,r.key),this.keyedMap=Ii(),this.sortedSet=new ot(this.comparator)}static emptySet(t){return new n(t.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,r)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let r=new n;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=e,r}};var qo=class{constructor(){this.W_=new ot(M.comparator)}track(t){let e=t.doc.key,r=this.W_.get(e);r?t.type!==0&&r.type===3?this.W_=this.W_.insert(e,t):t.type===3&&r.type!==1?this.W_=this.W_.insert(e,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.W_=this.W_.insert(e,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.W_=this.W_.insert(e,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.W_=this.W_.remove(e):t.type===1&&r.type===2?this.W_=this.W_.insert(e,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.W_=this.W_.insert(e,{type:2,doc:t.doc}):U():this.W_=this.W_.insert(e,t)}G_(){let t=[];return this.W_.inorderTraversal((e,r)=>{t.push(r)}),t}},Pr=class n{constructor(t,e,r,i,s,o,u,c,h){this.query=t,this.docs=e,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(t,e,r,i,s){let o=[];return e.forEach(u=>{o.push({type:0,doc:u})}),new n(t,e,Bo.emptySet(e),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&es(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,r=t.docChanges;if(e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(e[i].type!==r[i].type||!e[i].doc.isEqual(r[i].doc))return!1;return!0}};var Yc=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(t=>t.J_())}},Jc=class{constructor(){this.queries=Am(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(e,r){let i=L(e),s=i.queries;i.queries=Am(),s.forEach((o,u)=>{for(let c of u.j_)c.onError(r)})})(this,new N(S.ABORTED,"Firestore shutting down"))}};function Am(){return new ye(n=>ep(n),es)}function jl(n,t){return C(this,null,function*(){let e=L(n),r=3,i=t.query,s=e.queries.get(i);s?!s.H_()&&t.J_()&&(r=2):(s=new Yc,r=t.J_()?0:1);try{switch(r){case 0:s.z_=yield e.onListen(i,!0);break;case 1:s.z_=yield e.onListen(i,!1);break;case 2:yield e.onFirstRemoteStoreListen(i)}}catch(o){let u=Fr(o,`Initialization of query '${or(t.query)}' failed`);return void t.onError(u)}e.queries.set(i,s),s.j_.push(t),t.Z_(e.onlineState),s.z_&&t.X_(s.z_)&&$l(e)})}function Gl(n,t){return C(this,null,function*(){let e=L(n),r=t.query,i=3,s=e.queries.get(r);if(s){let o=s.j_.indexOf(t);o>=0&&(s.j_.splice(o,1),s.j_.length===0?i=t.J_()?0:1:!s.H_()&&t.J_()&&(i=2))}switch(i){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}})}function aT(n,t){let e=L(n),r=!1;for(let i of t){let s=i.query,o=e.queries.get(s);if(o){for(let u of o.j_)u.X_(i)&&(r=!0);o.z_=i}}r&&$l(e)}function uT(n,t,e){let r=L(n),i=r.queries.get(t);if(i)for(let s of i.j_)s.onError(e);r.queries.delete(t)}function $l(n){n.Y_.forEach(t=>{t.next()})}var Zc,Rm;(Rm=Zc||(Zc={})).ea="default",Rm.Cache="cache";var Ki=class{constructor(t,e,r){this.query=t,this.ta=e,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(t){if(!this.options.includeMetadataChanges){let r=[];for(let i of t.docChanges)i.type!==3&&r.push(i);t=new Pr(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.na?this.ia(t)&&(this.ta.next(t),e=!0):this.sa(t,this.onlineState)&&(this.oa(t),e=!0),this.ra=t,e}onError(t){this.ta.error(t)}Z_(t){this.onlineState=t;let e=!1;return this.ra&&!this.na&&this.sa(this.ra,t)&&(this.oa(this.ra),e=!0),e}sa(t,e){if(!t.fromCache||!this.J_())return!0;let r=e!=="Offline";return(!this.options._a||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}ia(t){if(t.docChanges.length>0)return!0;let e=this.ra&&this.ra.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}oa(t){t=Pr.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.na=!0,this.ta.next(t)}J_(){return this.options.source!==Zc.Cache}};var tl=class{constructor(t,e){this.aa=t,this.byteLength=e}ua(){return"metadata"in this.aa}};var zo=class{constructor(t){this.serializer=t}Es(t){return fe(this.serializer,t)}ds(t){return t.metadata.exists?Ep(this.serializer,t.document,!1):Et.newNoDocument(this.Es(t.metadata.name),this.As(t.metadata.readTime))}As(t){return gt(t)}},el=class{constructor(t,e,r){this.ca=t,this.localStore=e,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Xp(t)}la(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.aa.namedQuery)this.queries.push(t.aa.namedQuery);else if(t.aa.documentMetadata){this.documents.push({metadata:t.aa.documentMetadata}),t.aa.documentMetadata.exists||++e;let r=Y.fromString(t.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else t.aa.document&&(this.documents[this.documents.length-1].document=t.aa.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}ha(t){let e=new Map,r=new zo(this.serializer);for(let i of t)if(i.metadata.queries){let s=r.Es(i.metadata.name);for(let o of i.metadata.queries){let u=(e.get(o)||W()).add(s);e.set(o,u)}}return e}complete(){return C(this,null,function*(){let t=yield Qv(this.localStore,new zo(this.serializer),this.documents,this.ca.id),e=this.ha(this.documents);for(let r of this.queries)yield Hv(this.localStore,r,e.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:t}})}};function Xp(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var jo=class{constructor(t){this.key=t}},Go=class{constructor(t){this.key=t}},$o=class{constructor(t,e){this.query=t,this.Ta=e,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=W(),this.mutatedKeys=W(),this.Aa=rp(t),this.Ra=new Bo(this.Aa)}get Va(){return this.Ta}ma(t,e){let r=e?e.fa:new qo,i=e?e.Ra:this.Ra,s=e?e.mutatedKeys:this.mutatedKeys,o=i,u=!1,c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((f,p)=>{let _=i.get(f),E=ns(this.query,p)?p:null,x=!!_&&this.mutatedKeys.has(_.key),D=!!E&&(E.hasLocalMutations||this.mutatedKeys.has(E.key)&&E.hasCommittedMutations),k=!1;_&&E?_.data.isEqual(E.data)?x!==D&&(r.track({type:3,doc:E}),k=!0):this.ga(_,E)||(r.track({type:2,doc:E}),k=!0,(c&&this.Aa(E,c)>0||h&&this.Aa(E,h)<0)&&(u=!0)):!_&&E?(r.track({type:0,doc:E}),k=!0):_&&!E&&(r.track({type:1,doc:_}),k=!0,(c||h)&&(u=!0)),k&&(E?(o=o.add(E),s=D?s.add(f):s.delete(f)):(o=o.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let f=this.query.limitType==="F"?o.last():o.first();o=o.delete(f.key),s=s.delete(f.key),r.track({type:1,doc:f})}return{Ra:o,fa:r,ns:u,mutatedKeys:s}}ga(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,r,i){let s=this.Ra;this.Ra=t.Ra,this.mutatedKeys=t.mutatedKeys;let o=t.fa.G_();o.sort((f,p)=>function(E,x){let D=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return U()}};return D(E)-D(x)}(f.type,p.type)||this.Aa(f.doc,p.doc)),this.pa(r),i=i!=null&&i;let u=e&&!i?this.ya():[],c=this.da.size===0&&this.current&&!i?1:0,h=c!==this.Ea;return this.Ea=c,o.length!==0||h?{snapshot:new Pr(this.query,t.Ra,s,o,t.mutatedKeys,c===0,h,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:u}:{wa:u}}Z_(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new qo,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(t){return!this.Ta.has(t)&&!!this.Ra.has(t)&&!this.Ra.get(t).hasLocalMutations}pa(t){t&&(t.addedDocuments.forEach(e=>this.Ta=this.Ta.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.Ta=this.Ta.delete(e)),this.current=t.current)}ya(){if(!this.current)return[];let t=this.da;this.da=W(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});let e=[];return t.forEach(r=>{this.da.has(r)||e.push(new Go(r))}),this.da.forEach(r=>{t.has(r)||e.push(new jo(r))}),e}ba(t){this.Ta=t.Ts,this.da=W();let e=this.ma(t.documents);return this.applyChanges(e,!0)}Da(){return Pr.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},nl=class{constructor(t,e,r){this.query=t,this.targetId=e,this.view=r}},rl=class{constructor(t){this.key=t,this.va=!1}},il=class{constructor(t,e,r,i,s,o){this.localStore=t,this.remoteStore=e,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new ye(u=>ep(u),es),this.Ma=new Map,this.xa=new Set,this.Oa=new ot(M.comparator),this.Na=new Map,this.La=new ji,this.Ba={},this.ka=new Map,this.qa=Ar.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function cT(n,t,e=!0){return C(this,null,function*(){let r=sa(n),i,s=r.Fa.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=yield Yp(r,t,e,!0),i})}function lT(n,t){return C(this,null,function*(){let e=sa(n);yield Yp(e,t,!0,!1)})}function Yp(n,t,e,r){return C(this,null,function*(){let i=yield Rr(n.localStore,$t(t)),s=i.targetId,o=e?n.sharedClientState.addLocalQueryTarget(s):"not-current",u;return r&&(u=yield Kl(n,t,s,o==="current",i.resumeToken)),n.isPrimaryClient&&e&&ia(n.remoteStore,i),u})}function Kl(n,t,e,r,i){return C(this,null,function*(){n.Ka=(p,_,E)=>function(D,k,B,z){return C(this,null,function*(){let F=k.view.ma(B);F.ns&&(F=yield Vo(D.localStore,k.query,!1).then(({documents:v})=>k.view.ma(v,F)));let G=z&&z.targetChanges.get(k.targetId),Q=z&&z.targetMismatches.get(k.targetId)!=null,$=k.view.applyChanges(F,D.isPrimaryClient,G,Q);return sl(D,k.targetId,$.wa),$.snapshot})}(n,p,_,E);let s=yield Vo(n.localStore,t,!0),o=new $o(t,s.Ts),u=o.ma(s.documents),c=Ui.createSynthesizedTargetChangeForCurrentChange(e,r&&n.onlineState!=="Offline",i),h=o.applyChanges(u,n.isPrimaryClient,c);sl(n,e,h.wa);let f=new nl(t,e,o);return n.Fa.set(t,f),n.Ma.has(e)?n.Ma.get(e).push(t):n.Ma.set(e,[t]),h.snapshot})}function hT(n,t,e){return C(this,null,function*(){let r=L(n),i=r.Fa.get(t),s=r.Ma.get(i.targetId);if(s.length>1)return r.Ma.set(i.targetId,s.filter(o=>!es(o,t))),void r.Fa.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield br(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),e&&Sr(r.remoteStore,i.targetId),Cr(r,i.targetId)}).catch(on))):(Cr(r,i.targetId),yield br(r.localStore,i.targetId,!0))})}function dT(n,t){return C(this,null,function*(){let e=L(n),r=e.Fa.get(t),i=e.Ma.get(r.targetId);e.isPrimaryClient&&i.length===1&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),Sr(e.remoteStore,r.targetId))})}function fT(n,t,e){return C(this,null,function*(){let r=Xl(n);try{let i=yield function(o,u){let c=L(o),h=pt.now(),f=u.reduce((E,x)=>E.add(x.key),W()),p,_;return c.persistence.runTransaction("Locally write mutations","readwrite",E=>{let x=Qt(),D=W();return c.cs.getEntries(E,f).next(k=>{x=k,x.forEach((B,z)=>{z.isValidDocument()||(D=D.add(B))})}).next(()=>c.localDocuments.getOverlayedDocuments(E,x)).next(k=>{p=k;let B=[];for(let z of u){let F=Sv(z,p.get(z.key).overlayedDocument);F!=null&&B.push(new se(z.key,F,Qm(F.value.mapValue),ft.exists(!0)))}return c.mutationQueue.addMutationBatch(E,h,B,u)}).next(k=>{_=k;let B=k.applyToLocalDocumentSet(p,D);return c.documentOverlayCache.saveOverlays(E,k.batchId,B)})}).then(()=>({batchId:_.batchId,changes:sp(p)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(i.batchId),function(o,u,c){let h=o.Ba[o.currentUser.toKey()];h||(h=new ot(K)),h=h.insert(u,c),o.Ba[o.currentUser.toKey()]=h}(r,i.batchId,e),yield De(r,i.changes),yield Lr(r.remoteStore)}catch(i){let s=Fr(i,"Failed to persist write");e.reject(s)}})}function Jp(n,t){return C(this,null,function*(){let e=L(n);try{let r=yield Kv(e.localStore,t);t.targetChanges.forEach((i,s)=>{let o=e.Na.get(s);o&&(q(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.va=!0:i.modifiedDocuments.size>0?q(o.va):i.removedDocuments.size>0&&(q(o.va),o.va=!1))}),yield De(e,r,t)}catch(r){yield on(r)}})}function bm(n,t,e){let r=L(n);if(r.isPrimaryClient&&e===0||!r.isPrimaryClient&&e===1){let i=[];r.Fa.forEach((s,o)=>{let u=o.view.Z_(t);u.snapshot&&i.push(u.snapshot)}),function(o,u){let c=L(o);c.onlineState=u;let h=!1;c.queries.forEach((f,p)=>{for(let _ of p.j_)_.Z_(u)&&(h=!0)}),h&&$l(c)}(r.eventManager,t),i.length&&r.Ca.d_(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function mT(n,t,e){return C(this,null,function*(){let r=L(n);r.sharedClientState.updateQueryState(t,"rejected",e);let i=r.Na.get(t),s=i&&i.key;if(s){let o=new ot(M.comparator);o=o.insert(s,Et.newNoDocument(s,j.min()));let u=W().add(s),c=new Fi(j.min(),new Map,new ot(K),o,u);yield Jp(r,c),r.Oa=r.Oa.remove(s),r.Na.delete(t),Hl(r)}else yield br(r.localStore,t,!1).then(()=>Cr(r,t,e)).catch(on)})}function pT(n,t){return C(this,null,function*(){let e=L(n),r=t.batch.batchId;try{let i=yield $v(e.localStore,t);Ql(e,r,null),Wl(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),yield De(e,i)}catch(i){yield on(i)}})}function gT(n,t,e){return C(this,null,function*(){let r=L(n);try{let i=yield function(o,u){let c=L(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return c.mutationQueue.lookupMutationBatch(h,u).next(p=>(q(p!==null),f=p.keys(),c.mutationQueue.removeMutationBatch(h,p))).next(()=>c.mutationQueue.performConsistencyCheck(h)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(h,f,u)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>c.localDocuments.getDocuments(h,f))})}(r.localStore,t);Ql(r,t,e),Wl(r,t),r.sharedClientState.updateMutationState(t,"rejected",e),yield De(r,i)}catch(i){yield on(i)}})}function _T(n,t){return C(this,null,function*(){let e=L(n);un(e.remoteStore)||V("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield function(o){let u=L(o);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>u.mutationQueue.getHighestUnacknowledgedBatchId(c))}(e.localStore);if(r===-1)return void t.resolve();let i=e.ka.get(r)||[];i.push(t),e.ka.set(r,i)}catch(r){let i=Fr(r,"Initialization of waitForPendingWrites() operation failed");t.reject(i)}})}function Wl(n,t){(n.ka.get(t)||[]).forEach(e=>{e.resolve()}),n.ka.delete(t)}function Ql(n,t,e){let r=L(n),i=r.Ba[r.currentUser.toKey()];if(i){let s=i.get(t);s&&(e?s.reject(e):s.resolve(),i=i.remove(t)),r.Ba[r.currentUser.toKey()]=i}}function Cr(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(let r of n.Ma.get(t))n.Fa.delete(r),e&&n.Ca.$a(r,e);n.Ma.delete(t),n.isPrimaryClient&&n.La.gr(t).forEach(r=>{n.La.containsKey(r)||Zp(n,r)})}function Zp(n,t){n.xa.delete(t.path.canonicalString());let e=n.Oa.get(t);e!==null&&(Sr(n.remoteStore,e),n.Oa=n.Oa.remove(t),n.Na.delete(e),Hl(n))}function sl(n,t,e){for(let r of e)r instanceof jo?(n.La.addReference(r.key,t),yT(n,r)):r instanceof Go?(V("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,t),n.La.containsKey(r.key)||Zp(n,r.key)):U()}function yT(n,t){let e=t.key,r=e.path.canonicalString();n.Oa.get(e)||n.xa.has(r)||(V("SyncEngine","New document in limbo: "+e),n.xa.add(r),Hl(n))}function Hl(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){let t=n.xa.values().next().value;n.xa.delete(t);let e=new M(Y.fromString(t)),r=n.qa.next();n.Na.set(r,new rl(e)),n.Oa=n.Oa.insert(e,r),ia(n.remoteStore,new Er($t(Nr(e.path)),r,"TargetPurposeLimboResolution",Yt.oe))}}function De(n,t,e){return C(this,null,function*(){let r=L(n),i=[],s=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((u,c)=>{o.push(r.Ka(c,t,e).then(h=>{var f;if((h||e)&&r.isPrimaryClient){let p=h?!h.fromCache:(f=e?.targetChanges.get(c.targetId))===null||f===void 0?void 0:f.current;r.sharedClientState.updateQueryState(c.targetId,p?"current":"not-current")}if(h){i.push(h);let p=Mc.Wi(c.targetId,h);s.push(p)}}))}),yield Promise.all(o),r.Ca.d_(i),yield function(c,h){return C(this,null,function*(){let f=L(c);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>b.forEach(h,_=>b.forEach(_.$i,E=>f.persistence.referenceDelegate.addReference(p,_.targetId,E)).next(()=>b.forEach(_.Ui,E=>f.persistence.referenceDelegate.removeReference(p,_.targetId,E)))))}catch(p){if(!an(p))throw p;V("LocalStore","Failed to update sequence numbers: "+p)}for(let p of h){let _=p.targetId;if(!p.fromCache){let E=f.os.get(_),x=E.snapshotVersion,D=E.withLastLimboFreeSnapshotVersion(x);f.os=f.os.insert(_,D)}}})}(r.localStore,s))})}function wT(n,t){return C(this,null,function*(){let e=L(n);if(!e.currentUser.isEqual(t)){V("SyncEngine","User change. New user:",t.toKey());let r=yield Fp(e.localStore,t);e.currentUser=t,function(s,o){s.ka.forEach(u=>{u.forEach(c=>{c.reject(new N(S.CANCELLED,o))})}),s.ka.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),yield De(e,r.hs)}})}function vT(n,t){let e=L(n),r=e.Na.get(t);if(r&&r.va)return W().add(r.key);{let i=W(),s=e.Ma.get(t);if(!s)return i;for(let o of s){let u=e.Fa.get(o);i=i.unionWith(u.view.Va)}return i}}function TT(n,t){return C(this,null,function*(){let e=L(n),r=yield Vo(e.localStore,t.query,!0),i=t.view.ba(r);return e.isPrimaryClient&&sl(e,t.targetId,i.wa),i})}function IT(n,t){return C(this,null,function*(){let e=L(n);return zp(e.localStore,t).then(r=>De(e,r))})}function ET(n,t,e,r){return C(this,null,function*(){let i=L(n),s=yield function(u,c){let h=L(u),f=L(h.mutationQueue);return h.persistence.runTransaction("Lookup mutation documents","readonly",p=>f.Mn(p,c).next(_=>_?h.localDocuments.getDocuments(p,_):b.resolve(null)))}(i.localStore,t);s!==null?(e==="pending"?yield Lr(i.remoteStore):e==="acknowledged"||e==="rejected"?(Ql(i,t,r||null),Wl(i,t),function(u,c){L(L(u).mutationQueue).On(c)}(i.localStore,t)):U(),yield De(i,s)):V("SyncEngine","Cannot apply mutation batch with id: "+t)})}function AT(n,t){return C(this,null,function*(){let e=L(n);if(sa(e),Xl(e),t===!0&&e.Qa!==!0){let r=e.sharedClientState.getAllActiveQueryTargets(),i=yield Sm(e,r.toArray());e.Qa=!0,yield Hc(e.remoteStore,!0);for(let s of i)ia(e.remoteStore,s)}else if(t===!1&&e.Qa!==!1){let r=[],i=Promise.resolve();e.Ma.forEach((s,o)=>{e.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Cr(e,o),br(e.localStore,o,!0))),Sr(e.remoteStore,o)}),yield i,yield Sm(e,r),function(o){let u=L(o);u.Na.forEach((c,h)=>{Sr(u.remoteStore,h)}),u.La.pr(),u.Na=new Map,u.Oa=new ot(M.comparator)}(e),e.Qa=!1,yield Hc(e.remoteStore,!1)}})}function Sm(n,t,e){return C(this,null,function*(){let r=L(n),i=[],s=[];for(let o of t){let u,c=r.Ma.get(o);if(c&&c.length!==0){u=yield Rr(r.localStore,$t(c[0]));for(let h of c){let f=r.Fa.get(h),p=yield TT(r,f);p.snapshot&&s.push(p.snapshot)}}else{let h=yield qp(r.localStore,o);u=yield Rr(r.localStore,h),yield Kl(r,tg(h),o,!1,u.resumeToken)}i.push(u)}return r.Ca.d_(s),i})}function tg(n){return tp(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function RT(n){return function(e){return L(L(e).persistence).Qi()}(L(n).localStore)}function bT(n,t,e,r){return C(this,null,function*(){let i=L(n);if(i.Qa)return void V("SyncEngine","Ignoring unexpected query state notification.");let s=i.Ma.get(t);if(s&&s.length>0)switch(e){case"current":case"not-current":{let o=yield zp(i.localStore,np(s[0])),u=Fi.createSynthesizedRemoteEventForCurrentChange(t,e==="current",yt.EMPTY_BYTE_STRING);yield De(i,o,u);break}case"rejected":yield br(i.localStore,t,!0),Cr(i,t,r);break;default:U()}})}function ST(n,t,e){return C(this,null,function*(){let r=sa(n);if(r.Qa){for(let i of t){if(r.Ma.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){V("SyncEngine","Adding an already active target "+i);continue}let s=yield qp(r.localStore,i),o=yield Rr(r.localStore,s);yield Kl(r,tg(s),o.targetId,!1,o.resumeToken),ia(r.remoteStore,o)}for(let i of e)r.Ma.has(i)&&(yield br(r.localStore,i,!1).then(()=>{Sr(r.remoteStore,i),Cr(r,i)}).catch(on))}})}function sa(n){let t=L(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=Jp.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=vT.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=mT.bind(null,t),t.Ca.d_=aT.bind(null,t.eventManager),t.Ca.$a=uT.bind(null,t.eventManager),t}function Xl(n){let t=L(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=pT.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=gT.bind(null,t),t}function PT(n,t,e){let r=L(n);(function(s,o,u){return C(this,null,function*(){try{let c=yield o.getMetadata();if(yield function(E,x){let D=L(E),k=gt(x.createTime);return D.persistence.runTransaction("hasNewerBundle","readonly",B=>D.Gr.getBundleMetadata(B,x.id)).then(B=>!!B&&B.createTime.compareTo(k)>=0)}(s.localStore,c))return yield o.close(),u._completeWith(function(E){return{taskState:"Success",documentsLoaded:E.totalDocuments,bytesLoaded:E.totalBytes,totalDocuments:E.totalDocuments,totalBytes:E.totalBytes}}(c)),Promise.resolve(new Set);u._updateProgress(Xp(c));let h=new el(c,s.localStore,o.serializer),f=yield o.Ua();for(;f;){let _=yield h.la(f);_&&u._updateProgress(_),f=yield o.Ua()}let p=yield h.complete();return yield De(s,p.Ia,void 0),yield function(E,x){let D=L(E);return D.persistence.runTransaction("Save bundle","readwrite",k=>D.Gr.saveBundleMetadata(k,x))}(s.localStore,c),u._completeWith(p.progress),Promise.resolve(p.Pa)}catch(c){return pe("SyncEngine",`Loading bundle failed with ${c}`),u._failWith(c),Promise.resolve(new Set)}})})(r,t,e).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var Wi=class{constructor(){this.synchronizeTabs=!1}initialize(t){return C(this,null,function*(){this.serializer=rs(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),yield this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)})}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return Mp(this.persistence,new Do,t.initialUser,this.serializer)}createPersistence(t){return new xo(ko.Zr,this.serializer)}createSharedClientState(t){return new Lo}terminate(){return C(this,null,function*(){var t,e;(t=this.gcScheduler)===null||t===void 0||t.stop(),(e=this.indexBackfillerScheduler)===null||e===void 0||e.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var Ko=class n extends Wi{constructor(t,e,r){super(),this.Wa=t,this.cacheSizeBytes=e,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(t){return C(this,null,function*(){yield Fa(n.prototype,this,"initialize").call(this,t),yield this.Wa.initialize(this,t),yield Xl(this.Wa.syncEngine),yield Lr(this.Wa.remoteStore),yield this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(t){return Mp(this.persistence,new Do,t.initialUser,this.serializer)}createGarbageCollectionScheduler(t,e){let r=this.persistence.referenceDelegate.garbageCollector;return new Tc(r,t.asyncQueue,e)}createIndexBackfillerScheduler(t,e){let r=new Fu(e,this.persistence);return new Mu(t.asyncQueue,r)}createPersistence(t){let e=Ul(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Zt.withCacheSize(this.cacheSizeBytes):Zt.DEFAULT;return new Lc(this.synchronizeTabs,e,t.clientId,r,t.asyncQueue,Gp(),ro(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(t){return new Lo}},ol=class n extends Ko{constructor(t,e){super(t,e,!1),this.Wa=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}initialize(t){return C(this,null,function*(){yield Fa(n.prototype,this,"initialize").call(this,t);let e=this.Wa.syncEngine;this.sharedClientState instanceof Pi&&(this.sharedClientState.syncEngine={no:ET.bind(null,e),ro:bT.bind(null,e),io:ST.bind(null,e),Qi:RT.bind(null,e),eo:IT.bind(null,e)},yield this.sharedClientState.start()),yield this.persistence.yi(r=>C(this,null,function*(){yield AT(this.Wa.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(t){let e=Gp();if(!Pi.D(e))throw new N(S.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=Ul(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Pi(e,t.asyncQueue,r,t.clientId,t.initialUser)}},Qi=class{initialize(t,e){return C(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>bm(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=wT.bind(null,this.syncEngine),yield Hc(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new Jc}()}createDatastore(t){let e=rs(t.databaseInfo.databaseId),r=function(s){return new jc(s)}(t.databaseInfo);return function(s,o,u,c){return new Kc(s,o,u,c)}(t.authCredentials,t.appCheckCredentials,r,e)}createRemoteStore(t){return function(r,i,s,o,u){return new Qc(r,i,s,o,u)}(this.localStore,this.datastore,t.asyncQueue,e=>bm(this.syncEngine,e,0),function(){return Mo.D()?new Mo:new qc}())}createSyncEngine(t,e){return function(i,s,o,u,c,h,f){let p=new il(i,s,o,u,c,h);return f&&(p.Qa=!0),p}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return C(this,null,function*(){var t,e;yield function(i){return C(this,null,function*(){let s=L(i);V("RemoteStore","RemoteStore shutting down."),s.L_.add(5),yield Or(s),s.k_.shutdown(),s.q_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(e=this.eventManager)===null||e===void 0||e.terminate()})}};function Pm(n,t=10240){let e=0;return{read(){return C(this,null,function*(){if(e<n.byteLength){let i={value:n.slice(e,e+t),done:!1};return e+=t,i}return{done:!0}})},cancel(){return C(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var xr=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ga(this.observer.next,t)}error(t){this.observer.error?this.Ga(this.observer.error,t):mt("Uncaught Error in snapshot listener:",t.toString())}za(){this.muted=!0}Ga(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}};var al=class{constructor(t,e){this.ja=t,this.serializer=e,this.metadata=new It,this.buffer=new Uint8Array,this.Ha=function(){return new TextDecoder("utf-8")}(),this.Ja().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.aa)}`))},r=>this.metadata.reject(r))}close(){return this.ja.cancel()}getMetadata(){return C(this,null,function*(){return this.metadata.promise})}Ua(){return C(this,null,function*(){return yield this.getMetadata(),this.Ja()})}Ja(){return C(this,null,function*(){let t=yield this.Ya();if(t===null)return null;let e=this.Ha.decode(t),r=Number(e);isNaN(r)&&this.Za(`length string (${e}) is not valid number`);let i=yield this.Xa(r);return new tl(JSON.parse(i),t.length+r)})}eu(){return this.buffer.findIndex(t=>t===123)}Ya(){return C(this,null,function*(){for(;this.eu()<0&&!(yield this.tu()););if(this.buffer.length===0)return null;let t=this.eu();t<0&&this.Za("Reached the end of bundle when a length string is expected.");let e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e})}Xa(t){return C(this,null,function*(){for(;this.buffer.length<t;)(yield this.tu())&&this.Za("Reached the end of bundle when more is expected.");let e=this.Ha.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e})}Za(t){throw this.ja.cancel(),new Error(`Invalid bundle format: ${t}`)}tu(){return C(this,null,function*(){let t=yield this.ja.read();if(!t.done){let e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done})}};var ul=class{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(t){return C(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new N(S.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let e=yield function(i,s){return C(this,null,function*(){let o=L(i),u={documents:s.map(p=>Bi(o.serializer,p))},c=yield o.Lo("BatchGetDocuments",o.serializer.databaseId,Y.emptyPath(),u,s.length),h=new Map;c.forEach(p=>{let _=Vv(o.serializer,p);h.set(_.key.toString(),_)});let f=[];return s.forEach(p=>{let _=h.get(p.toString());q(!!_),f.push(_)}),f})}(this.datastore,t);return e.forEach(r=>this.recordVersion(r)),e})}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(t.toString())}delete(t){this.write(new tn(t,this.precondition(t))),this.writtenDocs.add(t.toString())}commit(){return C(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,r)=>{let i=M.fromPath(r);this.mutations.push(new Oi(i,this.precondition(i)))}),yield function(r,i){return C(this,null,function*(){let s=L(r),o={writes:i.map(u=>qi(s.serializer,u))};yield s.Mo("Commit",s.serializer.databaseId,Y.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw U();e=j.min()}let r=this.readVersions.get(t.key.toString());if(r){if(!e.isEqual(r))throw new N(S.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){let e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(j.min())?ft.exists(!1):ft.updateTime(e):ft.none()}preconditionForUpdate(t){let e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(j.min()))throw new N(S.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ft.updateTime(e)}return ft.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}};var cl=class{constructor(t,e,r,i,s){this.asyncQueue=t,this.datastore=e,this.options=r,this.updateFunction=i,this.deferred=s,this.nu=r.maxAttempts,this.t_=new $i(this.asyncQueue,"transaction_retry")}ru(){this.nu-=1,this.iu()}iu(){this.t_.Go(()=>C(this,null,function*(){let t=new ul(this.datastore),e=this.su(t);e&&e.then(r=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.ou(i)}))}).catch(r=>{this.ou(r)})}))}su(t){try{let e=this.updateFunction(t);return!Zi(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}ou(t){this.nu>0&&this._u(t)?(this.nu-=1,this.asyncQueue.enqueueAndForget(()=>(this.iu(),Promise.resolve()))):this.deferred.reject(t)}_u(t){if(t.name==="FirebaseError"){let e=t.code;return e==="aborted"||e==="failed-precondition"||e==="already-exists"||!pp(e)}return!1}};var ll=class{constructor(t,e,r,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=r,this.databaseInfo=i,this.user=Tt.UNAUTHENTICATED,this.clientId=oo.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>C(this,null,function*(){V("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(V("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new N(S.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let t=new It;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>C(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let r=Fr(e,"Failed to shutdown persistence");t.reject(r)}})),t.promise}};function io(n,t){return C(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),V("FirestoreClient","Initializing OfflineComponentProvider");let e=n.configuration;yield t.initialize(e);let r=e.initialUser;n.setCredentialChangeListener(i=>C(this,null,function*(){r.isEqual(i)||(yield Fp(t.localStore,i),r=i)})),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=t})}function hl(n,t){return C(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let e=yield Yl(n);V("FirestoreClient","Initializing OnlineComponentProvider"),yield t.initialize(e,n.configuration),n.setCredentialChangeListener(r=>Em(t.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Em(t.remoteStore,i)),n._onlineComponents=t})}function eg(n){return n.name==="FirebaseError"?n.code===S.FAILED_PRECONDITION||n.code===S.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}function Yl(n){return C(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){V("FirestoreClient","Using user provided OfflineComponentProvider");try{yield io(n,n._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!eg(e))throw e;pe("Error using user provided cache. Falling back to memory cache: "+e),yield io(n,new Wi)}}else V("FirestoreClient","Using default OfflineComponentProvider"),yield io(n,new Wi);return n._offlineComponents})}function oa(n){return C(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(V("FirestoreClient","Using user provided OnlineComponentProvider"),yield hl(n,n._uninitializedComponentsProvider._online)):(V("FirestoreClient","Using default OnlineComponentProvider"),yield hl(n,new Qi))),n._onlineComponents})}function ng(n){return Yl(n).then(t=>t.persistence)}function Jl(n){return Yl(n).then(t=>t.localStore)}function rg(n){return oa(n).then(t=>t.remoteStore)}function Zl(n){return oa(n).then(t=>t.syncEngine)}function CT(n){return oa(n).then(t=>t.datastore)}function kr(n){return C(this,null,function*(){let t=yield oa(n),e=t.eventManager;return e.onListen=cT.bind(null,t.syncEngine),e.onUnlisten=hT.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=lT.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=dT.bind(null,t.syncEngine),e})}function xT(n){return n.asyncQueue.enqueue(()=>C(this,null,function*(){let t=yield ng(n),e=yield rg(n);return t.setNetworkEnabled(!0),function(i){let s=L(i);return s.L_.delete(0),is(s)}(e)}))}function kT(n){return n.asyncQueue.enqueue(()=>C(this,null,function*(){let t=yield ng(n),e=yield rg(n);return t.setNetworkEnabled(!1),function(i){return C(this,null,function*(){let s=L(i);s.L_.add(0),yield Or(s),s.q_.set("Offline")})}(e)}))}function DT(n,t){let e=new It;return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return function(i,s,o){return C(this,null,function*(){try{let u=yield function(h,f){let p=L(h);return p.persistence.runTransaction("read document","readonly",_=>p.localDocuments.getDocument(_,f))}(i,s);u.isFoundDocument()?o.resolve(u):u.isNoDocument()?o.resolve(null):o.reject(new N(S.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){let c=Fr(u,`Failed to get document '${s} from cache`);o.reject(c)}})}(yield Jl(n),t,e)})),e.promise}function ig(n,t,e={}){let r=new It;return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return function(s,o,u,c,h){let f=new xr({next:_=>{o.enqueueAndForget(()=>Gl(s,p));let E=_.docs.has(u);!E&&_.fromCache?h.reject(new N(S.UNAVAILABLE,"Failed to get document because the client is offline.")):E&&_.fromCache&&c&&c.source==="server"?h.reject(new N(S.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(_)},error:_=>h.reject(_)}),p=new Ki(Nr(u.path),f,{includeMetadataChanges:!0,_a:!0});return jl(s,p)}(yield kr(n),n.asyncQueue,t,e,r)})),r.promise}function VT(n,t){let e=new It;return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return function(i,s,o){return C(this,null,function*(){try{let u=yield Vo(i,s,!0),c=new $o(s,u.Ts),h=c.ma(u.documents),f=c.applyChanges(h,!1);o.resolve(f.snapshot)}catch(u){let c=Fr(u,`Failed to execute query '${s} against cache`);o.reject(c)}})}(yield Jl(n),t,e)})),e.promise}function sg(n,t,e={}){let r=new It;return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return function(s,o,u,c,h){let f=new xr({next:_=>{o.enqueueAndForget(()=>Gl(s,p)),_.fromCache&&c.source==="server"?h.reject(new N(S.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(_)},error:_=>h.reject(_)}),p=new Ki(u,f,{includeMetadataChanges:!0,_a:!0});return jl(s,p)}(yield kr(n),n.asyncQueue,t,e,r)})),r.promise}function NT(n,t){let e=new xr(t);return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return function(i,s){L(i).Y_.add(s),s.next()}(yield kr(n),e)})),()=>{e.za(),n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return function(i,s){L(i).Y_.delete(s)}(yield kr(n),e)}))}}function OT(n,t,e,r){let i=function(o,u){let c;return c=typeof o=="string"?_p().encode(o):o,function(f,p){return new al(f,p)}(function(f,p){if(f instanceof Uint8Array)return Pm(f,p);if(f instanceof ArrayBuffer)return Pm(new Uint8Array(f),p);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),u)}(e,rs(t));n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){PT(yield Zl(n),i,r)}))}function LT(n,t){return n.asyncQueue.enqueue(()=>C(this,null,function*(){return function(r,i){let s=L(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.Gr.getNamedQuery(o,i))}(yield Jl(n),t)}))}function og(n){let t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}var Cm=new Map;function th(n,t,e){if(!e)throw new N(S.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function MT(n,t,e,r){if(t===!0&&r===!0)throw new N(S.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function xm(n){if(!M.isDocumentKey(n))throw new N(S.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function km(n){if(M.isDocumentKey(n))throw new N(S.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function aa(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let t=function(r){return r.constructor?r.constructor.name:null}(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":U()}function Z(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new N(S.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=aa(n);throw new N(S.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}function ag(n,t){if(t<=0)throw new N(S.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${t}.`)}var Wo=class{constructor(t){var e,r;if(t.host===void 0){if(t.ssl!==void 0)throw new N(S.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(e=t.ssl)===null||e===void 0||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new N(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}MT("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=og((r=t.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new N(S.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new N(S.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new N(S.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},Dn=class{constructor(t,e,r,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Wo({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new N(S.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(t){if(this._settingsFrozen)throw new N(S.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Wo(t),t.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Su;switch(r.type){case"firstParty":return new ku(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new N(S.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let r=Cm.get(e);r&&(V("ComponentProvider","Removing Datastore"),Cm.delete(e),r.terminate())}(this),Promise.resolve()}};function FT(n,t,e,r={}){var i;let s=(n=Z(n,Dn))._getSettings(),o=`${t}:${e}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&pe("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let u,c;if(typeof r.mockUserToken=="string")u=r.mockUserToken,c=Tt.MOCK_USER;else{u=Ps(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let h=r.mockUserToken.sub||r.mockUserToken.user_id;if(!h)throw new N(S.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Tt(h)}n._authCredentials=new Pu(new so(u,c))}}var Pt=class n{constructor(t,e,r){this.converter=e,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new n(this.firestore,t,this._query)}},_t=class n{constructor(t,e,r){this.converter=e,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new me(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new n(this.firestore,t,this._key)}},me=class n extends Pt{constructor(t,e,r){super(t,e,Nr(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new _t(this.firestore,null,new M(t))}withConverter(t){return new n(this.firestore,t,this._path)}};function ZE(n,t,...e){if(n=tt(n),th("collection","path",t),n instanceof Dn){let r=Y.fromString(t,...e);return km(r),new me(n,null,r)}{if(!(n instanceof _t||n instanceof me))throw new N(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(Y.fromString(t,...e));return km(r),new me(n.firestore,null,r)}}function t0(n,t){if(n=Z(n,Dn),th("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new N(S.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Pt(n,null,function(r){return new ie(Y.emptyPath(),r)}(t))}function UT(n,t,...e){if(n=tt(n),arguments.length===1&&(t=oo.newId()),th("doc","path",t),n instanceof Dn){let r=Y.fromString(t,...e);return xm(r),new _t(n,null,new M(r))}{if(!(n instanceof _t||n instanceof me))throw new N(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(Y.fromString(t,...e));return xm(r),new _t(n.firestore,n instanceof me?n.converter:null,new M(r))}}function e0(n,t){return n=tt(n),t=tt(t),(n instanceof _t||n instanceof me)&&(t instanceof _t||t instanceof me)&&n.firestore===t.firestore&&n.path===t.path&&n.converter===t.converter}function BT(n,t){return n=tt(n),t=tt(t),n instanceof Pt&&t instanceof Pt&&n.firestore===t.firestore&&es(n._query,t._query)&&n.converter===t.converter}var dl=class{constructor(){this.au=Promise.resolve(),this.uu=[],this.cu=!1,this.lu=[],this.hu=null,this.Pu=!1,this.Iu=!1,this.Tu=[],this.t_=new $i(this,"async_queue_retry"),this.Eu=()=>{let e=ro();e&&V("AsyncQueue","Visibility state changed to "+e.visibilityState),this.t_.jo()};let t=ro();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Eu)}get isShuttingDown(){return this.cu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.du(),this.Au(t)}enterRestrictedMode(t){if(!this.cu){this.cu=!0,this.Iu=t||!1;let e=ro();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.Eu)}}enqueue(t){if(this.du(),this.cu)return new Promise(()=>{});let e=new It;return this.Au(()=>this.cu&&this.Iu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.uu.push(t),this.Ru()))}Ru(){return C(this,null,function*(){if(this.uu.length!==0){try{yield this.uu[0](),this.uu.shift(),this.t_.reset()}catch(t){if(!an(t))throw t;V("AsyncQueue","Operation failed with retryable error: "+t)}this.uu.length>0&&this.t_.Go(()=>this.Ru())}})}Au(t){let e=this.au.then(()=>(this.Pu=!0,t().catch(r=>{this.hu=r,this.Pu=!1;let i=function(o){let u=o.message||"";return o.stack&&(u=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),u}(r);throw mt("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.Pu=!1,r))));return this.au=e,e}enqueueAfterDelay(t,e,r){this.du(),this.Tu.indexOf(t)>-1&&(e=0);let i=Xc.createAndSchedule(this,t,e,r,s=>this.Vu(s));return this.lu.push(i),i}du(){this.hu&&U()}verifyOperationInProgress(){}mu(){return C(this,null,function*(){let t;do t=this.au,yield t;while(t!==this.au)})}fu(t){for(let e of this.lu)if(e.timerId===t)return!0;return!1}gu(t){return this.mu().then(()=>{this.lu.sort((e,r)=>e.targetTimeMs-r.targetTimeMs);for(let e of this.lu)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.mu()})}pu(t){this.Tu.push(t)}Vu(t){let e=this.lu.indexOf(t);this.lu.splice(e,1)}};function fl(n){return function(e,r){if(typeof e!="object"||e===null)return!1;let i=e;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var ml=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new It,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,r){this._progressObserver={next:t,error:e,complete:r}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}};var n0=-1,ct=class extends Dn{constructor(t,e,r,i){super(t,e,r,i),this.type="firestore",this._queue=function(){return new dl}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||ug(this),this._firestoreClient.terminate()}};function r0(n,t){let e=typeof n=="object"?n:Vs(),r=typeof n=="string"?n:t||"(default)",i=ks(e,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=Ss("firestore");s&&FT(i,...s)}return i}function Ct(n){return n._firestoreClient||ug(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function ug(n){var t,e,r;let i=n._freezeSettings(),s=function(u,c,h,f){return new Uu(u,c,h,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,og(f.experimentalLongPollingOptions),f.useFetchStreams)}(n._databaseId,((t=n._app)===null||t===void 0?void 0:t.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new ll(n._authCredentials,n._appCheckCredentials,n._queue,s),!((e=i.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function i0(n,t){lg(n=Z(n,ct));let e=Ct(n);if(e._uninitializedComponentsProvider)throw new N(S.FAILED_PRECONDITION,"SDK cache is already specified.");pe("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new Qi;return cg(e,i,new Ko(i,r.cacheSizeBytes,t?.forceOwnership))}function s0(n){lg(n=Z(n,ct));let t=Ct(n);if(t._uninitializedComponentsProvider)throw new N(S.FAILED_PRECONDITION,"SDK cache is already specified.");pe("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=n._freezeSettings(),r=new Qi;return cg(t,r,new ol(r,e.cacheSizeBytes))}function cg(n,t,e){let r=new It;return n.asyncQueue.enqueue(()=>C(this,null,function*(){try{yield io(n,e),yield hl(n,t),r.resolve()}catch(i){let s=i;if(!eg(s))throw s;pe("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function o0(n){if(n._initialized&&!n._terminated)throw new N(S.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new It;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>C(this,null,function*(){try{yield function(r){return C(this,null,function*(){if(!Qe.D())return Promise.resolve();let i=r+"main";yield Qe.delete(i)})}(Ul(n._databaseId,n._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}function a0(n){return function(e){let r=new It;return e.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return _T(yield Zl(e),r)})),r.promise}(Ct(n=Z(n,ct)))}function u0(n){return xT(Ct(n=Z(n,ct)))}function c0(n){return kT(Ct(n=Z(n,ct)))}function l0(n,t){let e=Ct(n=Z(n,ct)),r=new ml;return OT(e,n._databaseId,t,r),r}function h0(n,t){return LT(Ct(n=Z(n,ct)),t).then(e=>e?new Pt(n,null,e.query):null)}function lg(n){if(n._initialized||n._terminated)throw new N(S.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Dr=class n{constructor(t){this._byteString=t}static fromBase64String(t){try{return new n(yt.fromBase64String(t))}catch(e){throw new N(S.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new n(yt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}};var nn=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new N(S.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new At(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var xe=class{constructor(t){this._methodName=t}};var Hi=class{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new N(S.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new N(S.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return K(this._lat,t._lat)||K(this._long,t._long)}};var Xi=class{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,t._values)}};var qT=/^__.*__$/,pl=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return this.fieldMask!==null?new se(t,this.data,this.fieldMask,e,this.fieldTransforms):new Ze(t,this.data,e,this.fieldTransforms)}},Qo=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return new se(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function hg(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw U()}}var Ho=class n{constructor(t,e,r,i,s,o){this.settings=t,this.databaseId=e,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.yu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get wu(){return this.settings.wu}Su(t){return new n(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}bu(t){var e;let r=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.Su({path:r,Du:!1});return i.vu(t),i}Cu(t){var e;let r=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.Su({path:r,Du:!1});return i.yu(),i}Fu(t){return this.Su({path:void 0,Du:!0})}Mu(t){return Xo(t,this.settings.methodName,this.settings.xu||!1,this.path,this.settings.Ou)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}yu(){if(this.path)for(let t=0;t<this.path.length;t++)this.vu(this.path.get(t))}vu(t){if(t.length===0)throw this.Mu("Document fields must not be empty");if(hg(this.wu)&&qT.test(t))throw this.Mu('Document fields cannot begin and end with "__"')}},gl=class{constructor(t,e,r){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=r||rs(t)}Nu(t,e,r,i=!1){return new Ho({wu:t,methodName:e,Ou:r,path:At.emptyPath(),Du:!1,xu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Ln(n){let t=n._freezeSettings(),e=rs(n._databaseId);return new gl(n._databaseId,!!t.ignoreUndefinedProperties,e)}function ua(n,t,e,r,i,s={}){let o=n.Nu(s.merge||s.mergeFields?2:0,t,e,i);rh("Data must be an object, but it was:",o,r);let u=mg(r,o),c,h;if(s.merge)c=new Jt(o.fieldMask),h=o.fieldTransforms;else if(s.mergeFields){let f=[];for(let p of s.mergeFields){let _=Tl(t,p,e);if(!o.contains(_))throw new N(S.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);gg(f,_)||f.push(_)}c=new Jt(f),h=o.fieldTransforms.filter(p=>c.covers(p.field))}else c=null,h=o.fieldTransforms;return new pl(new Lt(u),c,h)}var Yi=class n extends xe{_toFieldTransform(t){if(t.wu!==2)throw t.wu===1?t.Mu(`${this._methodName}() can only appear at the top level of your update data`):t.Mu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof n}};function dg(n,t,e){return new Ho({wu:3,Ou:t.settings.Ou,methodName:n._methodName,Du:e},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var _l=class n extends xe{_toFieldTransform(t){return new Cn(t.path,new Ye)}isEqual(t){return t instanceof n}},yl=class n extends xe{constructor(t,e){super(t),this.Lu=e}_toFieldTransform(t){let e=dg(this,t,!0),r=this.Lu.map(s=>Mn(s,e)),i=new Pe(r);return new Cn(t.path,i)}isEqual(t){return t instanceof n&&Ka(this.Lu,t.Lu)}},wl=class n extends xe{constructor(t,e){super(t),this.Lu=e}_toFieldTransform(t){let e=dg(this,t,!0),r=this.Lu.map(s=>Mn(s,e)),i=new Ce(r);return new Cn(t.path,i)}isEqual(t){return t instanceof n&&Ka(this.Lu,t.Lu)}},vl=class n extends xe{constructor(t,e){super(t),this.Bu=e}_toFieldTransform(t){let e=new Je(t.serializer,up(t.serializer,this.Bu));return new Cn(t.path,e)}isEqual(t){return t instanceof n&&this.Bu===t.Bu}};function eh(n,t,e,r){let i=n.Nu(1,t,e);rh("Data must be an object, but it was:",i,r);let s=[],o=Lt.empty();On(r,(c,h)=>{let f=ih(t,c,e);h=tt(h);let p=i.Cu(f);if(h instanceof Yi)s.push(f);else{let _=Mn(h,p);_!=null&&(s.push(f),o.set(f,_))}});let u=new Jt(s);return new Qo(o,u,i.fieldTransforms)}function nh(n,t,e,r,i,s){let o=n.Nu(1,t,e),u=[Tl(t,r,e)],c=[i];if(s.length%2!=0)throw new N(S.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<s.length;_+=2)u.push(Tl(t,s[_])),c.push(s[_+1]);let h=[],f=Lt.empty();for(let _=u.length-1;_>=0;--_)if(!gg(h,u[_])){let E=u[_],x=c[_];x=tt(x);let D=o.Cu(E);if(x instanceof Yi)h.push(E);else{let k=Mn(x,D);k!=null&&(h.push(E),f.set(E,k))}}let p=new Jt(h);return new Qo(f,p,o.fieldTransforms)}function fg(n,t,e,r=!1){return Mn(e,n.Nu(r?4:3,t))}function Mn(n,t){if(pg(n=tt(n)))return rh("Unsupported field value:",t,n),mg(n,t);if(n instanceof xe)return function(r,i){if(!hg(i.wu))throw i.Mu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Mu(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.Du&&t.wu!==4)throw t.Mu("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let u of r){let c=Mn(u,i.Fu(o));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),o++}return{arrayValue:{values:s}}}(n,t)}return function(r,i){if((r=tt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return up(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=pt.fromDate(r);return{timestampValue:Ir(i.serializer,s)}}if(r instanceof pt){let s=new pt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Ir(i.serializer,s)}}if(r instanceof Hi)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Dr)return{bytesValue:yp(i.serializer,r._byteString)};if(r instanceof _t){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Mu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Ll(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Xi)return function(o,u){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(c=>{if(typeof c!="number")throw u.Mu("VectorValues must only contain numeric values.");return Ol(u.serializer,c)})}}}}}}(r,i);throw i.Mu(`Unsupported field value: ${aa(r)}`)}(n,t)}function mg(n,t){let e={};return $m(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):On(n,(r,i)=>{let s=Mn(i,t.bu(r));s!=null&&(e[r]=s)}),{mapValue:{fields:e}}}function pg(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof pt||n instanceof Hi||n instanceof Dr||n instanceof _t||n instanceof xe||n instanceof Xi)}function rh(n,t,e){if(!pg(e)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(e)){let r=aa(e);throw r==="an object"?t.Mu(n+" a custom object"):t.Mu(n+" "+r)}}function Tl(n,t,e){if((t=tt(t))instanceof nn)return t._internalPath;if(typeof t=="string")return ih(n,t);throw Xo("Field path arguments must be of type string or ",n,!1,void 0,e)}var zT=new RegExp("[~\\*/\\[\\]]");function ih(n,t,e){if(t.search(zT)>=0)throw Xo(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new nn(...t.split("."))._internalPath}catch{throw Xo(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function Xo(n,t,e,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,u=`Function ${t}() called with invalid data`;e&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new N(S.INVALID_ARGUMENT,u+n+c)}function gg(n,t){return n.some(e=>e.isEqual(t))}var Vn=class{constructor(t,e,r,i,s){this._firestore=t,this._userDataWriter=e,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new _t(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new Il(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(ca("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},Il=class extends Vn{data(){return super.data()}};function ca(n,t){return typeof t=="string"?ih(n,t):t instanceof nn?t._internalPath:t._delegate._internalPath}function _g(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new N(S.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Ji=class{},Nn=class extends Ji{};function d0(n,t,...e){let r=[];t instanceof Ji&&r.push(t),r=r.concat(e),function(s){let o=s.filter(c=>c instanceof El).length,u=s.filter(c=>c instanceof Yo).length;if(o>1||o>0&&u>0)throw new N(S.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var Yo=class n extends Nn{constructor(t,e,r){super(),this._field=t,this._op=e,this._value=r,this.type="where"}static _create(t,e,r){return new n(t,e,r)}_apply(t){let e=this._parse(t);return wg(t._query,e),new Pt(t.firestore,t.converter,Ju(t._query,e))}_parse(t){let e=Ln(t.firestore);return function(s,o,u,c,h,f,p){let _;if(h.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new N(S.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){Vm(p,f);let E=[];for(let x of p)E.push(Dm(c,s,x));_={arrayValue:{values:E}}}else _=Dm(c,s,p)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||Vm(p,f),_=fg(u,o,p,f==="in"||f==="not-in");return H.create(h,f,_)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}};function f0(n,t,e){let r=t,i=ca("where",n);return Yo._create(i,r,e)}var El=class n extends Ji{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new n(t,e)}_parse(t){let e=this._queryConstraints.map(r=>r._parse(t)).filter(r=>r.getFilters().length>0);return e.length===1?e[0]:nt.create(e,this._getOperator())}_apply(t){let e=this._parse(t);return e.getFilters().length===0?t:(function(i,s){let o=i,u=s.getFlattenedFilters();for(let c of u)wg(o,c),o=Ju(o,c)}(t._query,e),new Pt(t.firestore,t.converter,Ju(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Al=class n extends Nn{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new n(t,e)}_apply(t){let e=function(i,s,o){if(i.startAt!==null)throw new N(S.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new N(S.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Sn(s,o)}(t._query,this._field,this._direction);return new Pt(t.firestore,t.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new ie(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(t._query,e))}};function m0(n,t="asc"){let e=t,r=ca("orderBy",n);return Al._create(r,e)}var Jo=class n extends Nn{constructor(t,e,r){super(),this.type=t,this._limit=e,this._limitType=r}static _create(t,e,r){return new n(t,e,r)}_apply(t){return new Pt(t.firestore,t.converter,_o(t._query,this._limit,this._limitType))}};function p0(n){return ag("limit",n),Jo._create("limit",n,"F")}function g0(n){return ag("limitToLast",n),Jo._create("limitToLast",n,"L")}var Zo=class n extends Nn{constructor(t,e,r){super(),this.type=t,this._docOrFields=e,this._inclusive=r}static _create(t,e,r){return new n(t,e,r)}_apply(t){let e=yg(t,this.type,this._docOrFields,this._inclusive);return new Pt(t.firestore,t.converter,function(i,s){return new ie(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(t._query,e))}};function _0(...n){return Zo._create("startAt",n,!0)}function y0(...n){return Zo._create("startAfter",n,!1)}var ta=class n extends Nn{constructor(t,e,r){super(),this.type=t,this._docOrFields=e,this._inclusive=r}static _create(t,e,r){return new n(t,e,r)}_apply(t){let e=yg(t,this.type,this._docOrFields,this._inclusive);return new Pt(t.firestore,t.converter,function(i,s){return new ie(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(t._query,e))}};function w0(...n){return ta._create("endBefore",n,!1)}function v0(...n){return ta._create("endAt",n,!0)}function yg(n,t,e,r){if(e[0]=tt(e[0]),e[0]instanceof Vn)return function(s,o,u,c,h){if(!c)throw new N(S.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);let f=[];for(let p of dr(s))if(p.field.isKeyField())f.push(bn(o,c.key));else{let _=c.data.field(p.field);if(na(_))throw new N(S.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+p.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(_===null){let E=p.field.canonicalString();throw new N(S.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${E}' (used as the orderBy) does not exist.`)}f.push(_)}return new _e(f,h)}(n._query,n.firestore._databaseId,t,e[0]._document,r);{let i=Ln(n.firestore);return function(o,u,c,h,f,p){let _=o.explicitOrderBy;if(f.length>_.length)throw new N(S.INVALID_ARGUMENT,`Too many arguments provided to ${h}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let E=[];for(let x=0;x<f.length;x++){let D=f[x];if(_[x].field.isKeyField()){if(typeof D!="string")throw new N(S.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${h}(), but got a ${typeof D}`);if(!Vl(o)&&D.indexOf("/")!==-1)throw new N(S.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${h}() must be a plain document ID, but '${D}' contains a slash.`);let k=o.path.child(Y.fromString(D));if(!M.isDocumentKey(k))throw new N(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${h}() must result in a valid document path, but '${k}' is not because it contains an odd number of segments.`);let B=new M(k);E.push(bn(u,B))}else{let k=fg(c,h,D);E.push(k)}}return new _e(E,p)}(n._query,n.firestore._databaseId,i,t,e,r)}}function Dm(n,t,e){if(typeof(e=tt(e))=="string"){if(e==="")throw new N(S.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Vl(t)&&e.indexOf("/")!==-1)throw new N(S.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);let r=t.path.child(Y.fromString(e));if(!M.isDocumentKey(r))throw new N(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return bn(n,new M(r))}if(e instanceof _t)return bn(n,e._key);throw new N(S.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${aa(e)}.`)}function Vm(n,t){if(!Array.isArray(n)||n.length===0)throw new N(S.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function wg(n,t){let e=function(i,s){for(let o of i)for(let u of o.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(e!==null)throw e===t.op?new N(S.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new N(S.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}var ea=class{convertValue(t,e="none"){switch(Rn(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ut(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(He(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw U()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let r={};return On(t,(i,s)=>{r[i]=this.convertValue(s,e)}),r}convertVectorValue(t){var e,r,i;let s=(i=(r=(e=t.fields)===null||e===void 0?void 0:e.value.arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>ut(o.doubleValue));return new Xi(s)}convertGeoPoint(t){return new Hi(ut(t.latitude),ut(t.longitude))}convertArray(t,e){return(t.values||[]).map(r=>this.convertValue(r,e))}convertServerTimestamp(t,e){switch(e){case"previous":let r=kl(t);return r==null?null:this.convertValue(r,e);case"estimate":return this.convertTimestamp(Di(t));default:return null}}convertTimestamp(t){let e=Se(t);return new pt(e.seconds,e.nanos)}convertDocumentKey(t,e){let r=Y.fromString(t);q(Cp(r));let i=new _r(r.get(1),r.get(3)),s=new M(r.popFirst(5));return i.isEqual(e)||mt(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}};function la(n,t,e){let r;return r=n?e&&(e.merge||e.mergeFields)?n.toFirestore(t,e):n.toFirestore(t):t,r}var Rl=class extends ea{constructor(t){super(),this.firestore=t}convertBytes(t){return new Dr(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new _t(this.firestore,null,e)}};var be=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},rn=class extends Vn{constructor(t,e,r,i,s,o){super(t,e,r,i,o),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new mr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let r=this._document.data.field(ca("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,e.serverTimestamps)}}},mr=class extends rn{data(t={}){return super.data(t)}},sn=class{constructor(t,e,r,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new be(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(r=>{t.call(e,new mr(this._firestore,this._userDataWriter,r.key,r,new be(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new N(S.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(u=>{let c=new mr(i._firestore,i._userDataWriter,u.doc.key,u.doc,new be(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||u.type!==3).map(u=>{let c=new mr(i._firestore,i._userDataWriter,u.doc.key,u.doc,new be(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),h=-1,f=-1;return u.type!==0&&(h=o.indexOf(u.doc.key),o=o.delete(u.doc.key)),u.type!==1&&(o=o.add(u.doc),f=o.indexOf(u.doc.key)),{type:jT(u.type),doc:c,oldIndex:h,newIndex:f}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}};function jT(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return U()}}function T0(n,t){return n instanceof rn&&t instanceof rn?n._firestore===t._firestore&&n._key.isEqual(t._key)&&(n._document===null?t._document===null:n._document.isEqual(t._document))&&n._converter===t._converter:n instanceof sn&&t instanceof sn&&n._firestore===t._firestore&&BT(n.query,t.query)&&n.metadata.isEqual(t.metadata)&&n._snapshot.isEqual(t._snapshot)}function I0(n){n=Z(n,_t);let t=Z(n.firestore,ct);return ig(Ct(t),n._key).then(e=>sh(t,n,e))}var ke=class extends ea{constructor(t){super(),this.firestore=t}convertBytes(t){return new Dr(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new _t(this.firestore,null,e)}};function E0(n){n=Z(n,_t);let t=Z(n.firestore,ct),e=Ct(t),r=new ke(t);return DT(e,n._key).then(i=>new rn(t,r,n._key,i,new be(i!==null&&i.hasLocalMutations,!0),n.converter))}function A0(n){n=Z(n,_t);let t=Z(n.firestore,ct);return ig(Ct(t),n._key,{source:"server"}).then(e=>sh(t,n,e))}function R0(n){n=Z(n,Pt);let t=Z(n.firestore,ct),e=Ct(t),r=new ke(t);return _g(n._query),sg(e,n._query).then(i=>new sn(t,r,n,i))}function b0(n){n=Z(n,Pt);let t=Z(n.firestore,ct),e=Ct(t),r=new ke(t);return VT(e,n._query).then(i=>new sn(t,r,n,i))}function S0(n){n=Z(n,Pt);let t=Z(n.firestore,ct),e=Ct(t),r=new ke(t);return sg(e,n._query,{source:"server"}).then(i=>new sn(t,r,n,i))}function P0(n,t,e){n=Z(n,_t);let r=Z(n.firestore,ct),i=la(n.converter,t,e);return ha(r,[ua(Ln(r),"setDoc",n._key,i,n.converter!==null,e).toMutation(n._key,ft.none())])}function C0(n,t,e,...r){n=Z(n,_t);let i=Z(n.firestore,ct),s=Ln(i),o;return o=typeof(t=tt(t))=="string"||t instanceof nn?nh(s,"updateDoc",n._key,t,e,r):eh(s,"updateDoc",n._key,t),ha(i,[o.toMutation(n._key,ft.exists(!0))])}function x0(n){return ha(Z(n.firestore,ct),[new tn(n._key,ft.none())])}function k0(n,t){let e=Z(n.firestore,ct),r=UT(n),i=la(n.converter,t);return ha(e,[ua(Ln(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,ft.exists(!1))]).then(()=>r)}function D0(n,...t){var e,r,i;n=tt(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof t[o]!="object"||fl(t[o])||(s=t[o],o++);let u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(fl(t[o])){let p=t[o];t[o]=(e=p.next)===null||e===void 0?void 0:e.bind(p),t[o+1]=(r=p.error)===null||r===void 0?void 0:r.bind(p),t[o+2]=(i=p.complete)===null||i===void 0?void 0:i.bind(p)}let c,h,f;if(n instanceof _t)h=Z(n.firestore,ct),f=Nr(n._key.path),c={next:p=>{t[o]&&t[o](sh(h,n,p))},error:t[o+1],complete:t[o+2]};else{let p=Z(n,Pt);h=Z(p.firestore,ct),f=p._query;let _=new ke(h);c={next:E=>{t[o]&&t[o](new sn(h,_,p,E))},error:t[o+1],complete:t[o+2]},_g(n._query)}return function(_,E,x,D){let k=new xr(D),B=new Ki(E,k,x);return _.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return jl(yield kr(_),B)})),()=>{k.za(),_.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return Gl(yield kr(_),B)}))}}(Ct(h),f,u,c)}function V0(n,t){return NT(Ct(n=Z(n,ct)),fl(t)?t:{next:t})}function ha(n,t){return function(r,i){let s=new It;return r.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return fT(yield Zl(r),i,s)})),s.promise}(Ct(n),t)}function sh(n,t,e){let r=e.docs.get(t._key),i=new ke(n);return new rn(n,i,t._key,r,new be(e.hasPendingWrites,e.fromCache),t.converter)}var GT={maxAttempts:5};var Nm=class{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Ln(t)}set(t,e,r){this._verifyNotCommitted();let i=$e(t,this._firestore),s=la(i.converter,e,r),o=ua(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,ft.none())),this}update(t,e,r,...i){this._verifyNotCommitted();let s=$e(t,this._firestore),o;return o=typeof(e=tt(e))=="string"||e instanceof nn?nh(this._dataReader,"WriteBatch.update",s._key,e,r,i):eh(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,ft.exists(!0))),this}delete(t){this._verifyNotCommitted();let e=$e(t,this._firestore);return this._mutations=this._mutations.concat(new tn(e._key,ft.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new N(S.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function $e(n,t){if((n=tt(n)).firestore!==t)throw new N(S.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var bl=class extends class{constructor(e,r){this._firestore=e,this._transaction=r,this._dataReader=Ln(e)}get(e){let r=$e(e,this._firestore),i=new Rl(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||s.length!==1)return U();let o=s[0];if(o.isFoundDocument())return new Vn(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new Vn(this._firestore,i,r._key,null,r.converter);throw U()})}set(e,r,i){let s=$e(e,this._firestore),o=la(s.converter,r,i),u=ua(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,i);return this._transaction.set(s._key,u),this}update(e,r,i,...s){let o=$e(e,this._firestore),u;return u=typeof(r=tt(r))=="string"||r instanceof nn?nh(this._dataReader,"Transaction.update",o._key,r,i,s):eh(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,u),this}delete(e){let r=$e(e,this._firestore);return this._transaction.delete(r._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){let e=$e(t,this._firestore),r=new ke(this._firestore);return super.get(t).then(i=>new rn(this._firestore,r,e._key,i._document,new be(!1,!1),e.converter))}};function O0(n,t,e){n=Z(n,ct);let r=Object.assign(Object.assign({},GT),e);return function(s){if(s.maxAttempts<1)throw new N(S.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,u){let c=new It;return s.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){let h=yield CT(s);new cl(s.asyncQueue,h,u,o,c).ru()})),c.promise}(Ct(n),i=>t(new bl(n,i)),r)}function L0(){return new Yi("deleteField")}function M0(){return new _l("serverTimestamp")}function F0(...n){return new yl("arrayUnion",n)}function U0(...n){return new wl("arrayRemove",n)}function B0(n){return new vl("increment",n)}(function(t,e=!0){(function(i){Vr=i})(Ds),xs(new Kn("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),u=new ct(new Cu(r.getProvider("auth-internal")),new Vu(r.getProvider("app-check-internal")),function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new N(S.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new _r(h.options.projectId,f)}(o,i),o);return s=Object.assign({useFetchStreams:e},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),Ue(Df,"4.7.1",t),Ue(Df,"4.7.1","esm2017")})();export{Xa as a,OI as b,LI as c,WE as d,pe as e,QE as f,N as g,pt as h,At as i,M as j,XE as k,_r as l,MT as m,Z as n,FT as o,_t as p,ZE as q,t0 as r,UT as s,e0 as t,BT as u,n0 as v,r0 as w,Ct as x,i0 as y,s0 as z,o0 as A,a0 as B,u0 as C,c0 as D,l0 as E,h0 as F,Dr as G,nn as H,Hi as I,d0 as J,f0 as K,m0 as L,p0 as M,g0 as N,_0 as O,y0 as P,w0 as Q,v0 as R,ea as S,rn as T,mr as U,sn as V,T0 as W,I0 as X,E0 as Y,A0 as Z,R0 as _,b0 as $,S0 as aa,P0 as ba,C0 as ca,x0 as da,k0 as ea,D0 as fa,V0 as ga,ha,Nm as ia,O0 as ja,L0 as ka,M0 as la,F0 as ma,U0 as na,B0 as oa,li as pa,ZI as qa,tE as ra,jd as sa,aE as ta,Rf as ua,mu as va,uE as wa,Gw as xa,NE as ya};

import{a as Se,b as Le,c as nt,d as re,e as At,f as rt,g as ot,h as Dt,i as Ei,j as Pi,k as Rt}from"./chunk-MMZJ7P3Q.js";import{z as Et}from"./chunk-XCAZ4NYN.js";import{a as si,d as tt,e as ne,f as wi,h as it}from"./chunk-2RQPKCKX.js";import{a as Gt,b as X}from"./chunk-YJBF73UA.js";import{A as h,Ab as _e,Ac as di,Ba as pe,Bb as he,Bc as bi,Ca as ue,Cb as oi,Cc as fi,Da as V,Db as Mt,Dc as gi,Eb as We,Ec as _i,Fc as hi,Ga as P,Gc as Ti,Ha as Ct,Hb as ee,Hc as xi,I as ke,Ib as Oe,Ic as vi,J as xt,Ja as ti,Jb as Ne,Jc as Ci,K as l,Kb as te,Kc as Mi,L as C,Lb as Ue,Lc as Si,Mb as ze,Mc as yi,Nb as Ge,Nc as Bi,Ob as Qe,Oc as et,Pb as Ye,Pc as Ii,Q as b,Qb as Ze,Qc as Me,R as a,Rb as Ke,Rc as wt,Sb as St,Tb as li,Ub as Te,Vb as mi,W as m,Wb as ai,X as s,Xb as yt,Y as M,Z as O,_ as N,aa as w,ab as ii,ba as S,bb as c,c as E,ca as p,cb as J,da as Xt,ea as ae,f as le,fa as se,g as Q,ga as ce,gb as I,ha as U,hb as Ee,hc as Je,ia as d,ib as Ve,ic as ie,ja as vt,jc as ci,ka as y,kc as xe,l as v,m as _t,ma as ei,mc as ve,na as q,oa as j,p as me,pa as $,pb as Ae,q as ht,qb as de,rb as be,rc as pi,s as L,sb as ni,sc as Ce,ta as st,tb as ri,u as F,ub as fe,v as Tt,va as f,vb as He,vc as Bt,wa as g,wb as ge,xa as Z,xb as De,xc as ui,yb as Re,yc as Xe,z as _,zc as It}from"./chunk-KH6MZ2DN.js";import{g as Vi,i as B}from"./chunk-GV7GV3NK.js";var H=class extends Ee{annees;acquis;doublon;idBloc;bloc;carnet;user;getAnnees(){return this.annees}setAnnees(t){this.annees=t}getAcquis(){return this.acquis}setAcquis(t){this.acquis=t}getDoublon(){return this.doublon}setDoublon(t){this.doublon=t}getIdBloc(){return this.idBloc}setIdBloc(t){this.idBloc=t}getCarnet(){return this.carnet}setCarnet(t){this.carnet=t}getBloc(){return this.bloc}setBloc(t){this.bloc=t}getUser(){return this.user}setUser(t){this.user=t}};B([I("Ann\xE9e")],H.prototype,"annees",2),B([I("Acquis")],H.prototype,"acquis",2),B([I("Doublon")],H.prototype,"doublon",2),B([I("Ident bloc")],H.prototype,"idBloc",2),B([I("Bloc")],H.prototype,"bloc",2),B([I("Carnet")],H.prototype,"carnet",2),B([I("User")],H.prototype,"user",2);var Y=class extends Ee{idUser;idTimbre;acquis;doublon;constructor(t,e,i,r){super(),this.idUser=t||null,this.idTimbre=e||null,this.acquis=i||!1,this.doublon=r||!1}getIdUser(){return this.idUser}setIdUser(t){this.idUser=t}getIdTimbre(){return this.idTimbre}setIdTimbre(t){this.idTimbre=t}isAcquis(){return this.acquis}setAcquis(t){this.acquis=t}isDoublon(){return this.doublon}setDoublon(t){this.doublon=t}};B([I("Identifiant Utilisateur")],Y.prototype,"idUser",2),B([I("Identifiant timbre")],Y.prototype,"idTimbre",2),B([I("Acquis")],Y.prototype,"acquis",2),B([I("Doublon")],Y.prototype,"doublon",2);var W=class n{constructor(t){this.firestore=t}reinitResume$=new E(!0);timbreCritereModel=new H;timbreCritereBlocModel=new H;getAnneesAsync(t){return this.firestore.collection(t,e=>{let i=e;return i=i.orderBy("annee","desc"),i}).valueChanges().pipe(le(e=>{let i=e.map(r=>Number(r.annee)).filter(r=>c(r)&&r!=0);return Array.from(new Set(i))}))}getTimbresByCritereAsync(t){return this.getAllTimbres(t).pipe(le(e=>this.constructTimbres(e,null,null)))}getAllTimbres(t){return this.firestore.collection("/timbres",e=>{let i=e;return c(t)&&(c(t.getAnnees())&&t.getAnnees()?.length>0&&(i=i.where("annee","in",t.getAnnees())),c(t.getBloc())&&t.getBloc()!="TOUS"?i=i.where("idBloc",t.getBloc()!="OUI"?"==":"!=",null):c(t.getIdBloc())&&(i=i.where("idBloc","==",t.getIdBloc()))),i=i.orderBy("id","asc"),i}).valueChanges()}constructTimbres(t,e,i,r){let o=[];return t?.length>0&&t.forEach(u=>{let T=this.constructTimbre(u,e,i),x=!0;c(r)&&c(T.getTimbreAcquisModel())&&(c(r.getAcquis())&&!(r.getAcquis()=="TOUS"||r.getAcquis()=="OUI"&&T.getTimbreAcquisModel().isAcquis()||r.getAcquis()=="NON"&&!T.getTimbreAcquisModel().isAcquis())&&(x=!1),c(r.getDoublon())&&!(r.getDoublon()=="TOUS"||r.getDoublon()=="OUI"&&T.getTimbreAcquisModel().isDoublon()||r.getDoublon()=="NON"&&!T.getTimbreAcquisModel().isDoublon())&&(x=!1)),x==!0&&o.push(T)}),o}constructTimbre(t,e,i){let r=Ve(Se,t);if(c(i)){let o=i.find(u=>u.getId()==r?.getIdBloc());c(o)&&r.setTimbreBlocModel(o)}if(c(e)){let o=e.find(u=>u.idTimbre==r.getId());c(o)?r.setTimbreAcquisModel(Ve(Y,o)):r.setTimbreAcquisModel(new Y)}return r}supprimerTimbreAcquis(t){this.firestore.collection("/timbres_acquis").ref.where("idTimbre","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.delete()})})}supprimerTimbre(t){this.firestore.collection("/timbres").ref.where("id","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.delete()})}).catch(e=>{console.error("Erreur de suppression :",e)})}static \u0275fac=function(e){return new(e||n)(L(Ae))};static \u0275prov=me({token:n,factory:n.\u0275fac})};var oe=class extends Ee{idUser;idBloc;acquis;doublon;constructor(t,e,i,r){super(),this.idUser=t||null,this.idBloc=e||null,this.acquis=i||!1,this.doublon=r||!1}getIdUser(){return this.idUser}setIdUser(t){this.idUser=t}getIdBloc(){return this.idBloc}setIdBloc(t){this.idBloc=t}isAcquis(){return this.acquis}setAcquis(t){this.acquis=t}isDoublon(){return this.doublon}setDoublon(t){this.doublon=t}};B([I("Identifiant Utilisateur")],oe.prototype,"idUser",2),B([I("Identifiant bloc")],oe.prototype,"idBloc",2),B([I("Acquis")],oe.prototype,"acquis",2),B([I("Doublon")],oe.prototype,"doublon",2);var K=class n{constructor(t,e,i,r,o){this.firestore=t;this.authService=e;this.uploadService=i;this.utilsService=r;this.timbreUtilsService=o}heigthTable=50;widthTimbre=100;heightTimbre=100;widthTimbreZoom=500;heightTimbreZoom=500;total$=new E(0);totalCarnet$=new E(0);timbresBlocModel$=new E(null);upload(t,e,i){let r=this.widthTimbre,o=this.heightTimbre;return e=="table"?(r=r*(this.heigthTable/o),o=this.heigthTable):e=="zoom"&&(r=r*(this.heightTimbreZoom/o),o=this.heightTimbreZoom),this.uploadService.processAndUploadImage(t?.getImage(),r,o,"bloc-"+t.getId(),this.getDossier(t,e,i))}getTotal(t){this.total$.next(null),this.totalCarnet$.next(null),this.getAllBlocs(t).pipe(v(e=>c(e)&&e?.length>0)).subscribe(e=>{this.total$.next(e?.filter(i=>!i.carnet)?.length),this.totalCarnet$.next(e?.filter(i=>i.carnet)?.length)})}getBloc(t){return this.firestore.collection("/timbres_bloc",e=>e.where("id","==",t)).valueChanges()}getBlocByIdAsync(t){return this.getBloc(t).pipe(le(e=>Ve(Le,e[0])))}getAllBlocs(t){return this.firestore.collection("/timbres_bloc",e=>{let i=e;return c(t)&&(c(t.getAnnees())&&t.getAnnees()?.length>0&&(i=i.where("annee","in",t.getAnnees())),c(t.getCarnet())&&t.getCarnet()!="TOUS"&&(i=i.where("carnet",t.getCarnet()!="OUI"?"==":"!=",null))),i=i.orderBy("id","asc"),i}).valueChanges()}getTimbreBlocAcquis(){return this.authService.userSelect$.pipe(v(t=>c(t)),_t(t=>c(t)?this.getTimbreBlocAcquisByUser(t.getId()).pipe(v(),le(e=>e)):null))}getTimbreBlocAcquisByUser(t){return this.firestore.collection("/timbres_bloc_acquis",e=>e.where("idUser","==",t)).valueChanges()}getBlocs(t){this.timbresBlocModel$.next(null),Q([this.getAllBlocs(t),this.getTimbreBlocAcquis()]).pipe(v()).subscribe(([e,i])=>{this.constructBlocs(e,i,t),this.getTotal()})}getBlocsAsync(t){return this.timbresBlocModel$.next(null),this.getAllBlocs(t).pipe(v(),le(e=>this.constructBlocs(e,null,t)))}constructBloc(t,e){let i=Ve(Le,t);if(c(e)){let r=e.find(o=>o.idBloc==i.getId());c(r)?i.setTimbreBlocAcquisModel(Ve(oe,r)):i.setTimbreBlocAcquisModel(new oe)}return i}constructBlocs(t,e,i){let r=[];return t?.length>0&&t.forEach(o=>{let u=this.constructBloc(o,e);this.getTimbresByBlocAsync(u.getId()).subscribe(x=>{u.setNbTimbres(x?.length)});let T=!0;c(i)&&c(u.getTimbreBlocAcquisModel())&&(c(i.getAcquis())&&!(i.getAcquis()=="TOUS"||i.getAcquis()=="OUI"&&u.getTimbreBlocAcquisModel().isAcquis()||i.getAcquis()=="NON"&&!u.getTimbreBlocAcquisModel().isAcquis())&&(T=!1),c(i.getDoublon())&&!(i.getDoublon()=="TOUS"||i.getDoublon()=="OUI"&&u.getTimbreBlocAcquisModel().isDoublon()||i.getDoublon()=="NON"&&!u.getTimbreBlocAcquisModel().isDoublon())&&(T=!1)),T==!0&&r.push(u)}),this.timbresBlocModel$.next(r),r}acquis(t,e){return this.authService.userSelect$.pipe(v(i=>c(i))).subscribe(i=>{c(t?.getTimbreBlocAcquisModel()?.getIdUser())?this.firestore.collection("/timbres_bloc_acquis").ref.where("idBloc","==",t.getId()).where("idUser","==",i.getId()).get().then(r=>{r.forEach(o=>{let u=t.getTimbreBlocAcquisModel();e?(u.setAcquis(!0),u.setDoublon(!u.isDoublon())):(u.setAcquis(!u.isAcquis()),u.isAcquis()||u.setDoublon(!1)),o.ref.update(Object.assign(new Object,u))})}).catch(r=>{console.error("Erreur de mise \xE0 jour:",r)}):this.addAcquis(i?.getId(),t,e),this.timbreUtilsService.reinitResume$.next(!0)})}addAcquis(t,e,i){let r=new oe;r.setIdUser(t),r.setIdBloc(e.getId()),r.setAcquis(!0),r.setDoublon(i),e.setTimbreBlocAcquisModel(r),this.firestore.collection("/timbres_bloc_acquis").add(Object.assign(new Object,r))}ajouterSansId(t){this.utilsService.getMaxIdentAsync("/timbres_bloc").pipe(v()).subscribe(e=>{t.setId(e),this.ajouter(t,!0)})}ajouter(t,e){this.getBloc(t.getId()).pipe(v()).subscribe(i=>{J(i)||J(i[0])||c(i[0])&&i[0]?.length==0?(t.setTimbreBlocAcquisModel(null),this.firestore.collection("/timbres_bloc").add(Object.assign(new Object,t)),e&&this.getBlocs(),this.timbreUtilsService.reinitResume$.next(!0)):console.error("bloc "+t.getId()+" d\xE9j\xE0 existant")})}modifier(t){this.firestore.collection("/timbres_bloc").ref.where("id","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.update(Object.assign(new Object,t)),this.getBlocs()})}).catch(e=>{console.error("Erreur de mise \xE0 jour:",e)})}getTimbresByBlocAsync(t){let e=new H;return e.setIdBloc(t),this.timbreUtilsService.getTimbresByCritereAsync(e)}supprimer(t){this.getTimbresByBlocAsync(t.getId()).pipe(v()).subscribe(e=>{e.forEach(i=>{this.timbreUtilsService.supprimerTimbreAcquis(i),this.timbreUtilsService.supprimerTimbre(i)})}),this.firestore.collection("/timbres_bloc_acquis").ref.where("idBloc","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.delete()})}),this.firestore.collection("/timbres_bloc").ref.where("id","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.delete(),this.getBlocs()})}).catch(e=>{console.error("Erreur de suppression :",e)}),this.timbreUtilsService.reinitResume$.next(!0)}getDossier(t,e,i){let r="timbre//"+t.getAnnee();return c(e)&&(r=r+"/"+e),r=r+"/bloc/"+(c(i)?i:t.getId()),r}getBouchon(){let t=new Le;return t.setAnnee(new Date().getFullYear()),t.setMonnaie("E"),t}static \u0275fac=function(e){return new(e||n)(L(Ae),L(X),L(nt),L(re),L(W))};static \u0275prov=me({token:n,factory:n.\u0275fac})};var Nt=(e=>(e.TABLE="table",e.GRAPH="graph",e))(Nt||{});var z=class n{constructor(t,e,i,r,o,u){this.firestore=t;this.authService=e;this.timbreBlocService=i;this.uploadService=r;this.utilsService=o;this.timbreUtilsService=u}heigthTable=50;widthTimbre=100;heightTimbre=100;widthTimbreZoom=500;heightTimbreZoom=500;total$=new E(0);timbres$=new E(null);load$=new E(!1);mode="graph";getTimbre(t){return this.firestore.collection("/timbres",e=>e.where("id","==",t)).valueChanges()}getTimbreByIdAsync(t){return Q([this.getTimbre(t),this.timbreBlocService.getBlocsAsync()]).pipe(le(([e,i])=>this.timbreUtilsService.constructTimbre(e[0],null,i)))}getTotal(t){this.total$.next(null),this.timbreUtilsService.getAllTimbres(t).pipe(v()).subscribe(e=>{this.total$.next(e?.length)})}getTimbres(t){this.timbres$.next(null),this.load$.next(!1),Q([this.timbreUtilsService.getAllTimbres(t),this.getTimbreAcquis(),this.timbreBlocService.getBlocsAsync(t)]).pipe(v()).subscribe(([e,i,r])=>{this.timbres$.next(this.timbreUtilsService.constructTimbres(e,i,r,t)),this.getTotal(),this.load$.next(!0)})}getTimbreAcquis(){return this.authService.userSelect$.pipe(v(t=>c(t)),_t(t=>c(t)?this.getTimbreAcquisByUser(t.getId()).pipe(v(),le(e=>e)):null))}getTimbreAcquisByUser(t){return this.firestore.collection("/timbres_acquis",e=>e.where("idUser","==",t)).valueChanges()}acquis(t,e){return this.authService.userSelect$.pipe(v(i=>c(i))).subscribe(i=>{c(t?.getTimbreAcquisModel()?.getIdUser())?this.firestore.collection("/timbres_acquis").ref.where("idTimbre","==",t.getId()).where("idUser","==",i.getId()).get().then(r=>{r.forEach(o=>{let u=t.getTimbreAcquisModel();e?(u.setAcquis(!0),u.setDoublon(!u.isDoublon())):(u.setAcquis(!u.isAcquis()),u.isAcquis()||u.setDoublon(!1)),o.ref.update(Object.assign(new Object,u))})}).catch(r=>{console.error("Erreur de mise \xE0 jour:",r)}):this.addAcquis(i?.getId(),t,e),this.timbreUtilsService.reinitResume$.next(!0)})}addAcquis(t,e,i){let r=new Y;r.setIdUser(t),r.setIdTimbre(e.getId()),r.setAcquis(!0),r.setDoublon(i),e.setTimbreAcquisModel(r),this.firestore.collection("/timbres_acquis").add(Object.assign(new Object,r))}ajouterSansId(t){this.utilsService.getMaxIdentAsync("/timbres").pipe(v()).subscribe(e=>{t.setId(e),c(t.getIdBloc())&&t.setMonnaie(null),this.ajouter(t,!0)})}ajouter(t,e){this.getTimbre(t.getId()).pipe(v()).subscribe(i=>{J(i)||J(i[0])||c(i[0])&&i[0]?.length==0?(t.setTimbreAcquisModel(null),t.setTimbreBlocModel(null),this.firestore.collection("/timbres").add(Object.assign(new Object,t)),e&&this.getTimbres(),this.timbreUtilsService.reinitResume$.next(!0)):console.error("timbre "+t.getId()+" d\xE9j\xE0 existant")})}modifier(t){t.setTimbreBlocModel(null),t.setTimbreAcquisModel(null),this.firestore.collection("/timbres").ref.where("id","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.update(Object.assign(new Object,t)),this.getTimbres()})}).catch(e=>{console.error("Erreur de mise \xE0 jour:",e)})}supprimerTimbre(t){this.firestore.collection("/timbres").ref.where("id","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.delete(),this.getTimbres()})}).catch(e=>{console.error("Erreur de suppression :",e)})}supprimer(t){this.timbreUtilsService.supprimerTimbreAcquis(t),this.supprimerTimbre(t),this.timbreUtilsService.reinitResume$.next(!0)}getBouchon(){let t=new Se;return t.setAnnee(new Date().getFullYear()),t.setMonnaie("E"),t.setType(""),t.setYt(""),t}upload(t,e,i){let r=this.widthTimbre,o=this.heightTimbre;return e=="table"?(r=r*(this.heigthTable/o),o=this.heigthTable):e=="zoom"&&(r=r*(this.heightTimbreZoom/o),o=this.heightTimbreZoom),this.uploadService.processAndUploadImage(t?.getImage(),r,o,c(i)?i:t?.getId(),this.getDossier(t,e))}getDossier(t,e){let i="timbre//";return c(t.getIdBloc())?i=i+t.getTimbreBlocModel().getAnnee():i=i+t.getAnnee(),c(e)&&(i=i+"/"+e),c(t.getIdBloc())&&(i=i+"/bloc/"+t.getIdBloc()),i}static \u0275fac=function(e){return new(e||n)(L(Ae),L(X),L(K),L(nt),L(re),L(W))};static \u0275prov=me({token:n,factory:n.\u0275fac})};var R=class extends Ee{annee;total;nombre;acquis;doublon;nombreCarnet;nombreTimbresCarnet;acquisTimbresCarnet;doublonTimbresCarnet;nombreBloc;acquisBloc;doublonBloc;nombreTimbresBloc;acquisTimbresBloc;doublonTimbresBloc;constructor(t,e,i,r,o,u,T,x,A,k,D,we,gt,Kt,Jt){super(),this.annee=t||null,this.total=e||0,this.nombre=i||0,this.acquis=r||0,this.doublon=o||0,this.nombreCarnet=u||0,this.nombreTimbresCarnet=T||0,this.acquisTimbresCarnet=x||0,this.doublonTimbresCarnet=A||0,this.nombreBloc=k||0,this.acquisBloc=D||0,this.doublonBloc=we||0,this.nombreTimbresBloc=gt||0,this.acquisTimbresBloc=Kt||0,this.doublonTimbresBloc=Jt||0}getAnnee(){return this.annee}setAnnee(t){this.annee=t}getTotal(){return this.total}setTotal(t){this.total=t}getNombre(){return this.nombre}setNombre(t){this.nombre=t}getAcquis(){return this.acquis}setAcquis(t){this.acquis=t}getDoublon(){return this.doublon}setDoublon(t){this.doublon=t}getNombreCarnet(){return this.nombreCarnet}setNombreCarnet(t){this.nombreCarnet=t}getNombreTimbresCarnet(){return this.nombreTimbresCarnet}setNombreTimbresCarnet(t){this.nombreTimbresCarnet=t}getAcquisTimbresCarnet(){return this.acquisTimbresCarnet}setAcquisTimbresCarnet(t){this.acquisTimbresCarnet=t}getDoublonTimbresCarnet(){return this.doublonTimbresCarnet}setDoublonTimbresCarnet(t){this.doublonTimbresCarnet=t}getNombreBloc(){return this.nombreBloc}setNombreBloc(t){this.nombreBloc=t}getAcquisBloc(){return this.acquisBloc}setAcquisBloc(t){this.acquisBloc=t}getDoublonBloc(){return this.doublonBloc}setDoublonBloc(t){this.doublonBloc=t}getNombreTimbresBloc(){return this.nombreTimbresBloc}setNombreTimbresBloc(t){this.nombreTimbresBloc=t}getAcquisTimbresBloc(){return this.acquisTimbresBloc}setAcquisTimbresBloc(t){this.acquisTimbresBloc=t}getDoublonTimbresBloc(){return this.doublonTimbresBloc}setDoublonTimbresBloc(t){this.doublonTimbresBloc=t}};B([I("Ann\xE9e")],R.prototype,"annee",2),B([I("Total")],R.prototype,"total",2),B([I("Nombre timbres")],R.prototype,"nombre",2),B([I("Total de timbres acquis")],R.prototype,"acquis",2),B([I("Total de timbres en doublon")],R.prototype,"doublon",2),B([I("Carnet")],R.prototype,"nombreCarnet",2),B([I("Timbres carnet")],R.prototype,"nombreTimbresCarnet",2),B([I("Total timbres carnet acquis")],R.prototype,"acquisTimbresCarnet",2),B([I("Total timbres carnet en doublon")],R.prototype,"doublonTimbresCarnet",2),B([I("Bloc")],R.prototype,"nombreBloc",2),B([I("Total bloc acquis")],R.prototype,"acquisBloc",2),B([I("Total bloc en doublon")],R.prototype,"doublonBloc",2),B([I("Timbres bloc")],R.prototype,"nombreTimbresBloc",2),B([I("Total timbres bloc acquis")],R.prototype,"acquisTimbresBloc",2),B([I("Total timbres bloc en doublon")],R.prototype,"doublonTimbresBloc",2);var Ut=class n{constructor(t,e,i){this.timbreService=t;this.timbreBlocService=e;this.timbreUtilsService=i}load$=new E(!1);timbresResume$=new E(null);totalTimbreResume$=new E(null);getResume(t){this.load$.next(!1),this.timbresResume$.next(null),this.totalTimbreResume$.next(null),Q([this.timbreUtilsService.getAllTimbres(t),this.timbreService.getTimbreAcquis(),this.timbreBlocService.getAllBlocs(t),this.timbreBlocService.getTimbreBlocAcquis()]).pipe(v()).subscribe(([e,i,r,o])=>{this.timbresResume$.next(this.construct(e,i,r,o)),this.timbreUtilsService.reinitResume$.next(!1)})}construct(t,e,i,r){let o=[];if(t?.length>0&&(t.forEach(u=>{let T=u.annee;if(c(i)&&J(u.annee)&&c(u.idBloc)){let k=i.find(D=>D.id==u.idBloc);c(k)&&(T=k.annee)}let x=o.find(k=>k.getAnnee()==T);J(x)&&(x=new R,x.setAnnee(T),o.push(x)),x.setTotal(x.getTotal()+1);let A=c(u.idBloc)?i.find(k=>k.id==u.idBloc):null;if(c(u.idBloc)?c(A)&&A.carnet?x.setNombreTimbresCarnet(x.getNombreTimbresCarnet()+1):x.setNombreTimbresBloc(x.getNombreTimbresBloc()+1):x.setNombre(x.getNombre()+1),c(e)){let k=e.find(D=>D.idTimbre==u.id);c(k)&&(k.acquis==!0&&(c(u.idBloc)?c(A)&&A.carnet?x.setAcquisTimbresCarnet(x.getAcquisTimbresCarnet()+1):x.setAcquisTimbresBloc(x.getAcquisTimbresBloc()+1):x.setAcquis(x.getAcquis()+1)),k.doublon==!0&&(c(u.idBloc)?c(A)&&A.carnet?x.setDoublonTimbresCarnet(x.getDoublonTimbresCarnet()+1):x.setDoublonTimbresBloc(x.getDoublonTimbresBloc()+1):x.setDoublon(x.getDoublon()+1)))}}),i.forEach(u=>{let T=o.find(x=>x.getAnnee()==u.annee);if(J(T)&&(T=new R,T.setAnnee(u.annee),o.push(T)),u.carnet?T.setNombreCarnet(T.getNombreCarnet()+1):T.setNombreBloc(T.getNombreBloc()+1),c(r)){let x=r.find(A=>A.idBloc==u.id);c(x)&&(x.acquis==!0&&(u.carnet||T.setAcquisBloc(T.getAcquisBloc()+1)),x.doublon==!0&&(u.carnet||T.setDoublonBloc(T.getDoublonBloc()+1)))}})),c(o)&&o?.length>0){let u=new R;o.forEach(T=>{u.setTotal(u.getTotal()+T.getTotal()),u.setNombre(u.getNombre()+T.getNombre()),u.setAcquis(u.getAcquis()+T.getAcquis()),u.setDoublon(u.getDoublon()+T.getDoublon()),u.setNombreCarnet(u.getNombreCarnet()+T.getNombreCarnet()),u.setNombreTimbresCarnet(u.getNombreTimbresCarnet()+T.getNombreTimbresCarnet()),u.setAcquisTimbresCarnet(u.getAcquisTimbresCarnet()+T.getAcquisTimbresCarnet()),u.setDoublonTimbresCarnet(u.getDoublonTimbresCarnet()+T.getDoublonTimbresCarnet()),u.setNombreBloc(u.getNombreBloc()+T.getNombreBloc()),u.setAcquisBloc(u.getAcquisBloc()+T.getAcquisBloc()),u.setDoublonBloc(u.getDoublonBloc()+T.getDoublonBloc()),u.setNombreTimbresBloc(u.getNombreTimbresBloc()+T.getNombreTimbresBloc()),u.setAcquisTimbresBloc(u.getAcquisTimbresBloc()+T.getAcquisTimbresBloc()),u.setDoublonTimbresBloc(u.getDoublonTimbresBloc()+T.getDoublonTimbresBloc())}),this.totalTimbreResume$.next(u)}return this.load$.next(!0),o}static \u0275fac=function(e){return new(e||n)(L(z),L(K),L(W))};static \u0275prov=me({token:n,factory:n.\u0275fac})};var qe=class n{constructor(t){this.firestore=t}loadGlob$=new E(!0);load$=new E(!0);supprimer(t,e){return this.load$.next(!1),this.firestore.collection(t).valueChanges().pipe(v()).subscribe(i=>{c(i)&&i?.length>0?i.forEach((r,o)=>{this.firestore.collection(t).ref.where(e,"==",r[e]).get().then(u=>{u.forEach(T=>{T.ref.delete(),o==i.length-1&&this.load$.next(!0)})}).catch(u=>{console.error("Erreur de suppression :",u)})}):this.load$.next(!0)})}supprimerTimbres(t){this.load$.next(!1),this.firestore.collection("/timbres",e=>{let i=e;return i=i.where("annee","==",t),i}).valueChanges().pipe(v()).subscribe(e=>{c(e)&&e?.length>0?e.forEach((i,r)=>{this.firestore.collection("/timbres").ref.where("id","==",i.id).get().then(o=>{o.forEach(u=>{this.supprimerAcquis(i.id),u.ref.delete(),r==e.length-1&&this.load$.next(!0)})}).catch(o=>{console.error("Erreur de suppression :",o)})}):this.load$.next(!0)})}supprimerAcquis(t){this.load$.next(!1),this.firestore.collection("/timbres_acquis",e=>{let i=e;return i=i.where("idTimbre","==",t),i}).valueChanges().pipe(v()).subscribe(e=>{c(e)&&e?.length>0?e.forEach((i,r)=>{this.firestore.collection("/timbres_acquis").ref.where("idTimbre","==",i.idTimbre).get().then(o=>{o.forEach(u=>{u.ref.delete(),r==e.length-1&&this.load$.next(!0)})}).catch(o=>{console.error("Erreur de suppression :",o)})}):this.load$.next(!0)})}supprimerBlocs(t){this.load$.next(!1),this.firestore.collection("/timbres_bloc",e=>{let i=e;return i=i.where("annee","==",t),i}).valueChanges().pipe(v()).subscribe(e=>{c(e)&&e?.length>0?e.forEach((i,r)=>{this.firestore.collection("/timbres_bloc").ref.where("id","==",i.id).get().then(o=>{o.forEach(u=>{this.supprimerBlocsAcquis(i.id),u.ref.delete(),r==e.length-1&&this.load$.next(!0)})}).catch(o=>{console.error("Erreur de suppression :",o)})}):this.load$.next(!0)})}supprimerBlocsAcquis(t){this.load$.next(!1),this.firestore.collection("/timbres_bloc_acquis",e=>{let i=e;return i=i.where("idBloc","==",t),i}).valueChanges().pipe(v()).subscribe(e=>{c(e)&&e?.length>0?e.forEach((i,r)=>{this.firestore.collection("/timbres_bloc_acquis").ref.where("id","==",i.id).get().then(o=>{o.forEach(u=>{u.ref.delete(),r==e.length-1&&this.load$.next(!0)})}).catch(o=>{console.error("Erreur de suppression :",o)})}):this.load$.next(!0)})}static \u0275fac=function(e){return new(e||n)(L(Ae))};static \u0275prov=me({token:n,factory:n.\u0275fac})};var Lt=class n{static \u0275fac=function(e){return new(e||n)};static \u0275mod=Tt({type:n});static \u0275inj=ht({providers:[qe,ti()],imports:[Ii,Ct,oi,Mt,St,wi,wt,yt]})};var Ri=class n{static \u0275fac=function(e){return new(e||n)};static \u0275mod=Tt({type:n});static \u0275inj=ht({providers:[z],imports:[Ct,Mt,St,mi,ai,yt,li,pi,ci,wt,ie,Lt,Te,Ce,It]})};var Ni=n=>({accent50:n});function Hi(n,t){n&1&&M(0,"lib-spinner",2),n&2&&a("textSpec","Chargement en cours ...")}function Wi(n,t){if(n&1&&(m(0,"th",28),M(1,"lib-libelle-model",29),s()),n&2){let e=p(2);l(),a("object",e.timbreResumeModel)("key","annee")}}function zi(n,t){if(n&1&&(m(0,"td",30),d(1),s()),n&2){let e=t.$implicit;l(),y(" ",e==null?null:e.getAnnee()," ")}}function Gi(n,t){n&1&&M(0,"td",31)}function Qi(n,t){if(n&1&&(m(0,"th",28),M(1,"lib-libelle-model",29),s()),n&2){let e=p(2);l(),a("object",e.timbreResumeModel)("key","total")}}function Yi(n,t){if(n&1&&(m(0,"td",30),d(1),s()),n&2){let e=t.$implicit;l(),y(" ",e==null?null:e.getTotal()," ")}}function Zi(n,t){if(n&1&&(m(0,"td",31)(1,"b"),d(2),f(3,"async"),s()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getTotal()," ")}}function Ki(n,t){if(n&1&&(m(0,"th",32),M(1,"lib-libelle-model",29),s()),n&2){let e=p(2);l(),a("object",e.timbreResumeModel)("key","nombre")}}function Ji(n,t){if(n&1&&(m(0,"td",33),d(1),s()),n&2){let e=t.$implicit;l(),y(" ",e==null?null:e.getNombre()," ")}}function Xi(n,t){if(n&1&&(m(0,"td",31)(1,"b"),d(2),f(3,"async"),s()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getNombre()," ")}}function en(n,t){if(n&1&&(m(0,"th",32),M(1,"lib-icon",34),s()),n&2){let e=p(2);l(),a("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK)("info",e.timbreResumeModel.getPropertyLibelle("acquis"))}}function tn(n,t){if(n&1&&(m(0,"td",35),d(1),s()),n&2){let e=t.$implicit;a("ngClass",st(2,Ni,(e==null?null:e.getNombre())==(e==null?null:e.getAcquis()))),l(),y(" ",e==null?null:e.getAcquis()," ")}}function nn(n,t){if(n&1&&(m(0,"td",31)(1,"b"),d(2),f(3,"async"),s()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getAcquis()," ")}}function rn(n,t){if(n&1&&(m(0,"th",32),M(1,"lib-icon",34),s()),n&2){let e=p(2);l(),a("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK_DOUBLE)("info",e.timbreResumeModel.getPropertyLibelle("doublon"))}}function on(n,t){if(n&1&&(m(0,"td",35),d(1),s()),n&2){let e=t.$implicit;a("ngClass",st(2,Ni,(e==null?null:e.getNombre())==(e==null?null:e.getDoublon()))),l(),y(" ",e==null?null:e.getDoublon()," ")}}function ln(n,t){if(n&1&&(m(0,"td",31)(1,"b"),d(2),f(3,"async"),s()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getDoublon()," ")}}function mn(n,t){if(n&1&&(m(0,"th",32),M(1,"lib-libelle-model",29),s()),n&2){let e=p(2);l(),a("object",e.timbreResumeModel)("key","nombreCarnet")}}function an(n,t){if(n&1&&(m(0,"td",35),d(1),s()),n&2){let e=t.$implicit;a("ngClass",(e==null?null:e.getNombreCarnet())==0?"gray25":"primary25"),l(),y(" ",(e==null?null:e.getNombreCarnet())>0?e==null?null:e.getNombreCarnet():""," ")}}function sn(n,t){if(n&1&&(m(0,"td",31)(1,"b"),d(2),f(3,"async"),s()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getNombreCarnet()," ")}}function cn(n,t){if(n&1&&(m(0,"th",32),M(1,"lib-libelle-model",29),s()),n&2){let e=p(2);l(),a("object",e.timbreResumeModel)("key","nombreTimbresCarnet")}}function pn(n,t){if(n&1&&(m(0,"td",35),d(1),s()),n&2){let e=t.$implicit;a("ngClass",(e==null?null:e.getNombreCarnet())==0?"gray25":"primary25"),l(),y(" ",(e==null?null:e.getNombreCarnet())>0?e==null?null:e.getNombreTimbresCarnet():""," ")}}function un(n,t){if(n&1&&(m(0,"td",31)(1,"b"),d(2),f(3,"async"),s()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getNombreTimbresCarnet()," ")}}function dn(n,t){if(n&1&&(m(0,"th",32),M(1,"lib-icon",34),s()),n&2){let e=p(2);l(),a("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK)("info",e.timbreResumeModel.getPropertyLibelle("acquisTimbresCarnet"))}}function bn(n,t){if(n&1&&(m(0,"td",35),d(1),s()),n&2){let e=t.$implicit;a("ngClass",(e==null?null:e.getNombreTimbresCarnet())==0?"gray25":(e==null?null:e.getNombreTimbresCarnet())==(e==null?null:e.getAcquisTimbresCarnet())?"accent50":"primary25"),l(),y(" ",(e==null?null:e.getNombreCarnet())>0?e==null?null:e.getAcquisTimbresCarnet():""," ")}}function fn(n,t){if(n&1&&(m(0,"td",31)(1,"b"),d(2),f(3,"async"),s()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getAcquisTimbresCarnet()," ")}}function gn(n,t){if(n&1&&(m(0,"th",32),M(1,"lib-icon",34),s()),n&2){let e=p(2);l(),a("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK_DOUBLE)("info",e.timbreResumeModel.getPropertyLibelle("doublonTimbresCarnet"))}}function _n(n,t){if(n&1&&(m(0,"td",35),d(1),s()),n&2){let e=t.$implicit;a("ngClass",(e==null?null:e.getNombreTimbresCarnet())==0?"gray25":(e==null?null:e.getNombreTimbresCarnet())==(e==null?null:e.getDoublonTimbresCarnet())?"accent50":"primary25"),l(),y(" ",(e==null?null:e.getNombreCarnet())>0?e==null?null:e.getDoublonTimbresCarnet():""," ")}}function hn(n,t){if(n&1&&(m(0,"td",31)(1,"b"),d(2),f(3,"async"),s()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getDoublonTimbresCarnet()," ")}}function Tn(n,t){if(n&1&&(m(0,"th",32),M(1,"lib-libelle-model",29),s()),n&2){let e=p(2);l(),a("object",e.timbreResumeModel)("key","nombreBloc")}}function xn(n,t){if(n&1&&(m(0,"td",35),d(1),s()),n&2){let e=t.$implicit;a("ngClass",(e==null?null:e.getNombreBloc())==0?"gray25":""),l(),y(" ",(e==null?null:e.getNombreBloc())>0?e==null?null:e.getNombreBloc():""," ")}}function vn(n,t){if(n&1&&(m(0,"td",31)(1,"b"),d(2),f(3,"async"),s()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getNombreBloc()," ")}}function Cn(n,t){if(n&1&&(m(0,"th",32),M(1,"lib-icon",34),s()),n&2){let e=p(2);l(),a("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK)("info",e.timbreResumeModel.getPropertyLibelle("acquisBloc"))}}function Mn(n,t){if(n&1&&(m(0,"td",35),d(1),s()),n&2){let e=t.$implicit;a("ngClass",(e==null?null:e.getNombreBloc())==0?"gray25":e.getNombreBloc()==(e==null?null:e.getAcquisBloc())?"accent50":""),l(),y(" ",(e==null?null:e.getNombreBloc())>0?e==null?null:e.getAcquisBloc():""," ")}}function Sn(n,t){if(n&1&&(m(0,"td",31)(1,"b"),d(2),f(3,"async"),s()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getAcquisBloc()," ")}}function yn(n,t){if(n&1&&(m(0,"th",32),M(1,"lib-icon",34),s()),n&2){let e=p(2);l(),a("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK_DOUBLE)("info",e.timbreResumeModel.getPropertyLibelle("doublonBloc"))}}function Bn(n,t){if(n&1&&(m(0,"td",35),d(1),s()),n&2){let e=t.$implicit;a("ngClass",(e==null?null:e.getNombreBloc())==0?"gray25":e.getNombreBloc()==(e==null?null:e.getDoublonBloc())?"accent50":""),l(),y(" ",(e==null?null:e.getNombreBloc())>0?e==null?null:e.getDoublonBloc():""," ")}}function In(n,t){if(n&1&&(m(0,"td",31)(1,"b"),d(2),f(3,"async"),s()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getDoublonBloc()," ")}}function wn(n,t){if(n&1&&(m(0,"th",32),M(1,"lib-libelle-model",29),s()),n&2){let e=p(2);l(),a("object",e.timbreResumeModel)("key","nombreTimbresBloc")}}function En(n,t){if(n&1&&(m(0,"td",35),d(1),s()),n&2){let e=t.$implicit;a("ngClass",(e==null?null:e.getNombreTimbresBloc())==0?"gray25":"primary25"),l(),y(" ",(e==null?null:e.getNombreTimbresBloc())>0?e==null?null:e.getNombreTimbresBloc():""," ")}}function An(n,t){if(n&1&&(m(0,"td",31)(1,"b"),d(2),f(3,"async"),s()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getNombreTimbresBloc()," ")}}function Dn(n,t){if(n&1&&(m(0,"th",32),M(1,"lib-icon",34),s()),n&2){let e=p(2);l(),a("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK)("info",e.timbreResumeModel.getPropertyLibelle("acquisTimbresBloc"))}}function Rn(n,t){if(n&1&&(m(0,"td",35),d(1),s()),n&2){let e=t.$implicit;a("ngClass",(e==null?null:e.getNombreTimbresBloc())==0?"gray25":(e==null?null:e.getNombreTimbresBloc())==(e==null?null:e.getAcquisTimbresBloc())?"accent50":"primary25"),l(),y(" ",(e==null?null:e.getNombreTimbresBloc())>0?e==null?null:e.getAcquisTimbresBloc():""," ")}}function On(n,t){if(n&1&&(m(0,"td",31)(1,"b"),d(2),f(3,"async"),s()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getAcquisTimbresBloc()," ")}}function Nn(n,t){if(n&1&&(m(0,"th",32),M(1,"lib-icon",34),s()),n&2){let e=p(2);l(),a("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.CHECK_DOUBLE)("info",e.timbreResumeModel.getPropertyLibelle("doublonTimbresBloc"))}}function Un(n,t){if(n&1&&(m(0,"td",35),d(1),s()),n&2){let e=t.$implicit;a("ngClass",(e==null?null:e.getNombreTimbresBloc())==0?"gray25":(e==null?null:e.getNombreTimbresBloc())==(e==null?null:e.getDoublonTimbresBloc())?"accent50":"primary25"),l(),y(" ",(e==null?null:e.getNombreTimbresBloc())>0?e==null?null:e.getDoublonTimbresBloc():""," ")}}function Ln(n,t){if(n&1&&(m(0,"td",31)(1,"b"),d(2),f(3,"async"),s()()),n&2){let e,i=p(2);l(2),y("",(e=g(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getDoublonTimbresBloc()," ")}}function Fn(n,t){n&1&&M(0,"tr",36)}function qn(n,t){if(n&1){let e=w();m(0,"tr",37),S("click",function(){let r=_(e).$implicit,o=p(2);return h(o.filtreParAnnee(r))}),s()}}function jn(n,t){n&1&&M(0,"tr",38)}function $n(n,t){if(n&1){let e=w();m(0,"table",3),S("matSortChange",function(r){_(e);let o=p();return h(o.sortData(r))}),O(1,4),b(2,Wi,2,2,"th",5)(3,zi,2,1,"td",6)(4,Gi,1,0,"td",7),N(),O(5,8),b(6,Qi,2,2,"th",5)(7,Yi,2,1,"td",6)(8,Zi,4,3,"td",7),N(),O(9,9),b(10,Ki,2,2,"th",10)(11,Ji,2,1,"td",11)(12,Xi,4,3,"td",7),N(),O(13,12),b(14,en,2,3,"th",10)(15,tn,2,4,"td",13)(16,nn,4,3,"td",7),N(),O(17,14),b(18,rn,2,3,"th",10)(19,on,2,4,"td",13)(20,ln,4,3,"td",7),N(),O(21,15),b(22,mn,2,2,"th",10)(23,an,2,2,"td",13)(24,sn,4,3,"td",7),N(),O(25,16),b(26,cn,2,2,"th",10)(27,pn,2,2,"td",13)(28,un,4,3,"td",7),N(),O(29,17),b(30,dn,2,3,"th",10)(31,bn,2,2,"td",13)(32,fn,4,3,"td",7),N(),O(33,18),b(34,gn,2,3,"th",10)(35,_n,2,2,"td",13)(36,hn,4,3,"td",7),N(),O(37,19),b(38,Tn,2,2,"th",10)(39,xn,2,2,"td",13)(40,vn,4,3,"td",7),N(),O(41,20),b(42,Cn,2,3,"th",10)(43,Mn,2,2,"td",13)(44,Sn,4,3,"td",7),N(),O(45,21),b(46,yn,2,3,"th",10)(47,Bn,2,2,"td",13)(48,In,4,3,"td",7),N(),O(49,22),b(50,wn,2,2,"th",10)(51,En,2,2,"td",13)(52,An,4,3,"td",7),N(),O(53,23),b(54,Dn,2,3,"th",10)(55,Rn,2,2,"td",13)(56,On,4,3,"td",7),N(),O(57,24),b(58,Nn,2,3,"th",10)(59,Un,2,2,"td",13)(60,Ln,4,3,"td",7),N(),b(61,Fn,1,0,"tr",25)(62,qn,1,0,"tr",26)(63,jn,1,0,"tr",27),s()}if(n&2){let e=p();a("dataSource",e.dataSource),l(61),a("matHeaderRowDef",e.displayedColumns)("matHeaderRowDefSticky",!0),l(),a("matRowDefColumns",e.displayedColumns),l(),a("matFooterRowDef",e.displayedColumns)("matFooterRowDefSticky",!0)}}var Ft=class n{constructor(t,e,i,r){this.dialogRef=t;this.timbreResumeService=e;this.timbreService=i;this.timbreUtilsService=r;this.dataSource=new et([])}paginator;sort;dataSource=new et;displayedColumns=["annee","total","nombre","acquis","doublon","nombreCarnet","nombreTimbresCarnet","acquisTimbresCarnet","doublonTimbresCarnet","nombreBloc","acquisBloc","doublonBloc","nombreTimbresBloc","acquisTimbresBloc","doublonTimbresBloc"];timbreResumeModel=new R;FontAwesomeEnum=be;FontAwesomeTypeEnum=de;ngOnInit(){this.timbreUtilsService.reinitResume$.pipe(v()).subscribe(t=>{t==!0&&this.timbreResumeService.getResume(),this.initData()})}initData(){this.timbreResumeService.timbresResume$.pipe(v(t=>c(t)&&t?.length>0)).subscribe(t=>{this.dataSource.data=t})}ngAfterViewInit(){this.dataSource.paginator=this.paginator}sortData(t){c(t)&&(this.dataSource.sort=this.sort)}filtreParAnnee(t){this.timbreUtilsService.timbreCritereModel=new H,this.timbreUtilsService.timbreCritereModel.setAnnees([t.getAnnee()]),this.timbreService.getTimbres(this.timbreUtilsService.timbreCritereModel),this.dialogRef.close()}static \u0275fac=function(e){return new(e||n)(C(xe),C(Ut),C(z),C(W))};static \u0275cmp=F({type:n,selectors:[["app-timbre-resume"]],viewQuery:function(e,i){if(e&1&&(ae(Bt,5),ae(Xe,5)),e&2){let r;se(r=ce())&&(i.paginator=r.first),se(r=ce())&&(i.sort=r.first)}},decls:4,vars:4,consts:[["load",""],[3,"ngIf","ngIfElse"],["fxFlexFill","",3,"textSpec"],["id","pdf-content","mat-table","","matSort","",3,"matSortChange","dataSource"],["matColumnDef","annee","sticky",""],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","","class","primary50",4,"matCellDef"],["mat-footer-cell","",4,"matFooterCellDef"],["matColumnDef","total","sticky",""],["matColumnDef","nombre"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","acquis"],["mat-cell","",3,"ngClass",4,"matCellDef"],["matColumnDef","doublon"],["matColumnDef","nombreCarnet"],["matColumnDef","nombreTimbresCarnet"],["matColumnDef","acquisTimbresCarnet"],["matColumnDef","doublonTimbresCarnet"],["matColumnDef","nombreBloc"],["matColumnDef","acquisBloc"],["matColumnDef","doublonBloc"],["matColumnDef","nombreTimbresBloc"],["matColumnDef","acquisTimbresBloc"],["matColumnDef","doublonTimbresBloc"],["mat-header-row","","class","bg-primary color-white",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","mat-row",3,"click",4,"matRowDef","matRowDefColumns"],["mat-footer-row","","class","bg-primary color-white",4,"matFooterRowDef","matFooterRowDefSticky"],["mat-header-cell","","mat-sort-header",""],[3,"object","key"],["mat-cell","",1,"primary50"],["mat-footer-cell",""],["mat-header-cell",""],["mat-cell",""],[1,"click",2,"font-size","1.2em",3,"type","icone","info"],["mat-cell","",3,"ngClass"],["mat-header-row","",1,"bg-primary","color-white"],["mat-row","",1,"mat-row",3,"click"],["mat-footer-row","",1,"bg-primary","color-white"]],template:function(e,i){if(e&1&&(b(0,Hi,1,1,"ng-template",1),f(1,"async"),b(2,$n,64,6,"ng-template",null,0,Z)),e&2){let r=U(3);a("ngIf",g(1,2,i.timbreResumeService.load$)==!1)("ngIfElse",r)}},dependencies:[di,fi,vi,_i,bi,Mi,gi,Ci,hi,xi,Ti,Si,Bi,yi,Xe,It,pe,V,_e,fe,ne,Me,it,P],styles:["th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{text-align:center}th[_ngcontent-%COMP%]{width:40px!important;max-width:40px!important}.mat-row[_ngcontent-%COMP%]{padding:0!important;height:30px}.mat-row[_ngcontent-%COMP%]   .mat-mdc-cell[_ngcontent-%COMP%]{width:40px!important}@media screen and (max-width: 800px){th[_ngcontent-%COMP%]{width:25px!important;max-width:25px!important}.mat-row[_ngcontent-%COMP%]{padding:0!important;height:15px}.mat-row[_ngcontent-%COMP%]   .mat-mdc-cell[_ngcontent-%COMP%]{width:25px!important}th[_ngcontent-%COMP%], .mat-row[_ngcontent-%COMP%]{font-size:.8em}}"]})};var ji=Vi(Pi());var mt=class{dossier;nom;alignLabel;detail;file;getDossier(){return this.dossier}setDossier(t){this.dossier=t}getNom(){return this.nom}setNom(t){this.nom=t}getAlignLabel(){return this.alignLabel}setAlignLabel(t){this.alignLabel=t}getDetail(){return this.detail}setDetail(t){this.detail=t}getFile(){return this.file}setFile(t){this.file=t}};var $e=class{key;dossier;maxWidth;maxHeight;getKey(){return this.key}setKey(t){this.key=t}getDossier(){return this.dossier}setDossier(t){this.dossier=t}getMaxWidth(){return this.maxWidth}setMaxWidth(t){this.maxWidth=t}getMaxHeight(){return this.maxHeight}setMaxHeight(t){this.maxHeight=t}};var zn=["canvas"];function Gn(n,t){if(n&1&&(m(0,"span",6)(1,"b"),d(2),s()()),n&2){let e=p();l(2),y("N\xB0",e.timbreModel==null?null:e.timbreModel.getId(),"")}}function Qn(n,t){n&1&&M(0,"lib-spinner",7),n&2&&a("textSpec","Chargement en cours ...")}function Yn(n,t){if(n&1&&(M(0,"mat-error",29),f(1,"async")),n&2){let e=p(2);a("innerHTML",g(1,1,e.messageError$),ke)}}function Zn(n,t){if(n&1&&(m(0,"mat-option",18),d(1),s()),n&2){let e=t.$implicit;a("value",e),l(),ei(" ",e.getAnnee()," - ",e.getId()," ",e.isCarnet()?" (carnet)":""," ")}}function Kn(n,t){if(n&1){let e=w();m(0,"img",30),S("click",function(){let r;_(e);let o=p(2);return h(o.utilsService.zoom(o.timbreModel==null||(r=o.timbreModel.getTimbreBlocModel())==null?null:r.getImageZoom()))}),s()}if(n&2){let e,i=p(2);a("src",i.timbreModel==null||(e=i.timbreModel.getTimbreBlocModel())==null?null:e.getImage(),xt)}}function Jn(n,t){if(n&1){let e=w();m(0,"form",8,1),S("ngSubmit",function(){_(e);let r=U(1),o=p();return h(o.valider(r))}),m(2,"div",9),b(3,Yn,2,3,"mat-error",10),f(4,"async"),m(5,"div",11)(6,"div",12)(7,"label"),M(8,"lib-libelle-model",13),s(),m(9,"input",14),$("ngModelChange",function(r){_(e);let o=p();return j(o.timbreModel.annee,r)||(o.timbreModel.annee=r),h(r)}),S("ngModelChange",function(r){_(e);let o=p();return h(o.changeAnnee(r))}),s()(),m(10,"div",15)(11,"label"),M(12,"lib-libelle-model",13),s(),m(13,"div",16)(14,"mat-select",17),f(15,"async"),S("ngModelChange",function(r){_(e);let o=p();return h(o.changeBloc(r))}),M(16,"mat-option",18),b(17,Zn,2,4,"mat-option",19),f(18,"async"),s(),b(19,Kn,1,1,"img",20),s()()(),m(20,"div",11)(21,"div",12)(22,"label"),M(23,"lib-libelle-model",13),s(),m(24,"input",21),$("ngModelChange",function(r){_(e);let o=p();return j(o.timbreModel.type,r)||(o.timbreModel.type=r),h(r)}),s()(),m(25,"div",12)(26,"label"),M(27,"lib-libelle-model",13),s(),m(28,"input",22),$("ngModelChange",function(r){_(e);let o=p();return j(o.timbreModel.monnaie,r)||(o.timbreModel.monnaie=r),h(r)}),s()()(),m(29,"div",11)(30,"div",12)(31,"label"),M(32,"lib-libelle-model",13),s(),m(33,"input",23),$("ngModelChange",function(r){_(e);let o=p();return j(o.timbreModel.yt,r)||(o.timbreModel.yt=r),h(r)}),s()(),M(34,"div",24),s(),m(35,"lib-upload",25),S("outPutObject",function(r){_(e);let o=p();return h(o.timbreModel=r)}),s()(),m(36,"div",26)(37,"button",27),S("click",function(){_(e);let r=p();return h(r.close())}),d(38," Annuler "),s(),m(39,"button",28),d(40," Enregistrer "),s()()()}if(n&2){let e,i,r=U(1),o=p();a("ngClass",r!=null&&r.submitted?"red-color":"blue-color"),l(3),a("ngIf",g(4,31,o.messageError$)),l(5),a("object",o.timbreModel)("key","annee"),l(),q("ngModel",o.timbreModel.annee),a("max",o.maxAnnee)("zMax",o.maxAnnee)("disabled",!!(o.timbreModel!=null&&o.timbreModel.getId())),l(3),a("object",o.timbreModel)("key","timbreBlocModel"),l(2),a("ngModel",o.timbreModel.getTimbreBlocModel())("placeholder","Choix bloc")("disabled",!!(o.timbreModel!=null&&o.timbreModel.getId())||((e=g(15,33,o.timbreBlocService.timbresBlocModel$))==null?null:e.length)<=0),l(2),a("value",null),l(),a("ngForOf",g(18,35,o.timbreBlocService.timbresBlocModel$)),l(2),a("ngIf",o.timbreModel==null||(i=o.timbreModel.getTimbreBlocModel())==null?null:i.getImage()),l(4),a("object",o.timbreModel)("key","type"),l(),q("ngModel",o.timbreModel.type),l(3),a("object",o.timbreModel)("key","monnaie"),l(),q("ngModel",o.timbreModel.monnaie),a("disabled",!!o.timbreModel.getTimbreBlocModel()),l(4),a("object",o.timbreModel)("key","yt"),l(),q("ngModel",o.timbreModel.yt),l(2),a("object",o.timbreModel)("key","image")("zoom",o.timbreModel.getImageZoom())("maxWidth",o.timbreService.widthTimbre)("maxHeight",o.timbreService.heightTimbre)}}var at=class n{constructor(t,e,i,r,o){this.httpResponseHandlerService=t;this.dialogRef=e;this.timbreService=i;this.timbreBlocService=r;this.utilsService=o}canvas;messageError$=new E(null);load$=new E(null);id;maxAnnee=new Date().getFullYear();timbreModel=new Se;fileUploadModel=new mt;ngOnInit(){this.initUpload(),this.load$.next(!1),c(this.id)?this.timbreService.getTimbreByIdAsync(this.id).subscribe(t=>{this.timbreModel=t,c(t.getTimbreBlocModel())&&(this.timbreModel.setAnnee(t.getTimbreBlocModel().getAnnee()),this.timbreModel.setMonnaie(t.getTimbreBlocModel().getMonnaie())),this.load$.next(!0)}):(this.timbreModel.setAnnee(new Date().getFullYear()),this.timbreModel.setMonnaie("E"),this.load$.next(!0)),this.changeAnnee(this.timbreModel.getAnnee())}initUpload(){this.fileUploadModel.setDossier("test"),this.fileUploadModel.setNom(new Date().getTime()?.toString());let t=new $e;t.setMaxWidth(this.timbreService.widthTimbre),t.setMaxHeight(this.timbreService.heightTimbre),t.setDossier("autre");let e=new $e;e.setMaxWidth(this.timbreService.widthTimbreZoom),e.setMaxHeight(this.timbreService.heightTimbreZoom),e.setDossier("zoom"),this.fileUploadModel.setDetail([t,e])}valider(t){if(this.messageError$.next(null),t?.valid)if(c(this.timbreModel.getImage()))this.saveData();else{this.messageError$.next("Veuillez s\xE9lectionner une image");return}}saveData(){this.load$.next(!1),c(this.timbreModel.getId())?this.save():this.ajouter()}ajouter(){this.utilsService.getMaxIdentAsync("/timbres").pipe(v()).subscribe(t=>{this.timbreModel.setId(t),this.save(!0)})}save(t){try{Q([this.timbreService.upload(this.timbreModel,"autre"),this.timbreService.upload(this.timbreModel,"table"),this.timbreService.upload(this.timbreModel,"zoom")]).pipe(v(([e,i,r])=>c(e)&&c(r)&&c(i))).subscribe(([e,i,r])=>{c(i)&&i!="nok"&&this.timbreModel.setImage(i),c(e)&&e!="nok"&&this.timbreModel.setImageTable(e),c(r)&&r!="nok"&&this.timbreModel.setImageZoom(r),t?this.timbreService.ajouter(this.timbreModel,!0):this.timbreService.modifier(this.timbreModel),this.httpResponseHandlerService.showNotificationSuccess("Transaction termin\xE9e","Votre timbre a bien \xE9t\xE9 modifi\xE9e."),this.load$.next(!0),this.dialogRef.close()})}catch{this.httpResponseHandlerService.showNotificationError("Transaction non aboutie","Votre timbre n'a pas pu \xEAtre modifi\xE9."),this.load$.next(!0)}}close(){this.dialogRef.close()}changeAnnee(t){if(this.timbreModel.setTimbreBlocModel(null),c(t)){let e=new H;e.setAnnees([t]),this.timbreBlocService.getBlocs(e)}}changeBloc(t){c(t)?(this.timbreModel.setIdBloc(t.getId()),this.timbreModel.setTimbreBlocModel(t),this.timbreModel.setMonnaie(t.getMonnaie()),this.timbreModel.setAnnee(t.getAnnee())):(this.timbreModel.setIdBloc(null),this.timbreModel.setTimbreBlocModel(null),this.timbreModel.setMonnaie("E"))}static \u0275fac=function(e){return new(e||n)(C(Et),C(xe),C(z),C(K),C(re))};static \u0275cmp=F({type:n,selectors:[["app-timbre-modifier"]],viewQuery:function(e,i){if(e&1&&ae(zn,5),e&2){let r;se(r=ce())&&(i.canvas=r.first)}},decls:9,vars:6,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],["class","accent",4,"ngIf"],[3,"ngIf","ngIfElse"],[1,"accent"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","space-between stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","column","fxLayoutGap","20px",1,"bloc-modal"],[3,"innerHTML",4,"ngIf"],["fxLayout","row","fxLayout.lt-lg","column","fxLayoutGap","30px","fxLayoutGap.lt-lg","5px"],["fxLayout","column",1,"form-input"],[3,"object","key"],["name","page","type","number","minlength","4","maxlength","4","min","1900","zMin","1900","required","","zControl","",1,"annee",2,"width","60px !important",3,"ngModelChange","ngModel","max","zMax","disabled"],["fxLayout","column",1,"form-input","select"],["fxLayout","row","fxLayoutGap","15px"],["name","bloc",2,"width","180px !important",3,"ngModelChange","ngModel","placeholder","disabled"],[1,"selectMin",3,"value"],["class","selectMin",3,"value",4,"ngFor","ngForOf"],["style","max-height: 40px","class","click",3,"src","click",4,"ngIf"],["name","type","type","text","trim","","zControl","",3,"ngModelChange","ngModel"],["name","monnaie","type","text","trim","","minlength","1","maxlength","2","required","","zControl","",2,"width","25px !important",3,"ngModelChange","ngModel","disabled"],["name","yt","type","text","trim","","zControl","",3,"ngModelChange","ngModel"],["fxHide.lt-lg","","fxLayout","column",1,"form-input"],[3,"outPutObject","object","key","zoom","maxWidth","maxHeight"],["fxLayout","row","fxLayoutGap","10px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"],[3,"innerHTML"],[1,"click",2,"max-height","40px",3,"click","src"]],template:function(e,i){if(e&1&&(m(0,"div",2)(1,"div",3)(2,"span"),d(3),s(),b(4,Gn,3,1,"span",4),s(),b(5,Qn,1,1,"ng-template",5),f(6,"async"),b(7,Jn,41,37,"ng-template",null,0,Z),s()),e&2){let r=U(8);l(3),y("",i.timbreModel!=null&&i.timbreModel.getId()?"MODIFICATION":"AJOUT"," "),l(),a("ngIf",i.timbreModel==null?null:i.timbreModel.getId()),l(),a("ngIf",g(6,4,i.load$)==!1)("ngIfElse",r)}},dependencies:[ie,Je,Ce,Te,pe,ue,V,ge,De,he,_e,Re,He,fe,Ue,We,ze,ee,Oe,Ye,Ze,Ke,Qe,Ge,te,Ne,ne,it,tt,At,rt,ot,Dt,P],encapsulation:2})};function Xn(n,t){if(n&1&&(m(0,"mat-option",4),d(1),s()),n&2){let e=t.$implicit;a("value",e),l(),y(" ",e," ")}}function er(n,t){if(n&1){let e=w();m(0,"div",1)(1,"div",2)(2,"mat-select",3),$("ngModelChange",function(r){_(e);let o=p();return j(o.timbreUtilsService.timbreCritereModel.acquis,r)||(o.timbreUtilsService.timbreCritereModel.acquis=r),h(r)}),S("ngModelChange",function(){_(e);let r=p();return h(r.filtreByCritere())}),m(3,"mat-option",4),d(4," Oui"),s(),m(5,"mat-option",4),d(6," Non"),s(),m(7,"mat-option",4),d(8," Tous"),s()()(),m(9,"div",2)(10,"mat-select",5),$("ngModelChange",function(r){_(e);let o=p();return j(o.timbreUtilsService.timbreCritereModel.doublon,r)||(o.timbreUtilsService.timbreCritereModel.doublon=r),h(r)}),S("ngModelChange",function(){_(e);let r=p();return h(r.filtreByCritere())}),m(11,"mat-option",4),d(12," Oui"),s(),m(13,"mat-option",4),d(14," Non"),s(),m(15,"mat-option",4),d(16," Tous"),s()()(),m(17,"div",2)(18,"mat-select",6),$("ngModelChange",function(r){_(e);let o=p();return j(o.timbreUtilsService.timbreCritereModel.carnet,r)||(o.timbreUtilsService.timbreCritereModel.carnet=r),h(r)}),S("ngModelChange",function(){_(e);let r=p();return h(r.filtreByCritere())}),m(19,"mat-option",4),d(20," Oui"),s(),m(21,"mat-option",4),d(22," Non"),s(),m(23,"mat-option",4),d(24," Tous"),s()()(),m(25,"div",2)(26,"mat-select",7),$("ngModelChange",function(r){_(e);let o=p();return j(o.timbreUtilsService.timbreCritereModel.bloc,r)||(o.timbreUtilsService.timbreCritereModel.bloc=r),h(r)}),S("ngModelChange",function(){_(e);let r=p();return h(r.filtreByCritere())}),m(27,"mat-option",4),d(28," Oui"),s(),m(29,"mat-option",4),d(30," Non"),s(),m(31,"mat-option",4),d(32," Tous"),s()()(),m(33,"div",8)(34,"mat-select",9),$("ngModelChange",function(r){_(e);let o=p();return j(o.timbreUtilsService.timbreCritereModel.annees,r)||(o.timbreUtilsService.timbreCritereModel.annees=r),h(r)}),S("ngModelChange",function(){_(e);let r=p();return h(r.filtreByCritere())}),b(35,Xn,2,2,"mat-option",10),f(36,"async"),s()()()}if(n&2){let e=p();l(2),q("ngModel",e.timbreUtilsService.timbreCritereModel.acquis),a("placeholder","Acquis"),l(),a("value","OUI"),l(2),a("value","NON"),l(2),a("value","TOUS"),l(3),q("ngModel",e.timbreUtilsService.timbreCritereModel.doublon),a("placeholder","Doublon"),l(),a("value","OUI"),l(2),a("value","NON"),l(2),a("value","TOUS"),l(3),q("ngModel",e.timbreUtilsService.timbreCritereModel.carnet),a("placeholder","Carnet"),l(),a("value","OUI"),l(2),a("value","NON"),l(2),a("value","TOUS"),l(3),q("ngModel",e.timbreUtilsService.timbreCritereModel.bloc),a("placeholder","Bloc"),l(),a("value","OUI"),l(2),a("value","NON"),l(2),a("value","TOUS"),l(3),q("ngModel",e.timbreUtilsService.timbreCritereModel.annees),a("placeholder","Ann\xE9es"),l(),a("ngForOf",g(36,23,e.annees$))}}var $t=class n{constructor(t,e,i){this.authService=t;this.timbreService=e;this.timbreUtilsService=i}modif=!0;annees$;ngOnInit(){this.annees$=this.timbreUtilsService.getAnneesAsync("/timbres")}filtreByCritere(){this.timbreUtilsService.timbreCritereModel.getCarnet()=="OUI"&&this.timbreUtilsService.timbreCritereModel.setBloc("OUI"),this.timbreUtilsService.timbreCritereModel.getAcquis()=="NON"&&this.timbreUtilsService.timbreCritereModel.setDoublon("TOUS"),c(this.timbreUtilsService.timbreCritereModel.getAnnees())&&this.timbreUtilsService.timbreCritereModel.getAnnees().length>0&&this.timbreService.getTimbres(this.timbreUtilsService.timbreCritereModel)}static \u0275fac=function(e){return new(e||n)(C(X),C(z),C(W))};static \u0275cmp=F({type:n,selectors:[["app-timbre-recherche"]],inputs:{modif:"modif"},decls:1,vars:1,consts:[["class","menuRecherche",4,"ngIf"],[1,"menuRecherche"],[1,"form-input","select",2,"width","100px"],["name","acquis",3,"ngModelChange","ngModel","placeholder"],[1,"selectMin",3,"value"],["name","doublon",1,"scrollBarAccent",3,"ngModelChange","ngModel","placeholder"],["name","carnet",1,"scrollBarAccent",3,"ngModelChange","ngModel","placeholder"],["name","bloc",1,"scrollBarAccent",3,"ngModelChange","ngModel","placeholder"],[1,"form-input","select",2,"width","150px"],["name","anneeSelect","multiple","",3,"ngModelChange","ngModel","placeholder"],["class","selectMin",3,"value",4,"ngFor","ngForOf"]],template:function(e,i){e&1&&b(0,er,37,25,"div",0),e&2&&a("ngIf",i.modif)},dependencies:[Ce,Te,ue,V,ee,te,P],styles:[".menuRecherche[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:left;width:100%}.menuRecherche[_ngcontent-%COMP%] > .form-input[_ngcontent-%COMP%]{margin:0 10px;display:flex;flex-direction:column;justify-content:space-between;align-items:stretch}@media screen and (max-width: 800px){.menuRecherche[_ngcontent-%COMP%] > .form-input[_ngcontent-%COMP%]{margin:5px 10px}}"]})};function ir(n,t){if(n&1&&(m(0,"div",3)(1,"span"),d(2,"Nombre de timbres : "),s(),m(3,"span",4),d(4),f(5,"async"),s()()),n&2){let e=p();l(4),vt(g(5,1,e.total$))}}var Vt=class n{constructor(t){this.dialog=t}total$;FontAwesomeEnum=be;FontAwesomeTypeEnum=de;resume(){this.dialog.open(Ft,{height:"auto",maxHeight:"95vh",width:"1000px"})}static \u0275fac=function(e){return new(e||n)(C(ve))};static \u0275cmp=F({type:n,selectors:[["app-timbre-total"]],inputs:{total$:"total$"},decls:4,vars:6,consts:[[1,"timbreTotal"],["class","nbTimbre",4,"ngIf"],[1,"accent","click",3,"click","icone","type","info"],[1,"nbTimbre"],[1,"bold"]],template:function(e,i){e&1&&(m(0,"div",0),b(1,ir,6,3,"div",1),f(2,"async"),m(3,"lib-icon",2),S("click",function(){return i.resume()}),s()()),e&2&&(l(),a("ngIf",g(2,4,i.total$)),l(2),a("icone",i.FontAwesomeEnum.CHART_LINE_UP)("type",i.FontAwesomeTypeEnum.TYPE_SOLID)("info","D\xE9tail par ann\xE9e"))},dependencies:[V,Me,P],styles:[".timbreTotal[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:start;align-content:center;gap:10px}.timbreTotal[_ngcontent-%COMP%]   .nbTimbre[_ngcontent-%COMP%]{font-size:1.2em}.timbreTotal[_ngcontent-%COMP%]   lib-icon[_ngcontent-%COMP%]{font-size:1.5em}@media screen and (max-width: 800px){.timbreTotal[_ngcontent-%COMP%]{height:25px;gap:5px}.timbreTotal[_ngcontent-%COMP%]   .nbTimbre[_ngcontent-%COMP%]{font-size:1em}.timbreTotal[_ngcontent-%COMP%]   lib-icon[_ngcontent-%COMP%]{font-size:1.2em}}"]})};function rr(n,t){if(n&1){let e=w();m(0,"img",16),S("click",function(){_(e);let r=p().$implicit,o=p();return h(o.utilsService.zoom(r==null?null:r.getImageZoom()))}),s()}if(n&2){let e=p().$implicit;a("src",e==null?null:e.getImageTable(),xt)}}function or(n,t){if(n&1&&d(0),n&2){let e,i=p().$implicit;y(" ",i==null||(e=i.getTimbreBlocModel())==null?null:e.getAnnee()," ")}}function lr(n,t){if(n&1&&d(0),n&2){let e=p().$implicit;y(" ",e==null?null:e.getAnnee()," ")}}function mr(n,t){if(n&1){let e=w();m(0,"lib-icon",17),S("click",function(){let r;_(e);let o=p().$implicit,u=p();return h(u.utilsService.zoom(o==null||(r=o.getTimbreBlocModel())==null?null:r.getImageZoom()))}),s()}if(n&2){let e,i=p().$implicit,r=p();a("classIcone","primary")("type",r.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",r.FontAwesomeEnum.IMAGE_POLAROID)("classInfo","imageHoverBloc")("info","<img src='"+(i==null||(e=i.getTimbreBlocModel())==null?null:e.getImageZoom())+"'/>")}}function ar(n,t){if(n&1&&(m(0,"div",8)(1,"div",9),b(2,rr,1,1,"img",10),s(),M(3,"div",11),m(4,"div",11),b(5,or,1,1,"ng-template",12)(6,lr,1,1,"ng-template",null,0,Z),m(8,"div",13),b(9,mr,1,5,"lib-icon",14),M(10,"lib-icon",15),s()()()),n&2){let e=t.$implicit,i=U(7),r=p();l(2),a("ngIf",e==null?null:e.getImageTable()),l(3),a("ngIf",e==null?null:e.getIdBloc())("ngIfElse",i),l(4),a("ngIf",e==null?null:e.getIdBloc()),l(),a("classIcone","primary")("type",r.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",r.FontAwesomeEnum.CIRCLE_INFO)("info",e==null?null:e.getYt())}}var Pt=class n{constructor(t,e,i,r,o,u){this.snackBar=t;this.authService=e;this.timbreService=i;this.timbreUtilsService=r;this.dialog=o;this.utilsService=u;this.dataSource=new et([])}paginator;sort;timbres$;load$;total$;modif=!0;dataSource=new et;displayedColumns;timbre=new Se;annees$;FontAwesomeEnum=be;FontAwesomeTypeEnum=de;ngOnInit(){this.annees$=this.timbreUtilsService.getAnneesAsync("/timbres"),this.timbre.setTimbreAcquisModel(new Y),this.displayedColumns=["image","id","annee","idBloc","monnaie","type","yt","acquis","doublon"],this.modif&&this.authService.user$.pipe(v(t=>c(t)&&t?.getDroit()==10)).subscribe(t=>{this.displayedColumns.push("modifier","supprimer")}),this.timbres$.subscribe(t=>{this.dataSource.data=t})}ngAfterViewInit(){this.dataSource.paginator=this.paginator}droitInsuffisant(){this.snackBar.open("Droit insuffisant",null,{duration:6e3})}acquisDoublon(t,e){this.authService.user$.pipe(v(i=>c(i))).subscribe(i=>{i?.getDroit()>=9?this.timbreService.acquis(t,e):this.droitInsuffisant()})}modifier(t){let e=this.dialog.open(at,{height:"75vh",maxHeight:"750px",width:"30%"});e.componentInstance.id=t.getId(),e.afterClosed().subscribe(()=>{e.close()})}supprimer(t){let e=this.dialog.open(Rt,{maxHeight:"95vh",data:{titre:"Confirmation",message:"Souhaitez-vous supprimer le timbre <b>n\xB0 "+t?.getId()+"</b> ?",btnDroite:"Oui",btnGauche:"Non"}});e.afterClosed().subscribe(()=>{e.componentInstance.data.resultat==="valider"&&this.timbreService.supprimer(t)})}static \u0275fac=function(e){return new(e||n)(C(ui),C(X),C(z),C(W),C(ve),C(re))};static \u0275cmp=F({type:n,selectors:[["app-timbre-resultat"]],viewQuery:function(e,i){if(e&1&&(ae(Bt,5),ae(Xe,5)),e&2){let r;se(r=ce())&&(i.paginator=r.first),se(r=ce())&&(i.sort=r.first)}},inputs:{timbres$:"timbres$",load$:"load$",total$:"total$",modif:"modif"},decls:10,vars:12,consts:[["noBloc",""],[1,"spinner",3,"fxHide","textSpec"],[3,"fxHide"],[1,"responsiveDirection","responsiveMenu"],[3,"total$"],[3,"modif"],[1,"listeTimbre","primary"],["class","detailTimbre border-primary",4,"ngFor","ngForOf"],[1,"detailTimbre","border-primary"],[1,"imgTimbre"],["class","image click",3,"src","click",4,"ngIf"],[1,"footerTimbre"],[3,"ngIf","ngIfElse"],[1,"infoTimbre"],["class","click","style","font-size: 1.2em",3,"classIcone","type","icone","classInfo","info","click",4,"ngIf"],[1,"click",2,"font-size","1.2em",3,"classIcone","type","icone","info"],[1,"image","click",3,"click","src"],[1,"click",2,"font-size","1.2em",3,"click","classIcone","type","icone","classInfo","info"]],template:function(e,i){e&1&&(M(0,"lib-spinner",1),f(1,"async"),m(2,"section",2),f(3,"async"),m(4,"div",3),M(5,"app-timbre-total",4)(6,"app-timbre-recherche",5),s(),m(7,"div",6),b(8,ar,11,8,"div",7),f(9,"async"),s()()),e&2&&(a("fxHide",g(1,6,i.load$)==!0)("textSpec","Chargement en cours ..."),l(2),a("fxHide",g(3,8,i.load$)==!1),l(3),a("total$",i.total$),l(),a("modif",i.modif),l(2),a("ngForOf",g(9,10,i.timbres$)))},dependencies:[ue,V,He,ne,Me,$t,Vt,P],styles:[".spinner[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;align-items:stretch;flex:100%;height:100%}.listeTimbre[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:left;width:100%}.listeTimbre[_ngcontent-%COMP%]   .detailTimbre[_ngcontent-%COMP%]{margin:10px;width:115px;height:150px;border-radius:10px;border:1px solid;padding:10px 10px 5px;display:flex;flex-direction:column;justify-content:space-between;align-items:stretch}.listeTimbre[_ngcontent-%COMP%]   .detailTimbre[_ngcontent-%COMP%]   .imgTimbre[_ngcontent-%COMP%]{width:100%;display:flex;flex:auto;justify-content:center;align-items:center}.listeTimbre[_ngcontent-%COMP%]   .detailTimbre[_ngcontent-%COMP%]   .imgTimbre[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100px;max-height:100px}.listeTimbre[_ngcontent-%COMP%]   .detailTimbre[_ngcontent-%COMP%]   .footerTimbre[_ngcontent-%COMP%]{height:25px;display:flex;flex-direction:row;justify-content:space-between;align-items:end;width:100%}.listeTimbre[_ngcontent-%COMP%]   .detailTimbre[_ngcontent-%COMP%]   .footerTimbre[_ngcontent-%COMP%]   .infoTimbre[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:end;gap:5px}@media screen and (max-width: 800px){.listeTimbre[_ngcontent-%COMP%]{justify-content:space-evenly}}"]})};function cr(n,t){if(n&1&&(M(0,"lib-spinner",5),f(1,"async")),n&2){let e=p();a("textSpec",g(1,1,e.messageLoad$))}}function pr(n,t){if(n&1&&(M(0,"mat-error",16),f(1,"async")),n&2){let e=p(2);a("innerHTML",g(1,1,e.messageError$),ke)}}function ur(n,t){if(n&1&&M(0,"app-timbre-resultat",17),n&2){let e=p(2);a("load$",e.load$)("timbres$",e.timbres$)("modif",!1)}}function dr(n,t){if(n&1&&(m(0,"mat-option",21),d(1),s()),n&2){let e=t.$implicit;a("value",e),l(),y(" ",e," ")}}function br(n,t){if(n&1){let e=w();m(0,"div",18)(1,"mat-select",19),$("ngModelChange",function(r){_(e);let o=p(2);return j(o.annees,r)||(o.annees=r),h(r)}),b(2,dr,2,2,"mat-option",20),s()()}if(n&2){let e=p(2);l(),q("ngModel",e.annees),a("placeholder","Ann\xE9es"),l(),a("ngForOf",e.anneesDispo)}}function fr(n,t){n&1&&(m(0,"button",22),d(1," Enregistrer "),s())}function gr(n,t){if(n&1){let e=w();m(0,"form",6,1),S("ngSubmit",function(){_(e);let r=U(1),o=p();return h(o.valider(r))}),m(2,"div",7),b(3,pr,2,3,"mat-error",8),f(4,"async"),b(5,ur,1,3,"app-timbre-resultat",9),f(6,"async"),s(),m(7,"div",10),b(8,br,3,3,"div",11),f(9,"async"),f(10,"async"),m(11,"button",12),S("click",function(){_(e);let r=p();return h(r.close())}),d(12," Annuler "),s(),m(13,"input",13),S("change",function(r){_(e);let o=p();return h(o.onFileChange(r))}),s(),m(14,"button",14),S("click",function(){_(e);let r=p();return h(r.triggerFileInput())}),d(15," Choisir un fichier "),s(),b(16,fr,2,0,"button",15),f(17,"async"),s()()}if(n&2){let e,i,r,o=U(1),u=p();a("ngClass",o!=null&&o.submitted?"red-color":"blue-color"),l(3),a("ngIf",g(4,6,u.messageError$)),l(2),a("ngIf",((e=g(6,8,u.timbres$))==null?null:e.length)>0),l(3),a("ngIf",!g(9,10,u.timbres$)||((i=g(10,12,u.timbres$))==null?null:i.length)==0),l(5),Xt("id",u.idFile),l(3),a("ngIf",((r=g(17,14,u.timbres$))==null?null:r.length)>0)}}var kt=class n{constructor(t,e,i,r,o,u,T){this.authService=t;this.timbreService=e;this.timbreBlocService=i;this.timbreUtilsService=r;this.uploadService=o;this.utilsService=u;this.dialogRef=T}dossier="/assets/images/timbres/";timbres$=new E(null);messageError$=new E(null);messageLoad$=new E("Chargement en cours ...");load$=new E(null);idFile="fileImport";identTimbre=1;identBloc=1;timbresModel=[];timbresBlocsModel=[];anneesDispo=[];annees=[new Date().getFullYear()];ngOnInit(){for(let t=new Date().getFullYear();t>=1900;t--)this.anneesDispo.push(t)}triggerFileInput(){document.getElementById(this.idFile).click()}onFileChange(t){let e=t.target.files[0];e&&(this.load$.next(!1),this.messageLoad$.next("Chargement en cours ..."),this.saveCsv(e))}saveCsv(t){let e=new FileReader;e.onload=()=>{let i=e.result;this.parseCsv(i)},e.readAsText(t)}parseCsv(t){c(this.annees)&&this.annees.length>0&&Q([this.utilsService.getMaxIdentAsync("/timbres"),this.utilsService.getMaxIdentAsync("/timbres_bloc"),this.authService.userSelect$]).pipe(v(([e,i,r])=>c(r))).subscribe(([e,i,r])=>{this.identTimbre=e,this.identBloc=i,this.timbresModel=[],this.timbres$.next(null),ji.parse(t,{header:!0,skipEmptyLines:!0,complete:o=>{c(o.data)&&o.data?.length>0&&(this.timbresBlocsModel=[],o.data.forEach((u,T)=>{let x=this.setTimbre(u,r);c(x?.getId())&&(this.timbresModel.push(x),this.identTimbre++),T==o.data.length-1&&(this.timbres$.next(this.timbresModel),this.load$.next(!0))}))},error:o=>{console.error("Erreur lors du parsing du CSV :",o)}})})}setTimbre(t,e){let i=new Se,r=t.CODE!="NULL"&&t.CODE!=""?Number(t.CODE):null,o=t.IDENT_BLOC!="NULL"&&t.IDENT_BLOC!=""&&c(t.IDENT_BLOC)?Number(t.IDENT_BLOC):null,u=t.ANNEE!="NULL"&&t.ANNEE!=""?Number(t.ANNEE):null,T=t.MONNAIE!="NULL"&&t.MONNAIE!=""?t.MONNAIE:null;if(this.annees.includes(u)){i.setId(this.identTimbre),i.setType(t.TYPE!="NULL"&&t.TYPE!=""?t.TYPE:null),i.setYt(t.YT!="NULL"&&t.YT!=""?t.YT:null),i.setAnnee(u);let x=new Y;x.setIdTimbre(i.getId()),x.setIdUser(e.getId()),x.setAcquis(t.ACQUIS=="1"),x.setDoublon(t.DOUBLON=="1"),i.setTimbreAcquisModel(x);let A=this.dossier+u+"/",k="";if(c(o)){if(A+="bloc/"+o,k=A+".png",A+="-",i.setTimbreBlocModel(this.timbresBlocsModel.find(D=>D.getAnnee()==u&&D.idOrigine==o)),J(i.getTimbreBlocModel())){let D=new Le;D.setId(this.identBloc),D.setAnnee(u),D.setMonnaie(T),D.setCarnet(t.CARNET=="1"),D.idOrigine=o;let we=new oe;we.setIdBloc(this.identBloc),we.setIdUser(e.getId()),we.setAcquis(t.ACQUIS_BLOC=="1"),we.setDoublon(t.DOUBLON_BLOC=="1"),D.setTimbreBlocAcquisModel(we),this.uploadService.checkIfImageExists(k).pipe(v()).subscribe(gt=>{gt&&(D.setImage(k),D.setImageTable(k),D.setImageZoom(k))}),this.timbresBlocsModel.push(D),i.setTimbreBlocModel(D),this.identBloc++}i.setIdBloc(i.getTimbreBlocModel()?.getId())}else i.setMonnaie(T);A+=r+".png",this.uploadService.checkIfImageExists(A).pipe(v()).subscribe(D=>{D&&(i.setImage(A),i.setImageTable(A),i.setImageZoom(A))})}return i}valider(t){this.messageError$.next(null),t?.valid&&(this.load$.next(!1),this.messageLoad$.next("Import en cours ..."),c(this.timbresBlocsModel)&&this.timbresBlocsModel?.length>0&&this.timbresBlocsModel.forEach((e,i)=>{this.saveBloc(e)}),this.timbres$.pipe(v()).subscribe(e=>{if(c(e)&&e?.length>0)e.forEach((i,r)=>{this.saveTimbre(i,r==e.length-1)});else{this.messageError$.next("Donn\xE9es incorrectes");return}}))}saveBloc(t){Q([this.timbreBlocService.upload(t,"autre"),this.timbreBlocService.upload(t,"table"),this.timbreBlocService.upload(t,"zoom")]).pipe(v(([e,i,r])=>c(e)&&c(r)&&c(i))).subscribe(([e,i,r])=>{c(i)&&i!="nok"&&t.setImage(i),c(e)&&e!="nok"&&t.setImageTable(e),c(r)&&r!="nok"&&t.setImageZoom(r),t?.getTimbreBlocAcquisModel()?.isAcquis()&&this.timbreBlocService.addAcquis(t?.getTimbreBlocAcquisModel()?.getIdUser(),t,t?.getTimbreBlocAcquisModel()?.isDoublon()),this.timbreBlocService.ajouter(t,!1)})}saveTimbre(t,e){Q([this.timbreService.upload(t,"autre"),this.timbreService.upload(t,"table"),this.timbreService.upload(t,"zoom")]).pipe(v(([i,r,o])=>c(i)&&c(o)&&c(r))).subscribe(([i,r,o])=>{c(r)&&r!="nok"&&t.setImage(r),c(i)&&i!="nok"&&t.setImageTable(i),c(o)&&o!="nok"&&t.setImageZoom(o),t?.getTimbreAcquisModel()?.isAcquis()&&this.timbreService.addAcquis(t?.getTimbreAcquisModel()?.getIdUser(),t,t?.getTimbreAcquisModel()?.isDoublon()),this.timbreService.ajouter(t,e),e&&(this.load$.next(!0),this.close())})}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||n)(C(X),C(z),C(K),C(W),C(nt),C(re),C(xe))};static \u0275cmp=F({type:n,selectors:[["app-timbre-importer"]],decls:8,vars:4,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],[3,"ngIf","ngIfElse"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","start stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","column","fxLayoutGap","20px",1,"bloc-modal"],[3,"innerHTML",4,"ngIf"],[3,"load$","timbres$","modif",4,"ngIf"],["fxLayout","row","fxLayoutGap","20px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["fxLayout","row","fxLayoutAlign","end center","class","form-input select noError","style","width: 150px",4,"ngIf"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","file","accept",".xls, .xlsx, .csv","hidden","","required","",3,"change","id"],["type","button","mat-raised-button","","color","accent",1,"rounded","large","color-white",3,"click"],["type","submit","class","rounded large color-white","mat-raised-button","","color","accent",4,"ngIf"],[3,"innerHTML"],[3,"load$","timbres$","modif"],["fxLayout","row","fxLayoutAlign","end center",1,"form-input","select","noError",2,"width","150px"],["name","anneeSelect","multiple","",3,"ngModelChange","ngModel","placeholder"],["class","selectMin",3,"value",4,"ngFor","ngForOf"],[1,"selectMin",3,"value"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"]],template:function(e,i){if(e&1&&(m(0,"div",2)(1,"div",3)(2,"span"),d(3,"TIMBRE IMPORTER"),s()(),b(4,cr,2,3,"ng-template",4),f(5,"async"),b(6,gr,18,16,"ng-template",null,0,Z),s()),e&2){let r=U(7);l(4),a("ngIf",g(5,2,i.load$)==!1)("ngIfElse",r)}},dependencies:[ie,Je,Ce,Te,pe,ue,V,ge,De,he,_e,Re,fe,Ue,ee,Oe,te,Ne,ne,Pt,P]})};var _r=["canvas"];function hr(n,t){n&1&&M(0,"lib-spinner",5),n&2&&a("textSpec","Chargement en cours ...")}function Tr(n,t){if(n&1&&(M(0,"mat-error",21),f(1,"async")),n&2){let e=p(2);a("innerHTML",g(1,1,e.messageError$),ke)}}function xr(n,t){if(n&1){let e=w();m(0,"div",10)(1,"label"),M(2,"lib-libelle-model",11),s(),m(3,"input",22),$("ngModelChange",function(r){_(e);let o=p(2);return j(o.timbreBlocModel.id,r)||(o.timbreBlocModel.id=r),h(r)}),s()()}if(n&2){let e=p(2);l(2),a("object",e.timbreBlocModel)("key","id"),l(),q("ngModel",e.timbreBlocModel.id),a("disabled",!!(e.timbreBlocModel!=null&&e.timbreBlocModel.getId()))}}function vr(n,t){if(n&1){let e=w();m(0,"form",6,1),S("ngSubmit",function(){_(e);let r=U(1),o=p();return h(o.valider(r))}),m(2,"div",7),b(3,Tr,2,3,"mat-error",8),f(4,"async"),b(5,xr,4,4,"div",9),m(6,"div",10)(7,"label"),M(8,"lib-libelle-model",11),s(),m(9,"input",12),$("ngModelChange",function(r){_(e);let o=p();return j(o.timbreBlocModel.annee,r)||(o.timbreBlocModel.annee=r),h(r)}),s()(),m(10,"div",10)(11,"label"),M(12,"lib-libelle-model",11),s(),m(13,"input",13),$("ngModelChange",function(r){_(e);let o=p();return j(o.timbreBlocModel.monnaie,r)||(o.timbreBlocModel.monnaie=r),h(r)}),s()(),m(14,"div",14)(15,"div",10)(16,"label"),M(17,"lib-libelle-model",11),s(),m(18,"input",15),$("ngModelChange",function(r){_(e);let o=p();return j(o.timbreBlocModel.yt,r)||(o.timbreBlocModel.yt=r),h(r)}),s()(),M(19,"div",16),s(),m(20,"lib-upload",17),S("outPutObject",function(r){_(e);let o=p();return h(o.timbreBlocModel=r)}),s()(),m(21,"div",18)(22,"button",19),S("click",function(){_(e);let r=p();return h(r.close())}),d(23," Annuler "),s(),m(24,"button",20),d(25," Enregistrer "),s()()()}if(n&2){let e=U(1),i=p();a("ngClass",e!=null&&e.submitted?"red-color":"blue-color"),l(3),a("ngIf",g(4,18,i.messageError$)),l(2),a("ngIf",i.timbreBlocModel==null?null:i.timbreBlocModel.getId()),l(3),a("object",i.timbreBlocModel)("key","annee"),l(),q("ngModel",i.timbreBlocModel.annee),a("max",i.maxAnnee)("zMax",i.maxAnnee),l(3),a("object",i.timbreBlocModel)("key","monnaie"),l(),q("ngModel",i.timbreBlocModel.monnaie),l(4),a("object",i.timbreBlocModel)("key","yt"),l(),q("ngModel",i.timbreBlocModel.yt),l(2),a("object",i.timbreBlocModel)("key","image")("maxWidth",i.timbreBlocService.widthTimbre)("maxHeight",i.timbreBlocService.heightTimbre)}}var Ht=class n{constructor(t,e,i,r){this.httpResponseHandlerService=t;this.dialogRef=e;this.utilsService=i;this.timbreBlocService=r}canvas;messageError$=new E(null);load$=new E(null);id;maxAnnee=new Date().getFullYear();timbreBlocModel=new Le;fileUploadModel=new mt;ngOnInit(){this.initUpload(),this.load$.next(!1),c(this.id)?this.timbreBlocService.getBlocByIdAsync(this.id).subscribe(t=>{this.timbreBlocModel=t,this.load$.next(!0)}):(this.timbreBlocModel.setAnnee(new Date().getFullYear()),this.timbreBlocModel.setMonnaie("E"),this.load$.next(!0))}initUpload(){this.fileUploadModel.setDossier("test"),this.fileUploadModel.setNom(new Date().getTime()?.toString());let t=new $e;t.setMaxWidth(this.timbreBlocService.widthTimbre),t.setMaxHeight(this.timbreBlocService.heightTimbre),t.setDossier("autre");let e=new $e;e.setMaxWidth(this.timbreBlocService.widthTimbreZoom),e.setMaxHeight(this.timbreBlocService.heightTimbreZoom),e.setDossier("zoom"),this.fileUploadModel.setDetail([t,e])}valider(t){if(this.messageError$.next(null),t?.valid)if(c(this.timbreBlocModel.getImage()))this.saveData();else{this.messageError$.next("Veuillez s\xE9lectionner une image");return}}saveData(){this.load$.next(!1),c(this.timbreBlocModel.getId())?this.save():this.ajouter()}ajouter(){this.utilsService.getMaxIdentAsync("/timbres_bloc").pipe(v()).subscribe(t=>{this.timbreBlocModel.setId(t),this.save(!0)})}save(t){try{Q([this.timbreBlocService.upload(this.timbreBlocModel,"autre"),this.timbreBlocService.upload(this.timbreBlocModel,"table"),this.timbreBlocService.upload(this.timbreBlocModel,"zoom")]).pipe(v(([e,i,r])=>c(e)&&c(r)&&c(i))).subscribe(([e,i,r])=>{c(i)&&i!="nok"&&this.timbreBlocModel.setImage(i),c(e)&&e!="nok"&&this.timbreBlocModel.setImageTable(e),c(r)&&r!="nok"&&this.timbreBlocModel.setImageZoom(r),t?this.timbreBlocService.ajouter(this.timbreBlocModel,!0):this.timbreBlocService.modifier(this.timbreBlocModel),this.httpResponseHandlerService.showNotificationSuccess("Transaction termin\xE9e","Votre timbre a bien \xE9t\xE9 modifi\xE9e."),this.load$.next(!0),this.dialogRef.close()})}catch{this.httpResponseHandlerService.showNotificationError("Transaction non aboutie","Votre timbre n'a pas pu \xEAtre modifi\xE9."),this.load$.next(!0)}}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||n)(C(Et),C(xe),C(re),C(K))};static \u0275cmp=F({type:n,selectors:[["app-timbre-modifier-bloc"]],viewQuery:function(e,i){if(e&1&&ae(_r,5),e&2){let r;se(r=ce())&&(i.canvas=r.first)}},decls:10,vars:6,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],[3,"ngIf","ngIfElse"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","space-between stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","column","fxLayoutGap","20px",1,"bloc-modal"],[3,"innerHTML",4,"ngIf"],["fxLayout","column","class","form-input",4,"ngIf"],["fxLayout","column",1,"form-input"],[3,"object","key"],["name","page","type","number","minlength","4","maxlength","4","min","1900","zMin","1900","required","","zControl","",1,"annee",2,"width","60px !important",3,"ngModelChange","ngModel","max","zMax"],["name","monnaie","type","text","trim","","minlength","1","maxlength","2","required","","zControl","",2,"width","25px !important",3,"ngModelChange","ngModel"],["fxLayout","row","fxLayout.lt-lg","column","fxLayoutGap","30px","fxLayoutGap.lt-lg","5px"],["name","yt","type","text","trim","","zControl","",3,"ngModelChange","ngModel"],["fxHide.lt-lg","","fxLayout","column",1,"form-input"],[3,"outPutObject","object","key","maxWidth","maxHeight"],["fxLayout","row","fxLayoutGap","10px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"],[3,"innerHTML"],["name","code","type","text","trim","","upperCase","","noEspace","","required","","zControl","",3,"ngModelChange","ngModel","disabled"]],template:function(e,i){if(e&1&&(m(0,"div",2)(1,"div",3)(2,"span"),d(3),s(),m(4,"span"),d(5),s()(),b(6,hr,1,1,"ng-template",4),f(7,"async"),b(8,vr,26,20,"ng-template",null,0,Z),s()),e&2){let r=U(9);l(3),y("",i.timbreBlocModel!=null&&i.timbreBlocModel.getId()?"MODIFICATION":"AJOUT"," BLOC "),l(2),vt(i.timbreBlocModel==null?null:i.timbreBlocModel.getId()),l(),a("ngIf",g(7,4,i.load$)==!1)("ngIfElse",r)}},dependencies:[ie,Je,pe,V,ge,De,he,_e,Re,He,fe,Ue,We,ze,ee,Oe,Ye,Ze,Ke,Qe,Ge,te,Ne,it,ne,si,tt,At,rt,ot,Ei,Dt,P],encapsulation:2})};function Cr(n,t){n&1&&M(0,"lib-spinner",5),n&2&&a("textSpec","Suppression en cours")}function Mr(n,t){if(n&1){let e=w();m(0,"form",6,1),S("ngSubmit",function(){_(e);let r=U(1),o=p();return h(o.valider(r))}),m(2,"div",7)(3,"div",8)(4,"input",9),$("ngModelChange",function(r){_(e);let o=p();return j(o.annee,r)||(o.annee=r),h(r)}),s()(),m(5,"button",10),S("click",function(){_(e);let r=p();return h(r.close())}),d(6," Annuler "),s(),m(7,"button",11),d(8," Supprimer "),s()()()}if(n&2){let e=U(1),i=p();a("ngClass",e!=null&&e.submitted?"red-color":"blue-color"),l(4),q("ngModel",i.annee),a("max",i.maxAnnee)("zMax",i.maxAnnee)}}var Wt=class n{constructor(t,e,i){this.dialog=t;this.dialogRef=e;this.timbreSupprimService=i}maxAnnee=new Date().getFullYear();annee=new Date().getFullYear();valider(t){if(t?.valid){let e=this.dialog.open(Rt,{maxHeight:"95vh",data:{titre:"Confirmation",message:"Souhaitez-vous supprimer les timbres ?",btnDroite:"Oui",btnGauche:"Non"}});e.afterClosed().subscribe(()=>{e.componentInstance.data.resultat==="valider"&&(this.timbreSupprimService.loadGlob$.next(!1),this.timbreSupprimService.supprimerTimbres(this.annee),this.timbreSupprimService.load$.pipe(v(i=>i==!0)).subscribe(i=>{this.timbreSupprimService.supprimerBlocs(this.annee),this.timbreSupprimService.load$.pipe(v(r=>r==!0)).subscribe(r=>{this.timbreSupprimService.loadGlob$.next(!0)})}))})}}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||n)(C(ve),C(xe),C(qe))};static \u0275cmp=F({type:n,selectors:[["app-timbre-supprim-choix-annee"]],decls:8,vars:4,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],[3,"ngIf","ngIfElse"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","start stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","row","fxLayoutGap","20px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["fxLayout","column","fxFlex","20","fxLayoutAlign","end end",1,"form-input","noError"],["name","annee","type","number","minlength","4","maxlength","4","min","1900","zMin","1900","required","","zControl","",2,"width","60px !important",3,"ngModelChange","ngModel","max","zMax"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"]],template:function(e,i){if(e&1&&(m(0,"div",2)(1,"div",3)(2,"span"),d(3,"TIMBRE IMPORTER"),s()(),b(4,Cr,1,1,"ng-template",4),f(5,"async"),b(6,Mr,9,4,"ng-template",null,0,Z),s()),e&2){let r=U(7);l(4),a("ngIf",g(5,2,i.timbreSupprimService.loadGlob$)==!1)("ngIfElse",r)}},dependencies:[ie,pe,V,ge,De,he,_e,Re,fe,Ue,We,ze,ee,Oe,Ye,Ze,Ke,Qe,Ge,te,Ne,ne,tt,rt,ot,P],encapsulation:2})};var Sr=n=>[n];function yr(n,t){if(n&1){let e=w();m(0,"lib-icon",2),S("click",function(){_(e);let r=p();return h(r.supprimer())}),s()}if(n&2){let e=p();a("icone",e.FontAwesomeEnum.ROTATE)("type",e.FontAwesomeTypeEnum.TYPE_SOLID)("attribs",st(4,Sr,e.FontAwesomeAttributEnum.SPIN))("info","Supprimer en cours")}}function Br(n,t){if(n&1){let e=w();m(0,"lib-icon",3),S("click",function(){_(e);let r=p();return h(r.supprimer())}),s()}if(n&2){let e=p();a("icone",e.FontAwesomeEnum.TRASH)("type",e.FontAwesomeTypeEnum.TYPE_SOLID)("info","Supprimer les timbres")}}var zt=class n{constructor(t,e){this.dialog=t;this.timbreSupprimService=e}FontAwesomeEnum=be;FontAwesomeTypeEnum=de;FontAwesomeAttributEnum=ni;supprimer(){this.dialog.open(Wt,{maxHeight:"50vh",width:"300px"})}static \u0275fac=function(e){return new(e||n)(C(ve),C(qe))};static \u0275cmp=F({type:n,selectors:[["app-timbre-supprim"]],decls:4,vars:6,consts:[["class","warn click","style","font-size: 2em",3,"icone","type","attribs","info","click",4,"ngIf"],["class","warn click","style","font-size: 2em",3,"icone","type","info","click",4,"ngIf"],[1,"warn","click",2,"font-size","2em",3,"click","icone","type","attribs","info"],[1,"warn","click",2,"font-size","2em",3,"click","icone","type","info"]],template:function(e,i){e&1&&(b(0,yr,1,6,"lib-icon",0),f(1,"async"),b(2,Br,1,3,"lib-icon",1),f(3,"async")),e&2&&(a("ngIf",g(1,2,i.timbreSupprimService.loadGlob$)==!1),l(2),a("ngIf",g(3,4,i.timbreSupprimService.loadGlob$)==!0))},dependencies:[V,Me,P],encapsulation:2})};function wr(n,t){if(n&1){let e=w();m(0,"button",9),S("click",function(){_(e);let r=p(2);return h(r.ajouter())}),d(1," Ajouter "),s()}}function Er(n,t){n&1&&(O(0),d(1,"\xA0Bloc"),N())}function Ar(n,t){if(n&1){let e=w();O(0),b(1,wr,2,0,"button",8),f(2,"async"),m(3,"button",9),S("click",function(){_(e);let r=p();return h(r.ajouterBloc())}),d(4," Ajouter "),b(5,Er,2,0,"ng-container",3),f(6,"async"),s(),N()}if(n&2){let e=p();l(),a("ngIf",g(2,2,e.headerService.route$)==e.RouteEnum.TIMBRE),l(4),a("ngIf",g(6,4,e.headerService.route$)==e.RouteEnum.TIMBRE)}}function Dr(n,t){if(n&1){let e=w();O(0),m(1,"lib-icon",11),S("click",function(){let r=_(e).$implicit,o=p(2);return h(o.headerService.setRoute(r.getRoute()))}),s(),N()}if(n&2){let e=t.$implicit;l(),a("icone",e==null?null:e.getIcone())("type",e==null?null:e.getType())("info",e==null?null:e.getInfo())}}function Rr(n,t){if(n&1&&(O(0),b(1,Dr,2,3,"ng-container",10),f(2,"async"),N()),n&2){let e=p();l(),a("ngForOf",g(2,1,e.headerService.choixRoutesTimbre$))}}function Or(n,t){if(n&1){let e=w();m(0,"lib-icon",13),S("click",function(){_(e);let r=p(2);return h(r.timbreService.mode=r.ModeEnum.TABLE)}),s()}if(n&2){let e=p(2);a("icone",e.FontAwesomeEnum.TABLE)("type",e.FontAwesomeTypeEnum.TYPE_SOLID)("info","Mode tableau")}}function Nr(n,t){if(n&1){let e=w();m(0,"lib-icon",13),S("click",function(){_(e);let r=p(2);return h(r.timbreService.mode=r.ModeEnum.GRAPH)}),s()}if(n&2){let e=p(2);a("icone",e.FontAwesomeEnum.MEMO)("type",e.FontAwesomeTypeEnum.TYPE_SOLID)("info","Mode tableau")}}function Ur(n,t){if(n&1&&(O(0),b(1,Or,1,3,"ng-template",12)(2,Nr,1,3,"ng-template",null,0,Z),N()),n&2){let e=U(3),i=p();l(),a("ngIf",i.timbreService.mode==i.ModeEnum.GRAPH)("ngIfElse",e)}}function Lr(n,t){if(n&1){let e=w();m(0,"lib-icon",14),S("click",function(){_(e);let r=p();return h(r.importer())}),s()}if(n&2){let e=p();a("icone",e.FontAwesomeEnum.UPLOAD)("type",e.FontAwesomeTypeEnum.TYPE_SOLID)("info","Importer les timbres")}}function Fr(n,t){n&1&&M(0,"app-timbre-supprim",15)}function qr(n,t){if(n&1&&(m(0,"mat-option",19),d(1),s()),n&2){let e=t.$implicit;a("value",e),l(),y(" ",e==null?null:e.getPrenom()," ")}}function jr(n,t){if(n&1){let e=w();m(0,"div",16)(1,"mat-select",17),f(2,"async"),S("ngModelChange",function(r){_(e);let o=p();return h(o.setUser(r))}),b(3,qr,2,2,"mat-option",18),f(4,"async"),s()()}if(n&2){let e=p();l(),a("ngModel",g(2,3,e.authService.userSelect$))("placeholder","Utilisateur"),l(2),a("ngForOf",g(4,5,e.authService.users$))}}var $i=class n{constructor(t,e,i,r,o,u){this.authService=t;this.headerService=e;this.timbreService=i;this.timbreBlocService=r;this.timbreUtilsService=o;this.dialog=u}FontAwesomeEnum=be;RouteEnum=ii;FontAwesomeTypeEnum=de;DroitEnum=Gt;ajouter(){let t=this.dialog.open(at,{maxHeight:"95vh",width:"30%"});t.afterClosed().subscribe(()=>{t.close()})}ajouterBloc(){let t=this.dialog.open(Ht,{maxHeight:"95vh",width:"30%"});t.afterClosed().subscribe(()=>{t.close()})}ajouterBouchon(){this.timbreService.ajouterSansId(this.timbreService.getBouchon())}importer(){let t=this.dialog.open(kt,{height:"90vh",width:"70%"});t.afterClosed().subscribe(()=>{t.close()})}setUser(t){this.authService.userSelect$.next(t),window.location.href.indexOf("bloc")>0?c(this.timbreUtilsService.timbreCritereBlocModel.getAnnees())&&this.timbreUtilsService.timbreCritereBlocModel.getAnnees().length>0?this.timbreBlocService.getBlocs(this.timbreUtilsService.timbreCritereBlocModel):this.timbreUtilsService.getAnneesAsync("/timbres_bloc").pipe(v(e=>c(e)&&e?.length>0)).subscribe(e=>{this.timbreUtilsService.timbreCritereBlocModel.setAnnees([e[0]]),this.timbreBlocService.getBlocs(this.timbreUtilsService.timbreCritereBlocModel)}):c(this.timbreUtilsService.timbreCritereModel.getAnnees())&&this.timbreUtilsService.timbreCritereModel.getAnnees().length>0?this.timbreService.getTimbres(this.timbreUtilsService.timbreCritereModel):this.timbreUtilsService.getAnneesAsync("/timbres").pipe(v(e=>c(e)&&e?.length>0)).subscribe(e=>{this.timbreUtilsService.timbreCritereModel.setAnnees([e[0]]),this.timbreService.getTimbres(this.timbreUtilsService.timbreCritereModel)}),this.timbreUtilsService.reinitResume$.next(!0)}ModeEnum=Nt;static \u0275fac=function(e){return new(e||n)(C(X),C(ri),C(z),C(K),C(W),C(ve))};static \u0275cmp=F({type:n,selectors:[["app-menu"]],decls:20,vars:28,consts:[["modeTable",""],[1,"menu"],[1,"sousMenu","sousMenuBouton"],[4,"ngIf"],[1,"sousMenu"],["class","accent click hide-on-mobile","style","font-size: 2em",3,"icone","type","info","click",4,"ngIf"],["class","hide-on-mobile",4,"ngIf"],["fxLayout","row","fxLayoutAlign","end center","class","form-input select","style","width: 120px",4,"ngIf"],["class","rounded large color-white","mat-raised-button","","color","primary",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],[4,"ngFor","ngForOf"],[1,"primary","click",2,"font-size","2em",3,"click","icone","type","info"],[3,"ngIf","ngIfElse"],[1,"primary","click","hide-on-mobile",2,"font-size","2em",3,"click","icone","type","info"],[1,"accent","click","hide-on-mobile",2,"font-size","2em",3,"click","icone","type","info"],[1,"hide-on-mobile"],["fxLayout","row","fxLayoutAlign","end center",1,"form-input","select",2,"width","120px"],["name","user",1,"scrollBarAccent",3,"ngModelChange","ngModel","placeholder"],["class","selectMin",3,"value",4,"ngFor","ngForOf"],[1,"selectMin",3,"value"]],template:function(e,i){if(e&1&&(m(0,"div",1)(1,"div",2),b(2,Ar,7,6,"ng-container",3),f(3,"async"),s(),m(4,"div",4),b(5,Rr,3,3,"ng-container",3),f(6,"async"),b(7,Ur,4,2,"ng-container",3),f(8,"async"),f(9,"async"),b(10,Lr,1,3,"lib-icon",5),f(11,"async"),f(12,"async"),b(13,Fr,1,0,"app-timbre-supprim",6),f(14,"async"),f(15,"async"),b(16,jr,5,7,"div",7),f(17,"async"),f(18,"async"),f(19,"async"),s()()),e&2){let r,o,u,T,x,A;l(2),a("ngIf",((r=g(3,6,i.authService.user$))==null?null:r.getDroit())==i.DroitEnum.TOTAL),l(3),a("ngIf",((o=g(6,8,i.headerService.choixRoutesTimbre$))==null?null:o.length)>0),l(2),a("ngIf",((u=g(8,10,i.authService.user$))==null?null:u.getDroit())==i.DroitEnum.TOTAL&&g(9,12,i.headerService.route$)==i.RouteEnum.TIMBRE),l(3),a("ngIf",((T=g(11,14,i.authService.user$))==null?null:T.getDroit())==i.DroitEnum.TOTAL&&g(12,16,i.headerService.route$)==i.RouteEnum.TIMBRE),l(3),a("ngIf",((x=g(14,18,i.authService.user$))==null?null:x.getDroit())==i.DroitEnum.TOTAL&&g(15,20,i.headerService.route$)==i.RouteEnum.TIMBRE),l(3),a("ngIf",(((A=g(17,22,i.authService.user$))==null?null:A.getDroit())==i.DroitEnum.TOTAL||((A=g(18,24,i.authService.user$))==null?null:A.getDroit())==i.DroitEnum.CONSULT_TOTAL)&&((A=g(19,26,i.authService.users$))==null?null:A.length)>0)}},dependencies:[ue,V,ge,he,ee,te,Me,ie,zt,Te,Ce,P],styles:[".menu[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:10px;padding:0 5px}.menu[_ngcontent-%COMP%]   .sousMenu[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:15px}@media screen and (max-width: 800px){.menu[_ngcontent-%COMP%]{flex-direction:column}.menu[_ngcontent-%COMP%]   .sousMenuBouton[_ngcontent-%COMP%]{justify-content:space-between}.menu[_ngcontent-%COMP%]   button.large[_ngcontent-%COMP%]{width:170px}.menu[_ngcontent-%COMP%]   .sousMenu[_ngcontent-%COMP%]{gap:10px}}"]})};export{H as a,Nt as b,Y as c,oe as d,W as e,K as f,z as g,at as h,Ht as i,$t as j,Ut as k,Ft as l,Vt as m,Pt as n,kt as o,$i as p,Ri as q};

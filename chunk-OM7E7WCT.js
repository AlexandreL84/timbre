import{a as ge,b as Ee,c as tt,d as ie,e as Nt,f as it,g as nt,h as Ft,i as Ci,j as qi,k as Mi,l as qt,m as ji,n as jt}from"./chunk-O2FA5LZO.js";import{z as Ut}from"./chunk-QT6IHMGS.js";import{a as ui,d as Je,e as te,f as Ti,h as Ie}from"./chunk-Z7E3CHHZ.js";import{a as qe}from"./chunk-HQOHRCUN.js";import{$a as ri,A as g,Aa as _e,Ab as J,Ac as yt,Ba as he,Bb as ue,Bc as wt,Ca as k,Cb as ai,Cc as fi,Db as Tt,Dc as Bt,Eb as Pe,Ec as It,Fa as P,Fc as gi,Ga as xt,Gc as Et,Hb as de,Hc as At,I as Fe,Ia as oi,Ib as Me,Ic as _i,J as ct,Jb as ve,Jc as Dt,K as l,Kb as be,Kc as Rt,L as v,Lb as Se,Lc as hi,Mb as $e,Mc as Ot,Nb as He,Nc as Ke,Ob as We,Oc as xi,Pb as ze,Pc as et,Q as b,Qb as Qe,Qc as Lt,R as s,Rb as Ge,Sb as Ct,Tb as si,Ub as Ye,Vb as ci,W as m,Wb as pi,X as a,Xb as Mt,Y as _,Z as A,_ as D,aa as w,ab as p,ba as C,bb as re,c as E,ca as c,da as ti,ea as ae,f as le,fa as se,fb as I,g as W,ga as ce,gb as xe,ha as O,hb as Re,hc as Ze,ia as d,ic as ee,ja as _t,jc as di,ka as S,kc as fe,l as M,la as ii,m as bt,ma as U,mc as ye,na as N,oa as F,ob as Te,p as me,pb as je,q as ft,qb as Ve,ra as ht,rb as li,rc as bi,s as L,sa as ni,sb as mi,sc as Xe,tb as Ce,u as V,ua as x,ub as ke,v as gt,va as T,vc as we,wa as Q,wb as X,xb as K,xc as Be,yb as pe,yc as vt,z as f,zc as St}from"./chunk-3WA7KK2Z.js";import{g as ei,i as B}from"./chunk-GV7GV3NK.js";var $=class extends xe{annees;acquis;doublon;idBloc;bloc;carnet;getAnnees(){return this.annees}setAnnees(t){this.annees=t}getAcquis(){return this.acquis}setAcquis(t){this.acquis=t}getDoublon(){return this.doublon}setDoublon(t){this.doublon=t}getIdBloc(){return this.idBloc}setIdBloc(t){this.idBloc=t}getCarnet(){return this.carnet}setCarnet(t){this.carnet=t}getBloc(){return this.bloc}setBloc(t){this.bloc=t}};B([I("Ann\xE9e")],$.prototype,"annees",2),B([I("Acquis")],$.prototype,"acquis",2),B([I("Doublon")],$.prototype,"doublon",2),B([I("Ident bloc")],$.prototype,"idBloc",2),B([I("Bloc")],$.prototype,"bloc",2),B([I("Carnet")],$.prototype,"carnet",2);var z=class extends xe{idUser;idTimbre;acquis;doublon;constructor(t,e,i,o){super(),this.idUser=t||null,this.idTimbre=e||null,this.acquis=i||!1,this.doublon=o||!1}getIdUser(){return this.idUser}setIdUser(t){this.idUser=t}getIdTimbre(){return this.idTimbre}setIdTimbre(t){this.idTimbre=t}isAcquis(){return this.acquis}setAcquis(t){this.acquis=t}isDoublon(){return this.doublon}setDoublon(t){this.doublon=t}};B([I("Identifiant Utilisateur")],z.prototype,"idUser",2),B([I("Identifiant timbre")],z.prototype,"idTimbre",2),B([I("Acquis")],z.prototype,"acquis",2),B([I("Doublon")],z.prototype,"doublon",2);var G=class n{constructor(t){this.firestore=t}timbreCritereModel=new $;getAnneesAsync(t){return this.firestore.collection(t,e=>{let i=e;return i=i.orderBy("annee","desc"),i}).valueChanges().pipe(le(e=>{let i=e.map(o=>Number(o.annee)).filter(o=>p(o)&&o!=0);return Array.from(new Set(i))}))}getTimbresByCritereAsync(t){return this.getAllTimbres(t).pipe(le(e=>this.constructTimbres(e,null,null)))}getAllTimbres(t){return this.firestore.collection("/timbres",e=>{let i=e;return p(t)&&(p(t.getAnnees())&&t.getAnnees()?.length>0&&(i=i.where("annee","in",t.getAnnees())),p(t.getBloc())&&t.getBloc()!="TOUS"?i=i.where("idBloc",t.getBloc()!="OUI"?"==":"!=",null):p(t.getIdBloc())&&(i=i.where("idBloc","==",t.getIdBloc()))),i=i.orderBy("id","asc"),i}).valueChanges()}constructTimbres(t,e,i,o){let r=[];return t?.length>0&&t.forEach(u=>{let h=this.constructTimbre(u,e,i),y=!0;p(o)&&p(h.getTimbreAcquisModel())&&(p(o.getAcquis())&&!(o.getAcquis()=="TOUS"||o.getAcquis()=="OUI"&&h.getTimbreAcquisModel().isAcquis()||o.getAcquis()=="NON"&&!h.getTimbreAcquisModel().isAcquis())&&(y=!1),p(o.getDoublon())&&!(o.getDoublon()=="TOUS"||o.getDoublon()=="OUI"&&h.getTimbreAcquisModel().isDoublon()||o.getDoublon()=="NON"&&!h.getTimbreAcquisModel().isDoublon())&&(y=!1)),y==!0&&r.push(h)}),r}constructTimbre(t,e,i){let o=Re(ge,t);if(p(i)){let r=i.find(u=>u.getId()==o?.getIdBloc());p(r)&&o.setTimbreBlocModel(r)}if(p(e)){let r=e.find(u=>u.idTimbre==o.getId());p(r)?o.setTimbreAcquisModel(Re(z,r)):o.setTimbreAcquisModel(new z)}return o}supprimerTimbreAcquis(t,e){p(t?.getTimbreAcquisModel()?.getIdUser())&&this.firestore.collection("/timbres_acquis").ref.where("idTimbre","==",t.getId()).where("idUser","==",e).get().then(i=>{i.forEach(o=>{o.ref.delete()})})}supprimerTimbre(t){this.firestore.collection("/timbres").ref.where("id","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.delete()})}).catch(e=>{console.error("Erreur de suppression :",e)})}static \u0275fac=function(e){return new(e||n)(L(Te))};static \u0275prov=me({token:n,factory:n.\u0275fac})};var ne=class extends xe{idUser;idBloc;acquis;doublon;constructor(t,e,i,o){super(),this.idUser=t||null,this.idBloc=e||null,this.acquis=i||!1,this.doublon=o||!1}getIdUser(){return this.idUser}setIdUser(t){this.idUser=t}getIdBloc(){return this.idBloc}setIdBloc(t){this.idBloc=t}isAcquis(){return this.acquis}setAcquis(t){this.acquis=t}isDoublon(){return this.doublon}setDoublon(t){this.doublon=t}};B([I("Identifiant Utilisateur")],ne.prototype,"idUser",2),B([I("Identifiant bloc")],ne.prototype,"idBloc",2),B([I("Acquis")],ne.prototype,"acquis",2),B([I("Doublon")],ne.prototype,"doublon",2);var oe=class n{constructor(t,e,i,o,r){this.firestore=t;this.authService=e;this.uploadService=i;this.utilsService=o;this.timbreUtilsService=r}heigthTable=50;widthTimbre=100;heightTimbre=100;widthTimbreZoom=500;heightTimbreZoom=500;total$=new E(0);totalCarnet$=new E(0);timbresBlocModel$=new E(null);upload(t,e,i){let o=this.widthTimbre,r=this.heightTimbre;return e=="table"?(o=o*(this.heigthTable/r),r=this.heigthTable):e=="zoom"&&(o=o*(this.heightTimbreZoom/r),r=this.heightTimbreZoom),this.uploadService.processAndUploadImage(t?.getImage(),o,r,"bloc-"+t.getId(),this.getDossier(t,e,i))}getTotal(t){this.total$.next(null),this.totalCarnet$.next(null),this.getAllBlocs(t).pipe(M(e=>p(e)&&e?.length>0)).subscribe(e=>{this.total$.next(e?.filter(i=>!i.carnet)?.length),this.totalCarnet$.next(e?.filter(i=>i.carnet)?.length)})}getBloc(t){return this.firestore.collection("/timbres_bloc",e=>e.where("id","==",t)).valueChanges()}getBlocByIdAsync(t){return this.getBloc(t).pipe(le(e=>Re(Ee,e[0])))}getAllBlocs(t){return this.firestore.collection("/timbres_bloc",e=>{let i=e;return p(t)&&(p(t.getAnnees())&&t.getAnnees()?.length>0&&(i=i.where("annee","in",t.getAnnees())),p(t.getCarnet())&&t.getCarnet()!="TOUS"&&(i=i.where("carnet",t.getCarnet()!="OUI"?"==":"!=",null))),i}).valueChanges()}getTimbreBlocAcquis(){return this.authService.getUser().pipe(M(),bt(t=>p(t)?this.getTimbreBlocAcquisByUser(t.getId()).pipe(M(),le(e=>e)):null))}getTimbreBlocAcquisByUser(t){return this.firestore.collection("/timbres_bloc_acquis",e=>e.where("idUser","==",t)).valueChanges()}getBlocs(t){this.timbresBlocModel$.next(null),W([this.getAllBlocs(t),this.getTimbreBlocAcquis()]).pipe(M()).subscribe(([e,i])=>{this.constructBlocs(e,i,t),this.getTotal()})}getBlocsAsync(t){return this.timbresBlocModel$.next(null),this.getAllBlocs(t).pipe(M(),le(e=>this.constructBlocs(e,null,t)))}constructBloc(t,e){let i=Re(Ee,t);if(p(e)){let o=e.find(r=>r.idBloc==i.getId());p(o)?i.setTimbreBlocAcquisModel(Re(ne,o)):i.setTimbreBlocAcquisModel(new ne)}return i}constructBlocs(t,e,i){let o=[];return t?.length>0&&t.forEach(r=>{let u=this.constructBloc(r,e);this.getTimbresByBlocAsync(u.getId()).subscribe(y=>{u.setNbTimbres(y?.length)});let h=!0;p(i)&&p(u.getTimbreBlocAcquisModel())&&(p(i.getAcquis())&&!(i.getAcquis()=="TOUS"||i.getAcquis()=="OUI"&&u.getTimbreBlocAcquisModel().isAcquis()||i.getAcquis()=="NON"&&!u.getTimbreBlocAcquisModel().isAcquis())&&(h=!1),p(i.getDoublon())&&!(i.getDoublon()=="TOUS"||i.getDoublon()=="OUI"&&u.getTimbreBlocAcquisModel().isDoublon()||i.getDoublon()=="NON"&&!u.getTimbreBlocAcquisModel().isDoublon())&&(h=!1)),h==!0&&o.push(u)}),this.timbresBlocModel$.next(o),o}acquis(t,e){return this.authService.getUser().pipe(M(i=>p(i))).subscribe(i=>{p(t?.getTimbreBlocAcquisModel()?.getIdUser())?this.firestore.collection("/timbres_bloc_acquis").ref.where("idTimbre","==",t.getId()).where("idUser","==",i.getId()).get().then(o=>{o.forEach(r=>{let u=t.getTimbreBlocAcquisModel();e?(u.setAcquis(!0),u.setDoublon(!u.isDoublon())):(u.setAcquis(!u.isAcquis()),u.isAcquis()||u.setDoublon(!1)),r.ref.update(Object.assign(new Object,u))})}).catch(o=>{console.error("Erreur de mise \xE0 jour:",o)}):this.addAcquis(i?.getId(),t,e)})}addAcquis(t,e,i){let o=new ne;o.setIdUser(t),o.setIdBloc(e.getId()),o.setAcquis(!0),o.setDoublon(i),e.setTimbreBlocAcquisModel(o),this.firestore.collection("/timbres_bloc_acquis").add(Object.assign(new Object,o))}ajouterSansId(t){this.utilsService.getMaxIdentAsync("/timbres_bloc").pipe(M()).subscribe(e=>{t.setId(e),this.ajouter(t,!0)})}ajouter(t,e){this.getBloc(t.getId()).pipe(M()).subscribe(i=>{re(i)||re(i[0])||p(i[0])&&i[0]?.length==0?(t.setTimbreBlocAcquisModel(null),this.firestore.collection("/timbres_bloc").add(Object.assign(new Object,t)),e&&this.getBlocs()):console.error("bloc "+t.getId()+" d\xE9j\xE0 existant")})}modifier(t){this.firestore.collection("/timbres_bloc").ref.where("id","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.update(Object.assign(new Object,t)),this.getBlocs()})}).catch(e=>{console.error("Erreur de mise \xE0 jour:",e)})}getTimbresByBlocAsync(t){let e=new $;return e.setIdBloc(t),this.timbreUtilsService.getTimbresByCritereAsync(e)}supprimer(t){this.authService.getUser().pipe(M(e=>p(e))).subscribe(e=>{this.getTimbresByBlocAsync(t.getId()).pipe(M()).subscribe(i=>{i.forEach(o=>{this.timbreUtilsService.supprimerTimbreAcquis(o,e.getId()),this.timbreUtilsService.supprimerTimbre(o)})}),p(t?.getTimbreBlocAcquisModel()?.getIdUser())&&this.firestore.collection("/timbres_bloc_acquis").ref.where("idBloc","==",t.getId()).where("idUser","==",e.getId()).get().then(i=>{i.forEach(o=>{o.ref.delete()})}),this.firestore.collection("/timbres_bloc").ref.where("id","==",t.getId()).get().then(i=>{i.forEach(o=>{o.ref.delete(),this.getBlocs()})}).catch(i=>{console.error("Erreur de suppression :",i)})})}getDossier(t,e,i){let o="timbre//"+t.getAnnee();return p(e)&&(o=o+"/"+e),o=o+"/bloc/"+(p(i)?i:t.getId()),o}getBouchon(){let t=new Ee;return t.setAnnee(new Date().getFullYear()),t.setMonnaie("E"),t}static \u0275fac=function(e){return new(e||n)(L(Te),L(qe),L(tt),L(ie),L(G))};static \u0275prov=me({token:n,factory:n.\u0275fac})};var H=class n{constructor(t,e,i,o,r,u){this.firestore=t;this.authService=e;this.timbreBlocService=i;this.uploadService=o;this.utilsService=r;this.timbreUtilsService=u}heigthTable=50;widthTimbre=100;heightTimbre=100;widthTimbreZoom=500;heightTimbreZoom=500;total$=new E(0);timbres$=new E(null);getTimbre(t){return this.firestore.collection("/timbres",e=>e.where("id","==",t)).valueChanges()}getTimbreByIdAsync(t){return W([this.getTimbre(t),this.timbreBlocService.getBlocsAsync()]).pipe(le(([e,i])=>this.timbreUtilsService.constructTimbre(e[0],null,i)))}getTotal(t){this.total$.next(null),this.timbreUtilsService.getAllTimbres(t).pipe(M()).subscribe(e=>{this.total$.next(e?.length)})}getTimbres(t){this.timbres$.next(null),W([this.timbreUtilsService.getAllTimbres(t),this.getTimbreAcquis(),this.timbreBlocService.getBlocsAsync(t)]).pipe(M()).subscribe(([e,i,o])=>{this.timbres$.next(this.timbreUtilsService.constructTimbres(e,i,o,t)),this.getTotal()})}getTimbreAcquis(){return this.authService.getUser().pipe(M(),bt(t=>p(t)?this.getTimbreAcquisByUser(t.getId()).pipe(M(),le(e=>e)):null))}getTimbreAcquisByUser(t){return this.firestore.collection("/timbres_acquis",e=>e.where("idUser","==",t)).valueChanges()}acquis(t,e){return this.authService.getUser().pipe(M(i=>p(i))).subscribe(i=>{p(t?.getTimbreAcquisModel()?.getIdUser())?this.firestore.collection("/timbres_acquis").ref.where("idTimbre","==",t.getId()).where("idUser","==",i.getId()).get().then(o=>{o.forEach(r=>{let u=t.getTimbreAcquisModel();e?(u.setAcquis(!0),u.setDoublon(!u.isDoublon())):(u.setAcquis(!u.isAcquis()),u.isAcquis()||u.setDoublon(!1)),r.ref.update(Object.assign(new Object,u))})}).catch(o=>{console.error("Erreur de mise \xE0 jour:",o)}):this.addAcquis(i?.getId(),t,e)})}addAcquis(t,e,i){let o=new z;o.setIdUser(t),o.setIdTimbre(e.getId()),o.setAcquis(!0),o.setDoublon(i),e.setTimbreAcquisModel(o),this.firestore.collection("/timbres_acquis").add(Object.assign(new Object,o))}ajouterSansId(t){this.utilsService.getMaxIdentAsync("/timbres").pipe(M()).subscribe(e=>{t.setId(e),p(t.getIdBloc())&&t.setMonnaie(null),this.ajouter(t,!0)})}ajouter(t,e){this.getTimbre(t.getId()).pipe(M()).subscribe(i=>{re(i)||re(i[0])||p(i[0])&&i[0]?.length==0?(t.setTimbreAcquisModel(null),t.setTimbreBlocModel(null),this.firestore.collection("/timbres").add(Object.assign(new Object,t)),e&&this.getTimbres()):console.error("timbre "+t.getId()+" d\xE9j\xE0 existant")})}modifier(t){t.setTimbreBlocModel(null),t.setTimbreAcquisModel(null),this.firestore.collection("/timbres").ref.where("id","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.update(Object.assign(new Object,t)),this.getTimbres()})}).catch(e=>{console.error("Erreur de mise \xE0 jour:",e)})}supprimerTimbre(t){this.firestore.collection("/timbres").ref.where("id","==",t.getId()).get().then(e=>{e.forEach(i=>{i.ref.delete(),this.getTimbres()})}).catch(e=>{console.error("Erreur de suppression :",e)})}supprimer(t){this.authService.getUser().pipe(M(e=>p(e))).subscribe(e=>{this.timbreUtilsService.supprimerTimbreAcquis(t,e.getId()),this.supprimerTimbre(t)})}getBouchon(){let t=new ge;return t.setAnnee(new Date().getFullYear()),t.setMonnaie("E"),t.setType(""),t.setYt(""),t}upload(t,e,i){let o=this.widthTimbre,r=this.heightTimbre;return e=="table"?(o=o*(this.heigthTable/r),r=this.heigthTable):e=="zoom"&&(o=o*(this.heightTimbreZoom/r),r=this.heightTimbreZoom),this.uploadService.processAndUploadImage(t?.getImage(),o,r,p(i)?i:t?.getId(),this.getDossier(t,e))}getDossier(t,e){let i="timbre//";return p(t.getIdBloc())?i=i+t.getTimbreBlocModel().getAnnee():i=i+t.getAnnee(),p(e)&&(i=i+"/"+e),p(t.getIdBloc())&&(i=i+"/bloc/"+t.getIdBloc()),i}static \u0275fac=function(e){return new(e||n)(L(Te),L(qe),L(oe),L(tt),L(ie),L(G))};static \u0275prov=me({token:n,factory:n.\u0275fac})};var q=class extends xe{annee;nombre;acquis;doublon;nombreCarnet;acquisCarnet;doublonCarnet;nombreBloc;acquisBloc;doublonBloc;constructor(t,e,i,o,r,u,h,y,R,Z){super(),this.annee=t||null,this.nombre=e||0,this.acquis=i||0,this.doublon=o||0,this.nombreCarnet=r||0,this.acquisCarnet=u||0,this.doublonCarnet=h||0,this.nombreBloc=y||0,this.acquisBloc=R||0,this.doublonBloc=Z||0}getAnnee(){return this.annee}setAnnee(t){this.annee=t}getNombre(){return this.nombre}setNombre(t){this.nombre=t}getAcquis(){return this.acquis}setAcquis(t){this.acquis=t}getDoublon(){return this.doublon}setDoublon(t){this.doublon=t}getNombreCarnet(){return this.nombreCarnet}setNombreCarnet(t){this.nombreCarnet=t}getAcquisCarnet(){return this.acquisCarnet}setAcquisCarnet(t){this.acquisCarnet=t}getDoublonCarnet(){return this.doublonCarnet}setDoublonCarnet(t){this.doublonCarnet=t}getNombreBloc(){return this.nombreBloc}setNombreBloc(t){this.nombreBloc=t}getAcquisBloc(){return this.acquisBloc}setAcquisBloc(t){this.acquisBloc=t}getDoublonBloc(){return this.doublonBloc}setDoublonBloc(t){this.doublonBloc=t}};B([I("Ann\xE9e")],q.prototype,"annee",2),B([I("Total")],q.prototype,"nombre",2),B([I("Acquis")],q.prototype,"acquis",2),B([I("Doublon")],q.prototype,"doublon",2),B([I("Total carnet")],q.prototype,"nombreCarnet",2),B([I("Acquis")],q.prototype,"acquisCarnet",2),B([I("Doublon")],q.prototype,"doublonCarnet",2),B([I("Total bloc")],q.prototype,"nombreBloc",2),B([I("Acquis")],q.prototype,"acquisBloc",2),B([I("Doublon")],q.prototype,"doublonBloc",2);var kt=class n{constructor(t,e,i){this.timbreService=t;this.timbreBlocService=e;this.timbreUtilsService=i}load$=new E(!1);timbresResume$=new E(null);totalTimbreResume$=new E(null);getResume(t){this.load$.next(!1),this.timbresResume$.next(null),this.totalTimbreResume$.next(null),W([this.timbreUtilsService.getAllTimbres(t),this.timbreService.getTimbreAcquis(),this.timbreBlocService.getAllBlocs(t),this.timbreBlocService.getTimbreBlocAcquis()]).pipe(M()).subscribe(([e,i,o,r])=>{this.timbresResume$.next(this.construct(e,i,o,r))})}construct(t,e,i,o){let r=[];if(t?.length>0&&(t.forEach(u=>{let h=u.annee;if(p(i)&&re(u.annee)&&p(u.idBloc)){let R=i.find(Z=>Z.id==u.idBloc);p(R)&&(h=R.annee)}let y=r.find(R=>R.getAnnee()==h);if(p(y)?y.setNombre(y.getNombre()+1):(y=new q,y.setAnnee(h),y.setNombre(1),r.push(y)),p(e)){let R=e.find(Z=>Z.idTimbre==u.id);p(R)&&(R.acquis==!0&&y.setAcquis(y.getAcquis()+1),R.doublon==!0&&y.setDoublon(y.getDoublon()+1))}}),i.forEach(u=>{let h=r.find(y=>y.getAnnee()==u.annee);if(re(h)&&(h=new q,h.setAnnee(u.annee),r.push(h)),u.carnet?h.setNombreCarnet(h.getNombreCarnet()+1):h.setNombreBloc(h.getNombreBloc()+1),p(o)){let y=o.find(R=>R.idBloc==u.id);p(y)&&(y.acquis==!0&&(u.carnet?h.setAcquisCarnet(h.getAcquisCarnet()+1):h.setAcquisBloc(h.getAcquisBloc()+1)),y.doublon==!0&&(u.carnet?h.setDoublonCarnet(h.getDoublonCarnet()+1):h.setDoublonBloc(h.getDoublonBloc()+1)))}})),p(r)&&r?.length>0){let u=new q;r.forEach(h=>{u.setNombre(u.getNombre()+h.getNombre()),u.setAcquis(u.getAcquis()+h.getAcquis()),u.setDoublon(u.getDoublon()+h.getDoublon()),u.setNombreCarnet(u.getNombreCarnet()+h.getNombreCarnet()),u.setNombreBloc(u.getNombreBloc()+h.getNombreBloc()),u.setAcquisBloc(u.getAcquisBloc()+h.getAcquisBloc()),u.setDoublonBloc(u.getDoublonBloc()+h.getDoublonBloc())}),this.totalTimbreResume$.next(u)}return this.load$.next(!0),r}static \u0275fac=function(e){return new(e||n)(L(H),L(oe),L(G))};static \u0275prov=me({token:n,factory:n.\u0275fac})};var Ae=class n{constructor(t){this.firestore=t}loadGlob$=new E(!0);load$=new E(!0);supprimer(t,e){return this.load$.next(!1),this.firestore.collection(t).valueChanges().pipe(M()).subscribe(i=>{p(i)&&i?.length>0?(console.log(i),i.forEach((o,r)=>{this.firestore.collection(t).ref.where(e,"==",o[e]).get().then(u=>{u.forEach(h=>{console.log(h.ref),h.ref.delete(),r==i.length-1&&this.load$.next(!0)})}).catch(u=>{console.error("Erreur de suppression :",u)})})):this.load$.next(!0)})}supprimerTimbres(t){this.load$.next(!1),this.firestore.collection("/timbres",e=>{let i=e;return i=i.where("annee","==",t),i}).valueChanges().pipe(M()).subscribe(e=>{p(e)&&e?.length>0?(console.log(e),e.forEach((i,o)=>{this.firestore.collection("/timbres").ref.where("id","==",i.id).get().then(r=>{r.forEach(u=>{console.log(u.ref),this.supprimerAcquis(i.id),u.ref.delete(),o==e.length-1&&this.load$.next(!0)})}).catch(r=>{console.error("Erreur de suppression :",r)})})):this.load$.next(!0)})}supprimerAcquis(t){this.load$.next(!1),this.firestore.collection("/timbres_acquis",e=>{let i=e;return i=i.where("idTimbre","==",t),i}).valueChanges().pipe(M()).subscribe(e=>{p(e)&&e?.length>0?(console.log(e),e.forEach((i,o)=>{this.firestore.collection("/timbres_acquis").ref.where("idTimbre","==",i.idTimbre).get().then(r=>{r.forEach(u=>{console.log(u.ref),u.ref.delete(),o==e.length-1&&this.load$.next(!0)})}).catch(r=>{console.error("Erreur de suppression :",r)})})):this.load$.next(!0)})}supprimerBlocs(t){this.load$.next(!1),this.firestore.collection("/timbres_bloc",e=>{let i=e;return i=i.where("annee","==",t),i}).valueChanges().pipe(M()).subscribe(e=>{p(e)&&e?.length>0?(console.log(e),e.forEach((i,o)=>{this.firestore.collection("/timbres_bloc").ref.where("id","==",i.id).get().then(r=>{r.forEach(u=>{console.log(u.ref),this.supprimerBlocsAcquis(i.id),u.ref.delete(),o==e.length-1&&this.load$.next(!0)})}).catch(r=>{console.error("Erreur de suppression :",r)})})):this.load$.next(!0)})}supprimerBlocsAcquis(t){this.load$.next(!1),this.firestore.collection("/timbres_bloc_acquis",e=>{let i=e;return i=i.where("idBloc","==",t),i}).valueChanges().pipe(M()).subscribe(e=>{p(e)&&e?.length>0?(console.log(e),e.forEach((i,o)=>{this.firestore.collection("/timbres_bloc_acquis").ref.where("id","==",i.id).get().then(r=>{r.forEach(u=>{console.log(u.ref),u.ref.delete(),o==e.length-1&&this.load$.next(!0)})}).catch(r=>{console.error("Erreur de suppression :",r)})})):this.load$.next(!0)})}static \u0275fac=function(e){return new(e||n)(L(Te))};static \u0275prov=me({token:n,factory:n.\u0275fac})};var Pt=class n{static \u0275fac=function(e){return new(e||n)};static \u0275mod=gt({type:n});static \u0275inj=ft({providers:[Ae,oi()],imports:[xi,xt,ai,Tt,Ct,Ti,Lt,Mt]})};var wi=class n{static \u0275fac=function(e){return new(e||n)};static \u0275mod=gt({type:n});static \u0275inj=ft({providers:[H],imports:[xt,Tt,Ct,ci,pi,Mt,si,bi,di,Lt,ee,Pt]})};var Hi=()=>[10,20,50,100];function Wi(n,t){n&1&&_(0,"lib-spinner",2),n&2&&s("textSpec","Chargement en cours ...")}function zi(n,t){if(n&1&&(m(0,"th",22),_(1,"lib-libelle-model",23),a()),n&2){let e=c(2);l(),s("object",e.timbreResumeModel)("key","annee")}}function Qi(n,t){if(n&1&&(m(0,"td",24),d(1),a()),n&2){let e=t.$implicit;l(),S(" ",e==null?null:e.getAnnee()," ")}}function Gi(n,t){n&1&&_(0,"td",25)}function Yi(n,t){if(n&1&&(m(0,"th",22),_(1,"lib-libelle-model",23),a()),n&2){let e=c(2);l(),s("object",e.timbreResumeModel)("key","nombre")}}function Zi(n,t){if(n&1&&(m(0,"td",24),d(1),a()),n&2){let e=t.$implicit;l(),S(" ",e==null?null:e.getNombre()," ")}}function Xi(n,t){if(n&1&&(m(0,"td",26)(1,"b"),d(2),x(3,"async"),a()()),n&2){let e,i=c(2);l(2),S("",(e=T(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getNombre()," ")}}function Ki(n,t){if(n&1&&(m(0,"th",22),_(1,"lib-libelle-model",23),a()),n&2){let e=c(2);l(),s("object",e.timbreResumeModel)("key","acquis")}}function Ji(n,t){if(n&1&&(m(0,"td",24),d(1),a()),n&2){let e=t.$implicit;l(),S(" ",e==null?null:e.getAcquis()," ")}}function en(n,t){if(n&1&&(m(0,"td",26)(1,"b"),d(2),x(3,"async"),a()()),n&2){let e,i=c(2);l(2),S("",(e=T(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getAcquis()," ")}}function tn(n,t){if(n&1&&(m(0,"th",22),_(1,"lib-libelle-model",23),a()),n&2){let e=c(2);l(),s("object",e.timbreResumeModel)("key","doublon")}}function nn(n,t){if(n&1&&(m(0,"td",24),d(1),a()),n&2){let e=t.$implicit;l(),S(" ",e==null?null:e.getDoublon()," ")}}function on(n,t){if(n&1&&(m(0,"td",26)(1,"b"),d(2),x(3,"async"),a()()),n&2){let e,i=c(2);l(2),S("",(e=T(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getDoublon()," ")}}function rn(n,t){if(n&1&&(m(0,"th",22),_(1,"lib-libelle-model",23),a()),n&2){let e=c(2);l(),s("object",e.timbreResumeModel)("key","nombreCarnet")}}function ln(n,t){if(n&1&&(m(0,"td",24),d(1),a()),n&2){let e=t.$implicit;l(),S(" ",e==null?null:e.getNombreCarnet()," ")}}function mn(n,t){if(n&1&&(m(0,"td",26)(1,"b"),d(2),x(3,"async"),a()()),n&2){let e,i=c(2);l(2),S("",(e=T(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getNombreCarnet()," ")}}function an(n,t){if(n&1&&(m(0,"th",22),_(1,"lib-libelle-model",23),a()),n&2){let e=c(2);l(),s("object",e.timbreResumeModel)("key","acquisCarnet")}}function sn(n,t){if(n&1&&(m(0,"td",24),d(1),a()),n&2){let e=t.$implicit;l(),S(" ",e==null?null:e.getAcquisCarnet()," ")}}function cn(n,t){if(n&1&&(m(0,"td",26)(1,"b"),d(2),x(3,"async"),a()()),n&2){let e,i=c(2);l(2),S("",(e=T(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getAcquisCarnet()," ")}}function pn(n,t){if(n&1&&(m(0,"th",22),_(1,"lib-libelle-model",23),a()),n&2){let e=c(2);l(),s("object",e.timbreResumeModel)("key","doublonCarnet")}}function un(n,t){if(n&1&&(m(0,"td",24),d(1),a()),n&2){let e=t.$implicit;l(),S(" ",e==null?null:e.getDoublonCarnet()," ")}}function dn(n,t){if(n&1&&(m(0,"td",26)(1,"b"),d(2),x(3,"async"),a()()),n&2){let e,i=c(2);l(2),S("",(e=T(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getDoublonCarnet()," ")}}function bn(n,t){if(n&1&&(m(0,"th",22),_(1,"lib-libelle-model",23),a()),n&2){let e=c(2);l(),s("object",e.timbreResumeModel)("key","nombreBloc")}}function fn(n,t){if(n&1&&(m(0,"td",24),d(1),a()),n&2){let e=t.$implicit;l(),S(" ",e==null?null:e.getNombreBloc()," ")}}function gn(n,t){if(n&1&&(m(0,"td",26)(1,"b"),d(2),x(3,"async"),a()()),n&2){let e,i=c(2);l(2),S("",(e=T(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getNombreBloc()," ")}}function _n(n,t){if(n&1&&(m(0,"th",22),_(1,"lib-libelle-model",23),a()),n&2){let e=c(2);l(),s("object",e.timbreResumeModel)("key","acquisBloc")}}function hn(n,t){if(n&1&&(m(0,"td",24),d(1),a()),n&2){let e=t.$implicit;l(),S(" ",e==null?null:e.getAcquisBloc()," ")}}function xn(n,t){if(n&1&&(m(0,"td",26)(1,"b"),d(2),x(3,"async"),a()()),n&2){let e,i=c(2);l(2),S("",(e=T(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getAcquisBloc()," ")}}function Tn(n,t){if(n&1&&(m(0,"th",22),_(1,"lib-libelle-model",23),a()),n&2){let e=c(2);l(),s("object",e.timbreResumeModel)("key","doublonBloc")}}function Cn(n,t){if(n&1&&(m(0,"td",24),d(1),a()),n&2){let e=t.$implicit;l(),S(" ",e==null?null:e.getDoublonBloc()," ")}}function Mn(n,t){if(n&1&&(m(0,"td",26)(1,"b"),d(2),x(3,"async"),a()()),n&2){let e,i=c(2);l(2),S("",(e=T(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:e.getDoublonBloc()," ")}}function vn(n,t){n&1&&_(0,"tr",27)}function Sn(n,t){if(n&1){let e=w();m(0,"tr",28),C("click",function(){let o=f(e).$implicit,r=c(2);return g(r.filtreParAnnee(o))}),a()}}function yn(n,t){n&1&&_(0,"tr",29)}function wn(n,t){if(n&1){let e=w();m(0,"table",3),C("matSortChange",function(o){f(e);let r=c();return g(r.sortData(o))}),A(1,4),b(2,zi,2,2,"th",5)(3,Qi,2,1,"td",6)(4,Gi,1,0,"td",7),D(),A(5,8),b(6,Yi,2,2,"th",5)(7,Zi,2,1,"td",6)(8,Xi,4,3,"td",9),D(),A(9,10),b(10,Ki,2,2,"th",5)(11,Ji,2,1,"td",6)(12,en,4,3,"td",9),D(),A(13,11),b(14,tn,2,2,"th",5)(15,nn,2,1,"td",6)(16,on,4,3,"td",9),D(),A(17,12),b(18,rn,2,2,"th",5)(19,ln,2,1,"td",6)(20,mn,4,3,"td",9),D(),A(21,13),b(22,an,2,2,"th",5)(23,sn,2,1,"td",6)(24,cn,4,3,"td",9),D(),A(25,14),b(26,pn,2,2,"th",5)(27,un,2,1,"td",6)(28,dn,4,3,"td",9),D(),A(29,15),b(30,bn,2,2,"th",5)(31,fn,2,1,"td",6)(32,gn,4,3,"td",9),D(),A(33,16),b(34,_n,2,2,"th",5)(35,hn,2,1,"td",6)(36,xn,4,3,"td",9),D(),A(37,17),b(38,Tn,2,2,"th",5)(39,Cn,2,1,"td",6)(40,Mn,4,3,"td",9),D(),b(41,vn,1,0,"tr",18)(42,Sn,1,0,"tr",19)(43,yn,1,0,"tr",20),a(),_(44,"mat-paginator",21)}if(n&2){let e=c();s("dataSource",e.dataSource),l(41),s("matHeaderRowDef",e.displayedColumns),l(),s("matRowDefColumns",e.displayedColumns),l(),s("matFooterRowDef",e.displayedColumns),l(),s("pageSize",15)("pageSizeOptions",ht(6,Hi))}}var $t=class n{constructor(t,e,i,o){this.dialogRef=t;this.timbreResumeService=e;this.timbreService=i;this.timbreUtilsService=o;this.dataSource=new Ke([])}paginator;sort;dataSource=new Ke;displayedColumns=["annee","nombre","acquis","doublon","nombreCarnet","acquisCarnet","doublonCarnet","nombreBloc","acquisBloc","doublonBloc"];timbreResumeModel=new q;ngOnInit(){this.timbreResumeService.getResume(),this.timbreResumeService.timbresResume$.subscribe(t=>{this.dataSource.data=t})}ngAfterViewInit(){this.dataSource.paginator=this.paginator}sortData(t){p(t)&&(this.dataSource.sort=this.sort)}filtreParAnnee(t){this.timbreUtilsService.timbreCritereModel=new $,this.timbreUtilsService.timbreCritereModel.setAnnees([t.getAnnee()]),this.timbreService.getTimbres(this.timbreUtilsService.timbreCritereModel),this.dialogRef.close()}static \u0275fac=function(e){return new(e||n)(v(fe),v(kt),v(H),v(G))};static \u0275cmp=V({type:n,selectors:[["app-timbre-resume"]],viewQuery:function(e,i){if(e&1&&(ae(we,5),ae(Be,5)),e&2){let o;se(o=ce())&&(i.paginator=o.first),se(o=ce())&&(i.sort=o.first)}},decls:4,vars:4,consts:[["load",""],[3,"ngIf","ngIfElse"],["fxFlexFill","",3,"textSpec"],["id","pdf-content","mat-table","","matSort","",3,"matSortChange","dataSource"],["matColumnDef","annee"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-footer-cell","",4,"matFooterCellDef"],["matColumnDef","nombre"],["mat-footer-cell","","class","accent",4,"matFooterCellDef"],["matColumnDef","acquis"],["matColumnDef","doublon"],["matColumnDef","nombreCarnet"],["matColumnDef","acquisCarnet"],["matColumnDef","doublonCarnet"],["matColumnDef","nombreBloc"],["matColumnDef","acquisBloc"],["matColumnDef","doublonBloc"],["mat-header-row","","class","bg-primary color-white",4,"matHeaderRowDef"],["mat-row","","class","mat-row",3,"click",4,"matRowDef","matRowDefColumns"],["mat-footer-row","",4,"matFooterRowDef"],[3,"pageSize","pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],[3,"object","key"],["mat-cell",""],["mat-footer-cell",""],["mat-footer-cell","",1,"accent"],["mat-header-row","",1,"bg-primary","color-white"],["mat-row","",1,"mat-row",3,"click"],["mat-footer-row",""]],template:function(e,i){if(e&1&&(b(0,Wi,1,1,"ng-template",1),x(1,"async"),b(2,wn,45,7,"ng-template",null,0,Q)),e&2){let o=O(3);s("ngIf",T(1,2,i.timbreResumeService.load$)==!1)("ngIfElse",o)}},dependencies:[St,wt,At,Bt,yt,Dt,fi,_i,It,Et,gi,Rt,Ot,hi,we,Be,vt,k,J,te,Ie,P],styles:[".mat-row[_ngcontent-%COMP%]{height:35px}.image[_ngcontent-%COMP%]{max-height:30px!important}.mat-column-acquis[_ngcontent-%COMP%], .mat-column-doublon[_ngcontent-%COMP%]{width:60px!important;max-width:60px!important;padding:0!important}.mat-column-ajouter[_ngcontent-%COMP%], .mat-column-modifier[_ngcontent-%COMP%], .mat-column-supprimer[_ngcontent-%COMP%]{width:35px!important;max-width:35px!important;padding:0!important}@media screen and (max-width: 800px){.mat-row[_ngcontent-%COMP%]{height:25px}.image[_ngcontent-%COMP%]{max-height:20px!important}.mat-column-acquis[_ngcontent-%COMP%], .mat-column-doublon[_ngcontent-%COMP%]{width:50px!important;max-width:50px!important;padding:0!important}.mat-column-ajouter[_ngcontent-%COMP%], .mat-column-modifier[_ngcontent-%COMP%], .mat-column-supprimer[_ngcontent-%COMP%]{width:20px!important;max-width:20px!important;padding:0!important}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:0 5px!important}th[_ngcontent-%COMP%], .mat-row[_ngcontent-%COMP%]{font-size:.8em}.mat-column-libelle[_ngcontent-%COMP%],   .mat-column-libelle .mat-sort-header-container{width:40px!important;max-width:40px!important}.mat-column-drapeau[_ngcontent-%COMP%],   .mat-column-drapeau span{width:15px!important;max-width:15px!important}.mat-column-classeur[_ngcontent-%COMP%],   .mat-column-classeur .mat-sort-header-container, .mat-column-page[_ngcontent-%COMP%],   .mat-column-page .mat-sort-header-container{width:15px!important;max-width:15px!important}.mat-column-total[_ngcontent-%COMP%],   .mat-column-total .mat-sort-header-container{width:25px!important;max-width:25px!important}.hide-on-mobile[_ngcontent-%COMP%]{display:none}}"]})};var Ui=ei(qi());var mt=class{dossier;nom;alignLabel;detail;file;getDossier(){return this.dossier}setDossier(t){this.dossier=t}getNom(){return this.nom}setNom(t){this.nom=t}getAlignLabel(){return this.alignLabel}setAlignLabel(t){this.alignLabel=t}getDetail(){return this.detail}setDetail(t){this.detail=t}getFile(){return this.file}setFile(t){this.file=t}};var De=class{key;dossier;maxWidth;maxHeight;getKey(){return this.key}setKey(t){this.key=t}getDossier(){return this.dossier}setDossier(t){this.dossier=t}getMaxWidth(){return this.maxWidth}setMaxWidth(t){this.maxWidth=t}getMaxHeight(){return this.maxHeight}setMaxHeight(t){this.maxHeight=t}};var Rn=["canvas"];function On(n,t){if(n&1&&(m(0,"span",6)(1,"b"),d(2),a()()),n&2){let e=c();l(2),S("N\xB0",e.timbreModel==null?null:e.timbreModel.getId(),"")}}function Ln(n,t){n&1&&_(0,"lib-spinner",7),n&2&&s("textSpec","Chargement en cours ...")}function Un(n,t){if(n&1&&(_(0,"mat-error",29),x(1,"async")),n&2){let e=c(2);s("innerHTML",T(1,1,e.messageError$),Fe)}}function Nn(n,t){if(n&1&&(m(0,"mat-option",18),d(1),a()),n&2){let e=t.$implicit;s("value",e),l(),ii(" ",e.getAnnee()," - ",e.getId()," ")}}function Fn(n,t){if(n&1){let e=w();m(0,"img",30),C("click",function(){let o;f(e);let r=c(2);return g(r.utilsService.zoom(r.timbreModel==null||(o=r.timbreModel.getTimbreBlocModel())==null?null:o.getImageZoom()))}),a()}if(n&2){let e,i=c(2);s("src",i.timbreModel==null||(e=i.timbreModel.getTimbreBlocModel())==null?null:e.getImage(),ct)}}function qn(n,t){if(n&1){let e=w();m(0,"form",8,1),C("ngSubmit",function(){f(e);let o=O(1),r=c();return g(r.valider(o))}),m(2,"div",9),b(3,Un,2,3,"mat-error",10),x(4,"async"),m(5,"div",11)(6,"div",12)(7,"label"),_(8,"lib-libelle-model",13),a(),m(9,"input",14),F("ngModelChange",function(o){f(e);let r=c();return N(r.timbreModel.annee,o)||(r.timbreModel.annee=o),g(o)}),C("ngModelChange",function(o){f(e);let r=c();return g(r.changeAnnee(o))}),a()(),m(10,"div",15)(11,"label"),_(12,"lib-libelle-model",13),a(),m(13,"div",16)(14,"mat-select",17),x(15,"async"),C("ngModelChange",function(o){f(e);let r=c();return g(r.changeBloc(o))}),_(16,"mat-option",18),b(17,Nn,2,3,"mat-option",19),x(18,"async"),a(),b(19,Fn,1,1,"img",20),a()()(),m(20,"div",11)(21,"div",12)(22,"label"),_(23,"lib-libelle-model",13),a(),m(24,"input",21),F("ngModelChange",function(o){f(e);let r=c();return N(r.timbreModel.type,o)||(r.timbreModel.type=o),g(o)}),a()(),m(25,"div",12)(26,"label"),_(27,"lib-libelle-model",13),a(),m(28,"input",22),F("ngModelChange",function(o){f(e);let r=c();return N(r.timbreModel.monnaie,o)||(r.timbreModel.monnaie=o),g(o)}),a()()(),m(29,"div",11)(30,"div",12)(31,"label"),_(32,"lib-libelle-model",13),a(),m(33,"input",23),F("ngModelChange",function(o){f(e);let r=c();return N(r.timbreModel.yt,o)||(r.timbreModel.yt=o),g(o)}),a()(),_(34,"div",24),a(),m(35,"lib-upload",25),C("outPutObject",function(o){f(e);let r=c();return g(r.timbreModel=o)}),a()(),m(36,"div",26)(37,"button",27),C("click",function(){f(e);let o=c();return g(o.close())}),d(38," Annuler "),a(),m(39,"button",28),d(40," Enregistrer "),a()()()}if(n&2){let e,i,o=O(1),r=c();s("ngClass",o!=null&&o.submitted?"red-color":"blue-color"),l(3),s("ngIf",T(4,31,r.messageError$)),l(5),s("object",r.timbreModel)("key","annee"),l(),U("ngModel",r.timbreModel.annee),s("max",r.maxAnnee)("zMax",r.maxAnnee)("disabled",!!(r.timbreModel!=null&&r.timbreModel.getId())),l(3),s("object",r.timbreModel)("key","timbreBlocModel"),l(2),s("ngModel",r.timbreModel.getTimbreBlocModel())("placeholder","Choix bloc")("disabled",!!(r.timbreModel!=null&&r.timbreModel.getId())||((e=T(15,33,r.timbreBlocService.timbresBlocModel$))==null?null:e.length)<=0),l(2),s("value",null),l(),s("ngForOf",T(18,35,r.timbreBlocService.timbresBlocModel$)),l(2),s("ngIf",r.timbreModel==null||(i=r.timbreModel.getTimbreBlocModel())==null?null:i.getImage()),l(4),s("object",r.timbreModel)("key","type"),l(),U("ngModel",r.timbreModel.type),l(3),s("object",r.timbreModel)("key","monnaie"),l(),U("ngModel",r.timbreModel.monnaie),s("disabled",!!r.timbreModel.getTimbreBlocModel()),l(4),s("object",r.timbreModel)("key","yt"),l(),U("ngModel",r.timbreModel.yt),l(2),s("object",r.timbreModel)("key","image")("zoom",r.timbreModel.getImageZoom())("maxWidth",r.timbreService.widthTimbre)("maxHeight",r.timbreService.heightTimbre)}}var at=class n{constructor(t,e,i,o,r){this.httpResponseHandlerService=t;this.dialogRef=e;this.timbreService=i;this.timbreBlocService=o;this.utilsService=r}canvas;messageError$=new E(null);load$=new E(null);id;maxAnnee=new Date().getFullYear();timbreModel=new ge;fileUploadModel=new mt;ngOnInit(){this.initUpload(),this.load$.next(!1),p(this.id)?this.timbreService.getTimbreByIdAsync(this.id).subscribe(t=>{this.timbreModel=t,p(t.getTimbreBlocModel())&&(this.timbreModel.setAnnee(t.getTimbreBlocModel().getAnnee()),this.timbreModel.setMonnaie(t.getTimbreBlocModel().getMonnaie())),this.load$.next(!0)}):(this.timbreModel.setAnnee(new Date().getFullYear()),this.timbreModel.setMonnaie("E"),this.load$.next(!0)),this.changeAnnee(this.timbreModel.getAnnee())}initUpload(){this.fileUploadModel.setDossier("test"),this.fileUploadModel.setNom(new Date().getTime()?.toString());let t=new De;t.setMaxWidth(this.timbreService.widthTimbre),t.setMaxHeight(this.timbreService.heightTimbre),t.setDossier("autre");let e=new De;e.setMaxWidth(this.timbreService.widthTimbreZoom),e.setMaxHeight(this.timbreService.heightTimbreZoom),e.setDossier("zoom"),this.fileUploadModel.setDetail([t,e])}valider(t){if(this.messageError$.next(null),t?.valid)if(p(this.timbreModel.getImage()))this.saveData();else{this.messageError$.next("Veuillez s\xE9lectionner une image");return}}saveData(){this.load$.next(!1),p(this.timbreModel.getId())?this.save():this.ajouter()}ajouter(){this.utilsService.getMaxIdentAsync("/timbres").pipe(M()).subscribe(t=>{this.timbreModel.setId(t),this.save(!0)})}save(t){try{W([this.timbreService.upload(this.timbreModel,"autre"),this.timbreService.upload(this.timbreModel,"table"),this.timbreService.upload(this.timbreModel,"zoom")]).pipe(M(([e,i,o])=>p(e)&&p(o)&&p(i))).subscribe(([e,i,o])=>{p(i)&&i!="nok"&&this.timbreModel.setImage(i),p(e)&&e!="nok"&&this.timbreModel.setImageTable(e),p(o)&&o!="nok"&&this.timbreModel.setImageZoom(o),t?this.timbreService.ajouter(this.timbreModel,!0):this.timbreService.modifier(this.timbreModel),this.httpResponseHandlerService.showNotificationSuccess("Transaction termin\xE9e","Votre timbre a bien \xE9t\xE9 modifi\xE9e."),this.load$.next(!0),this.dialogRef.close()})}catch{this.httpResponseHandlerService.showNotificationError("Transaction non aboutie","Votre timbre n'a pas pu \xEAtre modifi\xE9."),this.load$.next(!0)}}close(){this.dialogRef.close()}changeAnnee(t){if(this.timbreModel.setTimbreBlocModel(null),p(t)){let e=new $;e.setAnnees([t]),this.timbreBlocService.getBlocs(e)}}changeBloc(t){p(t)?(this.timbreModel.setIdBloc(t.getId()),this.timbreModel.setTimbreBlocModel(t),this.timbreModel.setMonnaie(t.getMonnaie()),this.timbreModel.setAnnee(t.getAnnee())):(this.timbreModel.setIdBloc(null),this.timbreModel.setTimbreBlocModel(null),this.timbreModel.setMonnaie("E"))}static \u0275fac=function(e){return new(e||n)(v(Ut),v(fe),v(H),v(oe),v(ie))};static \u0275cmp=V({type:n,selectors:[["app-timbre-modifier"]],viewQuery:function(e,i){if(e&1&&ae(Rn,5),e&2){let o;se(o=ce())&&(i.canvas=o.first)}},decls:9,vars:6,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],["class","accent",4,"ngIf"],[3,"ngIf","ngIfElse"],[1,"accent"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","space-between stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","column","fxLayoutGap","20px",1,"bloc-modal"],[3,"innerHTML",4,"ngIf"],["fxLayout","row","fxLayout.lt-lg","column","fxLayoutGap","30px","fxLayoutGap.lt-lg","5px"],["fxLayout","column",1,"form-input"],[3,"object","key"],["name","page","type","number","minlength","4","maxlength","4","min","1900","zMin","1900","required","","zControl","",1,"annee",2,"width","60px !important",3,"ngModelChange","ngModel","max","zMax","disabled"],["fxLayout","column",1,"form-input","select"],["fxLayout","row","fxLayoutGap","15px"],["name","bloc",2,"width","120px !important",3,"ngModelChange","ngModel","placeholder","disabled"],[1,"selectMin",3,"value"],["class","selectMin",3,"value",4,"ngFor","ngForOf"],["style","max-height: 40px","class","click",3,"src","click",4,"ngIf"],["name","type","type","text","trim","","zControl","",3,"ngModelChange","ngModel"],["name","monnaie","type","text","trim","","minlength","1","maxlength","2","required","","zControl","",2,"width","25px !important",3,"ngModelChange","ngModel","disabled"],["name","yt","type","text","trim","","zControl","",3,"ngModelChange","ngModel"],["fxHide.lt-lg","","fxLayout","column",1,"form-input"],[3,"outPutObject","object","key","zoom","maxWidth","maxHeight"],["fxLayout","row","fxLayoutGap","10px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"],[3,"innerHTML"],[1,"click",2,"max-height","40px",3,"click","src"]],template:function(e,i){if(e&1&&(m(0,"div",2)(1,"div",3)(2,"span"),d(3),a(),b(4,On,3,1,"span",4),a(),b(5,Ln,1,1,"ng-template",5),x(6,"async"),b(7,qn,41,37,"ng-template",null,0,Q),a()),e&2){let o=O(8);l(3),S("",i.timbreModel!=null&&i.timbreModel.getId()?"MODIFICATION":"AJOUT"," "),l(),s("ngIf",i.timbreModel==null?null:i.timbreModel.getId()),l(),s("ngIf",T(6,4,i.load$)==!1)("ngIfElse",o)}},dependencies:[ee,Ze,Xe,Ye,_e,he,k,X,K,ue,J,pe,ke,Ce,Se,Pe,$e,de,Me,ze,Qe,Ge,We,He,be,ve,te,Ie,Je,Nt,it,nt,Ft,P],encapsulation:2})};var Li=ei(ji());var jn=()=>[10,20,50,100];function Vn(n,t){if(n&1&&(m(0,"mat-option",34),d(1),a()),n&2){let e=t.$implicit;s("value",e),l(),S(" ",e," ")}}function kn(n,t){if(n&1){let e=w();m(0,"div",3)(1,"div",32)(2,"mat-select",33),F("ngModelChange",function(o){f(e);let r=c();return N(r.timbreUtilsService.timbreCritereModel.acquis,o)||(r.timbreUtilsService.timbreCritereModel.acquis=o),g(o)}),C("ngModelChange",function(){f(e);let o=c();return g(o.filtreByCritere())}),m(3,"mat-option",34),d(4," Oui"),a(),m(5,"mat-option",34),d(6," Non"),a(),m(7,"mat-option",34),d(8," Tous"),a()()(),m(9,"div",32)(10,"mat-select",35),F("ngModelChange",function(o){f(e);let r=c();return N(r.timbreUtilsService.timbreCritereModel.doublon,o)||(r.timbreUtilsService.timbreCritereModel.doublon=o),g(o)}),C("ngModelChange",function(){f(e);let o=c();return g(o.filtreByCritere())}),m(11,"mat-option",34),d(12," Oui"),a(),m(13,"mat-option",34),d(14," Non"),a(),m(15,"mat-option",34),d(16," Tous"),a()()(),m(17,"div",32)(18,"mat-select",36),F("ngModelChange",function(o){f(e);let r=c();return N(r.timbreUtilsService.timbreCritereModel.carnet,o)||(r.timbreUtilsService.timbreCritereModel.carnet=o),g(o)}),C("ngModelChange",function(){f(e);let o=c();return g(o.filtreByCritere())}),m(19,"mat-option",34),d(20," Oui"),a(),m(21,"mat-option",34),d(22," Non"),a(),m(23,"mat-option",34),d(24," Tous"),a()()(),m(25,"div",32)(26,"mat-select",37),F("ngModelChange",function(o){f(e);let r=c();return N(r.timbreUtilsService.timbreCritereModel.bloc,o)||(r.timbreUtilsService.timbreCritereModel.bloc=o),g(o)}),C("ngModelChange",function(){f(e);let o=c();return g(o.filtreByCritere())}),m(27,"mat-option",34),d(28," Oui"),a(),m(29,"mat-option",34),d(30," Non"),a(),m(31,"mat-option",34),d(32," Tous"),a()()(),m(33,"div",38)(34,"mat-select",39),F("ngModelChange",function(o){f(e);let r=c();return N(r.timbreUtilsService.timbreCritereModel.annees,o)||(r.timbreUtilsService.timbreCritereModel.annees=o),g(o)}),C("ngModelChange",function(){f(e);let o=c();return g(o.filtreByCritere())}),b(35,Vn,2,2,"mat-option",40),x(36,"async"),a()(),m(37,"div",41)(38,"input",42),C("input",function(o){f(e);let r=c();return g(r.applyFilter(o))}),a()(),m(39,"lib-icon",43),C("click",function(){f(e);let o=c();return g(o.exportTable())}),a()()}if(n&2){let e=c();l(2),U("ngModel",e.timbreUtilsService.timbreCritereModel.acquis),s("placeholder","Acquis"),l(),s("value","OUI"),l(2),s("value","NON"),l(2),s("value","TOUS"),l(3),U("ngModel",e.timbreUtilsService.timbreCritereModel.doublon),s("placeholder","Doublon"),l(),s("value","OUI"),l(2),s("value","NON"),l(2),s("value","TOUS"),l(3),U("ngModel",e.timbreUtilsService.timbreCritereModel.carnet),s("placeholder","Carnet"),l(),s("value","OUI"),l(2),s("value","NON"),l(2),s("value","TOUS"),l(3),U("ngModel",e.timbreUtilsService.timbreCritereModel.bloc),s("placeholder","Bloc"),l(),s("value","OUI"),l(2),s("value","NON"),l(2),s("value","TOUS"),l(3),U("ngModel",e.timbreUtilsService.timbreCritereModel.annees),s("placeholder","Ann\xE9es"),l(),s("ngForOf",T(36,26,e.annees$)),l(4),s("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.FILE_EXEL)("info","Exporter tableau")}}function Pn(n,t){if(n&1&&(m(0,"th",44),_(1,"lib-libelle-model",45),a()),n&2){let e=c();l(),s("object",e.timbre)("key","image")}}function $n(n,t){if(n&1){let e=w();m(0,"img",48),C("click",function(){f(e);let o=c().$implicit,r=c();return g(r.utilsService.zoom(o==null?null:o.getImageZoom()))}),a()}if(n&2){let e=c().$implicit;s("src",e==null?null:e.getImageTable(),ct)}}function Hn(n,t){if(n&1&&(m(0,"td",46),b(1,$n,1,1,"img",47),a()),n&2){let e=t.$implicit;l(),s("ngIf",e==null?null:e.getImageTable())}}function Wn(n,t){if(n&1&&(m(0,"th",49),_(1,"lib-libelle-model",50),a()),n&2){let e=c();l(),s("object",e.timbre)("key","id")}}function zn(n,t){if(n&1&&(m(0,"td",51),d(1),a()),n&2){let e=t.$implicit;l(),S(" ",e==null?null:e.getId()," ")}}function Qn(n,t){if(n&1&&(m(0,"th",49),_(1,"lib-libelle-model",50),a()),n&2){let e=c();l(),s("object",e.timbre)("key","annee")}}function Gn(n,t){if(n&1&&d(0),n&2){let e,i=c().$implicit;S(" ",i==null||(e=i.getTimbreBlocModel())==null?null:e.getAnnee()," ")}}function Yn(n,t){if(n&1&&d(0),n&2){let e=c().$implicit;S(" ",e==null?null:e.getAnnee()," ")}}function Zn(n,t){if(n&1&&(m(0,"td",51),b(1,Gn,1,1,"ng-template",52)(2,Yn,1,1,"ng-template",null,0,Q),a()),n&2){let e=t.$implicit,i=O(3);l(),s("ngIf",e==null?null:e.getIdBloc())("ngIfElse",i)}}function Xn(n,t){if(n&1&&(m(0,"th",53),_(1,"lib-libelle-model",50),a()),n&2){let e=c();l(),s("object",e.timbre)("key","idBloc")}}function Kn(n,t){if(n&1){let e=w();m(0,"img",48),C("click",function(){let o;f(e);let r=c(2).$implicit,u=c();return g(u.utilsService.zoom(r==null||(o=r.getTimbreBlocModel())==null?null:o.getImageZoom()))}),a()}if(n&2){let e,i=c(2).$implicit;s("src",i==null||(e=i.getTimbreBlocModel())==null?null:e.getImageTable(),ct)}}function Jn(n,t){if(n&1&&b(0,Kn,1,1,"img",47),n&2){let e,i=c().$implicit;s("ngIf",i==null||(e=i.getTimbreBlocModel())==null?null:e.getImage())}}function eo(n,t){n&1&&d(0," Non ")}function to(n,t){if(n&1&&(m(0,"td",51),b(1,Jn,1,1,"ng-template",52)(2,eo,1,0,"ng-template",null,0,Q),a()),n&2){let e=t.$implicit,i=O(3);l(),s("ngIf",e==null?null:e.getIdBloc())("ngIfElse",i)}}function io(n,t){if(n&1&&(m(0,"th",54),_(1,"lib-libelle-model",50),a()),n&2){let e=c();l(),s("object",e.timbre)("key","monnaie")}}function no(n,t){if(n&1&&d(0),n&2){let e,i=c().$implicit;S(" ",(i==null||(e=i.getTimbreBlocModel())==null?null:e.getMonnaie())=="E"?"\u20AC":"Francs"," ")}}function oo(n,t){if(n&1&&d(0),n&2){let e=c().$implicit;S(" ",(e==null?null:e.getMonnaie())=="E"?"\u20AC":"Francs"," ")}}function ro(n,t){if(n&1&&(m(0,"td",55),b(1,no,1,1,"ng-template",52)(2,oo,1,1,"ng-template",null,0,Q),a()),n&2){let e=t.$implicit,i=O(3);l(),s("ngIf",e==null?null:e.getIdBloc())("ngIfElse",i)}}function lo(n,t){if(n&1&&(m(0,"th",54),_(1,"lib-libelle-model",50),a()),n&2){let e=c();l(),s("object",e.timbre)("key","type")}}function mo(n,t){if(n&1&&(m(0,"td",55),d(1),a()),n&2){let e=t.$implicit;l(),S(" ",e==null?null:e.getType()," ")}}function ao(n,t){if(n&1&&(m(0,"th",54),_(1,"lib-libelle-model",50),a()),n&2){let e=c();l(),s("object",e.timbre)("key","yt")}}function so(n,t){if(n&1&&(m(0,"td",55),d(1),a()),n&2){let e=t.$implicit;l(),S(" ",e==null?null:e.getYt()," ")}}function co(n,t){if(n&1&&(m(0,"th",53),_(1,"lib-libelle-model",56),a()),n&2){let e=c();l(),s("object",e.timbre==null?null:e.timbre.getTimbreAcquisModel())("key","acquis")("align","center center")}}function po(n,t){if(n&1){let e=w();m(0,"td",46)(1,"lib-icon",57),C("click",function(){let o=f(e).$implicit,r=c();return g(r.acquis(o))}),a()()}if(n&2){let e,i,o,r=t.$implicit,u=c();l(),s("classIcone",!(r==null||(e=r.getTimbreAcquisModel())==null)&&e.isAcquis()?"accent":"primary")("type",u.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",!(r==null||(i=r.getTimbreAcquisModel())==null)&&i.isAcquis()?u.FontAwesomeEnum.CIRCLE_MINUS:u.FontAwesomeEnum.CIRCLE_PLUS)("info",!(r==null||(o=r.getTimbreAcquisModel())==null)&&o.isAcquis()?"pas acquis":"acquis")}}function uo(n,t){if(n&1&&(m(0,"th",53),_(1,"lib-libelle-model",56),a()),n&2){let e=c();l(),s("object",e.timbre==null?null:e.timbre.getTimbreAcquisModel())("key","doublon")("align","center center")}}function bo(n,t){if(n&1){let e=w();m(0,"td",46)(1,"lib-icon",57),C("click",function(){let o=f(e).$implicit,r=c();return g(r.doublon(o))}),a()()}if(n&2){let e,i,o,r=t.$implicit,u=c();l(),s("classIcone",!(r==null||(e=r.getTimbreAcquisModel())==null)&&e.isDoublon()?"accent":"primary")("type",u.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",!(r==null||(i=r.getTimbreAcquisModel())==null)&&i.isDoublon()?u.FontAwesomeEnum.CIRCLE_MINUS:u.FontAwesomeEnum.CIRCLE_PLUS)("info",!(r==null||(o=r.getTimbreAcquisModel())==null)&&o.isDoublon()?"pas en double":"en double")}}function fo(n,t){if(n&1&&(m(0,"th",58),_(1,"lib-icon",59),a()),n&2){let e=c();l(),s("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.PENCIL)("info","Modifier")}}function go(n,t){if(n&1){let e=w();m(0,"td",46)(1,"lib-icon",60),C("click",function(){let o=f(e).$implicit,r=c();return g(r.modifier(o))}),a()()}if(n&2){let e=c();l(),s("type",e.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",e.FontAwesomeEnum.PENCIL)("info","Modifier")}}function _o(n,t){if(n&1&&(m(0,"th",58),_(1,"lib-icon",59),a()),n&2){let e=c();l(),s("type",e.FontAwesomeTypeEnum.TYPE_SOLID)("icone",e.FontAwesomeEnum.TRASH)("info","Supprimer")}}function ho(n,t){if(n&1){let e=w();m(0,"td",46)(1,"lib-icon",60),C("click",function(){let o=f(e).$implicit,r=c();return g(r.supprimer(o))}),a()()}if(n&2){let e=c();l(),s("type",e.FontAwesomeTypeEnum.TYPE_SOLID)("icone",e.FontAwesomeEnum.TRASH)("info","Supprimer")}}function xo(n,t){n&1&&_(0,"tr",61)}function To(n,t){n&1&&_(0,"tr",62)}var Qt=class n{constructor(t,e,i,o){this.timbreService=t;this.timbreUtilsService=e;this.dialog=i;this.utilsService=o;this.dataSource=new Ke([])}paginator;sort;timbres$;total$;modif=!0;load$=new E(!1);dataSource=new Ke;displayedColumns;timbre=new ge;annees$;FontAwesomeEnum=Ve;FontAwesomeTypeEnum=je;ngOnInit(){this.annees$=this.timbreUtilsService.getAnneesAsync("/timbres"),this.timbre.setTimbreAcquisModel(new z),this.displayedColumns=["image","id","annee","idBloc","monnaie","type","yt","acquis","doublon"],this.modif&&this.displayedColumns.push("modifier","supprimer"),this.load$.next(!1),this.timbres$.subscribe(t=>{this.dataSource.data=t,this.load$.next(!0)})}ngAfterViewInit(){this.dataSource.paginator=this.paginator}sortData(t){p(t)&&(this.dataSource.sort=this.sort)}filtreByCritere(){this.timbreUtilsService.timbreCritereModel.getCarnet()=="OUI"&&this.timbreUtilsService.timbreCritereModel.setBloc("OUI"),this.timbreUtilsService.timbreCritereModel.getAcquis()=="NON"&&this.timbreUtilsService.timbreCritereModel.setDoublon("TOUS"),p(this.timbreUtilsService.timbreCritereModel.getAnnees())&&this.timbreUtilsService.timbreCritereModel.getAnnees().length>0&&this.timbreService.getTimbres(this.timbreUtilsService.timbreCritereModel)}applyFilter(t){let e=t.target.value;this.dataSource.filter=e.trim().toLowerCase()}resume(){this.dialog.open($t,{height:"auto",maxHeight:"750px",width:"900px"})}acquis(t){this.timbreService.acquis(t,!1)}doublon(t){this.timbreService.acquis(t,!0)}modifier(t){let e=this.dialog.open(at,{height:"75vh",maxHeight:"750px",width:"30%"});e.componentInstance.id=t.getId(),e.afterClosed().subscribe(()=>{e.close()})}supprimer(t){let e=this.dialog.open(jt,{maxHeight:"95vh",data:{titre:"Confirmation",message:"Souhaitez-vous supprimer le timbre <b>n\xB0 "+t?.getId()+"</b> ?",btnDroite:"Oui",btnGauche:"Non"}});e.afterClosed().subscribe(()=>{e.componentInstance.data.resultat==="valider"&&this.timbreService.supprimer(t)})}exportTable(){let t=qt.json_to_sheet(this.dataSource.data),e=qt.book_new();qt.book_append_sheet(e,t,"Donn\xE9es");let i=Mi(e,{bookType:"xlsx",type:"array"}),o=new Blob([i],{type:"application/octet-stream"});(0,Li.saveAs)(o,"export_timbres.xlsx")}generatePDFByImage(){let t="https://firebasestorage.googleapis.com/v0/b/book-f941b.appspot.com/o/AF.png?alt=media&token=a1039f78-3cff-41ab-8569-ea1b2cefe2c1";this.generatePDF(null)}generatePDF(t){}static \u0275fac=function(e){return new(e||n)(v(H),v(G),v(ye),v(ie))};static \u0275cmp=V({type:n,selectors:[["app-timbre-resultat"]],viewQuery:function(e,i){if(e&1&&(ae(we,5),ae(Be,5)),e&2){let o;se(o=ce())&&(i.paginator=o.first),se(o=ce())&&(i.sort=o.first)}},inputs:{timbres$:"timbres$",total$:"total$",modif:"modif"},decls:52,vars:23,consts:[["noBloc",""],["fxFlexFill","",3,"fxHide","textSpec"],[3,"fxHide"],["fxLayout","row","fxLayoutAlign","space-between center","fxLayoutGap","15px",2,"height","50px"],["fxLayout","row","fxLayoutAlign","start center","fxLayoutGap","10px",2,"height","50px"],["fxFlex","",2,"font-size","1.2em"],[1,"bold"],[1,"accent","click",2,"font-size","2em",3,"click","icone","type","info","classInfo"],["fxLayout","row","fxLayoutAlign","space-between center","fxLayoutGap","15px","style","height: 50px",4,"ngIf"],["id","pdf-content","mat-table","","matSort","",3,"matSortChange","dataSource"],["matColumnDef","image"],["mat-header-cell","","class","image",4,"matHeaderCellDef"],["mat-cell","","class","alignCenter",4,"matCellDef"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","annee"],["matColumnDef","idBloc"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","monnaie"],["mat-header-cell","","mat-sort-header","","class","hide-on-mobile",4,"matHeaderCellDef"],["mat-cell","","class","hide-on-mobile",4,"matCellDef"],["matColumnDef","type"],["matColumnDef","yt"],["matColumnDef","acquis"],["matColumnDef","doublon"],["matColumnDef","modifier"],["mat-header-cell","","class","alignCenter",4,"matHeaderCellDef"],["matColumnDef","supprimer"],["mat-header-row","","class","bg-primary color-white",4,"matHeaderRowDef"],["mat-row","","class","mat-row",4,"matRowDef","matRowDefColumns"],[3,"pageSize","pageSizeOptions"],["fxLayout","row","fxLayoutAlign","end center",1,"form-input","select",2,"width","100px"],["name","acquis",3,"ngModelChange","ngModel","placeholder"],[1,"selectMin",3,"value"],["name","doublon",1,"scrollBarAccent",3,"ngModelChange","ngModel","placeholder"],["name","carnet",1,"scrollBarAccent",3,"ngModelChange","ngModel","placeholder"],["name","bloc",1,"scrollBarAccent",3,"ngModelChange","ngModel","placeholder"],["fxLayout","row","fxLayoutAlign","end center",1,"form-input","select",2,"width","150px"],["name","anneeSelect","multiple","",3,"ngModelChange","ngModel","placeholder"],["class","selectMin",3,"value",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","end center",1,"form-input",2,"width","200px","min-height","55px","height","55px"],["placeholder","Filtrer les donn\xE9es","type","text",3,"input"],[1,"primary","click",2,"font-size","1.7em",3,"click","type","icone","info"],["mat-header-cell","",1,"image"],[1,"hide-on-mobile",3,"object","key"],["mat-cell","",1,"alignCenter"],["class","image click",3,"src","click",4,"ngIf"],[1,"image","click",3,"click","src"],["mat-header-cell","","mat-sort-header",""],[3,"object","key"],["mat-cell",""],[3,"ngIf","ngIfElse"],["mat-header-cell",""],["mat-header-cell","","mat-sort-header","",1,"hide-on-mobile"],["mat-cell","",1,"hide-on-mobile"],[3,"object","key","align"],[1,"click",2,"font-size","1.2em",3,"click","classIcone","type","icone","info"],["mat-header-cell","",1,"alignCenter"],[2,"font-size","1.2em",3,"type","icone","info"],[1,"primary","click",2,"font-size","1.2em",3,"click","type","icone","info"],["mat-header-row","",1,"bg-primary","color-white"],["mat-row","",1,"mat-row"]],template:function(e,i){e&1&&(_(0,"lib-spinner",1),x(1,"async"),m(2,"section",2),x(3,"async"),m(4,"div",3)(5,"div",4)(6,"div",5)(7,"span"),d(8,"Nombre de timbres : "),a(),m(9,"span",6),d(10),x(11,"async"),x(12,"async"),a()(),m(13,"lib-icon",7),C("click",function(){return i.resume()}),a()(),b(14,kn,40,28,"div",8),a(),m(15,"table",9),C("matSortChange",function(r){return i.sortData(r)}),A(16,10),b(17,Pn,2,2,"th",11)(18,Hn,2,1,"td",12),D(),A(19,13),b(20,Wn,2,2,"th",14)(21,zn,2,1,"td",15),D(),A(22,16),b(23,Qn,2,2,"th",14)(24,Zn,4,2,"td",15),D(),A(25,17),b(26,Xn,2,2,"th",18)(27,to,4,2,"td",15),D(),A(28,19),b(29,io,2,2,"th",20)(30,ro,4,2,"td",21),D(),A(31,22),b(32,lo,2,2,"th",20)(33,mo,2,1,"td",21),D(),A(34,23),b(35,ao,2,2,"th",20)(36,so,2,1,"td",21),D(),A(37,24),b(38,co,2,3,"th",18)(39,po,2,4,"td",12),D(),A(40,25),b(41,uo,2,3,"th",18)(42,bo,2,4,"td",12),D(),A(43,26),b(44,fo,2,3,"th",27)(45,go,2,3,"td",12),D(),A(46,28),b(47,_o,2,3,"th",27)(48,ho,2,3,"td",12),D(),b(49,xo,1,0,"tr",29)(50,To,1,0,"tr",30),a(),_(51,"mat-paginator",31),a()),e&2&&(s("fxHide",T(1,14,i.load$)==!0)("textSpec","Chargement en cours ..."),l(2),s("fxHide",T(3,16,i.load$)==!1),l(8),_t(T(11,18,i.total$)?T(12,20,i.total$):i.dataSource==null||i.dataSource.data==null?null:i.dataSource.data.length),l(3),s("icone",i.FontAwesomeEnum.CHART_LINE_UP)("type",i.FontAwesomeTypeEnum.TYPE_SOLID)("info","D\xE9tail par ann\xE9e")("classInfo","tooltiptextDescription tooltiptextBgWhite widthAuto"),l(),s("ngIf",i.modif),l(),s("dataSource",i.dataSource),l(34),s("matHeaderRowDef",i.displayedColumns),l(),s("matRowDefColumns",i.displayedColumns),l(),s("pageSize",15)("pageSizeOptions",ht(22,jn)))},dependencies:[Xe,Ye,St,wt,At,Bt,yt,Dt,It,Et,Rt,Ot,we,Be,vt,he,k,X,K,ue,J,pe,ke,de,be,te,et,Ie,P],styles:[".mat-row[_ngcontent-%COMP%]{height:35px}.image[_ngcontent-%COMP%]{max-height:30px!important}.mat-column-acquis[_ngcontent-%COMP%], .mat-column-doublon[_ngcontent-%COMP%]{width:60px!important;max-width:60px!important;padding:0!important}.mat-column-ajouter[_ngcontent-%COMP%], .mat-column-modifier[_ngcontent-%COMP%], .mat-column-supprimer[_ngcontent-%COMP%]{width:35px!important;max-width:35px!important;padding:0!important}@media screen and (max-width: 800px){.mat-row[_ngcontent-%COMP%]{height:25px}.image[_ngcontent-%COMP%]{max-height:20px!important}.mat-column-acquis[_ngcontent-%COMP%], .mat-column-doublon[_ngcontent-%COMP%]{width:50px!important;max-width:50px!important;padding:0!important}.mat-column-ajouter[_ngcontent-%COMP%], .mat-column-modifier[_ngcontent-%COMP%], .mat-column-supprimer[_ngcontent-%COMP%]{width:20px!important;max-width:20px!important;padding:0!important}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:0 5px!important}th[_ngcontent-%COMP%], .mat-row[_ngcontent-%COMP%]{font-size:.8em}.mat-column-libelle[_ngcontent-%COMP%],   .mat-column-libelle .mat-sort-header-container{width:40px!important;max-width:40px!important}.mat-column-drapeau[_ngcontent-%COMP%],   .mat-column-drapeau span{width:15px!important;max-width:15px!important}.mat-column-classeur[_ngcontent-%COMP%],   .mat-column-classeur .mat-sort-header-container, .mat-column-page[_ngcontent-%COMP%],   .mat-column-page .mat-sort-header-container{width:15px!important;max-width:15px!important}.mat-column-total[_ngcontent-%COMP%],   .mat-column-total .mat-sort-header-container{width:25px!important;max-width:25px!important}.hide-on-mobile[_ngcontent-%COMP%]{display:none}}"]})};function Mo(n,t){if(n&1&&(_(0,"lib-spinner",5),x(1,"async")),n&2){let e=c();s("textSpec",T(1,1,e.messageLoad$))}}function vo(n,t){if(n&1&&(_(0,"mat-error",16),x(1,"async")),n&2){let e=c(2);s("innerHTML",T(1,1,e.messageError$),Fe)}}function So(n,t){if(n&1&&_(0,"app-timbre-resultat",17),n&2){let e=c(2);s("timbres$",e.timbres$)("modif",!1)}}function yo(n,t){if(n&1&&(m(0,"mat-option",21),d(1),a()),n&2){let e=t.$implicit;s("value",e),l(),S(" ",e," ")}}function wo(n,t){if(n&1){let e=w();m(0,"div",18)(1,"mat-select",19),F("ngModelChange",function(o){f(e);let r=c(2);return N(r.annees,o)||(r.annees=o),g(o)}),b(2,yo,2,2,"mat-option",20),a()()}if(n&2){let e=c(2);l(),U("ngModel",e.annees),s("placeholder","Ann\xE9es"),l(),s("ngForOf",e.anneesDispo)}}function Bo(n,t){n&1&&(m(0,"button",22),d(1," Enregistrer "),a())}function Io(n,t){if(n&1){let e=w();m(0,"form",6,1),C("ngSubmit",function(){f(e);let o=O(1),r=c();return g(r.valider(o))}),m(2,"div",7),b(3,vo,2,3,"mat-error",8),x(4,"async"),b(5,So,1,2,"app-timbre-resultat",9),x(6,"async"),a(),m(7,"div",10),b(8,wo,3,3,"div",11),x(9,"async"),x(10,"async"),m(11,"button",12),C("click",function(){f(e);let o=c();return g(o.close())}),d(12," Annuler "),a(),m(13,"input",13),C("change",function(o){f(e);let r=c();return g(r.onFileChange(o))}),a(),m(14,"button",14),C("click",function(){f(e);let o=c();return g(o.triggerFileInput())}),d(15," Choisir un fichier "),a(),b(16,Bo,2,0,"button",15),x(17,"async"),a()()}if(n&2){let e,i,o,r=O(1),u=c();s("ngClass",r!=null&&r.submitted?"red-color":"blue-color"),l(3),s("ngIf",T(4,6,u.messageError$)),l(2),s("ngIf",((e=T(6,8,u.timbres$))==null?null:e.length)>0),l(3),s("ngIf",!T(9,10,u.timbres$)||((i=T(10,12,u.timbres$))==null?null:i.length)==0),l(5),ti("id",u.idFile),l(3),s("ngIf",((o=T(17,14,u.timbres$))==null?null:o.length)>0)}}var Gt=class n{constructor(t,e,i,o,r,u,h){this.authService=t;this.timbreService=e;this.timbreBlocService=i;this.timbreUtilsService=o;this.uploadService=r;this.utilsService=u;this.dialogRef=h}dossier="/assets/images/timbres/";timbres$=new E(null);messageError$=new E(null);messageLoad$=new E("Chargement en cours ...");load$=new E(null);idFile="fileImport";identTimbre=1;identBloc=1;timbresModel=[];timbresBlocsModel=[];anneesDispo=[];annees=[new Date().getFullYear()];ngOnInit(){for(let t=new Date().getFullYear();t>=1900;t--)this.anneesDispo.push(t)}triggerFileInput(){document.getElementById(this.idFile).click()}onFileChange(t){let e=t.target.files[0];e&&(this.load$.next(!1),this.messageLoad$.next("Chargement en cours ..."),this.saveCsv(e))}saveCsv(t){let e=new FileReader;e.onload=()=>{let i=e.result;this.parseCsv(i)},e.readAsText(t)}parseCsv(t){p(this.annees)&&this.annees.length>0&&W([this.utilsService.getMaxIdentAsync("/timbres"),this.utilsService.getMaxIdentAsync("/timbres_bloc"),this.authService.getUser()]).pipe(M(([e,i,o])=>p(o))).subscribe(([e,i,o])=>{this.identTimbre=e,this.identBloc=i,this.timbresModel=[],this.timbres$.next(null),Ui.parse(t,{header:!0,skipEmptyLines:!0,complete:r=>{p(r.data)&&r.data?.length>0&&(this.timbresBlocsModel=[],r.data.forEach((u,h)=>{let y=this.setTimbre(u,o);p(y?.getId())&&(this.timbresModel.push(y),this.identTimbre++),h==r.data.length-1&&(this.timbres$.next(this.timbresModel),this.load$.next(!0))}))},error:r=>{console.error("Erreur lors du parsing du CSV :",r)}})})}setTimbre(t,e){let i=new ge,o=t.CODE!="NULL"&&t.CODE!=""?Number(t.CODE):null,r=t.IDENT_BLOC!="NULL"&&t.IDENT_BLOC!=""&&p(t.IDENT_BLOC)?Number(t.IDENT_BLOC):null,u=t.ANNEE!="NULL"&&t.ANNEE!=""?Number(t.ANNEE):null,h=t.MONNAIE!="NULL"&&t.MONNAIE!=""?t.MONNAIE:null;if(this.annees.includes(u)){i.setId(this.identTimbre),i.setType(t.TYPE!="NULL"&&t.TYPE!=""?t.TYPE:null),i.setYt(t.YT!="NULL"&&t.YT!=""?t.YT:null),i.setAnnee(u);let y=new z;y.setIdTimbre(i.getId()),y.setIdUser(e.getId()),y.setAcquis(t.ACQUIS=="1"),y.setDoublon(t.DOUBLON=="1"),i.setTimbreAcquisModel(y);let R=this.dossier+u+"/",Z="";if(p(r)){if(R+="bloc/"+r,Z=R+".png",R+="-",i.setTimbreBlocModel(this.timbresBlocsModel.find(j=>j.getAnnee()==u&&j.idOrigine==r)),re(i.getTimbreBlocModel())){let j=new Ee;j.setId(this.identBloc),j.setAnnee(u),j.setMonnaie(h),j.setCarnet(t.CARNET=="1"),j.idOrigine=r;let st=new ne;st.setIdBloc(this.identBloc),st.setIdUser(e.getId()),st.setAcquis(t.ACQUIS_BLOC=="1"),st.setDoublon(t.DOUBLON_BLOC=="1"),j.setTimbreBlocAcquisModel(st),this.uploadService.checkIfImageExists(Z).pipe(M()).subscribe(Fi=>{Fi&&(j.setImage(Z),j.setImageTable(Z),j.setImageZoom(Z))}),this.timbresBlocsModel.push(j),i.setTimbreBlocModel(j),this.identBloc++}i.setIdBloc(i.getTimbreBlocModel()?.getId())}else i.setMonnaie(h);R+=o+".png",this.uploadService.checkIfImageExists(R).pipe(M()).subscribe(j=>{j&&(i.setImage(R),i.setImageTable(R),i.setImageZoom(R))})}return i}valider(t){this.messageError$.next(null),t?.valid&&(this.load$.next(!1),this.messageLoad$.next("Import en cours ..."),p(this.timbresBlocsModel)&&this.timbresBlocsModel?.length>0&&this.timbresBlocsModel.forEach((e,i)=>{this.saveBloc(e)}),this.timbres$.pipe(M()).subscribe(e=>{if(p(e)&&e?.length>0)e.forEach((i,o)=>{this.saveTimbre(i,o==e.length-1)});else{this.messageError$.next("Donn\xE9es incorrectes");return}}))}saveBloc(t){W([this.timbreBlocService.upload(t,"autre"),this.timbreBlocService.upload(t,"table"),this.timbreBlocService.upload(t,"zoom")]).pipe(M(([e,i,o])=>p(e)&&p(o)&&p(i))).subscribe(([e,i,o])=>{p(i)&&i!="nok"&&t.setImage(i),p(e)&&e!="nok"&&t.setImageTable(e),p(o)&&o!="nok"&&t.setImageZoom(o),t?.getTimbreBlocAcquisModel()?.isAcquis()&&this.timbreBlocService.addAcquis(t?.getTimbreBlocAcquisModel()?.getIdUser(),t,t?.getTimbreBlocAcquisModel()?.isDoublon()),this.timbreBlocService.ajouter(t,!1)})}saveTimbre(t,e){W([this.timbreService.upload(t,"autre"),this.timbreService.upload(t,"table"),this.timbreService.upload(t,"zoom")]).pipe(M(([i,o,r])=>p(i)&&p(r)&&p(o))).subscribe(([i,o,r])=>{p(o)&&o!="nok"&&t.setImage(o),p(i)&&i!="nok"&&t.setImageTable(i),p(r)&&r!="nok"&&t.setImageZoom(r),t?.getTimbreAcquisModel()?.isAcquis()&&this.timbreService.addAcquis(t?.getTimbreAcquisModel()?.getIdUser(),t,t?.getTimbreAcquisModel()?.isDoublon()),this.timbreService.ajouter(t,e),e&&(this.load$.next(!0),this.close())})}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||n)(v(qe),v(H),v(oe),v(G),v(tt),v(ie),v(fe))};static \u0275cmp=V({type:n,selectors:[["app-timbre-importer"]],decls:8,vars:4,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],[3,"ngIf","ngIfElse"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","start stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","column","fxLayoutGap","20px",1,"bloc-modal"],[3,"innerHTML",4,"ngIf"],[3,"timbres$","modif",4,"ngIf"],["fxLayout","row","fxLayoutGap","20px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["fxLayout","row","fxLayoutAlign","end center","class","form-input select noError","style","width: 150px",4,"ngIf"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","file","accept",".xls, .xlsx, .csv","hidden","","required","",3,"change","id"],["type","button","mat-raised-button","","color","accent",1,"rounded","large","color-white",3,"click"],["type","submit","class","rounded large color-white","mat-raised-button","","color","accent",4,"ngIf"],[3,"innerHTML"],[3,"timbres$","modif"],["fxLayout","row","fxLayoutAlign","end center",1,"form-input","select","noError",2,"width","150px"],["name","anneeSelect","multiple","",3,"ngModelChange","ngModel","placeholder"],["class","selectMin",3,"value",4,"ngFor","ngForOf"],[1,"selectMin",3,"value"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"]],template:function(e,i){if(e&1&&(m(0,"div",2)(1,"div",3)(2,"span"),d(3,"TIMBRE IMPORTER"),a()(),b(4,Mo,2,3,"ng-template",4),x(5,"async"),b(6,Io,18,16,"ng-template",null,0,Q),a()),e&2){let o=O(7);l(4),s("ngIf",T(5,2,i.load$)==!1)("ngIfElse",o)}},dependencies:[ee,Ze,Xe,Ye,_e,he,k,X,K,ue,J,pe,Ce,Se,de,Me,be,ve,te,Qt,P]})};var Eo=["canvas"];function Ao(n,t){n&1&&_(0,"lib-spinner",5),n&2&&s("textSpec","Chargement en cours ...")}function Do(n,t){if(n&1&&(_(0,"mat-error",21),x(1,"async")),n&2){let e=c(2);s("innerHTML",T(1,1,e.messageError$),Fe)}}function Ro(n,t){if(n&1){let e=w();m(0,"div",10)(1,"label"),_(2,"lib-libelle-model",11),a(),m(3,"input",22),F("ngModelChange",function(o){f(e);let r=c(2);return N(r.timbreBlocModel.id,o)||(r.timbreBlocModel.id=o),g(o)}),a()()}if(n&2){let e=c(2);l(2),s("object",e.timbreBlocModel)("key","id"),l(),U("ngModel",e.timbreBlocModel.id),s("disabled",!!(e.timbreBlocModel!=null&&e.timbreBlocModel.getId()))}}function Oo(n,t){if(n&1){let e=w();m(0,"form",6,1),C("ngSubmit",function(){f(e);let o=O(1),r=c();return g(r.valider(o))}),m(2,"div",7),b(3,Do,2,3,"mat-error",8),x(4,"async"),b(5,Ro,4,4,"div",9),m(6,"div",10)(7,"label"),_(8,"lib-libelle-model",11),a(),m(9,"input",12),F("ngModelChange",function(o){f(e);let r=c();return N(r.timbreBlocModel.annee,o)||(r.timbreBlocModel.annee=o),g(o)}),a()(),m(10,"div",10)(11,"label"),_(12,"lib-libelle-model",11),a(),m(13,"input",13),F("ngModelChange",function(o){f(e);let r=c();return N(r.timbreBlocModel.monnaie,o)||(r.timbreBlocModel.monnaie=o),g(o)}),a()(),m(14,"div",14)(15,"div",10)(16,"label"),_(17,"lib-libelle-model",11),a(),m(18,"input",15),F("ngModelChange",function(o){f(e);let r=c();return N(r.timbreBlocModel.yt,o)||(r.timbreBlocModel.yt=o),g(o)}),a()(),_(19,"div",16),a(),m(20,"lib-upload",17),C("outPutObject",function(o){f(e);let r=c();return g(r.timbreBlocModel=o)}),a()(),m(21,"div",18)(22,"button",19),C("click",function(){f(e);let o=c();return g(o.close())}),d(23," Annuler "),a(),m(24,"button",20),d(25," Enregistrer "),a()()()}if(n&2){let e=O(1),i=c();s("ngClass",e!=null&&e.submitted?"red-color":"blue-color"),l(3),s("ngIf",T(4,18,i.messageError$)),l(2),s("ngIf",i.timbreBlocModel==null?null:i.timbreBlocModel.getId()),l(3),s("object",i.timbreBlocModel)("key","annee"),l(),U("ngModel",i.timbreBlocModel.annee),s("max",i.maxAnnee)("zMax",i.maxAnnee),l(3),s("object",i.timbreBlocModel)("key","monnaie"),l(),U("ngModel",i.timbreBlocModel.monnaie),l(4),s("object",i.timbreBlocModel)("key","yt"),l(),U("ngModel",i.timbreBlocModel.yt),l(2),s("object",i.timbreBlocModel)("key","image")("maxWidth",i.timbreBlocService.widthTimbre)("maxHeight",i.timbreBlocService.heightTimbre)}}var Yt=class n{constructor(t,e,i,o){this.httpResponseHandlerService=t;this.dialogRef=e;this.utilsService=i;this.timbreBlocService=o}canvas;messageError$=new E(null);load$=new E(null);id;maxAnnee=new Date().getFullYear();timbreBlocModel=new Ee;fileUploadModel=new mt;ngOnInit(){this.initUpload(),this.load$.next(!1),p(this.id)?this.timbreBlocService.getBlocByIdAsync(this.id).subscribe(t=>{this.timbreBlocModel=t,this.load$.next(!0)}):(this.timbreBlocModel.setAnnee(new Date().getFullYear()),this.timbreBlocModel.setMonnaie("E"),this.load$.next(!0))}initUpload(){this.fileUploadModel.setDossier("test"),this.fileUploadModel.setNom(new Date().getTime()?.toString());let t=new De;t.setMaxWidth(this.timbreBlocService.widthTimbre),t.setMaxHeight(this.timbreBlocService.heightTimbre),t.setDossier("autre");let e=new De;e.setMaxWidth(this.timbreBlocService.widthTimbreZoom),e.setMaxHeight(this.timbreBlocService.heightTimbreZoom),e.setDossier("zoom"),this.fileUploadModel.setDetail([t,e])}valider(t){if(this.messageError$.next(null),t?.valid)if(p(this.timbreBlocModel.getImage()))this.saveData();else{this.messageError$.next("Veuillez s\xE9lectionner une image");return}}saveData(){this.load$.next(!1),p(this.timbreBlocModel.getId())?this.save():this.ajouter()}ajouter(){this.utilsService.getMaxIdentAsync("/timbres_bloc").pipe(M()).subscribe(t=>{this.timbreBlocModel.setId(t),this.save(!0)})}save(t){try{W([this.timbreBlocService.upload(this.timbreBlocModel,"autre"),this.timbreBlocService.upload(this.timbreBlocModel,"table"),this.timbreBlocService.upload(this.timbreBlocModel,"zoom")]).pipe(M(([e,i,o])=>p(e)&&p(o)&&p(i))).subscribe(([e,i,o])=>{p(i)&&i!="nok"&&this.timbreBlocModel.setImage(i),p(e)&&e!="nok"&&this.timbreBlocModel.setImageTable(e),p(o)&&o!="nok"&&this.timbreBlocModel.setImageZoom(o),t?this.timbreBlocService.ajouter(this.timbreBlocModel,!0):this.timbreBlocService.modifier(this.timbreBlocModel),this.httpResponseHandlerService.showNotificationSuccess("Transaction termin\xE9e","Votre timbre a bien \xE9t\xE9 modifi\xE9e."),this.load$.next(!0),this.dialogRef.close()})}catch{this.httpResponseHandlerService.showNotificationError("Transaction non aboutie","Votre timbre n'a pas pu \xEAtre modifi\xE9."),this.load$.next(!0)}}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||n)(v(Ut),v(fe),v(ie),v(oe))};static \u0275cmp=V({type:n,selectors:[["app-timbre-modifier-bloc"]],viewQuery:function(e,i){if(e&1&&ae(Eo,5),e&2){let o;se(o=ce())&&(i.canvas=o.first)}},decls:10,vars:6,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],[3,"ngIf","ngIfElse"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","space-between stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","column","fxLayoutGap","20px",1,"bloc-modal"],[3,"innerHTML",4,"ngIf"],["fxLayout","column","class","form-input",4,"ngIf"],["fxLayout","column",1,"form-input"],[3,"object","key"],["name","page","type","number","minlength","4","maxlength","4","min","1900","zMin","1900","required","","zControl","",1,"annee",2,"width","60px !important",3,"ngModelChange","ngModel","max","zMax"],["name","monnaie","type","text","trim","","minlength","1","maxlength","2","required","","zControl","",2,"width","25px !important",3,"ngModelChange","ngModel"],["fxLayout","row","fxLayout.lt-lg","column","fxLayoutGap","30px","fxLayoutGap.lt-lg","5px"],["name","yt","type","text","trim","","zControl","",3,"ngModelChange","ngModel"],["fxHide.lt-lg","","fxLayout","column",1,"form-input"],[3,"outPutObject","object","key","maxWidth","maxHeight"],["fxLayout","row","fxLayoutGap","10px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"],[3,"innerHTML"],["name","code","type","text","trim","","upperCase","","noEspace","","required","","zControl","",3,"ngModelChange","ngModel","disabled"]],template:function(e,i){if(e&1&&(m(0,"div",2)(1,"div",3)(2,"span"),d(3),a(),m(4,"span"),d(5),a()(),b(6,Ao,1,1,"ng-template",4),x(7,"async"),b(8,Oo,26,20,"ng-template",null,0,Q),a()),e&2){let o=O(9);l(3),S("",i.timbreBlocModel!=null&&i.timbreBlocModel.getId()?"MODIFICATION":"AJOUT"," BLOC "),l(2),_t(i.timbreBlocModel==null?null:i.timbreBlocModel.getId()),l(),s("ngIf",T(7,4,i.load$)==!1)("ngIfElse",o)}},dependencies:[ee,Ze,_e,k,X,K,ue,J,pe,ke,Ce,Se,Pe,$e,de,Me,ze,Qe,Ge,We,He,be,ve,Ie,te,ui,Je,Nt,it,nt,Ci,Ft,P],encapsulation:2})};function Lo(n,t){n&1&&_(0,"lib-spinner",5),n&2&&s("textSpec","Suppression en cours")}function Uo(n,t){if(n&1){let e=w();m(0,"form",6,1),C("ngSubmit",function(){f(e);let o=O(1),r=c();return g(r.valider(o))}),m(2,"div",7)(3,"div",8)(4,"input",9),F("ngModelChange",function(o){f(e);let r=c();return N(r.annee,o)||(r.annee=o),g(o)}),a()(),m(5,"button",10),C("click",function(){f(e);let o=c();return g(o.close())}),d(6," Annuler "),a(),m(7,"button",11),d(8," Supprimer "),a()()()}if(n&2){let e=O(1),i=c();s("ngClass",e!=null&&e.submitted?"red-color":"blue-color"),l(4),U("ngModel",i.annee),s("max",i.maxAnnee)("zMax",i.maxAnnee)}}var Zt=class n{constructor(t,e,i){this.dialog=t;this.dialogRef=e;this.timbreSupprimService=i}maxAnnee=new Date().getFullYear();annee=new Date().getFullYear();valider(t){if(t?.valid){let e=this.dialog.open(jt,{maxHeight:"95vh",data:{titre:"Confirmation",message:"Souhaitez-vous supprimer les timbres ?",btnDroite:"Oui",btnGauche:"Non"}});e.afterClosed().subscribe(()=>{e.componentInstance.data.resultat==="valider"&&(this.timbreSupprimService.loadGlob$.next(!1),this.timbreSupprimService.supprimerTimbres(this.annee),this.timbreSupprimService.load$.pipe(M(i=>i==!0)).subscribe(i=>{this.timbreSupprimService.supprimerBlocs(this.annee),this.timbreSupprimService.load$.pipe(M(o=>o==!0)).subscribe(o=>{this.timbreSupprimService.loadGlob$.next(!0)})}))})}}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||n)(v(ye),v(fe),v(Ae))};static \u0275cmp=V({type:n,selectors:[["app-timbre-supprim-choix-annee"]],decls:8,vars:4,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],[3,"ngIf","ngIfElse"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","start stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","row","fxLayoutGap","20px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["fxLayout","column","fxFlex","20","fxLayoutAlign","end end",1,"form-input","noError"],["name","annee","type","number","minlength","4","maxlength","4","min","1900","zMin","1900","required","","zControl","",2,"width","60px !important",3,"ngModelChange","ngModel","max","zMax"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"]],template:function(e,i){if(e&1&&(m(0,"div",2)(1,"div",3)(2,"span"),d(3,"TIMBRE IMPORTER"),a()(),b(4,Lo,1,1,"ng-template",4),x(5,"async"),b(6,Uo,9,4,"ng-template",null,0,Q),a()),e&2){let o=O(7);l(4),s("ngIf",T(5,2,i.timbreSupprimService.loadGlob$)==!1)("ngIfElse",o)}},dependencies:[ee,_e,k,X,K,ue,J,pe,Ce,Se,Pe,$e,de,Me,ze,Qe,Ge,We,He,be,ve,te,Je,it,nt,P],styles:[".mat-row[_ngcontent-%COMP%]{height:35px}.image[_ngcontent-%COMP%]{max-height:30px!important}.mat-column-acquis[_ngcontent-%COMP%], .mat-column-doublon[_ngcontent-%COMP%]{width:60px!important;max-width:60px!important;padding:0!important}.mat-column-ajouter[_ngcontent-%COMP%], .mat-column-modifier[_ngcontent-%COMP%], .mat-column-supprimer[_ngcontent-%COMP%]{width:35px!important;max-width:35px!important;padding:0!important}@media screen and (max-width: 800px){.mat-row[_ngcontent-%COMP%]{height:25px}.image[_ngcontent-%COMP%]{max-height:20px!important}.mat-column-acquis[_ngcontent-%COMP%], .mat-column-doublon[_ngcontent-%COMP%]{width:50px!important;max-width:50px!important;padding:0!important}.mat-column-ajouter[_ngcontent-%COMP%], .mat-column-modifier[_ngcontent-%COMP%], .mat-column-supprimer[_ngcontent-%COMP%]{width:20px!important;max-width:20px!important;padding:0!important}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:0 5px!important}th[_ngcontent-%COMP%], .mat-row[_ngcontent-%COMP%]{font-size:.8em}.mat-column-libelle[_ngcontent-%COMP%],   .mat-column-libelle .mat-sort-header-container{width:40px!important;max-width:40px!important}.mat-column-drapeau[_ngcontent-%COMP%],   .mat-column-drapeau span{width:15px!important;max-width:15px!important}.mat-column-classeur[_ngcontent-%COMP%],   .mat-column-classeur .mat-sort-header-container, .mat-column-page[_ngcontent-%COMP%],   .mat-column-page .mat-sort-header-container{width:15px!important;max-width:15px!important}.mat-column-total[_ngcontent-%COMP%],   .mat-column-total .mat-sort-header-container{width:25px!important;max-width:25px!important}.hide-on-mobile[_ngcontent-%COMP%]{display:none}}"]})};var No=n=>[n];function Fo(n,t){if(n&1){let e=w();m(0,"lib-icon",2),C("click",function(){f(e);let o=c();return g(o.supprimer())}),a()}if(n&2){let e=c();s("icone",e.FontAwesomeEnum.ROTATE)("type",e.FontAwesomeTypeEnum.TYPE_SOLID)("attribs",ni(5,No,e.FontAwesomeAttributEnum.SPIN))("info","Supprimer en cours")("classInfo","tooltiptextDescription tooltiptextBgWhite widthAuto")}}function qo(n,t){if(n&1){let e=w();m(0,"lib-icon",3),C("click",function(){f(e);let o=c();return g(o.supprimer())}),a()}if(n&2){let e=c();s("icone",e.FontAwesomeEnum.TRASH)("type",e.FontAwesomeTypeEnum.TYPE_SOLID)("info","Supprimer les timbres")("classInfo","tooltiptextDescription tooltiptextBgWhite widthAuto")}}var Xt=class n{constructor(t,e){this.dialog=t;this.timbreSupprimService=e}FontAwesomeEnum=Ve;FontAwesomeTypeEnum=je;FontAwesomeAttributEnum=li;supprimer(){this.dialog.open(Zt,{maxHeight:"50vh",width:"300px"})}static \u0275fac=function(e){return new(e||n)(v(ye),v(Ae))};static \u0275cmp=V({type:n,selectors:[["app-timbre-supprim"]],decls:4,vars:6,consts:[["class","warn click","style","font-size: 2em",3,"icone","type","attribs","info","classInfo","click",4,"ngIf"],["class","warn click","style","font-size: 2em",3,"icone","type","info","classInfo","click",4,"ngIf"],[1,"warn","click",2,"font-size","2em",3,"click","icone","type","attribs","info","classInfo"],[1,"warn","click",2,"font-size","2em",3,"click","icone","type","info","classInfo"]],template:function(e,i){e&1&&(b(0,Fo,1,7,"lib-icon",0),x(1,"async"),b(2,qo,1,4,"lib-icon",1),x(3,"async")),e&2&&(s("ngIf",T(1,2,i.timbreSupprimService.loadGlob$)==!1),l(2),s("ngIf",T(3,4,i.timbreSupprimService.loadGlob$)==!0))},dependencies:[k,et,P],encapsulation:2})};function Vo(n,t){if(n&1){let e=w();A(0),m(1,"lib-icon",6),C("click",function(){let o=f(e).$implicit,r=c(2);return g(r.headerService.setRoute(o.getRoute()))}),a(),D()}if(n&2){let e=t.$implicit;l(),s("icone",e==null?null:e.getIcone())("type",e==null?null:e.getType())("info",e==null?null:e.getInfo())("classInfo","tooltiptextDescription tooltiptextBgWhite widthAuto")}}function ko(n,t){if(n&1&&(A(0),b(1,Vo,2,4,"ng-container",5),x(2,"async"),D()),n&2){let e=c();l(),s("ngForOf",T(2,1,e.headerService.choixRoutesTimbre$))}}function Po(n,t){if(n&1){let e=w();m(0,"button",3),C("click",function(){f(e);let o=c();return g(o.ajouter())}),d(1," Ajouter "),a()}}function $o(n,t){n&1&&(A(0),d(1,"\xA0Bloc"),D())}function Ho(n,t){if(n&1){let e=w();m(0,"lib-icon",7),C("click",function(){f(e);let o=c();return g(o.importer())}),a()}if(n&2){let e=c();s("icone",e.FontAwesomeEnum.UPLOAD)("type",e.FontAwesomeTypeEnum.TYPE_SOLID)("info","Importer les timbres")("classInfo","tooltiptextDescription tooltiptextBgWhite widthAuto")}}function Wo(n,t){n&1&&_(0,"app-timbre-supprim")}var Ni=class n{constructor(t,e,i){this.headerService=t;this.timbreService=e;this.dialog=i}FontAwesomeEnum=Ve;RouteEnum=ri;FontAwesomeTypeEnum=je;ajouter(){let t=this.dialog.open(at,{maxHeight:"95vh",width:"30%"});t.afterClosed().subscribe(()=>{t.close()})}ajouterBloc(){let t=this.dialog.open(Yt,{maxHeight:"95vh",width:"30%"});t.afterClosed().subscribe(()=>{t.close()})}ajouterBouchon(){this.timbreService.ajouterSansId(this.timbreService.getBouchon())}importer(){let t=this.dialog.open(Gt,{height:"90vh",width:"70%"});t.afterClosed().subscribe(()=>{t.close()})}static \u0275fac=function(e){return new(e||n)(v(mi),v(H),v(ye))};static \u0275cmp=V({type:n,selectors:[["app-menu"]],decls:13,vars:15,consts:[["fxLayout","row","fxLayoutGap","20px"],[4,"ngIf"],["class","rounded large color-white","mat-raised-button","","color","primary",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["class","accent click","style","font-size: 2em",3,"icone","type","info","classInfo","click",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"primary","click",2,"font-size","2em",3,"click","icone","type","info","classInfo"],[1,"accent","click",2,"font-size","2em",3,"click","icone","type","info","classInfo"]],template:function(e,i){if(e&1&&(m(0,"div",0),b(1,ko,3,3,"ng-container",1),x(2,"async"),b(3,Po,2,0,"button",2),x(4,"async"),m(5,"button",3),C("click",function(){return i.ajouterBloc()}),d(6," Ajouter "),b(7,$o,2,0,"ng-container",1),x(8,"async"),a(),b(9,Ho,1,4,"lib-icon",4),x(10,"async"),b(11,Wo,1,0,"app-timbre-supprim",1),x(12,"async"),a()),e&2){let o;l(),s("ngIf",((o=T(2,5,i.headerService.choixRoutesTimbre$))==null?null:o.length)>0),l(2),s("ngIf",T(4,7,i.headerService.route$)==i.RouteEnum.TIMBRE),l(4),s("ngIf",T(8,9,i.headerService.route$)==i.RouteEnum.TIMBRE),l(2),s("ngIf",T(10,11,i.headerService.route$)==i.RouteEnum.TIMBRE),l(2),s("ngIf",T(12,13,i.headerService.route$)==i.RouteEnum.TIMBRE)}},dependencies:[he,k,X,K,et,ee,Xt,P],encapsulation:2})};export{$ as a,ne as b,G as c,oe as d,H as e,Yt as f,kt as g,$t as h,Qt as i,Gt as j,Ni as k,wi as l};

import{a as Ze,b as K,c as Lt,d as Ye,e as Xe,f as Ut,g as Ti,h as Li,i as Mi,j as qt,k as Ui,l as Nt}from"./chunk-LB4AWIUO.js";import{B as Ot}from"./chunk-DH2KDA45.js";import{a as pi,d as Qe,e as de,f as xi,h as Me}from"./chunk-5RX37K4O.js";import{a as we}from"./chunk-TKUAFQV7.js";import{A as h,Aa as Be,Ac as Ct,Ba as Ie,Bb as pe,Bc as vt,Ca as Y,Cb as ge,Cc as St,Db as li,Dc as bi,Eb as ht,Ec as yt,Fa as G,Fb as Oe,Fc as Bt,Ga as gt,Gc as fi,Hc as It,I as ye,Ia as ii,Ib as he,Ic as wt,J as rt,Jb as Le,Jc as gi,K as l,Kb as Ue,Kc as Et,L as B,Lb as _e,Lc as At,Mb as qe,Mc as hi,Nb as Ne,Nc as Dt,Ob as Fe,Oc as We,Pb as je,Pc as _i,Q as b,Qb as Pe,Qc as Ge,R as s,Rb as Ve,Rc as Rt,Sb as ke,Tb as _t,Ub as mi,Vb as xt,W as m,Wb as ai,X as a,Xb as si,Y as _,Yb as ci,Z as A,_ as D,aa as R,ab as ni,ba as C,bb as c,c as E,ca as p,cb as ie,da as Jt,ea as re,f as ne,fa as le,g as z,ga as me,gb as T,ha as P,hb as X,ia as d,ib as Se,ic as $e,ja as bt,jc as ue,ka as I,kc as ui,l as M,la as ei,lc as He,m as pt,ma as N,na as F,nc as ze,oa as j,p as oe,pb as be,q as ut,qb as Ee,ra as ft,rb as Ae,s as L,sa as ti,sb as oi,sc as di,tb as ri,tc as Tt,u as Q,ua as v,ub as De,v as dt,va as S,vb as Re,wa as ae,wc as xe,xb as se,yb as ce,yc as Te,z as g,zb as fe,zc as Mt}from"./chunk-QQYM6OGW.js";import{g as Kt,i as x}from"./chunk-GV7GV3NK.js";var V=class extends X{annees;acquis;doublon;idBloc;bloc;carnet;getAnnees(){return this.annees}setAnnees(e){this.annees=e}getAcquis(){return this.acquis}setAcquis(e){this.acquis=e}getDoublon(){return this.doublon}setDoublon(e){this.doublon=e}getIdBloc(){return this.idBloc}setIdBloc(e){this.idBloc=e}getCarnet(){return this.carnet}setCarnet(e){this.carnet=e}getBloc(){return this.bloc}setBloc(e){this.bloc=e}};x([T("Ann\xE9e")],V.prototype,"annees",2),x([T("Acquis")],V.prototype,"acquis",2),x([T("Doublon")],V.prototype,"doublon",2),x([T("Ident bloc")],V.prototype,"idBloc",2),x([T("Bloc")],V.prototype,"bloc",2),x([T("Carnet")],V.prototype,"carnet",2);var O=class extends X{id;idBloc;annee;monnaie;type;yt;image;imageTable;imageZoom;timbreAcquisModel;timbreBlocModel;constructor(e,t,i,n,r,u,f,y,w,H,U){super(),this.id=e||null,this.idBloc=t||null,this.annee=i||null,this.monnaie=n||null,this.type=r||null,this.yt=u||null,this.image=f||null,this.imageTable=y||null,this.imageZoom=w||null,this.timbreAcquisModel=H||null,this.timbreBlocModel=U||null}getId(){return this.id}setId(e){this.id=e}getIdBloc(){return this.idBloc}setIdBloc(e){this.idBloc=e}getAnnee(){return this.annee}setAnnee(e){this.annee=e}getMonnaie(){return this.monnaie}setMonnaie(e){this.monnaie=e}getType(){return this.type}setType(e){this.type=e}getYt(){return this.yt}setYt(e){this.yt=e}getImage(){return this.image}setImage(e){this.image=e}getImageTable(){return this.imageTable}setImageTable(e){this.imageTable=e}getImageZoom(){return this.imageZoom}setImageZoom(e){this.imageZoom=e}getTimbreAcquisModel(){return this.timbreAcquisModel}setTimbreAcquisModel(e){this.timbreAcquisModel=e}getTimbreBlocModel(){return this.timbreBlocModel}setTimbreBlocModel(e){this.timbreBlocModel=e}};x([T("Identifiant")],O.prototype,"id",2),x([T("Identifiant bloc")],O.prototype,"idBloc",2),x([T("Ann\xE9e")],O.prototype,"annee",2),x([T("Monnaie")],O.prototype,"monnaie",2),x([T("Type")],O.prototype,"type",2),x([T("R\xE9ference Yvert Tellier")],O.prototype,"yt",2),x([T("Image")],O.prototype,"image",2),x([T("Image tableau")],O.prototype,"imageTable",2),x([T("Image zoom")],O.prototype,"imageZoom",2),x([T("v\xE9rif")],O.prototype,"timbreAcquisModel",2),x([T("Bloc")],O.prototype,"timbreBlocModel",2);var W=class extends X{idUser;idTimbre;acquis;doublon;constructor(e,t,i,n){super(),this.idUser=e||null,this.idTimbre=t||null,this.acquis=i||!1,this.doublon=n||!1}getIdUser(){return this.idUser}setIdUser(e){this.idUser=e}getIdTimbre(){return this.idTimbre}setIdTimbre(e){this.idTimbre=e}isAcquis(){return this.acquis}setAcquis(e){this.acquis=e}isDoublon(){return this.doublon}setDoublon(e){this.doublon=e}};x([T("Identifiant Utilisateur")],W.prototype,"idUser",2),x([T("Identifiant timbre")],W.prototype,"idTimbre",2),x([T("Acquis")],W.prototype,"acquis",2),x([T("Doublon")],W.prototype,"doublon",2);var J=class o{constructor(e){this.firestore=e}timbreCritereModel=new V;getAnneesAsync(e){return this.firestore.collection(e,t=>{let i=t;return i=i.orderBy("annee","desc"),i}).valueChanges().pipe(ne(t=>{let i=t.map(n=>Number(n.annee)).filter(n=>c(n)&&n!=0);return Array.from(new Set(i))}))}getTimbresByCritereAsync(e){return this.getAllTimbres(e).pipe(ne(t=>this.constructTimbres(t,null,null)))}getAllTimbres(e){return this.firestore.collection("/timbres",t=>{let i=t;return c(e)&&(c(e.getAnnees())&&e.getAnnees()?.length>0&&(i=i.where("annee","in",e.getAnnees())),c(e.getBloc())&&e.getBloc()!="TOUS"?i=i.where("idBloc",e.getBloc()!="OUI"?"==":"!=",null):c(e.getIdBloc())&&(i=i.where("idBloc","==",e.getIdBloc()))),i=i.orderBy("id","asc"),i}).valueChanges()}constructTimbres(e,t,i,n){let r=[];return e?.length>0&&e.forEach(u=>{let f=this.constructTimbre(u,t,i),y=!0;c(n)&&c(f.getTimbreAcquisModel())&&(c(n.getAcquis())&&!(n.getAcquis()=="TOUS"||n.getAcquis()=="OUI"&&f.getTimbreAcquisModel().isAcquis()||n.getAcquis()=="NON"&&!f.getTimbreAcquisModel().isAcquis())&&(y=!1),c(n.getDoublon())&&!(n.getDoublon()=="TOUS"||n.getDoublon()=="OUI"&&f.getTimbreAcquisModel().isDoublon()||n.getDoublon()=="NON"&&!f.getTimbreAcquisModel().isDoublon())&&(y=!1)),y==!0&&r.push(f)}),r}constructTimbre(e,t,i){let n=Se(O,e);if(c(i)){let r=i.find(u=>u.getId()==n?.getIdBloc());c(r)&&n.setTimbreBlocModel(r)}if(c(t)){let r=t.find(u=>u.idTimbre==n.getId());c(r)?n.setTimbreAcquisModel(Se(W,r)):n.setTimbreAcquisModel(new W)}return n}supprimerTimbreAcquis(e,t){c(e?.getTimbreAcquisModel()?.getIdUser())&&this.firestore.collection("/timbres_acquis").ref.where("idTimbre","==",e.getId()).where("idUser","==",t).get().then(i=>{i.forEach(n=>{n.ref.delete()})})}supprimerTimbre(e){this.firestore.collection("/timbres").ref.where("id","==",e.getId()).get().then(t=>{t.forEach(i=>{i.ref.delete()})}).catch(t=>{console.error("Erreur de suppression :",t)})}static \u0275fac=function(t){return new(t||o)(L(be))};static \u0275prov=oe({token:o,factory:o.\u0275fac})};var q=class extends X{id;annee;carnet;monnaie;image;imageTable;imageZoom;timbreBlocAcquisModel;nbTimbres;idOrigine;constructor(e,t,i,n,r,u,f,y,w){super(),this.id=e||null,this.annee=t||null,this.carnet=i||!1,this.monnaie=n||null,this.image=r||null,this.imageTable=u||null,this.imageZoom=f||null,this.timbreBlocAcquisModel=y||null,this.nbTimbres=w||null}getId(){return this.id}setId(e){this.id=e}getAnnee(){return this.annee}setAnnee(e){this.annee=e}isCarnet(){return this.carnet}setCarnet(e){this.carnet=e}getMonnaie(){return this.monnaie}setMonnaie(e){this.monnaie=e}getImage(){return this.image}setImage(e){this.image=e}getImageTable(){return this.imageTable}setImageTable(e){this.imageTable=e}getImageZoom(){return this.imageZoom}setImageZoom(e){this.imageZoom=e}getTimbreBlocAcquisModel(){return this.timbreBlocAcquisModel}setTimbreBlocAcquisModel(e){this.timbreBlocAcquisModel=e}getNbTimbres(){return this.nbTimbres}setNbTimbres(e){this.nbTimbres=e}};x([T("Identifiant")],q.prototype,"id",2),x([T("Ann\xE9e")],q.prototype,"annee",2),x([T("Carnet")],q.prototype,"carnet",2),x([T("Monnaie")],q.prototype,"monnaie",2),x([T("Image")],q.prototype,"image",2),x([T("Image tableau")],q.prototype,"imageTable",2),x([T("Image zoom")],q.prototype,"imageZoom",2),x([T("v\xE9rif")],q.prototype,"timbreBlocAcquisModel",2),x([T("Nombre de timbres")],q.prototype,"nbTimbres",2);var ee=class extends X{idUser;idBloc;acquis;doublon;constructor(e,t,i,n){super(),this.idUser=e||null,this.idBloc=t||null,this.acquis=i||!1,this.doublon=n||!1}getIdUser(){return this.idUser}setIdUser(e){this.idUser=e}getIdBloc(){return this.idBloc}setIdBloc(e){this.idBloc=e}isAcquis(){return this.acquis}setAcquis(e){this.acquis=e}isDoublon(){return this.doublon}setDoublon(e){this.doublon=e}};x([T("Identifiant Utilisateur")],ee.prototype,"idUser",2),x([T("Identifiant bloc")],ee.prototype,"idBloc",2),x([T("Acquis")],ee.prototype,"acquis",2),x([T("Doublon")],ee.prototype,"doublon",2);var te=class o{constructor(e,t,i,n,r){this.firestore=e;this.authService=t;this.uploadService=i;this.utilsService=n;this.timbreUtilsService=r}heigthTable=50;widthTimbre=100;heightTimbre=100;widthTimbreZoom=500;heightTimbreZoom=500;total$=new E(0);timbresBlocModel$=new E(null);upload(e,t){let i=this.widthTimbre,n=this.heightTimbre;return t=="table"?(i=i*(this.heigthTable/n),n=this.heigthTable):t=="zoom"&&(i=i*(this.heightTimbreZoom/n),n=this.heightTimbreZoom),this.uploadService.processAndUploadImage(e?.getImage(),i,n,"bloc",this.getDossier(e,t))}getTotal(e){this.total$.next(null),this.getAllBlocs(e).pipe(M()).subscribe(t=>{this.total$.next(t?.length)})}getBloc(e){return this.firestore.collection("/timbres_bloc",t=>t.where("id","==",e)).valueChanges()}getBlocByIdAsync(e){return this.getBloc(e).pipe(ne(t=>Se(q,t[0])))}getAllBlocs(e){return this.firestore.collection("/timbres_bloc",t=>{let i=t;return c(e)&&(c(e.getAnnees())&&e.getAnnees()?.length>0&&(i=i.where("annee","in",e.getAnnees())),c(e.getCarnet())&&e.getCarnet()!="TOUS"&&(i=i.where("carnet",e.getCarnet()!="OUI"?"==":"!=",null))),i}).valueChanges()}getTimbreBlocAcquis(){return this.authService.getUser().pipe(M(),pt(e=>c(e)?this.getTimbreBlocAcquisByUser(e.getId()).pipe(M(),ne(t=>t)):null))}getTimbreBlocAcquisByUser(e){return this.firestore.collection("/timbres_bloc_acquis",t=>t.where("idUser","==",e)).valueChanges()}getBlocs(e){this.getTotal(),this.timbresBlocModel$.next(null),z([this.getAllBlocs(e),this.getTimbreBlocAcquis()]).pipe(M()).subscribe(([t,i])=>{this.constructBlocs(t,i,e)})}getBlocsAsync(e){return this.timbresBlocModel$.next(null),this.getAllBlocs(e).pipe(M(),ne(t=>this.constructBlocs(t,null,e)))}constructBloc(e,t){let i=Se(q,e);if(c(t)){let n=t.find(r=>r.idBloc==i.getId());c(n)?i.setTimbreBlocAcquisModel(Se(ee,n)):i.setTimbreBlocAcquisModel(new ee)}return i}constructBlocs(e,t,i){let n=[];return e?.length>0&&e.forEach(r=>{let u=this.constructBloc(r,t);this.getTimbresByBlocAsync(u.getId()).subscribe(y=>{u.setNbTimbres(y?.length)});let f=!0;c(i)&&c(u.getTimbreBlocAcquisModel())&&(c(i.getAcquis())&&!(i.getAcquis()=="TOUS"||i.getAcquis()=="OUI"&&u.getTimbreBlocAcquisModel().isAcquis()||i.getAcquis()=="NON"&&!u.getTimbreBlocAcquisModel().isAcquis())&&(f=!1),c(i.getDoublon())&&!(i.getDoublon()=="TOUS"||i.getDoublon()=="OUI"&&u.getTimbreBlocAcquisModel().isDoublon()||i.getDoublon()=="NON"&&!u.getTimbreBlocAcquisModel().isDoublon())&&(f=!1)),f==!0&&n.push(u)}),this.timbresBlocModel$.next(n),n}acquis(e,t){return this.authService.getUser().pipe(M(i=>c(i))).subscribe(i=>{c(e?.getTimbreBlocAcquisModel()?.getIdUser())?this.firestore.collection("/timbres_bloc_acquis").ref.where("idTimbre","==",e.getId()).where("idUser","==",i.getId()).get().then(n=>{n.forEach(r=>{let u=e.getTimbreBlocAcquisModel();t?(u.setAcquis(!0),u.setDoublon(!u.isDoublon())):(u.setAcquis(!u.isAcquis()),u.isAcquis()||u.setDoublon(!1)),r.ref.update(Object.assign(new Object,u))})}).catch(n=>{console.error("Erreur de mise \xE0 jour:",n)}):this.addAcquis(i?.getId(),e,t)})}addAcquis(e,t,i){let n=new ee;n.setIdUser(e),n.setIdBloc(t.getId()),n.setAcquis(!0),n.setDoublon(i),t.setTimbreBlocAcquisModel(n),this.firestore.collection("/timbres_bloc_acquis").add(Object.assign(new Object,n))}ajouterSansId(e){this.utilsService.getMaxIdentAsync("/timbres_bloc").pipe(M()).subscribe(t=>{e.setId(t),this.ajouter(e,!0)})}ajouter(e,t){this.getBloc(e.getId()).pipe(M()).subscribe(i=>{ie(i)||ie(i[0])||c(i[0])&&i[0]?.length==0?(e.setTimbreBlocAcquisModel(null),this.firestore.collection("/timbres_bloc").add(Object.assign(new Object,e)),t&&this.getBlocs()):console.error("bloc d\xE9j\xE0 existant")})}modifier(e){this.firestore.collection("/timbres_bloc").ref.where("id","==",e.getId()).get().then(t=>{t.forEach(i=>{i.ref.update(Object.assign(new Object,e)),this.getBlocs()})}).catch(t=>{console.error("Erreur de mise \xE0 jour:",t)})}getTimbresByBlocAsync(e){let t=new V;return t.setIdBloc(e),this.timbreUtilsService.getTimbresByCritereAsync(t)}supprimer(e){this.authService.getUser().pipe(M(t=>c(t))).subscribe(t=>{this.getTimbresByBlocAsync(e.getId()).pipe(M()).subscribe(i=>{i.forEach(n=>{this.timbreUtilsService.supprimerTimbreAcquis(n,t.getId()),this.timbreUtilsService.supprimerTimbre(n)})}),c(e?.getTimbreBlocAcquisModel()?.getIdUser())&&this.firestore.collection("/timbres_bloc_acquis").ref.where("idBloc","==",e.getId()).where("idUser","==",t.getId()).get().then(i=>{i.forEach(n=>{n.ref.delete()})}),this.firestore.collection("/timbres_bloc").ref.where("id","==",e.getId()).get().then(i=>{i.forEach(n=>{n.ref.delete(),this.getBlocs()})}).catch(i=>{console.error("Erreur de suppression :",i)})})}getDossier(e,t){let i="timbre//"+e.getAnnee();return c(t)&&(i=i+"/"+t),i=i+"/bloc/"+e.getId(),i}getBouchon(){let e=new q;return e.setAnnee(new Date().getFullYear()),e.setMonnaie("E"),e}static \u0275fac=function(t){return new(t||o)(L(be),L(we),L(Ze),L(K),L(J))};static \u0275prov=oe({token:o,factory:o.\u0275fac})};var k=class o{constructor(e,t,i,n,r,u){this.firestore=e;this.authService=t;this.timbreBlocService=i;this.uploadService=n;this.utilsService=r;this.timbreUtilsService=u}heigthTable=50;widthTimbre=100;heightTimbre=100;widthTimbreZoom=500;heightTimbreZoom=500;total$=new E(0);timbres$=new E(null);getTimbre(e){return this.firestore.collection("/timbres",t=>t.where("id","==",e)).valueChanges()}getTimbreByIdAsync(e){return z([this.getTimbre(e),this.timbreBlocService.getBlocsAsync()]).pipe(ne(([t,i])=>this.timbreUtilsService.constructTimbre(t[0],null,i)))}getTotal(e){this.total$.next(null),this.timbreUtilsService.getAllTimbres(e).pipe(M()).subscribe(t=>{this.total$.next(t?.length)})}getTimbres(e){this.getTotal(),this.timbres$.next(null),z([this.timbreUtilsService.getAllTimbres(e),this.getTimbreAcquis(),this.timbreBlocService.getBlocsAsync(e)]).pipe(M()).subscribe(([t,i,n])=>{this.timbres$.next(this.timbreUtilsService.constructTimbres(t,i,n,e))})}getTimbreAcquis(){return this.authService.getUser().pipe(M(),pt(e=>c(e)?this.getTimbreAcquisByUser(e.getId()).pipe(M(),ne(t=>t)):null))}getTimbreAcquisByUser(e){return this.firestore.collection("/timbres_acquis",t=>t.where("idUser","==",e)).valueChanges()}acquis(e,t){return this.authService.getUser().pipe(M(i=>c(i))).subscribe(i=>{c(e?.getTimbreAcquisModel()?.getIdUser())?this.firestore.collection("/timbres_acquis").ref.where("idTimbre","==",e.getId()).where("idUser","==",i.getId()).get().then(n=>{n.forEach(r=>{let u=e.getTimbreAcquisModel();t?(u.setAcquis(!0),u.setDoublon(!u.isDoublon())):(u.setAcquis(!u.isAcquis()),u.isAcquis()||u.setDoublon(!1)),r.ref.update(Object.assign(new Object,u))})}).catch(n=>{console.error("Erreur de mise \xE0 jour:",n)}):this.addAcquis(i?.getId(),e,t)})}addAcquis(e,t,i){let n=new W;n.setIdUser(e),n.setIdTimbre(t.getId()),n.setAcquis(!0),n.setDoublon(i),t.setTimbreAcquisModel(n),this.firestore.collection("/timbres_acquis").add(Object.assign(new Object,n))}ajouterSansId(e){this.utilsService.getMaxIdentAsync("/timbres").pipe(M()).subscribe(t=>{e.setId(t),c(e.getIdBloc())&&e.setMonnaie(null),this.ajouter(e,!0)})}ajouter(e,t){this.getTimbre(e.getId()).pipe(M()).subscribe(i=>{ie(i)||ie(i[0])||c(i[0])&&i[0]?.length==0?(e.setTimbreAcquisModel(null),e.setTimbreBlocModel(null),this.firestore.collection("/timbres").add(Object.assign(new Object,e)),t&&this.getTimbres()):console.error("timbre d\xE9j\xE0 existant")})}modifier(e){e.setTimbreBlocModel(null),e.setTimbreAcquisModel(null),this.firestore.collection("/timbres").ref.where("id","==",e.getId()).get().then(t=>{t.forEach(i=>{i.ref.update(Object.assign(new Object,e)),this.getTimbres()})}).catch(t=>{console.error("Erreur de mise \xE0 jour:",t)})}supprimerTimbre(e){this.firestore.collection("/timbres").ref.where("id","==",e.getId()).get().then(t=>{t.forEach(i=>{i.ref.delete(),this.getTimbres()})}).catch(t=>{console.error("Erreur de suppression :",t)})}supprimer(e){this.authService.getUser().pipe(M(t=>c(t))).subscribe(t=>{this.timbreUtilsService.supprimerTimbreAcquis(e,t.getId()),this.supprimerTimbre(e)})}getBouchon(){let e=new O;return e.setAnnee(new Date().getFullYear()),e.setMonnaie("E"),e.setType(""),e.setYt(""),e}upload(e,t){let i=this.widthTimbre,n=this.heightTimbre;return t=="table"?(i=i*(this.heigthTable/n),n=this.heigthTable):t=="zoom"&&(i=i*(this.heightTimbreZoom/n),n=this.heightTimbreZoom),this.uploadService.processAndUploadImage(e?.getImage(),i,n,e?.getId(),this.getDossier(e,t))}getDossier(e,t){let i="timbre//";return c(e.getIdBloc())?i=i+e.getTimbreBlocModel().getAnnee():i=i+e.getAnnee(),c(t)&&(i=i+"/"+t),c(e.getIdBloc())&&(i=i+"/bloc/"+e.getIdBloc()),i}static \u0275fac=function(t){return new(t||o)(L(be),L(we),L(te),L(Ze),L(K),L(J))};static \u0275prov=oe({token:o,factory:o.\u0275fac})};var $=class extends X{annee;nombre;acquis;doublon;nombreCarnet;nombreBloc;acquisBloc;doublonBloc;constructor(e,t,i,n,r,u,f,y){super(),this.annee=e||null,this.nombre=t||0,this.acquis=i||0,this.doublon=n||0,this.nombreCarnet=r||0,this.nombreBloc=u||0,this.acquisBloc=f||0,this.doublonBloc=y||0}getAnnee(){return this.annee}setAnnee(e){this.annee=e}getNombre(){return this.nombre}setNombre(e){this.nombre=e}getAcquis(){return this.acquis}setAcquis(e){this.acquis=e}getDoublon(){return this.doublon}setDoublon(e){this.doublon=e}getNombreCarnet(){return this.nombreCarnet}setNombreCarnet(e){this.nombreCarnet=e}getNombreBloc(){return this.nombreBloc}setNombreBloc(e){this.nombreBloc=e}getAcquisBloc(){return this.acquisBloc}setAcquisBloc(e){this.acquisBloc=e}getDoublonBloc(){return this.doublonBloc}setDoublonBloc(e){this.doublonBloc=e}};x([T("Ann\xE9e")],$.prototype,"annee",2),x([T("Total")],$.prototype,"nombre",2),x([T("Acquis")],$.prototype,"acquis",2),x([T("Doublon")],$.prototype,"doublon",2),x([T("Total carnet")],$.prototype,"nombreCarnet",2),x([T("Total bloc")],$.prototype,"nombreBloc",2),x([T("Acquis")],$.prototype,"acquisBloc",2),x([T("Doublon")],$.prototype,"doublonBloc",2);var jt=class o{constructor(e,t,i){this.timbreService=e;this.timbreBlocService=t;this.timbreUtilsService=i}timbresResume$=new E(null);totalTimbreResume$=new E(null);getResume(e){this.timbresResume$.next(null),this.totalTimbreResume$.next(null),z([this.timbreUtilsService.getAllTimbres(e),this.timbreService.getTimbreAcquis(),this.timbreBlocService.getAllBlocs(e),this.timbreBlocService.getTimbreBlocAcquis()]).pipe(M()).subscribe(([t,i,n,r])=>{this.timbresResume$.next(this.construct(t,i,n,r))})}construct(e,t,i,n){let r=[];if(e?.length>0&&(e.forEach(u=>{let f=u.annee;if(c(i)&&ie(u.annee)&&c(u.idBloc)){let w=i.find(H=>H.id==u.idBloc);c(w)&&(f=w.annee)}let y=r.find(w=>w.getAnnee()==f);if(c(y)?y.setNombre(y.getNombre()+1):(y=new $,y.setAnnee(f),y.setNombre(1),r.push(y)),c(t)){let w=t.find(H=>H.idTimbre==u.id);c(w)&&(w.acquis==!0&&y.setAcquis(y.getAcquis()+1),w.doublon==!0&&y.setDoublon(y.getDoublon()+1))}}),i.forEach(u=>{let f=r.find(y=>y.getAnnee()==u.annee);if(ie(f)&&(f=new $,f.setAnnee(u.annee),r.push(f)),u.carnet?f.setNombreCarnet(f.getNombreCarnet()+1):f.setNombreBloc(f.getNombreBloc()+1),c(n)){let y=n.find(w=>w.idBloc==u.id);c(y)&&(y.acquis==!0&&f.setAcquisBloc(f.getAcquisBloc()+1),y.doublon==!0&&f.setDoublonBloc(f.getDoublonBloc()+1))}})),c(r)&&r?.length>0){let u=new $;r.forEach(f=>{u.setNombre(u.getNombre()+f.getNombre()),u.setAcquis(u.getAcquis()+f.getAcquis()),u.setDoublon(u.getDoublon()+f.getDoublon()),u.setNombreCarnet(u.getNombreCarnet()+f.getNombreCarnet()),u.setNombreBloc(u.getNombreBloc()+f.getNombreBloc()),u.setAcquisBloc(u.getAcquisBloc()+f.getAcquisBloc()),u.setDoublonBloc(u.getDoublonBloc()+f.getDoublonBloc())}),this.totalTimbreResume$.next(u)}return r}static \u0275fac=function(t){return new(t||o)(L(k),L(te),L(J))};static \u0275prov=oe({token:o,factory:o.\u0275fac})};var Je=class o{constructor(e){this.firestore=e}load$=new E(!0);supprimer(e,t){return this.load$.next(!1),this.firestore.collection(e).valueChanges().pipe(M()).subscribe(i=>{c(i)&&i?.length>0?(console.log(i),i.forEach((n,r)=>{this.firestore.collection(e).ref.where(t,"==",n[t]).get().then(u=>{u.forEach(f=>{console.log(f.ref),f.ref.delete(),r==i.length-1&&this.load$.next(!0)})}).catch(u=>{console.error("Erreur de suppression :",u)})})):this.load$.next(!0)})}supprimerTimbres(){this.load$.next(!1),this.firestore.collection("/timbres").valueChanges().pipe(M()).subscribe(e=>{c(e)&&e?.length>0?(console.log(e),e.forEach((t,i)=>{this.firestore.collection("/timbres").ref.where("id","==",t.id).get().then(n=>{n.forEach(r=>{console.log(r.ref),r.ref.delete(),i==e.length-1&&this.load$.next(!0)})}).catch(n=>{console.error("Erreur de suppression :",n)})})):this.load$.next(!0)})}supprimerAcquis(){this.load$.next(!1),this.firestore.collection("/timbres_acquis").valueChanges().pipe(M()).subscribe(e=>{c(e)&&e?.length>0?(console.log(e),e.forEach((t,i)=>{this.firestore.collection("/timbres_acquis").ref.where("idTimbre","==",t.idTimbre).get().then(n=>{n.forEach(r=>{console.log(r.ref),r.ref.delete(),i==e.length-1&&this.load$.next(!0)})}).catch(n=>{console.error("Erreur de suppression :",n)})})):this.load$.next(!0)})}supprimerBlocs(){this.load$.next(!1),this.firestore.collection("/timbres_bloc_acquis").valueChanges().pipe(M()).subscribe(e=>{c(e)&&e?.length>0?(console.log(e),e.forEach((t,i)=>{this.firestore.collection("/timbres_bloc_acquis").ref.where("idBloc","==",t.idBloc).get().then(n=>{n.forEach(r=>{console.log(r.ref),r.ref.delete(),i==e.length-1&&this.load$.next(!0)})}).catch(n=>{console.error("Erreur de suppression :",n)})})):this.load$.next(!0)})}supprimerBlocsAcquis(){this.load$.next(!1),this.firestore.collection("/timbres_bloc").valueChanges().pipe(M()).subscribe(e=>{c(e)&&e?.length>0?(console.log(e),e.forEach((t,i)=>{this.firestore.collection("/timbres_bloc").ref.where("id","==",t.id).get().then(n=>{n.forEach(r=>{console.log(r.ref),r.ref.delete(),i==e.length-1&&this.load$.next(!0)})}).catch(n=>{console.error("Erreur de suppression :",n)})})):this.load$.next(!0)})}static \u0275fac=function(t){return new(t||o)(L(be))};static \u0275prov=oe({token:o,factory:o.\u0275fac})};var Pt=class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=dt({type:o});static \u0275inj=ut({providers:[Je,ii()],imports:[_i,gt,li,ht,_t,xi,Rt]})};var Si=class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=dt({type:o});static \u0275inj=ut({providers:[k],imports:[gt,ht,_t,ai,si,ci,mi,di,ui,Rt,ue,Pt]})};var Vi=()=>[10,20,50,100];function ki(o,e){if(o&1&&(m(0,"th",19),_(1,"lib-libelle-model",20),a()),o&2){let t=p();l(),s("object",t.timbreResumeModel)("key","annee")}}function $i(o,e){if(o&1&&(m(0,"td",21),d(1),a()),o&2){let t=e.$implicit;l(),I(" ",t==null?null:t.getAnnee()," ")}}function Hi(o,e){o&1&&_(0,"td",22)}function zi(o,e){if(o&1&&(m(0,"th",19),_(1,"lib-libelle-model",20),a()),o&2){let t=p();l(),s("object",t.timbreResumeModel)("key","nombre")}}function Wi(o,e){if(o&1&&(m(0,"td",21),d(1),a()),o&2){let t=e.$implicit;l(),I(" ",t==null?null:t.getNombre()," ")}}function Qi(o,e){if(o&1&&(m(0,"td",23)(1,"b"),d(2),v(3,"async"),a()()),o&2){let t,i=p();l(2),I("",(t=S(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:t.getNombre()," ")}}function Gi(o,e){if(o&1&&(m(0,"th",19),_(1,"lib-libelle-model",20),a()),o&2){let t=p();l(),s("object",t.timbreResumeModel)("key","acquis")}}function Zi(o,e){if(o&1&&(m(0,"td",21),d(1),a()),o&2){let t=e.$implicit;l(),I(" ",t==null?null:t.getAcquis()," ")}}function Yi(o,e){if(o&1&&(m(0,"td",23)(1,"b"),d(2),v(3,"async"),a()()),o&2){let t,i=p();l(2),I("",(t=S(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:t.getAcquis()," ")}}function Xi(o,e){if(o&1&&(m(0,"th",19),_(1,"lib-libelle-model",20),a()),o&2){let t=p();l(),s("object",t.timbreResumeModel)("key","doublon")}}function Ki(o,e){if(o&1&&(m(0,"td",21),d(1),a()),o&2){let t=e.$implicit;l(),I(" ",t==null?null:t.getDoublon()," ")}}function Ji(o,e){if(o&1&&(m(0,"td",23)(1,"b"),d(2),v(3,"async"),a()()),o&2){let t,i=p();l(2),I("",(t=S(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:t.getDoublon()," ")}}function en(o,e){if(o&1&&(m(0,"th",19),_(1,"lib-libelle-model",20),a()),o&2){let t=p();l(),s("object",t.timbreResumeModel)("key","nombreCarnet")}}function tn(o,e){if(o&1&&(m(0,"td",21),d(1),a()),o&2){let t=e.$implicit;l(),I(" ",t==null?null:t.getNombreCarnet()," ")}}function nn(o,e){if(o&1&&(m(0,"td",23)(1,"b"),d(2),v(3,"async"),a()()),o&2){let t,i=p();l(2),I("",(t=S(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:t.getNombreBloc()," ")}}function on(o,e){if(o&1&&(m(0,"th",19),_(1,"lib-libelle-model",20),a()),o&2){let t=p();l(),s("object",t.timbreResumeModel)("key","nombreBloc")}}function rn(o,e){if(o&1&&(m(0,"td",21),d(1),a()),o&2){let t=e.$implicit;l(),I(" ",t==null?null:t.getNombreBloc()," ")}}function ln(o,e){if(o&1&&(m(0,"td",23)(1,"b"),d(2),v(3,"async"),a()()),o&2){let t,i=p();l(2),I("",(t=S(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:t.getNombreBloc()," ")}}function mn(o,e){if(o&1&&(m(0,"th",19),_(1,"lib-libelle-model",20),a()),o&2){let t=p();l(),s("object",t.timbreResumeModel)("key","acquisBloc")}}function an(o,e){if(o&1&&(m(0,"td",21),d(1),a()),o&2){let t=e.$implicit;l(),I(" ",t==null?null:t.getAcquisBloc()," ")}}function sn(o,e){if(o&1&&(m(0,"td",23)(1,"b"),d(2),v(3,"async"),a()()),o&2){let t,i=p();l(2),I("",(t=S(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:t.getAcquisBloc()," ")}}function cn(o,e){if(o&1&&(m(0,"th",19),_(1,"lib-libelle-model",20),a()),o&2){let t=p();l(),s("object",t.timbreResumeModel)("key","doublonBloc")}}function pn(o,e){if(o&1&&(m(0,"td",21),d(1),a()),o&2){let t=e.$implicit;l(),I(" ",t==null?null:t.getDoublonBloc()," ")}}function un(o,e){if(o&1&&(m(0,"td",23)(1,"b"),d(2),v(3,"async"),a()()),o&2){let t,i=p();l(2),I("",(t=S(3,1,i.timbreResumeService.totalTimbreResume$))==null?null:t.getDoublonBloc()," ")}}function dn(o,e){o&1&&_(0,"tr",24)}function bn(o,e){if(o&1){let t=R();m(0,"tr",25),C("click",function(){let n=g(t).$implicit,r=p();return h(r.filtreParAnnee(n))}),a()}}function fn(o,e){o&1&&_(0,"tr",26)}var Vt=class o{constructor(e,t,i){this.timbreResumeService=e;this.timbreService=t;this.timbreUtilsService=i;this.dataSource=new We([])}paginator;sort;load$=new E(!1);dataSource=new We;displayedColumns=["annee","nombre","acquis","doublon","nombreCarnet","nombreBloc","acquisBloc","doublonBloc"];timbreResumeModel=new $;ngOnInit(){this.timbreResumeService.getResume(),this.load$.next(!1),this.timbreResumeService.timbresResume$.subscribe(e=>{this.dataSource.data=e,this.load$.next(!0)})}ngAfterViewInit(){this.dataSource.paginator=this.paginator}sortData(e){c(e)&&(this.dataSource.sort=this.sort)}filtreParAnnee(e){this.timbreUtilsService.timbreCritereModel=new V,this.timbreUtilsService.timbreCritereModel.setAnnees([e.getAnnee()]),this.timbreService.getTimbres(this.timbreUtilsService.timbreCritereModel)}static \u0275fac=function(t){return new(t||o)(B(jt),B(k),B(J))};static \u0275cmp=Q({type:o,selectors:[["app-timbre-resume"]],viewQuery:function(t,i){if(t&1&&(re(xe,5),re(Te,5)),t&2){let n;le(n=me())&&(i.paginator=n.first),le(n=me())&&(i.sort=n.first)}},decls:41,vars:14,consts:[["fxFlexFill","",3,"fxHide","textSpec"],[3,"fxHide"],["id","pdf-content","mat-table","","matSort","",3,"matSortChange","dataSource"],["matColumnDef","annee"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-footer-cell","",4,"matFooterCellDef"],["matColumnDef","nombre"],["mat-footer-cell","","class","accent",4,"matFooterCellDef"],["matColumnDef","acquis"],["matColumnDef","doublon"],["matColumnDef","nombreCarnet"],["matColumnDef","nombreBloc"],["matColumnDef","acquisBloc"],["matColumnDef","doublonBloc"],["mat-header-row","","class","bg-primary color-white",4,"matHeaderRowDef"],["mat-row","","class","mat-row",3,"click",4,"matRowDef","matRowDefColumns"],["mat-footer-row","",4,"matFooterRowDef"],[3,"pageSize","pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],[3,"object","key"],["mat-cell",""],["mat-footer-cell",""],["mat-footer-cell","",1,"accent"],["mat-header-row","",1,"bg-primary","color-white"],["mat-row","",1,"mat-row",3,"click"],["mat-footer-row",""]],template:function(t,i){t&1&&(_(0,"lib-spinner",0),v(1,"async"),m(2,"section",1),v(3,"async"),m(4,"table",2),C("matSortChange",function(r){return i.sortData(r)}),A(5,3),b(6,ki,2,2,"th",4)(7,$i,2,1,"td",5)(8,Hi,1,0,"td",6),D(),A(9,7),b(10,zi,2,2,"th",4)(11,Wi,2,1,"td",5)(12,Qi,4,3,"td",8),D(),A(13,9),b(14,Gi,2,2,"th",4)(15,Zi,2,1,"td",5)(16,Yi,4,3,"td",8),D(),A(17,10),b(18,Xi,2,2,"th",4)(19,Ki,2,1,"td",5)(20,Ji,4,3,"td",8),D(),A(21,11),b(22,en,2,2,"th",4)(23,tn,2,1,"td",5)(24,nn,4,3,"td",8),D(),A(25,12),b(26,on,2,2,"th",4)(27,rn,2,1,"td",5)(28,ln,4,3,"td",8),D(),A(29,13),b(30,mn,2,2,"th",4)(31,an,2,1,"td",5)(32,sn,4,3,"td",8),D(),A(33,14),b(34,cn,2,2,"th",4)(35,pn,2,1,"td",5)(36,un,4,3,"td",8),D(),b(37,dn,1,0,"tr",15)(38,bn,1,0,"tr",16)(39,fn,1,0,"tr",17),a(),_(40,"mat-paginator",18),a()),t&2&&(s("fxHide",S(1,9,i.load$)==!0)("textSpec","Chargement en cours ..."),l(2),s("fxHide",S(3,11,i.load$)==!1),l(2),s("dataSource",i.dataSource),l(33),s("matHeaderRowDef",i.displayedColumns),l(),s("matRowDefColumns",i.displayedColumns),l(),s("matFooterRowDef",i.displayedColumns),l(),s("pageSize",15)("pageSizeOptions",ft(13,Vi)))},dependencies:[Ct,St,wt,yt,vt,Et,bi,gi,Bt,It,fi,At,Dt,hi,xe,Te,Mt,pe,Re,de,Me,G],styles:[".mat-row[_ngcontent-%COMP%]{height:35px}.image[_ngcontent-%COMP%]{max-height:30px!important}.mat-column-acquis[_ngcontent-%COMP%], .mat-column-doublon[_ngcontent-%COMP%]{width:60px!important;max-width:60px!important;padding:0!important}.mat-column-ajouter[_ngcontent-%COMP%], .mat-column-modifier[_ngcontent-%COMP%], .mat-column-supprimer[_ngcontent-%COMP%]{width:35px!important;max-width:35px!important;padding:0!important}@media screen and (max-width: 800px){.mat-row[_ngcontent-%COMP%]{height:25px}.image[_ngcontent-%COMP%]{max-height:20px!important}.mat-column-acquis[_ngcontent-%COMP%], .mat-column-doublon[_ngcontent-%COMP%]{width:50px!important;max-width:50px!important;padding:0!important}.mat-column-ajouter[_ngcontent-%COMP%], .mat-column-modifier[_ngcontent-%COMP%], .mat-column-supprimer[_ngcontent-%COMP%]{width:20px!important;max-width:20px!important;padding:0!important}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:0 5px!important}th[_ngcontent-%COMP%], .mat-row[_ngcontent-%COMP%]{font-size:.8em}.mat-column-libelle[_ngcontent-%COMP%],   .mat-column-libelle .mat-sort-header-container{width:40px!important;max-width:40px!important}.mat-column-drapeau[_ngcontent-%COMP%],   .mat-column-drapeau span{width:15px!important;max-width:15px!important}.mat-column-classeur[_ngcontent-%COMP%],   .mat-column-classeur .mat-sort-header-container, .mat-column-page[_ngcontent-%COMP%],   .mat-column-page .mat-sort-header-container{width:15px!important;max-width:15px!important}.mat-column-total[_ngcontent-%COMP%],   .mat-column-total .mat-sort-header-container{width:25px!important;max-width:25px!important}.hide-on-mobile[_ngcontent-%COMP%]{display:none}}"]})};var Di=Kt(Li());var it=class{dossier;nom;alignLabel;detail;file;getDossier(){return this.dossier}setDossier(e){this.dossier=e}getNom(){return this.nom}setNom(e){this.nom=e}getAlignLabel(){return this.alignLabel}setAlignLabel(e){this.alignLabel=e}getDetail(){return this.detail}setDetail(e){this.detail=e}getFile(){return this.file}setFile(e){this.file=e}};var ve=class{key;dossier;maxWidth;maxHeight;getKey(){return this.key}setKey(e){this.key=e}getDossier(){return this.dossier}setDossier(e){this.dossier=e}getMaxWidth(){return this.maxWidth}setMaxWidth(e){this.maxWidth=e}getMaxHeight(){return this.maxHeight}setMaxHeight(e){this.maxHeight=e}};var vn=["canvas"];function Sn(o,e){if(o&1&&(m(0,"span",6)(1,"b"),d(2),a()()),o&2){let t=p();l(2),I("N\xB0",t.timbreModel==null?null:t.timbreModel.getId(),"")}}function yn(o,e){o&1&&_(0,"lib-spinner",7),o&2&&s("textSpec","Chargement en cours ...")}function Bn(o,e){if(o&1&&(_(0,"mat-error",29),v(1,"async")),o&2){let t=p(2);s("innerHTML",S(1,1,t.messageError$),ye)}}function In(o,e){if(o&1&&(m(0,"mat-option",18),d(1),a()),o&2){let t=e.$implicit;s("value",t),l(),ei(" ",t.getAnnee()," - ",t.getId()," ")}}function wn(o,e){if(o&1){let t=R();m(0,"img",30),C("click",function(){let n;g(t);let r=p(2);return h(r.utilsService.zoom(r.timbreModel==null||(n=r.timbreModel.getTimbreBlocModel())==null?null:n.getImageZoom()))}),a()}if(o&2){let t,i=p(2);s("src",i.timbreModel==null||(t=i.timbreModel.getTimbreBlocModel())==null?null:t.getImage(),rt)}}function En(o,e){if(o&1){let t=R();m(0,"form",8,1),C("ngSubmit",function(){g(t);let n=P(1),r=p();return h(r.valider(n))}),m(2,"div",9),b(3,Bn,2,3,"mat-error",10),v(4,"async"),m(5,"div",11)(6,"div",12)(7,"label"),_(8,"lib-libelle-model",13),a(),m(9,"input",14),j("ngModelChange",function(n){g(t);let r=p();return F(r.timbreModel.annee,n)||(r.timbreModel.annee=n),h(n)}),C("ngModelChange",function(n){g(t);let r=p();return h(r.changeAnnee(n))}),a()(),m(10,"div",15)(11,"label"),_(12,"lib-libelle-model",13),a(),m(13,"div",16)(14,"mat-select",17),v(15,"async"),C("ngModelChange",function(n){g(t);let r=p();return h(r.changeBloc(n))}),_(16,"mat-option",18),b(17,In,2,3,"mat-option",19),v(18,"async"),a(),b(19,wn,1,1,"img",20),a()()(),m(20,"div",11)(21,"div",12)(22,"label"),_(23,"lib-libelle-model",13),a(),m(24,"input",21),j("ngModelChange",function(n){g(t);let r=p();return F(r.timbreModel.type,n)||(r.timbreModel.type=n),h(n)}),a()(),m(25,"div",12)(26,"label"),_(27,"lib-libelle-model",13),a(),m(28,"input",22),j("ngModelChange",function(n){g(t);let r=p();return F(r.timbreModel.monnaie,n)||(r.timbreModel.monnaie=n),h(n)}),a()()(),m(29,"div",11)(30,"div",12)(31,"label"),_(32,"lib-libelle-model",13),a(),m(33,"input",23),j("ngModelChange",function(n){g(t);let r=p();return F(r.timbreModel.yt,n)||(r.timbreModel.yt=n),h(n)}),a()(),_(34,"div",24),a(),m(35,"lib-upload",25),C("outPutObject",function(n){g(t);let r=p();return h(r.timbreModel=n)}),a()(),m(36,"div",26)(37,"button",27),C("click",function(){g(t);let n=p();return h(n.close())}),d(38," Annuler "),a(),m(39,"button",28),d(40," Enregistrer "),a()()()}if(o&2){let t,i,n=P(1),r=p();s("ngClass",n!=null&&n.submitted?"red-color":"blue-color"),l(3),s("ngIf",S(4,31,r.messageError$)),l(5),s("object",r.timbreModel)("key","annee"),l(),N("ngModel",r.timbreModel.annee),s("max",r.maxAnnee)("zMax",r.maxAnnee)("disabled",!!(r.timbreModel!=null&&r.timbreModel.getId())),l(3),s("object",r.timbreModel)("key","timbreBlocModel"),l(2),s("ngModel",r.timbreModel.getTimbreBlocModel())("placeholder","Choix bloc")("disabled",!!(r.timbreModel!=null&&r.timbreModel.getId())||((t=S(15,33,r.timbreBlocService.timbresBlocModel$))==null?null:t.length)<=0),l(2),s("value",null),l(),s("ngForOf",S(18,35,r.timbreBlocService.timbresBlocModel$)),l(2),s("ngIf",r.timbreModel==null||(i=r.timbreModel.getTimbreBlocModel())==null?null:i.getImage()),l(4),s("object",r.timbreModel)("key","type"),l(),N("ngModel",r.timbreModel.type),l(3),s("object",r.timbreModel)("key","monnaie"),l(),N("ngModel",r.timbreModel.monnaie),s("disabled",!!r.timbreModel.getTimbreBlocModel()),l(4),s("object",r.timbreModel)("key","yt"),l(),N("ngModel",r.timbreModel.yt),l(2),s("object",r.timbreModel)("key","image")("zoom",r.timbreModel.getImageZoom())("maxWidth",r.timbreService.widthTimbre)("maxHeight",r.timbreService.heightTimbre)}}var nt=class o{constructor(e,t,i,n,r){this.httpResponseHandlerService=e;this.dialogRef=t;this.timbreService=i;this.timbreBlocService=n;this.utilsService=r}canvas;messageError$=new E(null);load$=new E(null);id;maxAnnee=new Date().getFullYear();timbreModel=new O;fileUploadModel=new it;ngOnInit(){this.initUpload(),this.load$.next(!1),c(this.id)?this.timbreService.getTimbreByIdAsync(this.id).subscribe(e=>{this.timbreModel=e,c(e.getTimbreBlocModel())&&(this.timbreModel.setAnnee(e.getTimbreBlocModel().getAnnee()),this.timbreModel.setMonnaie(e.getTimbreBlocModel().getMonnaie())),this.load$.next(!0)}):(this.timbreModel.setAnnee(new Date().getFullYear()),this.timbreModel.setMonnaie("E"),this.load$.next(!0)),this.changeAnnee(this.timbreModel.getAnnee())}initUpload(){this.fileUploadModel.setDossier("test"),this.fileUploadModel.setNom(new Date().getTime()?.toString());let e=new ve;e.setMaxWidth(this.timbreService.widthTimbre),e.setMaxHeight(this.timbreService.heightTimbre),e.setDossier("autre");let t=new ve;t.setMaxWidth(this.timbreService.widthTimbreZoom),t.setMaxHeight(this.timbreService.heightTimbreZoom),t.setDossier("zoom"),this.fileUploadModel.setDetail([e,t])}valider(e){if(this.messageError$.next(null),e?.valid)if(c(this.timbreModel.getImage()))this.saveData();else{this.messageError$.next("Veuillez s\xE9lectionner une image");return}}saveData(){this.load$.next(!1),c(this.timbreModel.getId())?this.save():this.ajouter()}ajouter(){this.utilsService.getMaxIdentAsync("/timbres").pipe(M()).subscribe(e=>{this.timbreModel.setId(e),this.save(!0)})}save(e){try{z([this.timbreService.upload(this.timbreModel,"autre"),this.timbreService.upload(this.timbreModel,"table"),this.timbreService.upload(this.timbreModel,"zoom")]).pipe(M(([t,i,n])=>c(t)&&c(n)&&c(i))).subscribe(([t,i,n])=>{c(i)&&i!="nok"&&this.timbreModel.setImage(i),c(t)&&t!="nok"&&this.timbreModel.setImageTable(t),c(n)&&n!="nok"&&this.timbreModel.setImageZoom(n),e?this.timbreService.ajouter(this.timbreModel,!0):this.timbreService.modifier(this.timbreModel),this.httpResponseHandlerService.showNotificationSuccess("Transaction termin\xE9e","Votre timbre a bien \xE9t\xE9 modifi\xE9e."),this.load$.next(!0),this.dialogRef.close()})}catch{this.httpResponseHandlerService.showNotificationError("Transaction non aboutie","Votre timbre n'a pas pu \xEAtre modifi\xE9."),this.load$.next(!0)}}close(){this.dialogRef.close()}changeAnnee(e){if(this.timbreModel.setTimbreBlocModel(null),c(e)){let t=new V;t.setAnnees([e]),this.timbreBlocService.getBlocs(t)}}changeBloc(e){c(e)?(this.timbreModel.setIdBloc(e.getId()),this.timbreModel.setTimbreBlocModel(e),this.timbreModel.setMonnaie(e.getMonnaie()),this.timbreModel.setAnnee(e.getAnnee())):(this.timbreModel.setIdBloc(null),this.timbreModel.setTimbreBlocModel(null),this.timbreModel.setMonnaie("E"))}static \u0275fac=function(t){return new(t||o)(B(Ot),B(He),B(k),B(te),B(K))};static \u0275cmp=Q({type:o,selectors:[["app-timbre-modifier"]],viewQuery:function(t,i){if(t&1&&re(vn,5),t&2){let n;le(n=me())&&(i.canvas=n.first)}},decls:9,vars:6,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],["class","accent",4,"ngIf"],[3,"ngIf","ngIfElse"],[1,"accent"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","space-between stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","column","fxLayoutGap","20px",1,"bloc-modal"],[3,"innerHTML",4,"ngIf"],["fxLayout","row","fxLayout.lt-lg","column","fxLayoutGap","30px","fxLayoutGap.lt-lg","5px"],["fxLayout","column",1,"form-input"],[3,"object","key"],["name","page","type","number","minlength","4","maxlength","4","min","1900","zMin","1900","required","","zControl","",1,"annee",2,"width","60px !important",3,"ngModelChange","ngModel","max","zMax","disabled"],["fxLayout","column",1,"form-input","select"],["fxLayout","row","fxLayoutGap","15px"],["name","bloc",2,"width","120px !important",3,"ngModelChange","ngModel","placeholder","disabled"],[1,"selectMin",3,"value"],["class","selectMin",3,"value",4,"ngFor","ngForOf"],["style","max-height: 40px","class","click",3,"src","click",4,"ngIf"],["name","type","type","text","trim","","zControl","",3,"ngModelChange","ngModel"],["name","monnaie","type","text","trim","","minlength","1","maxlength","2","required","","zControl","",2,"width","25px !important",3,"ngModelChange","ngModel","disabled"],["name","yt","type","text","trim","","zControl","",3,"ngModelChange","ngModel"],["fxHide.lt-lg","","fxLayout","column",1,"form-input"],[3,"outPutObject","object","key","zoom","maxWidth","maxHeight"],["fxLayout","row","fxLayoutGap","10px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"],[3,"innerHTML"],[1,"click",2,"max-height","40px",3,"click","src"]],template:function(t,i){if(t&1&&(m(0,"div",2)(1,"div",3)(2,"span"),d(3),a(),b(4,Sn,3,1,"span",4),a(),b(5,yn,1,1,"ng-template",5),v(6,"async"),b(7,En,41,37,"ng-template",null,0,ae),a()),t&2){let n=P(8);l(3),I("",i.timbreModel!=null&&i.timbreModel.getId()?"MODIFICATION":"AJOUT"," "),l(),s("ngIf",i.timbreModel==null?null:i.timbreModel.getId()),l(),s("ngIf",S(6,4,i.load$)==!1)("ngIfElse",n)}},dependencies:[ue,$e,Tt,xt,Be,Ie,Y,se,ce,ge,pe,fe,Re,De,qe,Oe,Ne,he,Le,Pe,Ve,ke,je,Fe,_e,Ue,de,Me,Qe,Lt,Ye,Xe,Ut,G],encapsulation:2})};var Ai=Kt(Ui());var An=()=>[10,20,50,100];function Dn(o,e){if(o&1&&(m(0,"mat-option",34),d(1),a()),o&2){let t=e.$implicit;s("value",t),l(),I(" ",t," ")}}function Rn(o,e){if(o&1){let t=R();m(0,"div",3)(1,"div",32)(2,"mat-select",33),j("ngModelChange",function(n){g(t);let r=p();return F(r.timbreUtilsService.timbreCritereModel.acquis,n)||(r.timbreUtilsService.timbreCritereModel.acquis=n),h(n)}),C("ngModelChange",function(){g(t);let n=p();return h(n.filtreByCritere())}),m(3,"mat-option",34),d(4," Oui"),a(),m(5,"mat-option",34),d(6," Non"),a(),m(7,"mat-option",34),d(8," Tous"),a()()(),m(9,"div",32)(10,"mat-select",35),j("ngModelChange",function(n){g(t);let r=p();return F(r.timbreUtilsService.timbreCritereModel.doublon,n)||(r.timbreUtilsService.timbreCritereModel.doublon=n),h(n)}),C("ngModelChange",function(){g(t);let n=p();return h(n.filtreByCritere())}),m(11,"mat-option",34),d(12," Oui"),a(),m(13,"mat-option",34),d(14," Non"),a(),m(15,"mat-option",34),d(16," Tous"),a()()(),m(17,"div",32)(18,"mat-select",36),j("ngModelChange",function(n){g(t);let r=p();return F(r.timbreUtilsService.timbreCritereModel.carnet,n)||(r.timbreUtilsService.timbreCritereModel.carnet=n),h(n)}),C("ngModelChange",function(){g(t);let n=p();return h(n.filtreByCritere())}),m(19,"mat-option",34),d(20," Oui"),a(),m(21,"mat-option",34),d(22," Non"),a(),m(23,"mat-option",34),d(24," Tous"),a()()(),m(25,"div",32)(26,"mat-select",37),j("ngModelChange",function(n){g(t);let r=p();return F(r.timbreUtilsService.timbreCritereModel.bloc,n)||(r.timbreUtilsService.timbreCritereModel.bloc=n),h(n)}),C("ngModelChange",function(){g(t);let n=p();return h(n.filtreByCritere())}),m(27,"mat-option",34),d(28," Oui"),a(),m(29,"mat-option",34),d(30," Non"),a(),m(31,"mat-option",34),d(32," Tous"),a()()(),m(33,"div",38)(34,"mat-select",39),j("ngModelChange",function(n){g(t);let r=p();return F(r.timbreUtilsService.timbreCritereModel.annees,n)||(r.timbreUtilsService.timbreCritereModel.annees=n),h(n)}),C("ngModelChange",function(){g(t);let n=p();return h(n.filtreByCritere())}),b(35,Dn,2,2,"mat-option",40),v(36,"async"),a()(),m(37,"div",41)(38,"input",42),C("input",function(n){g(t);let r=p();return h(r.applyFilter(n))}),a()(),m(39,"lib-icon",43),C("click",function(){g(t);let n=p();return h(n.exportTable())}),a()()}if(o&2){let t=p();l(2),N("ngModel",t.timbreUtilsService.timbreCritereModel.acquis),s("placeholder","Acquis"),l(),s("value","OUI"),l(2),s("value","NON"),l(2),s("value","TOUS"),l(3),N("ngModel",t.timbreUtilsService.timbreCritereModel.doublon),s("placeholder","Doublon"),l(),s("value","OUI"),l(2),s("value","NON"),l(2),s("value","TOUS"),l(3),N("ngModel",t.timbreUtilsService.timbreCritereModel.carnet),s("placeholder","Carnet"),l(),s("value","OUI"),l(2),s("value","NON"),l(2),s("value","TOUS"),l(3),N("ngModel",t.timbreUtilsService.timbreCritereModel.bloc),s("placeholder","Bloc"),l(),s("value","OUI"),l(2),s("value","NON"),l(2),s("value","TOUS"),l(3),N("ngModel",t.timbreUtilsService.timbreCritereModel.annees),s("placeholder","Ann\xE9es"),l(),s("ngForOf",S(36,26,t.annees$)),l(4),s("type",t.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",t.FontAwesomeEnum.FILE_EXEL)("info","Exporter tableau")}}function On(o,e){if(o&1&&(m(0,"th",44),_(1,"lib-libelle-model",45),a()),o&2){let t=p();l(),s("object",t.timbre)("key","image")}}function Ln(o,e){if(o&1){let t=R();m(0,"img",48),C("click",function(){g(t);let n=p().$implicit,r=p();return h(r.utilsService.zoom(n==null?null:n.getImageZoom()))}),a()}if(o&2){let t=p().$implicit;s("src",t==null?null:t.getImageTable(),rt)}}function Un(o,e){if(o&1&&(m(0,"td",46),b(1,Ln,1,1,"img",47),a()),o&2){let t=e.$implicit;l(),s("ngIf",t==null?null:t.getImageTable())}}function qn(o,e){if(o&1&&(m(0,"th",49),_(1,"lib-libelle-model",50),a()),o&2){let t=p();l(),s("object",t.timbre)("key","id")}}function Nn(o,e){if(o&1&&(m(0,"td",51),d(1),a()),o&2){let t=e.$implicit;l(),I(" ",t==null?null:t.getId()," ")}}function Fn(o,e){if(o&1&&(m(0,"th",49),_(1,"lib-libelle-model",50),a()),o&2){let t=p();l(),s("object",t.timbre)("key","annee")}}function jn(o,e){if(o&1&&d(0),o&2){let t,i=p().$implicit;I(" ",i==null||(t=i.getTimbreBlocModel())==null?null:t.getAnnee()," ")}}function Pn(o,e){if(o&1&&d(0),o&2){let t=p().$implicit;I(" ",t==null?null:t.getAnnee()," ")}}function Vn(o,e){if(o&1&&(m(0,"td",51),b(1,jn,1,1,"ng-template",52)(2,Pn,1,1,"ng-template",null,0,ae),a()),o&2){let t=e.$implicit,i=P(3);l(),s("ngIf",t==null?null:t.getIdBloc())("ngIfElse",i)}}function kn(o,e){if(o&1&&(m(0,"th",53),_(1,"lib-libelle-model",50),a()),o&2){let t=p();l(),s("object",t.timbre)("key","idBloc")}}function $n(o,e){if(o&1){let t=R();m(0,"img",48),C("click",function(){let n;g(t);let r=p(2).$implicit,u=p();return h(u.utilsService.zoom(r==null||(n=r.getTimbreBlocModel())==null?null:n.getImageZoom()))}),a()}if(o&2){let t,i=p(2).$implicit;s("src",i==null||(t=i.getTimbreBlocModel())==null?null:t.getImageTable(),rt)}}function Hn(o,e){if(o&1&&b(0,$n,1,1,"img",47),o&2){let t,i=p().$implicit;s("ngIf",i==null||(t=i.getTimbreBlocModel())==null?null:t.getImage())}}function zn(o,e){o&1&&d(0," Non ")}function Wn(o,e){if(o&1&&(m(0,"td",51),b(1,Hn,1,1,"ng-template",52)(2,zn,1,0,"ng-template",null,0,ae),a()),o&2){let t=e.$implicit,i=P(3);l(),s("ngIf",t==null?null:t.getIdBloc())("ngIfElse",i)}}function Qn(o,e){if(o&1&&(m(0,"th",54),_(1,"lib-libelle-model",50),a()),o&2){let t=p();l(),s("object",t.timbre)("key","monnaie")}}function Gn(o,e){if(o&1&&d(0),o&2){let t,i=p().$implicit;I(" ",(i==null||(t=i.getTimbreBlocModel())==null?null:t.getMonnaie())=="E"?"\u20AC":"Francs"," ")}}function Zn(o,e){if(o&1&&d(0),o&2){let t=p().$implicit;I(" ",(t==null?null:t.getMonnaie())=="E"?"\u20AC":"Francs"," ")}}function Yn(o,e){if(o&1&&(m(0,"td",55),b(1,Gn,1,1,"ng-template",52)(2,Zn,1,1,"ng-template",null,0,ae),a()),o&2){let t=e.$implicit,i=P(3);l(),s("ngIf",t==null?null:t.getIdBloc())("ngIfElse",i)}}function Xn(o,e){if(o&1&&(m(0,"th",54),_(1,"lib-libelle-model",50),a()),o&2){let t=p();l(),s("object",t.timbre)("key","type")}}function Kn(o,e){if(o&1&&(m(0,"td",55),d(1),a()),o&2){let t=e.$implicit;l(),I(" ",t==null?null:t.getType()," ")}}function Jn(o,e){if(o&1&&(m(0,"th",54),_(1,"lib-libelle-model",50),a()),o&2){let t=p();l(),s("object",t.timbre)("key","yt")}}function eo(o,e){if(o&1&&(m(0,"td",55),d(1),a()),o&2){let t=e.$implicit;l(),I(" ",t==null?null:t.getYt()," ")}}function to(o,e){if(o&1&&(m(0,"th",53),_(1,"lib-libelle-model",50),a()),o&2){let t=p();l(),s("object",t.timbre==null?null:t.timbre.getTimbreAcquisModel())("key","acquis")}}function io(o,e){if(o&1){let t=R();m(0,"td",46)(1,"lib-icon",56),C("click",function(){let n=g(t).$implicit,r=p();return h(r.acquis(n))}),a()()}if(o&2){let t,i,n,r=e.$implicit,u=p();l(),s("classIcone",!(r==null||(t=r.getTimbreAcquisModel())==null)&&t.isAcquis()?"accent":"primary")("type",u.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",!(r==null||(i=r.getTimbreAcquisModel())==null)&&i.isAcquis()?u.FontAwesomeEnum.CIRCLE_MINUS:u.FontAwesomeEnum.CIRCLE_PLUS)("info",!(r==null||(n=r.getTimbreAcquisModel())==null)&&n.isAcquis()?"pas acquis":"acquis")}}function no(o,e){if(o&1&&(m(0,"th",53),_(1,"lib-libelle-model",50),a()),o&2){let t=p();l(),s("object",t.timbre==null?null:t.timbre.getTimbreAcquisModel())("key","doublon")}}function oo(o,e){if(o&1){let t=R();m(0,"td",46)(1,"lib-icon",56),C("click",function(){let n=g(t).$implicit,r=p();return h(r.doublon(n))}),a()()}if(o&2){let t,i,n,r=e.$implicit,u=p();l(),s("classIcone",!(r==null||(t=r.getTimbreAcquisModel())==null)&&t.isDoublon()?"accent":"primary")("type",u.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",!(r==null||(i=r.getTimbreAcquisModel())==null)&&i.isDoublon()?u.FontAwesomeEnum.CIRCLE_MINUS:u.FontAwesomeEnum.CIRCLE_PLUS)("info",!(r==null||(n=r.getTimbreAcquisModel())==null)&&n.isDoublon()?"pas en double":"en double")}}function ro(o,e){if(o&1&&(m(0,"th",57),_(1,"lib-icon",58),a()),o&2){let t=p();l(),s("type",t.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",t.FontAwesomeEnum.PENCIL)("info","Modifier")}}function lo(o,e){if(o&1){let t=R();m(0,"td",46)(1,"lib-icon",59),C("click",function(){let n=g(t).$implicit,r=p();return h(r.modifier(n))}),a()()}if(o&2){let t=p();l(),s("type",t.FontAwesomeTypeEnum.TYPE_LIGHT)("icone",t.FontAwesomeEnum.PENCIL)("info","Modifier")}}function mo(o,e){if(o&1&&(m(0,"th",57),_(1,"lib-icon",58),a()),o&2){let t=p();l(),s("type",t.FontAwesomeTypeEnum.TYPE_SOLID)("icone",t.FontAwesomeEnum.TRASH)("info","Supprimer")}}function ao(o,e){if(o&1){let t=R();m(0,"td",46)(1,"lib-icon",59),C("click",function(){let n=g(t).$implicit,r=p();return h(r.supprimer(n))}),a()()}if(o&2){let t=p();l(),s("type",t.FontAwesomeTypeEnum.TYPE_SOLID)("icone",t.FontAwesomeEnum.TRASH)("info","Supprimer")}}function so(o,e){o&1&&_(0,"tr",60)}function co(o,e){o&1&&_(0,"tr",61)}var Ht=class o{constructor(e,t,i,n){this.timbreService=e;this.timbreUtilsService=t;this.dialog=i;this.utilsService=n;this.dataSource=new We([])}paginator;sort;timbres$;total$;modif=!0;load$=new E(!1);dataSource=new We;displayedColumns;timbre=new O;annees$;FontAwesomeEnum=Ae;FontAwesomeTypeEnum=Ee;ngOnInit(){this.annees$=this.timbreUtilsService.getAnneesAsync("/timbres"),this.timbre.setTimbreAcquisModel(new W),this.displayedColumns=["image","id","annee","idBloc","monnaie","type","yt","acquis","doublon"],this.modif&&this.displayedColumns.push("modifier","supprimer"),this.load$.next(!1),this.timbres$.subscribe(e=>{this.dataSource.data=e,this.load$.next(!0)})}ngAfterViewInit(){this.dataSource.paginator=this.paginator}sortData(e){c(e)&&(this.dataSource.sort=this.sort)}filtreByCritere(){this.timbreUtilsService.timbreCritereModel.getCarnet()=="OUI"&&this.timbreUtilsService.timbreCritereModel.setBloc("OUI"),this.timbreUtilsService.timbreCritereModel.getAcquis()=="NON"&&this.timbreUtilsService.timbreCritereModel.setDoublon("TOUS"),this.timbreService.getTimbres(this.timbreUtilsService.timbreCritereModel)}applyFilter(e){let t=e.target.value;this.dataSource.filter=t.trim().toLowerCase()}resume(){let e=this.dialog.open(Vt,{height:"auto",maxHeight:"750px",width:"700px"});e.afterClosed().subscribe(()=>{e.close()})}acquis(e){this.timbreService.acquis(e,!1)}doublon(e){this.timbreService.acquis(e,!0)}modifier(e){let t=this.dialog.open(nt,{height:"75vh",maxHeight:"750px",width:"30%"});t.componentInstance.id=e.getId(),t.afterClosed().subscribe(()=>{t.close()})}supprimer(e){let t=this.dialog.open(Nt,{maxHeight:"95vh",data:{titre:"Confirmation",message:"Souhaitez-vous supprimer le timbre <b>n\xB0 "+e?.getId()+"</b> ?",btnDroite:"Oui",btnGauche:"Non"}});t.afterClosed().subscribe(()=>{t.componentInstance.data.resultat==="valider"&&this.timbreService.supprimer(e)})}exportTable(){let e=qt.json_to_sheet(this.dataSource.data),t=qt.book_new();qt.book_append_sheet(t,e,"Donn\xE9es");let i=Mi(t,{bookType:"xlsx",type:"array"}),n=new Blob([i],{type:"application/octet-stream"});(0,Ai.saveAs)(n,"export_timbres.xlsx")}generatePDFByImage(){let e="https://firebasestorage.googleapis.com/v0/b/book-f941b.appspot.com/o/AF.png?alt=media&token=a1039f78-3cff-41ab-8569-ea1b2cefe2c1";this.generatePDF(null)}generatePDF(e){}static \u0275fac=function(t){return new(t||o)(B(k),B(J),B(ze),B(K))};static \u0275cmp=Q({type:o,selectors:[["app-timbre-resultat"]],viewQuery:function(t,i){if(t&1&&(re(xe,5),re(Te,5)),t&2){let n;le(n=me())&&(i.paginator=n.first),le(n=me())&&(i.sort=n.first)}},inputs:{timbres$:"timbres$",total$:"total$",modif:"modif"},decls:52,vars:23,consts:[["noBloc",""],["fxFlexFill","",3,"fxHide","textSpec"],[3,"fxHide"],["fxLayout","row","fxLayoutAlign","space-between center","fxLayoutGap","15px",2,"height","50px"],["fxLayout","row","fxLayoutAlign","start center","fxLayoutGap","10px",2,"height","50px"],["fxFlex","",2,"font-size","1.2em"],[1,"bold"],[1,"accent","click",2,"font-size","2em",3,"click","icone","type","info","classInfo"],["fxLayout","row","fxLayoutAlign","space-between center","fxLayoutGap","15px","style","height: 50px",4,"ngIf"],["id","pdf-content","mat-table","","matSort","",3,"matSortChange","dataSource"],["matColumnDef","image"],["mat-header-cell","","class","image",4,"matHeaderCellDef"],["mat-cell","","class","alignCenter",4,"matCellDef"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","annee"],["matColumnDef","idBloc"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","monnaie"],["mat-header-cell","","mat-sort-header","","class","hide-on-mobile",4,"matHeaderCellDef"],["mat-cell","","class","hide-on-mobile",4,"matCellDef"],["matColumnDef","type"],["matColumnDef","yt"],["matColumnDef","acquis"],["matColumnDef","doublon"],["matColumnDef","modifier"],["mat-header-cell","","class","alignCenter",4,"matHeaderCellDef"],["matColumnDef","supprimer"],["mat-header-row","","class","bg-primary color-white",4,"matHeaderRowDef"],["mat-row","","class","mat-row",4,"matRowDef","matRowDefColumns"],[3,"pageSize","pageSizeOptions"],["fxLayout","row","fxLayoutAlign","end center",1,"form-input","select",2,"width","100px"],["name","acquis",3,"ngModelChange","ngModel","placeholder"],[1,"selectMin",3,"value"],["name","doublon",1,"scrollBarAccent",3,"ngModelChange","ngModel","placeholder"],["name","carnet",1,"scrollBarAccent",3,"ngModelChange","ngModel","placeholder"],["name","bloc",1,"scrollBarAccent",3,"ngModelChange","ngModel","placeholder"],["fxLayout","row","fxLayoutAlign","end center",1,"form-input","select",2,"width","150px"],["name","anneeSelect","multiple","",3,"ngModelChange","ngModel","placeholder"],["class","selectMin",3,"value",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","end center",1,"form-input",2,"width","200px","min-height","55px","height","55px"],["placeholder","Filtrer les donn\xE9es","type","text",3,"input"],[1,"primary","click",2,"font-size","1.7em",3,"click","type","icone","info"],["mat-header-cell","",1,"image"],[1,"hide-on-mobile",3,"object","key"],["mat-cell","",1,"alignCenter"],["class","image click",3,"src","click",4,"ngIf"],[1,"image","click",3,"click","src"],["mat-header-cell","","mat-sort-header",""],[3,"object","key"],["mat-cell",""],[3,"ngIf","ngIfElse"],["mat-header-cell",""],["mat-header-cell","","mat-sort-header","",1,"hide-on-mobile"],["mat-cell","",1,"hide-on-mobile"],[1,"click",2,"font-size","1.2em",3,"click","classIcone","type","icone","info"],["mat-header-cell","",1,"alignCenter"],[2,"font-size","1.2em",3,"type","icone","info"],[1,"primary","click",2,"font-size","1.2em",3,"click","type","icone","info"],["mat-header-row","",1,"bg-primary","color-white"],["mat-row","",1,"mat-row"]],template:function(t,i){t&1&&(_(0,"lib-spinner",1),v(1,"async"),m(2,"section",2),v(3,"async"),m(4,"div",3)(5,"div",4)(6,"div",5)(7,"span"),d(8,"Nombre de timbres : "),a(),m(9,"span",6),d(10),v(11,"async"),v(12,"async"),a()(),m(13,"lib-icon",7),C("click",function(){return i.resume()}),a()(),b(14,Rn,40,28,"div",8),a(),m(15,"table",9),C("matSortChange",function(r){return i.sortData(r)}),A(16,10),b(17,On,2,2,"th",11)(18,Un,2,1,"td",12),D(),A(19,13),b(20,qn,2,2,"th",14)(21,Nn,2,1,"td",15),D(),A(22,16),b(23,Fn,2,2,"th",14)(24,Vn,4,2,"td",15),D(),A(25,17),b(26,kn,2,2,"th",18)(27,Wn,4,2,"td",15),D(),A(28,19),b(29,Qn,2,2,"th",20)(30,Yn,4,2,"td",21),D(),A(31,22),b(32,Xn,2,2,"th",20)(33,Kn,2,1,"td",21),D(),A(34,23),b(35,Jn,2,2,"th",20)(36,eo,2,1,"td",21),D(),A(37,24),b(38,to,2,2,"th",18)(39,io,2,4,"td",12),D(),A(40,25),b(41,no,2,2,"th",18)(42,oo,2,4,"td",12),D(),A(43,26),b(44,ro,2,3,"th",27)(45,lo,2,3,"td",12),D(),A(46,28),b(47,mo,2,3,"th",27)(48,ao,2,3,"td",12),D(),b(49,so,1,0,"tr",29)(50,co,1,0,"tr",30),a(),_(51,"mat-paginator",31),a()),t&2&&(s("fxHide",S(1,14,i.load$)==!0)("textSpec","Chargement en cours ..."),l(2),s("fxHide",S(3,16,i.load$)==!1),l(8),bt(S(11,18,i.total$)?S(12,20,i.total$):i.dataSource==null||i.dataSource.data==null?null:i.dataSource.data.length),l(3),s("icone",i.FontAwesomeEnum.CHART_LINE_UP)("type",i.FontAwesomeTypeEnum.TYPE_SOLID)("info","D\xE9tail par ann\xE9e")("classInfo","tooltiptextDescription tooltiptextBgWhite widthAuto"),l(),s("ngIf",i.modif),l(),s("dataSource",i.dataSource),l(34),s("matHeaderRowDef",i.displayedColumns),l(),s("matRowDefColumns",i.displayedColumns),l(),s("pageSize",15)("pageSizeOptions",ft(22,An)))},dependencies:[Tt,xt,Ct,St,wt,yt,vt,Et,Bt,It,At,Dt,xe,Te,Mt,Ie,Y,se,ce,ge,pe,fe,Re,he,_e,de,Ge,Me,G],styles:[".mat-row[_ngcontent-%COMP%]{height:35px}.image[_ngcontent-%COMP%]{max-height:30px!important}.mat-column-acquis[_ngcontent-%COMP%], .mat-column-doublon[_ngcontent-%COMP%]{width:60px!important;max-width:60px!important;padding:0!important}.mat-column-ajouter[_ngcontent-%COMP%], .mat-column-modifier[_ngcontent-%COMP%], .mat-column-supprimer[_ngcontent-%COMP%]{width:35px!important;max-width:35px!important;padding:0!important}@media screen and (max-width: 800px){.mat-row[_ngcontent-%COMP%]{height:25px}.image[_ngcontent-%COMP%]{max-height:20px!important}.mat-column-acquis[_ngcontent-%COMP%], .mat-column-doublon[_ngcontent-%COMP%]{width:50px!important;max-width:50px!important;padding:0!important}.mat-column-ajouter[_ngcontent-%COMP%], .mat-column-modifier[_ngcontent-%COMP%], .mat-column-supprimer[_ngcontent-%COMP%]{width:20px!important;max-width:20px!important;padding:0!important}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:0 5px!important}th[_ngcontent-%COMP%], .mat-row[_ngcontent-%COMP%]{font-size:.8em}.mat-column-libelle[_ngcontent-%COMP%],   .mat-column-libelle .mat-sort-header-container{width:40px!important;max-width:40px!important}.mat-column-drapeau[_ngcontent-%COMP%],   .mat-column-drapeau span{width:15px!important;max-width:15px!important}.mat-column-classeur[_ngcontent-%COMP%],   .mat-column-classeur .mat-sort-header-container, .mat-column-page[_ngcontent-%COMP%],   .mat-column-page .mat-sort-header-container{width:15px!important;max-width:15px!important}.mat-column-total[_ngcontent-%COMP%],   .mat-column-total .mat-sort-header-container{width:25px!important;max-width:25px!important}.hide-on-mobile[_ngcontent-%COMP%]{display:none}}"]})};function uo(o,e){if(o&1&&(_(0,"lib-spinner",5),v(1,"async")),o&2){let t=p();s("textSpec",S(1,1,t.messageLoad$))}}function bo(o,e){if(o&1&&(_(0,"mat-error",17),v(1,"async")),o&2){let t=p(2);s("innerHTML",S(1,1,t.messageError$),ye)}}function fo(o,e){if(o&1&&_(0,"app-timbre-resultat",18),o&2){let t=p(2);s("timbres$",t.timbres$)("modif",!1)}}function go(o,e){o&1&&(m(0,"button",19),d(1," Enregistrer "),a())}function ho(o,e){if(o&1){let t=R();m(0,"form",6,1),C("ngSubmit",function(){g(t);let n=P(1),r=p();return h(r.valider(n))}),m(2,"div",7),b(3,bo,2,3,"mat-error",8),v(4,"async"),b(5,fo,1,2,"app-timbre-resultat",9),v(6,"async"),a(),m(7,"div",10)(8,"div",11)(9,"input",12),j("ngModelChange",function(n){g(t);let r=p();return F(r.annee,n)||(r.annee=n),h(n)}),a()(),m(10,"button",13),C("click",function(){g(t);let n=p();return h(n.close())}),d(11," Annuler "),a(),m(12,"input",14),C("change",function(n){g(t);let r=p();return h(r.onFileChange(n))}),a(),m(13,"button",15),C("click",function(){g(t);let n=p();return h(n.triggerFileInput())}),d(14," Choisir un fichier "),a(),b(15,go,2,0,"button",16),v(16,"async"),a()()}if(o&2){let t,i,n=P(1),r=p();s("ngClass",n!=null&&n.submitted?"red-color":"blue-color"),l(3),s("ngIf",S(4,8,r.messageError$)),l(2),s("ngIf",((t=S(6,10,r.timbres$))==null?null:t.length)>0),l(4),N("ngModel",r.annee),s("max",r.maxAnnee)("zMax",r.maxAnnee),l(3),Jt("id",r.idFile),l(3),s("ngIf",((i=S(16,12,r.timbres$))==null?null:i.length)>0)}}var zt=class o{constructor(e,t,i,n,r,u){this.authService=e;this.timbreService=t;this.timbreBlocService=i;this.uploadService=n;this.utilsService=r;this.dialogRef=u}dossier="/assets/images/timbres/";timbres$=new E(null);messageError$=new E(null);messageLoad$=new E("Chargement en cours ...");load$=new E(null);idFile="fileImport";identTimbre=1;identBloc=1;identTimbreAnnee=1;identBlocAnnee=1;timbresModel=[];timbresBlocsModel=[];maxAnnee=new Date().getFullYear();annee=new Date().getFullYear();triggerFileInput(){document.getElementById(this.idFile).click()}onFileChange(e){let t=e.target.files[0];t&&(this.load$.next(!1),this.messageLoad$.next("Chargement en cours ..."),this.saveCsv(t))}saveCsv(e){let t=new FileReader;t.onload=()=>{let i=t.result;this.parseCsv(i)},t.readAsText(e)}parseCsv(e){z([this.utilsService.getMaxIdentAsync("/timbres"),this.utilsService.getMaxIdentAsync("/timbres_bloc"),this.utilsService.getMaxIdentAsync("/timbres",this.annee),this.utilsService.getMaxIdentAsync("/timbres_bloc",this.annee),this.authService.getUser()]).pipe(M(([t,i,n])=>c(n))).subscribe(([t,i,n,r,u])=>{c(t)&&t>1&&(this.identTimbre=t+1),c(i)&&i>1&&(this.identBloc=i+1),c(n)&&n>1&&(this.identTimbreAnnee=n+1),c(r)&&r>1&&(this.identBlocAnnee=r+1),this.timbresModel=[],this.timbres$.next(null),Di.parse(e,{header:!0,skipEmptyLines:!0,complete:f=>{c(f.data)&&f.data?.length>0&&(this.timbresBlocsModel=[],f.data.forEach((y,w)=>{let H=this.setTimbre(y,u);c(H?.getId())&&(this.timbresModel.push(H),this.identTimbre++,this.identTimbreAnnee++),w==f.data.length-1&&(this.timbres$.next(this.timbresModel),this.load$.next(!0))}))},error:f=>{console.error("Erreur lors du parsing du CSV :",f)}})})}setTimbre(e,t){let i=new O,n=e.CODE!="NULL"&&e.CODE!=""?Number(e.CODE):null,r=e.IDENT_BLOC!="NULL"&&e.IDENT_BLOC!=""&&c(e.IDENT_BLOC)?Number(e.IDENT_BLOC):null,u=e.ANNEE!="NULL"&&e.ANNEE!=""?Number(e.ANNEE):null,f=e.MONNAIE!="NULL"&&e.MONNAIE!=""?e.MONNAIE:null;if(u==this.annee){i.setId(this.identTimbre),i.setType(e.TYPE!="NULL"&&e.TYPE!=""?e.TYPE:null),i.setYt(e.YT!="NULL"&&e.YT!=""?e.YT:null),i.setAnnee(u);let y=new W;y.setIdTimbre(i.getId()),y.setIdUser(t.getId()),y.setAcquis(e.ACQUIS=="1"),y.setDoublon(e.DOUBLON=="1"),i.setTimbreAcquisModel(y);let w=this.dossier+u+"/",H="";if(c(r)){if(w+="bloc/"+r,H=w+".png",w+="-",i.setTimbreBlocModel(this.timbresBlocsModel.find(U=>U.getAnnee()==u&&U.idOrigine==r)),ie(i.getTimbreBlocModel())){let U=new q;U.setId(this.identBloc),U.setAnnee(u),U.setMonnaie(f),U.setCarnet(e.CARNET=="1"),U.idOrigine=r;let ot=new ee;ot.setIdBloc(this.identBloc),ot.setIdUser(t.getId()),ot.setAcquis(e.ACQUIS_BLOC=="1"),ot.setDoublon(e.DOUBLON_BLOC=="1"),U.setTimbreBlocAcquisModel(ot),this.uploadService.checkIfImageExists(H).pipe(M()).subscribe(Oi=>{Oi&&(U.setImage(H),U.setImageTable(H),U.setImageZoom(H))}),this.timbresBlocsModel.push(U),i.setTimbreBlocModel(U),this.identBloc++}i.setIdBloc(i.getTimbreBlocModel()?.getId())}else i.setMonnaie(f);w+=n+".png",this.uploadService.checkIfImageExists(w).pipe(M()).subscribe(U=>{U&&(i.setImage(w),i.setImageTable(w),i.setImageZoom(w))})}return i}valider(e){this.messageError$.next(null),e?.valid&&(this.load$.next(!1),this.messageLoad$.next("Import en cours ..."),c(this.timbresBlocsModel)&&this.timbresBlocsModel?.length>0&&this.timbresBlocsModel.forEach((t,i)=>{this.saveBloc(t)}),this.timbres$.pipe(M()).subscribe(t=>{if(c(t)&&t?.length>0)t.forEach((i,n)=>{this.saveTimbre(i,n==t.length-1)});else{this.messageError$.next("Donn\xE9es incorrectes");return}}))}saveBloc(e){z([this.timbreBlocService.upload(e,"autre"),this.timbreBlocService.upload(e,"table"),this.timbreBlocService.upload(e,"zoom")]).pipe(M(([t,i,n])=>c(t)&&c(n)&&c(i))).subscribe(([t,i,n])=>{c(i)&&i!="nok"&&e.setImage(i),c(t)&&t!="nok"&&e.setImageTable(t),c(n)&&n!="nok"&&e.setImageZoom(n),e?.getTimbreBlocAcquisModel()?.isAcquis()&&this.timbreBlocService.addAcquis(e?.getTimbreBlocAcquisModel()?.getIdUser(),e,e?.getTimbreBlocAcquisModel()?.isDoublon()),this.timbreBlocService.ajouter(e,!1)})}saveTimbre(e,t){z([this.timbreService.upload(e,"autre"),this.timbreService.upload(e,"table"),this.timbreService.upload(e,"zoom")]).pipe(M(([i,n,r])=>c(i)&&c(r)&&c(n))).subscribe(([i,n,r])=>{c(n)&&n!="nok"&&e.setImage(n),c(i)&&i!="nok"&&e.setImageTable(i),c(r)&&r!="nok"&&e.setImageZoom(r),e?.getTimbreAcquisModel()?.isAcquis()&&this.timbreService.addAcquis(e?.getTimbreAcquisModel()?.getIdUser(),e,e?.getTimbreAcquisModel()?.isDoublon()),this.timbreService.ajouter(e,t),t&&(this.load$.next(!0),this.close())})}close(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||o)(B(we),B(k),B(te),B(Ze),B(K),B(He))};static \u0275cmp=Q({type:o,selectors:[["app-timbre-importer"]],decls:8,vars:4,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],[3,"ngIf","ngIfElse"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","start stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","column","fxLayoutGap","20px",1,"bloc-modal"],[3,"innerHTML",4,"ngIf"],[3,"timbres$","modif",4,"ngIf"],["fxLayout","row","fxLayoutGap","20px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["fxLayout","column","fxFlex","20","fxLayoutAlign","end end",1,"form-input","noError"],["name","annee","type","number","minlength","4","maxlength","4","min","1900","zMin","1900","required","","zControl","",2,"width","60px !important",3,"ngModelChange","ngModel","max","zMax"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","file","accept",".xls, .xlsx, .csv","hidden","","required","",3,"change","id"],["type","button","mat-raised-button","","color","accent",1,"rounded","large","color-white",3,"click"],["type","submit","class","rounded large color-white","mat-raised-button","","color","accent",4,"ngIf"],[3,"innerHTML"],[3,"timbres$","modif"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"]],template:function(t,i){if(t&1&&(m(0,"div",2)(1,"div",3)(2,"span"),d(3,"TIMBRE IMPORTER"),a()(),b(4,uo,2,3,"ng-template",4),v(5,"async"),b(6,ho,17,14,"ng-template",null,0,ae),a()),t&2){let n=P(7);l(4),s("ngIf",S(5,2,i.load$)==!1)("ngIfElse",n)}},dependencies:[ue,$e,Be,Y,se,ce,ge,pe,fe,De,qe,Oe,Ne,he,Le,Pe,Ve,ke,je,Fe,_e,Ue,de,Qe,Ye,Xe,Ht,G]})};var _o=["canvas"];function xo(o,e){o&1&&_(0,"lib-spinner",5),o&2&&s("textSpec","Chargement en cours ...")}function To(o,e){if(o&1&&(_(0,"mat-error",18),v(1,"async")),o&2){let t=p(2);s("innerHTML",S(1,1,t.messageError$),ye)}}function Mo(o,e){if(o&1){let t=R();m(0,"div",10)(1,"label"),_(2,"lib-libelle-model",11),a(),m(3,"input",19),j("ngModelChange",function(n){g(t);let r=p(2);return F(r.timbreBlocModel.id,n)||(r.timbreBlocModel.id=n),h(n)}),a()()}if(o&2){let t=p(2);l(2),s("object",t.timbreBlocModel)("key","id"),l(),N("ngModel",t.timbreBlocModel.id),s("disabled",!!(t.timbreBlocModel!=null&&t.timbreBlocModel.getId()))}}function Co(o,e){if(o&1){let t=R();m(0,"form",6,1),C("ngSubmit",function(){g(t);let n=P(1),r=p();return h(r.valider(n))}),m(2,"div",7),b(3,To,2,3,"mat-error",8),v(4,"async"),b(5,Mo,4,4,"div",9),m(6,"div",10)(7,"label"),_(8,"lib-libelle-model",11),a(),m(9,"input",12),j("ngModelChange",function(n){g(t);let r=p();return F(r.timbreBlocModel.annee,n)||(r.timbreBlocModel.annee=n),h(n)}),a()(),m(10,"div",10)(11,"label"),_(12,"lib-libelle-model",11),a(),m(13,"input",13),j("ngModelChange",function(n){g(t);let r=p();return F(r.timbreBlocModel.monnaie,n)||(r.timbreBlocModel.monnaie=n),h(n)}),a()(),m(14,"lib-upload",14),C("outPutObject",function(n){g(t);let r=p();return h(r.timbreBlocModel=n)}),a()(),m(15,"div",15)(16,"button",16),C("click",function(){g(t);let n=p();return h(n.close())}),d(17," Annuler "),a(),m(18,"button",17),d(19," Enregistrer "),a()()()}if(o&2){let t=P(1),i=p();s("ngClass",t!=null&&t.submitted?"red-color":"blue-color"),l(3),s("ngIf",S(4,15,i.messageError$)),l(2),s("ngIf",i.timbreBlocModel==null?null:i.timbreBlocModel.getId()),l(3),s("object",i.timbreBlocModel)("key","annee"),l(),N("ngModel",i.timbreBlocModel.annee),s("max",i.maxAnnee)("zMax",i.maxAnnee),l(3),s("object",i.timbreBlocModel)("key","monnaie"),l(),N("ngModel",i.timbreBlocModel.monnaie),l(),s("object",i.timbreBlocModel)("key","image")("maxWidth",i.timbreBlocService.widthTimbre)("maxHeight",i.timbreBlocService.heightTimbre)}}var Wt=class o{constructor(e,t,i,n){this.httpResponseHandlerService=e;this.dialogRef=t;this.utilsService=i;this.timbreBlocService=n}canvas;messageError$=new E(null);load$=new E(null);id;maxAnnee=new Date().getFullYear();timbreBlocModel=new q;fileUploadModel=new it;ngOnInit(){this.initUpload(),this.load$.next(!1),c(this.id)?this.timbreBlocService.getBlocByIdAsync(this.id).subscribe(e=>{this.timbreBlocModel=e,this.load$.next(!0)}):(this.timbreBlocModel.setAnnee(new Date().getFullYear()),this.timbreBlocModel.setMonnaie("E"),this.load$.next(!0))}initUpload(){this.fileUploadModel.setDossier("test"),this.fileUploadModel.setNom(new Date().getTime()?.toString());let e=new ve;e.setMaxWidth(this.timbreBlocService.widthTimbre),e.setMaxHeight(this.timbreBlocService.heightTimbre),e.setDossier("autre");let t=new ve;t.setMaxWidth(this.timbreBlocService.widthTimbreZoom),t.setMaxHeight(this.timbreBlocService.heightTimbreZoom),t.setDossier("zoom"),this.fileUploadModel.setDetail([e,t])}valider(e){if(this.messageError$.next(null),e?.valid)if(c(this.timbreBlocModel.getImage()))this.saveData();else{this.messageError$.next("Veuillez s\xE9lectionner une image");return}}saveData(){this.load$.next(!1),c(this.timbreBlocModel.getId())?this.save():this.ajouter()}ajouter(){this.utilsService.getMaxIdentAsync("/timbres_bloc").pipe(M()).subscribe(e=>{this.timbreBlocModel.setId(e),this.save(!0)})}save(e){try{z([this.timbreBlocService.upload(this.timbreBlocModel,"autre"),this.timbreBlocService.upload(this.timbreBlocModel,"table"),this.timbreBlocService.upload(this.timbreBlocModel,"zoom")]).pipe(M(([t,i,n])=>c(t)&&c(n)&&c(i))).subscribe(([t,i,n])=>{c(i)&&i!="nok"&&this.timbreBlocModel.setImage(i),c(t)&&t!="nok"&&this.timbreBlocModel.setImageTable(t),c(n)&&n!="nok"&&this.timbreBlocModel.setImageZoom(n),e?this.timbreBlocService.ajouter(this.timbreBlocModel,!0):this.timbreBlocService.modifier(this.timbreBlocModel),this.httpResponseHandlerService.showNotificationSuccess("Transaction termin\xE9e","Votre timbre a bien \xE9t\xE9 modifi\xE9e."),this.load$.next(!0),this.dialogRef.close()})}catch{this.httpResponseHandlerService.showNotificationError("Transaction non aboutie","Votre timbre n'a pas pu \xEAtre modifi\xE9."),this.load$.next(!0)}}close(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||o)(B(Ot),B(He),B(K),B(te))};static \u0275cmp=Q({type:o,selectors:[["app-timbre-modifier-bloc"]],viewQuery:function(t,i){if(t&1&&re(_o,5),t&2){let n;le(n=me())&&(i.canvas=n.first)}},decls:10,vars:6,consts:[["load",""],["formModif","ngForm"],["fxFlexFill","","fxLayout","column","fxLayoutAlign","space-between stretch",1,"dialog-modal"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","start center",1,"titre-modal","bg-primary","color-white"],[3,"ngIf","ngIfElse"],["fxFlexFill","",3,"textSpec"],["ngForm","formModif","fxLayoutGap","20px","fxFlex","100","fxLayout","column","fxLayoutAlign","space-between stretch",1,"formulaire-box-elevation",3,"ngSubmit","ngClass"],["fxLayout","column","fxLayoutGap","20px",1,"bloc-modal"],[3,"innerHTML",4,"ngIf"],["fxLayout","column","class","form-input",4,"ngIf"],["fxLayout","column",1,"form-input"],[3,"object","key"],["name","page","type","number","minlength","4","maxlength","4","min","1900","zMin","1900","required","","zControl","",1,"annee",2,"width","60px !important",3,"ngModelChange","ngModel","max","zMax"],["name","monnaie","type","text","trim","","minlength","1","maxlength","2","required","","zControl","",2,"width","25px !important",3,"ngModelChange","ngModel"],[3,"outPutObject","object","key","maxWidth","maxHeight"],["fxLayout","row","fxLayoutGap","10px","fxLayoutAlign","end end",1,"bloc-bouton-modal"],["type","button","mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["type","submit","mat-raised-button","","color","accent",1,"rounded","large","color-white"],[3,"innerHTML"],["name","code","type","text","trim","","upperCase","","noEspace","","required","","zControl","",3,"ngModelChange","ngModel","disabled"]],template:function(t,i){if(t&1&&(m(0,"div",2)(1,"div",3)(2,"span"),d(3),a(),m(4,"span"),d(5),a()(),b(6,xo,1,1,"ng-template",4),v(7,"async"),b(8,Co,20,17,"ng-template",null,0,ae),a()),t&2){let n=P(9);l(3),I("",i.timbreBlocModel!=null&&i.timbreBlocModel.getId()?"MODIFICATION":"AJOUT"," BLOC "),l(2),bt(i.timbreBlocModel==null?null:i.timbreBlocModel.getId()),l(),s("ngIf",S(7,4,i.load$)==!1)("ngIfElse",n)}},dependencies:[ue,$e,Be,Y,se,ce,ge,pe,fe,De,qe,Oe,Ne,he,Le,Pe,Ve,ke,je,Fe,_e,Ue,Me,de,pi,Qe,Lt,Ye,Xe,Ti,Ut,G],encapsulation:2})};var vo=o=>[o];function So(o,e){if(o&1){let t=R();m(0,"lib-icon",2),C("click",function(){g(t);let n=p();return h(n.supprimer())}),a()}if(o&2){let t=p();s("icone",t.FontAwesomeEnum.ROTATE)("type",t.FontAwesomeTypeEnum.TYPE_SOLID)("attribs",ti(5,vo,t.FontAwesomeAttributEnum.SPIN))("info","Supprimer en cours")("classInfo","tooltiptextDescription tooltiptextBgWhite widthAuto")}}function yo(o,e){if(o&1){let t=R();m(0,"lib-icon",3),C("click",function(){g(t);let n=p();return h(n.supprimer())}),a()}if(o&2){let t=p();s("icone",t.FontAwesomeEnum.TRASH)("type",t.FontAwesomeTypeEnum.TYPE_SOLID)("info","Supprimer les timbres")("classInfo","tooltiptextDescription tooltiptextBgWhite widthAuto")}}var Qt=class o{constructor(e,t){this.dialog=e;this.timbreSupprimService=t}FontAwesomeEnum=Ae;FontAwesomeTypeEnum=Ee;FontAwesomeAttributEnum=oi;supprimer(){let e=this.dialog.open(Nt,{maxHeight:"95vh",data:{titre:"Confirmation",message:"Souhaitez-vous supprimer les timbres ?",btnDroite:"Oui",btnGauche:"Non"}});e.afterClosed().subscribe(()=>{e.componentInstance.data.resultat==="valider"&&[{base:"/timbres_acquis",critere:"idTimbre"},{base:"/timbres_bloc_acquis",critere:"idBloc"},{base:"/timbres_bloc",critere:"id"},{base:"/timbres",critere:"id"}].forEach(i=>{this.timbreSupprimService.load$.pipe(M(n=>n==!0)).subscribe(n=>{this.timbreSupprimService.supprimer(i.base,i.critere)})})})}static \u0275fac=function(t){return new(t||o)(B(ze),B(Je))};static \u0275cmp=Q({type:o,selectors:[["app-timbre-supprim-tout"]],decls:4,vars:6,consts:[["class","warn click","style","font-size: 2em",3,"icone","type","attribs","info","classInfo","click",4,"ngIf"],["class","warn click","style","font-size: 2em",3,"icone","type","info","classInfo","click",4,"ngIf"],[1,"warn","click",2,"font-size","2em",3,"click","icone","type","attribs","info","classInfo"],[1,"warn","click",2,"font-size","2em",3,"click","icone","type","info","classInfo"]],template:function(t,i){t&1&&(b(0,So,1,7,"lib-icon",0),v(1,"async"),b(2,yo,1,4,"lib-icon",1),v(3,"async")),t&2&&(s("ngIf",S(1,2,i.timbreSupprimService.load$)==!1),l(2),s("ngIf",S(3,4,i.timbreSupprimService.load$)==!0))},dependencies:[Y,Ge,G],styles:[".mat-row[_ngcontent-%COMP%]{height:35px}.image[_ngcontent-%COMP%]{max-height:30px!important}.mat-column-acquis[_ngcontent-%COMP%], .mat-column-doublon[_ngcontent-%COMP%]{width:60px!important;max-width:60px!important;padding:0!important}.mat-column-ajouter[_ngcontent-%COMP%], .mat-column-modifier[_ngcontent-%COMP%], .mat-column-supprimer[_ngcontent-%COMP%]{width:35px!important;max-width:35px!important;padding:0!important}@media screen and (max-width: 800px){.mat-row[_ngcontent-%COMP%]{height:25px}.image[_ngcontent-%COMP%]{max-height:20px!important}.mat-column-acquis[_ngcontent-%COMP%], .mat-column-doublon[_ngcontent-%COMP%]{width:50px!important;max-width:50px!important;padding:0!important}.mat-column-ajouter[_ngcontent-%COMP%], .mat-column-modifier[_ngcontent-%COMP%], .mat-column-supprimer[_ngcontent-%COMP%]{width:20px!important;max-width:20px!important;padding:0!important}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:0 5px!important}th[_ngcontent-%COMP%], .mat-row[_ngcontent-%COMP%]{font-size:.8em}.mat-column-libelle[_ngcontent-%COMP%],   .mat-column-libelle .mat-sort-header-container{width:40px!important;max-width:40px!important}.mat-column-drapeau[_ngcontent-%COMP%],   .mat-column-drapeau span{width:15px!important;max-width:15px!important}.mat-column-classeur[_ngcontent-%COMP%],   .mat-column-classeur .mat-sort-header-container, .mat-column-page[_ngcontent-%COMP%],   .mat-column-page .mat-sort-header-container{width:15px!important;max-width:15px!important}.mat-column-total[_ngcontent-%COMP%],   .mat-column-total .mat-sort-header-container{width:25px!important;max-width:25px!important}.hide-on-mobile[_ngcontent-%COMP%]{display:none}}"]})};function Io(o,e){if(o&1){let t=R();A(0),m(1,"lib-icon",6),C("click",function(){let n=g(t).$implicit,r=p(2);return h(r.headerService.setRoute(n.getRoute()))}),a(),D()}if(o&2){let t=e.$implicit;l(),s("icone",t==null?null:t.getIcone())("type",t==null?null:t.getType())("info",t==null?null:t.getInfo())("classInfo","tooltiptextDescription tooltiptextBgWhite widthAuto")}}function wo(o,e){if(o&1&&(A(0),b(1,Io,2,4,"ng-container",5),v(2,"async"),D()),o&2){let t=p();l(),s("ngForOf",S(2,1,t.headerService.choixRoutesTimbre$))}}function Eo(o,e){if(o&1){let t=R();m(0,"button",3),C("click",function(){g(t);let n=p();return h(n.ajouter())}),d(1," Ajouter "),a()}}function Ao(o,e){o&1&&(A(0),d(1,"\xA0Bloc"),D())}function Do(o,e){if(o&1){let t=R();m(0,"lib-icon",7),C("click",function(){g(t);let n=p();return h(n.importer())}),a()}if(o&2){let t=p();s("icone",t.FontAwesomeEnum.UPLOAD)("type",t.FontAwesomeTypeEnum.TYPE_SOLID)("info","Importer les timbres")("classInfo","tooltiptextDescription tooltiptextBgWhite widthAuto")}}function Ro(o,e){o&1&&_(0,"app-timbre-supprim-tout")}var Ri=class o{constructor(e,t,i){this.headerService=e;this.timbreService=t;this.dialog=i}FontAwesomeEnum=Ae;RouteEnum=ni;FontAwesomeTypeEnum=Ee;ajouter(){let e=this.dialog.open(nt,{maxHeight:"95vh",width:"30%"});e.afterClosed().subscribe(()=>{e.close()})}ajouterBloc(){let e=this.dialog.open(Wt,{maxHeight:"95vh",width:"30%"});e.afterClosed().subscribe(()=>{e.close()})}ajouterBouchon(){this.timbreService.ajouterSansId(this.timbreService.getBouchon())}importer(){let e=this.dialog.open(zt,{height:"90vh",width:"70%"});e.afterClosed().subscribe(()=>{e.close()})}static \u0275fac=function(t){return new(t||o)(B(ri),B(k),B(ze))};static \u0275cmp=Q({type:o,selectors:[["app-menu"]],decls:13,vars:15,consts:[["fxLayout","row","fxLayoutGap","20px"],[4,"ngIf"],["class","rounded large color-white","mat-raised-button","","color","primary",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",1,"rounded","large","color-white",3,"click"],["class","accent click","style","font-size: 2em",3,"icone","type","info","classInfo","click",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"primary","click",2,"font-size","2em",3,"click","icone","type","info","classInfo"],[1,"accent","click",2,"font-size","2em",3,"click","icone","type","info","classInfo"]],template:function(t,i){if(t&1&&(m(0,"div",0),b(1,wo,3,3,"ng-container",1),v(2,"async"),b(3,Eo,2,0,"button",2),v(4,"async"),m(5,"button",3),C("click",function(){return i.ajouterBloc()}),d(6," Ajouter "),b(7,Ao,2,0,"ng-container",1),v(8,"async"),a(),b(9,Do,1,4,"lib-icon",4),v(10,"async"),b(11,Ro,1,0,"app-timbre-supprim-tout",1),v(12,"async"),a()),t&2){let n;l(),s("ngIf",((n=S(2,5,i.headerService.choixRoutesTimbre$))==null?null:n.length)>0),l(2),s("ngIf",S(4,7,i.headerService.route$)==i.RouteEnum.TIMBRE),l(4),s("ngIf",S(8,9,i.headerService.route$)==i.RouteEnum.TIMBRE),l(2),s("ngIf",S(10,11,i.headerService.route$)==i.RouteEnum.TIMBRE),l(2),s("ngIf",S(12,13,i.headerService.route$)==i.RouteEnum.TIMBRE)}},dependencies:[Ie,Y,se,ce,Ge,ue,Qt,G],encapsulation:2})};export{V as a,q as b,ee as c,J as d,te as e,k as f,Wt as g,jt as h,Vt as i,Ht as j,zt as k,Ri as l,Si as m};
